New Adwind Campaign targets US Petroleum Industrynetskope.com/blog/new-adwind-campaign-targets-us-petroleum-industry-2Abhinav SinghOctober 1, 2019A new campaign spreading the Adwind RAT has been seen in the wild, speciﬁcally targeting the petroleum industry in the US. The samples are relatively new and implement multi-layer obfuscation to try to evade detection. We found multiple RAT samples hosted on the serving domain and spread across multiple directories, all hosted within the last month. We have previously reported the use of this RAT targeting the retail and hospitality industry.The overall functionality of the RAT has remained the same as our previous post: It achieves persistence through registry modiﬁcations, performs process injection to stay under the radar, terminates security services (e.g., ﬁrewall, AV), and steals sensitive data. The major change is in the obfuscation technique, wherein multiple embedded JAR archives are used before unpacking the actual payload. Netskope Threat Protection detects the malware as ByteCode- JAVA.Trojan.Kryptik and Gen:Variant.Application.Agentus.1. This blog post provides an analysis of the new campaign and the new obfuscation techniques. Responsible Disclosure The URLs hosting the Adwind RAT were reported to Westnet on September 9th, 2019. Analysis Detailsurl Adwind Campaign targets US Petroleum Industry - NetskopeWe discovered the new campaign serving the Adwind RAT JAR payload from “members[.]westnet[.]com[.]au/~joeven/”. Westnet is an Australian ISP. The attacker is either a Westnet user or has compromised the account of one or more Westnet users. The same RAT is being hosted by multiple other Westnet users. Some of the recent uploads have multiple ﬁle extensions (*.png.jar.jar) to hide the actual ﬁle-type visibility from the target user. We have listed some of the current upload directories in the Indicators of compromise section. At the time of writing, the links were still active.When the victim executes the payload, there are multiple levels of JAR extractions that occur. Figure 1 below summarizes the execution stages at a high level.Figure 1: Process execution stages involved in Adwind’s infection chain Step 1 The dropped JAR payload executes and creates the parent java process and copies itself into the %User% directory. Once the copy is created, the java thread performs the following three actions:Executes the copy Creates a registry entry in HKCU/CurrentVersion/Run to maintain persistence. Creates WMI scripts in %temp% and launches them. These scripts, shown in Figure 2, disable ﬁrewall and antivirus services.url Adwind Campaign targets US Petroleum Industry - NetskopeFigure 2: WMI scripts created by the ﬁrst stage JAR payload. Step 2 The new JAR dropped in Step 1:Performs AES decryption routine on an embedded object to construct the Step 3 JAR Writes the Step 3 JAR in the %temp% directory and executes it as a new java thread.Figure 3 below shows the decompiled class ﬁles implementing the decryption routine on an object named “_”.Figure 3: Embedded object which decrypts to JAR ﬁle with the JRAT classurl Adwind Campaign targets US Petroleum Industry - NetskopeStep 3 The Step 3 JAR loads the JRAT class. Step 4 This JRAT class is responsible for loading and linking the DLL which contains the major RAT functionality. It then tries connecting to its command and control server at 185[.]205[.]210[.]48. The JRAT class contains multiple levels of obfuscations within itself in order to hide its features and functionality.When we last blogged about it, the RAT was cross-platform and supported Windows, Linux, and Mac. Figure 4 below shows the OS check implemented by JRAT, indicating that the cross- platform support hasn’t changed.Figure 4: JRAT class checking for OS environmentThe core functionalities of the RAT is shown in Figure 4 below. Some of the highlight features include:Capturing webcam images Scanning the hard-drive for ﬁles based on extensions deﬁned in RAT’s conﬁg. Spinning up multiple process threads and performing injection into known legitimate windows processes. Monitoring system status. Encrypting and exﬁltrating the data to its command and control server.url Adwind Campaign targets US Petroleum Industry - NetskopeFigure 5: Netskope Advanced Heuristic dashboard listing key features of the RAT. Conclusion The Adwind RAT is a well-known malware family that has actively been used in multiple campaigns over the last couple of years. The samples we analyzed showed that the VirusTotal detection ratio for the top-level JAR was 5/56 while that of the ﬁnal decrypted JAR was 49/58. These detection ratios indicate that attackers have largely been successful in developing new, innovative obfuscation techniques to evade detection. payloadPages serving the malicious JAR payloadurl Adwind Campaign targets US Petroleum Industry - Netskopehuup://members[.]westnet[.]com[.]au/~mcleodart/huup://members[.]westnet[.]com[.]au/~jbush/huup://members[.]westnet[.]com[.]au/~joeven/huup://members[.]westnet[.]com[.]au/~howrahnurs‐ ery_nbn/URLURLURLURLPages serving the malicious JAR payloadPages serving the malicious JAR payloadPages serving the malicious JAR payloadPages serving the malicious JAR payloadurl 