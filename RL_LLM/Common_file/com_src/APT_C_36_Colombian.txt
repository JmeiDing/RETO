2/19/2019360威胁情报中心|ti.360.net/blog/articles/apt-c-36-continuous-attacks-targeting-colombian-government-institutions-and-corporations-en APT-C-36: Continuous Attacks Targeting Colombian Government Institutions and Corporations 2019-02-18 By 360 Background Since April 2018, an APT group (Blind Eagle, APT-C-36) suspected coming from South America carried out continuous targeted attacks against Colombian government institutions as well as important corporations in ﬁnancial sector, petroleum industry, professional manufacturing, etc. Till this moment, 360 Threat Intelligence Center captured 29 bait documents, 62 Trojan samples and multiple related malicious domains in total. Attackers are targeting Windows platform and aiming at government institutions as well as big companies in Colombia.The ﬁrst sample being captured was in April 2018 and since that we observed a lot more related ones. Attackers like to use spear-ﬁshing email with password protected RAR attachment to avoid being detected by the email gateway. Decryption password is provided in the mail body and inside the attachment it is a MHTML macro based document with the .doc sufﬁx. Its purpose is to implant Imminent backdoor and gain a foothold into the target network which may make the follow up lateral movement easier to implement.After analyzing the last modiﬁed time of the encrypted documents, character set (locale) of the MHTML ﬁles, author names used by attackers, as well as elements like geopolitics in APT attacks, 360 Threat Intelligence Center suspect attackers come from South America and are in the UTC -4 time zone (or adjacent ones). Target and Victim Analysis After performing investigations on the classiﬁed victims, we ﬁnd the attacker targets big companies and government agencies in Colombia. The purpose is to implant Imminent backdoor to gain a foothold into the target network which may make the follow up lateral movement easier to implement. Based upon victims’ backgrounds, the attacker is focusing on strategic-level intelligence and may also have motivations to steal business intelligence and intellectual properties. Spoofed Source and Industry Distribution Based on the statistics of the attack information collected by 360 Threat Intelligence Center, the attacker disguised as Colombian national institutions to attack government agencies, ﬁnancial institutions, large domestic companies and multinational corporation branches in Colombia.Spoofed Source Colombian National Civil RegistryTarget INCI (Colombian National Institute for the Blind)url Directorate of Taxes and CustomsNational Administrative Department of Statistics Colombian National Cyber Police Ofﬁce of the Attorney GeneralColombia Migration360威胁情报中心Ecopetrol (Colombian Petroleum Co.) Hocol (Subsidiary of Ecopetrol) Wheel manufacturer in Colombia (IMSA) Logistics company in Colombia (Almaviva) Bank in Colombia (Banco de Occidente) ATH Columbia Division Bank in Colombia (Banco de Occidente) Sun Chemical Columbia BranchSome malicious domains used by the attacker also masquerade as Colombian government websites. For example, “diangovcomuiscia.com” looks like the ofﬁcial one “muiscia.dian.gov.co” that belongs to the National Directorate of Taxes and Customs.The attacker also forged the company information in the Imminent RAT:Company Information in RAT Company Description Energizer Holdings Inc. Progressive Corporation Simon Property Group Inc Sports Authority Inc Strongeagle, Lda.A healthcare company based in the United States A multinational energy company in the United States American battery manufacturer Auto insurance provider in America A commercial real estate company in America A sports goods retailer in the United States A company related to law suit in PortugalAffected Targets After monitoring and correlating the APT attack, 360 Threat Intelligence Center discovered multiple related emails to attack Colombian government agencies, ﬁnancial institutions and large enterprises. Based upon the above work, we collected the following spear- ﬁshing emails, bait documents and the corresponding victims. EcopetrolInformation and Related Email of the Attacked CorporationEcopetrol, also known as Colombian Petroleum Co. (www.ecopetrol.com.co), is the largest and primary petroleum company in Colombia.url Email Attack Against Ecopetrol360威胁情报中心Related Bait DocumentThe document was disguised as originating from the National Directorate of Taxes and Customs (www.dian.gov.co):Dian Embargo Bancario # 609776.docHocol Petroleum LimitedInformation and Related Email of the Attacked CorporationHocol was founded in 1956. It is a subsidiary of Ecopetrol and offers hydrocarbon exploration and production services.Targeted Email Attack Against HocolRelated Bait DocumentThe attacker pretends to come from the National Directorate of Taxes and Customs:url威胁情报中心estado de cuenta.docLogistics Company (Almaviva)Information and Related Email of the Attacked CorporationAlmaviva is a Colombian logistics company, it optimizes the supply chain through the safe management of processes and tools to ensure the efﬁciency of logistics operations.Targeted Email Attack Against AlmavivaRelated Bait DocumentThe attacker masquerades as the National Administrative Department of Statistics to launch the attack.url威胁情报中心listado de funcionarios autorizados para censo nacional 2018.docFinancial Institution (Banco Agrario)Information and Related Email of the Attacked InstitutionThe Banco Agrario is a Colombian state ﬁnancial institution founded in 1999 to provide banking services in the rural sectors.Targeted Email Attack Against Banco AgrarioRelated Bait DocumentThe bait document was spoofed from the Colombian National Cyber Police (caivirtual.policia.gov.co):url威胁情报中心Reporte fraude desde su dirrecion ip.docWheel Manufacturer (IMSA)Information and Related Email of the Attacked CorporationIMSA is a Colombian company and a leader in wheels.Targeted Email Attack Against IMSARelated Bait DocumentThe mail was disguised from the National Directorate of Taxes and Customs.url威胁情报中心Dian Embargo Bancario # 609776.docBank in Colombia (Banco de Occidente)Information and Related Email of the Attacked BankBanco de Occidente is one of the largest Colombian banks. It is part of the Grupo Aval conglomerate of ﬁnancial services in Colombia.Targeted Email Attack Against Banco de OccidenteRelated Bait DocumentThe bait document was spoofed from the Ofﬁce of the Attorney General (www.ﬁscalia.gov.co):url威胁情报中心Citacion Fiscalia general de la Nacion Proceso 305351T.docATH Columbia DivisionInformation and Related Email of the Attacked CorporationATH is a multinational ﬁnancial institution with a branch in Colombia.Targeted Email Attack Against ATH Columbia BranchRelated Bait DocumentThe attacker pretends to come from the Ofﬁce of the Attorney General (www.ﬁscalia.gov.co):url威胁情报中心Fiscalia proceso 305351T.docSun Chemical Columbia BranchInformation and Related Email of the Attacked CorporationSun Chemical is a multinational chemical company focusing on inks, paint, etc. It also has a branch in Colombia.Targeted Email Attack Against Sun Chemical Columbia BranchRelated Bait DocumentThe bait document was spoofed from the Colombia Migration (www.migracioncolombia.gov.co):url威胁情报中心Proceso Pendiente Migracion Colombia.docByington ColombiaInformation and Related Email of the Attacked CorporationByington Colombia provides business credit management and information solutions. Its business credit information services include business and credit information, commercial collection, and marketing services.Targeted Email Attack Against ByingtonRelated Bait DocumentThe document was disguised as originating from the National Directorate of Taxes and Customs:url威胁情报中心estado de cuenta.docTechnical Details 360 Threat Intelligence Center conducted a detailed analysis of the attack process based on the common attack techniques used by the APT group. The Latest Attack On February 14, 2019, 360 Threat Intelligence Center monitored attacks by the APT group again. The corresponding mail was not found by using the recently captured bait disguised from the Colombian National Civil Registry and attacked the Colombian National When attacking different targets, attackers carefully consider how to spoof the source of the message to make it look more credible. For example, by masquerading the National Civil Registry to attack the Institute for the Blind, pretending to be the Tax and Customs Administration to attack companies with international trade, disguising as the judiciary and immigration authorities against banks and multinational corporation branches located in Colombia.The attacker also carefully constructs the content of the message to appear originating from the forged institution and relating to the target. The following picture shows the translation of the corresponding mail disguised as originating from the judiciary of Colombia to attack the ATH Colombia branch.The email attachment is encrypted and stored in the compressed package, and a decryption password is provided in the mail body to bypass the security detection of the email gateway.url威胁情报中心Decryption password provided in the email After analyzing the mail, we found that the attacker used approaches such as proxy and VPN to hide its IP address when sending emails. So the sender’s real IP has not yet been obtained, only to ﬁgure out that these messages are sent through IDCs in Florida, USA. The Bait Document All of the bait documents are MHTML ones with malicious macro embedded and the .doc sufﬁx to bypass detection. Below is an example of bait document captured by 360 Threat Intelligence Center in February 2019:File Name Registraduria Nacional - Notiﬁcacion cancelacion cedula de ciudadania.doc Forged Source The Colombian National Civil Registryurl威胁情报中心MHTML macro based document with the .doc sufﬁxThe document is disguised from the Colombian National Civil Registry and uses Spanish to prompt the victim to enable the macro code in order to execute the subsequent payload.When the macro code gets executed, it calls the Document_Open function automatically.Function Document_Open ﬁrst calls the Main function to download binary data from hxxp://diangovcomuiscia.com/media/a.jpg and save as %AppData%\1.exe (MD5: by Google:Author This task stops the Google Telemetry Agent, that examines and uploads information about the use and errors of Google solutions when a user logs in to the system.Launch %AppData%\1.exe GoogleUpdateThe relevant code is shown below:url威胁情报中心File Name .NETThe backdoor payload (1.exe) get dropped out is in C# with obfuscation:After deobfuscation you can see “Imminent Monitor” string which may indicate it is related to Imminent Monitor RAT:When get executed, it ﬁrst extracts resource named as "application" and decrypt to a legitimate lzma.dll library:url威胁情报中心Then extract resource named as "_7z", and decompress it with lzma.dll to get the Eazfuscator.NET:After partially removing the obfuscation, it can be seen that the backdoor supports below functions:IDFunctionurl威胁情报中心bDfBqxDCINCfwSAfMnZwspLefnc Host management Network transmission channel management Upload, download, and execute PE ﬁles Support ﬁle thumbnail library Keylogger Malicious function management Mouse button action Host network management Packet header information Browser password recovery Mark remote desktop package Execute script (html, vbs and batch) Windows special folder Startup operation TCP refresh and shutdown Window operations (refresh, maximize, minimize, etc.)url威胁情报中心It is consistent with the descriptions provided on the ofﬁcial website:url威胁情报中心Dynamic DebuggingThe core component will check whether it is located in the %temp%\[appname] directory, otherwise it copies itself to %temp%\[appname]\[appname] and set the ﬁle attribute to hidden.Then launch the copied ﬁle:url威胁情报中心Finally delete the original ﬁle and exit the process:When the copied ﬁle gets executed, it creates the Imminent directory in the %AppData% directory to save the encrypted log, network information and system information. The ﬁle will be uploaded to C2 when related command is received.C2: mentes.publicvm.com:4050TTPs (Tactics, Techniques, and Procedures) 360 Threat Intelligence Center summarized TTPs of the APT group as follows:Attack PlatformColombian government agencies, large domestic corporations, and Colombian branch‐ es of multinational corporations April 2018Remote control of computer device and data exﬁltration EmailMHTML macro based document with the .doc sufﬁxImminent BackdoorDynamic domain nameMediumWindowsurl Tactics360威胁情报中心1.Compromise website in Spanish or register privacy-protected domain to store pay‐ load for delivery; 2.Spear-ﬁshing email with password protected attachment and MHTML macro based document to bypass detection; 3.Disguised as national agencies in Colombia to attack Colombia’s government, ﬁnan‐ cial institutions, large domestic companies or Colombian branches of multinational cor‐ 4.Commercial Trojan Imminent is used to remotely control the target;Attribution After analyzing the last modiﬁed time of the encrypted documents, character set (locale) of the MHTML ﬁles, as well as elements like geopolitics in APT attacks, 360 Threat Intelligence Center suspect attackers are in the UTC -4 time zone (or adjacent ones). The Reliable Last Modiﬁed Time Since RAR will save the modiﬁed time of the ﬁle, the time of the document obtained after decryption is very reliable. Take password protected RAR archive (Registraduria Nacional del Estado Civil -Proceso inicado.rar) as an example, the time after decryption is the same as the left one located in the MHTML meta data (the last modiﬁed time on the right side needs to be reduced by 8 hours since we are in the UTC +8 time zone).By comparing each last modiﬁed time of the RAR archive with the one located in the meta data, we have conﬁdence to say that the time is not spoofed. So it makes sense to perform related statistics of all the bait documents captured. Statistics of the Last Modiﬁed Time All of the last modiﬁed time from the captured bait documents are shown in the table below:UTC+00 02:57url威胁情报中心03:28 23:30From the above we could see that the time never distributed between 05:30 and 12:30, which supposed to be sleep hours. Combining with the fact that most of the activities are between 13:00 and 2:00, we suspect attackers are in the UTC -4 time zone (or adjacent We also performed statistics of timestamps in the dumped PE samples and ﬁgure out they are not far from the one in the bait documents:Last Modiﬁed Time of Bait Document Timestamp in PE Dump 2019/2/11 17:58 2018/12/3 15:30 2018/11/26 18:31 2018/11/15 12:492019/2/14 3:28 2018/12/3 23:26 2018/10/17 22:29 2018/10/17 22:29url威胁情报中心2018/11/8 14:21 2018/10/26 13:49 2018/10/22 17:22 2018/10/12 15:56 2018/10/4 5:17 2018/9/13 13:42 2018/9/9 0:32 2018/9/2 20:53 2018/8/27 15:19 2018/8/6 1:35 2018/8/1 2:57 2018/7/31 1:59 2018/7/30 1:17 2018/7/26 3:28 2018/7/10 4:55 2018/6/19 21:31 2018/6/14 1:15 2018/6/14 1:15 2018/5/29 13:38 2018/5/18 14:22 2018/4/28 12:27 2018/4/25 23:30 2018/4/24 12:50 2018/4/17 15:26 2018/4/6 4:402018/10/17 22:29 2018/10/17 22:29 2018/10/17 22:29 2018/10/17 22:292018/8/27 22:082018/8/27 22:08 2018/8/27 22:08 2018/8/1 11:25 2018/8/1 11:25 2018/8/1 11:25 2018/8/1 11:25 2018/8/27 22:08 2018/7/11 11:472018/5/22 20:11 2018/5/22 20:11 2018/5/22 20:112018/5/22 20:11Language and Charset We also perform statistics on the language and charset of the bait documents (MHTML) and ﬁnd they are created on Western European language environment (Spanish, etc.).url威胁情报中心Charsetwindows-1252Some of the author information are also Spanish.Centro de Servicios JudicialesAttacker Proﬁle Based on the time zone of the attacker, the language being used, and the geopolitical factors of the APT attack, we come up with following ﬁndings:1. The time zone (UTC -4) is related to countries in South America. 2. Most of the countries in South America use Spanish (except Brazil), which matchesthe attacker’s locale and user names in the bait documents.3. APT attack could probably be carried out by neighboring countries. 4. The background of the victims and the duration of the attack indicate the attackerkeeps concerned with strategic-level intelligence for a long time.Above all, 360 Threat Intelligence Center suspect the APT group probably comes from South American countries with government support.url威胁情报中心Bait Document MD5s Registraduria Nacional - Notiﬁcacion cancelacion cedula de ciudadania.doc estado de cuenta.doc inicado.doc Orden de comparendo N\xc2\xb0 5098.doc 2018.docCodigo Tarjeta Exito Regalo.doc fotos.doc Dian su deuda a la fecha.doc credito solicitado.doc comparendo electronico.doc C:\Users\kenneth.ubeda\Desktop\Migracion colombia pro‐ ceso pendiente 509876.doc Reporte fraude desde su dirrecion ip.doc Dian Embargo Prima de Navidad.doc IMPORTANTE IMPORTANT.doc Migracion colombia Proceso pendiente.doc - copia.nono.txt Citacion Fiscalia general de la Nacion Proceso 305351T.doc Fiscalia proceso 305351T.doc BoardingPass.doc ceosas.linkpc.net ceoseguros.comurl威胁情报中心diangovcomuiscia.com ismaboli.com medicosco.publicvm.com mentes.publicvm.comMalicious URL url url url url url url url url Archive MD5s [1].urlﬁce-365- advanced-threat-protection-with-detonation-based-heuristics-and-machine-learning/ [2].url Continuous Attacks Targeting Colombian Government Institutions and Corporations360威胁情报中心url 