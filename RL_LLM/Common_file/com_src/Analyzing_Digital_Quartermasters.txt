Analyzing Digital Quartermasters in Asia – Do Chinese and Indian APTs Have a Shared Supply Chain?anomali.com/blog/analyzing-digital-quartermasters-in-asia-do-chinese-and-indian-apts-have-a-shared-supply-chainAnomali Labs recently analyzed a large number of weaponized RTF phishing files related to APT groups aligned with Chinese and Indian state interests. This analysis has identified a shared object dimension and shared obfuscation methods across weaponized RTF files utilized by the APT groups known as Sidewinder (Indian State Interests), Goblin Panda/Conimes (Chinese State Interests), Temp.Periscope/ APT40 / Leviathan (Chinese State Interests), and Temp.Trident / Dagger Panda & Nomad Panda / Icefog (Chinese State Interests). Both unique object dimensions and multiple shared obfuscation methods are visible in the RTF files which appear to be artifacts of a shared RTF phishing weaponizer. In addition to shared RTF properties, a distinct pattern of post-exploitation TTP’s is shared between the APT groups aligned with China, whereas a unique post-exploitation execution chain can be seen in Sidewinder APT campaigns. The use of a common RTF phishing weaponizer alongside distinct post-exploitation TTPs introduces the possibility that Chinese and Indian APTs may have an overlapping supply chain for the acquisition of exploits and phishing weaponizers. However, after these tools are acquired a distinct and complex network of APT digital quartermasters may determine how these tools are equipped with payloads and deployed in distinct operations.Using Object Dimensions to Track RTF Phishing WeaponizersRTF files are among the most popular file formats used in phishing attacks today. To create a weaponized RTF file capable of exploiting a common vulnerability exploit (“CVE”), RTF weaponizers are often used which consist of a script that injects a malicious RTF object into a pre-crafted RTF phishing document. The resulting weaponized exploit file can then be attached to a phishing email and sent to a victim. When RTF weaponizers are acquired or purchased, it is common for operators to change aspects of the weaponizer payload which occurs after initial CVE exploitation. However, it is less common for operators to change the object header and dimensions within the RTF Weaponizer, resulting in shared unique object dimensions across weaponized exploits created by adversaries. Object dimensions are represented in the RTF strings as “\objhN” for height and “\objwN” for width. Analysts can identify related samples with matching unique object dimensions by hunting for samples with object dimensions sharing these properties.RTF 1.14 SpecificationAnomali Labs identified a unique object dimension present in RTF phishing files weaponized with CVE-2017-11882 and CVE-2018-0802 which appear to be utilized by numerous Asian APT groups. The identified RTFs all share a unique object height and width, which determine how the object will be rendered in Microsoft Word. Specifically the object dimensions “objw2180\objh300” are present in the RTF files and have been observed in phishing files linked to the APT groups Sidewinder, Goblin Panda, Temp.Periscope, and Temp.Trident.Additionally, object data present in the RTF files were shared between a number of samples utilized by these groups. There are multiple RTF obfuscation strings constant among these samples which is a byproduct of the obfuscation utilized by the RTF Weaponizer. This shared obfuscation output enforces the likelihood of this phishing weaponizer being utilized by multiple actors and possibly originating from an overlapping supply chain.11/61 It is worth noting that similarities between Sidewinder and Goblin Panda RTFs have historically been identified by security researchers . Additionally, the VietTimes in August 2018 wrote of a targeted attack against a number of Vietnamese State Agencies in Da Nang, Vietnam that 2 were identified during an investigation into Sidewinder APT activity. This activity was later attributed to the Goblin Panda / Conimes group .Distinct Execution TechniquesDespite all identified APT samples sharing unique RTF object dimensions and obfuscation methods, two distinct methods covered at length below for executing payloads were found. The Sidewinder APT downloads and executes a payload via an HTA file and the three clusters of Chinese APT activity drop shellcode via an OLE package which pulls down a source file for payload execution.The Sidewinder APT has historically targeted organizations linked to the Pakistani Military and is believed by security researchers to be an actor associated with Indian espionage interests possibly operating as a contractor in the space. Sidewinder has conducted campaigns targeting Windows and Android-based systems. Their use of weaponized RTF files with unique object dimensions in phishing campaigns rely on the successful exploitation of CVE-2017-11882 in which the opened RTF file downloads and executes HTA files on the victim’s machine . Primarily English language phishing files that invoke topics involving the military borders of India, China, and Pakistan are weaponized and require execution by the victim to pull down additional files including a malicious .hta. Once the .hta has been downloaded from a C2 domain and executed, the 4 powershell payload contained in the .hta file can then be executed on a victim’s system .36Alternatively, three distinct clusters of Chinese APT activity have been observed utilizing these RTF files sharing unique object dimensions. Goblin Panda / Conimes has historically targeted Vietnam utilizing RTF phishing attachments delivering a payload identified as “QCRat” . Temp.Periscope / APT40 / Leviathan has historically targeted U.S. and international institutions associated with naval and maritime issues affecting the South China Sea while supporting the theft of intellectual property . Temp.Trident / Dagger Panda & Nomad Panda / Icefog have historically targeted the Mongolia region (Dagger Panda) alongside Russian and Central Asia (Nomad Panda) likely as part of economic espionage efforts in support of the Belt and Road Initiative . Versions of the custom payload Fucobha have been identified as part of these campaigns, which was first identified in 2013 . In addition to these distinct APTs using a common RTF weaponizer, they share a common post-exploitation execution technique. Rather than downloading and executing a malicious file, the RTF document drops and executes shellcode via an OLE package that then drops a distinctive source file to execute a payload. This method has been identified earlier by security analysts . Anomali Labs identified the presence of the unique object dimension "objw871\\objh811\\objscalex8\\objscaley8” in RTF files involved with this post-exploitation method. This object dimension can be used to identify multiple malicious RTF files attributed to Chinese APT groups. The presence of both a shared phishing weaponizer and a shared post-exploitation execution technique between these groups is indicative of a noteworthy tool and TTP overlap. This overlap indicates that these APT groups may be part of a shared supply chain which receives tools for phishing exploitation from a shared Digital Quartermaster.5789ActorGoblin Panda a.k.a. ConimesTargetingPotential MotivationMethodologyUnique ToolsVietnam and Southeast AsiaEspionage aligned with commercial and South China Sea issuesRTF Phishing followed by shellcode executed via an OLE package dropping distinctive source fileQCRat PayloadTemp.Periscope a.k.a APT40 a.k.a LeviathanU.S. Defense; Maritime; Academic Institutions; International & Political organizationsIntellectual property theft and military espionageRTF Phishing followed by shellcode executed via an OLE package dropping distinctive source fileDADBOD MURKYTOPMongolia and Central AsiaEconomic espionage for Belt & Road InitiativeRTF Phishing followed by shellcode executed via an OLE package dropping distinctive source fileFucobha a.k.a Temp.Trident document matching these identified object dimensions and using the Chinese post-exploitation execution technique contains a last modified date of November 18, 2017. Two samples attributed to Temp.Periscope contain last modified dates from 2007 that appear to be manipulated and therefore cannot be accurately dated based on this information. The first identified RTF samples can be attributed to Temp.Periscope with Goblin Panda later beginning to utilize these RTF files in phishing campaigns circa January 2018. Temp.Trident appears to have begun using these RTF files in late February 2018 based on publicly available samples. Notably the Sidewinder APT RTF phishing samples were observed in the wild subsequent to use by Chinese APT groups with samples not observed until April 4, 2018 based on last modified dates of public samples. Most recently a sample was identified in October 2018.While CVE-2017-11882 was the primary RTF exploit observed between November 2017 and September 2018, a shift in TTPs was observed with an updated weaponizer targeting CVE-2018-0802. Subsequent to October 23, 2018. RTF phishing files attributed to Chinese APT groups and containing these unique object dimensions shifted their TTPs to target this new CVE. The targeted vulnerability is highly similar to CVE-2017-11882 and proof of concepts have been released which effectively target both vulnerabilities with minimal changes to the exploit code. No Sidewinder APT samples targeting CVE-2018-0802 were publicly identified at the time of analysis.2/6Conclusion: Are Exploits Being Traded from the Royal Road or Imperial Highway?The presence of unique RTF object dimensions, object data strings indicative of shared obfuscation methods, and shared post-exploitation TTP’s amongst Chinese APT groups indicate that a shared RTF phishing weaponizer may be in use by multiple adversaries in the APAC region. The constancy of the object dimensions and object data across APT groups, despite weaponzier updates targeting new CVE’s, reinforces the shared nature of this tool. The distribution of a shared weaponizer for phishing is consistent with historic reporting regarding the Goblin Panda APT that previously utilized a shared phishing weaponizer for CVE-2012-0158. Additionally, the practice of utilizing a shared Digital Quartermaster and phishing builder was previously observed across Chinese APT campaigns unrelated to these actors as early as 2013. This provides a historic precedent for tool sharing of this kind . The shared post-exploitation methods used by Temp.Periscope, Temp.Trident, and Goblin Panda, when examined in context of this shared RTF phishing weaponizer, supports a conclusion that these APTs may share a common supply chain and Digital Quartermaster.10Alternatively, analysis indicating this RTF phishing weaponizer overlaps with the otherwise unrelated Sidewinder APT campaigns raises a larger question about tool acquisition by APTs in the APAC region. Although not confirmed at this time, this occurrence could indicate that Indian & Chinese APT groups are using an overlapping supply chain for exploits. Similar supply chains have been known to consist of an ecosystem of underground exploit brokers and weaponizer developers providing tools to an exclusive list of clientele. However, despite the apparent overlap, this analysis has not determined if this RTF weaponizer originated in India, in China, or elsewhere. Publicly observed samples indicate that tool adoption was first seen by the Chinese group Temp.Periscope, with Goblin Panda, and Temp.Trident following suit prior to usage by the Sidewinder APT. While it is possible that this temporal adoption may indicate context about the weaponizer’s origin, unlike the ancient trading roads that have historically connected India and China, the current exchange of offensive cyber tools remains opaque. Further research is necessary at this time to substantiate the possibility of an active shared APT supply chain in the APAC region.Anomali Labs has developed the following Yara signatures that can be used to identify RTF samples containing the object dimensions consistent with APT phishing activity:YARA RULESrule RTF_weaponizer_objh300{ version = "1.0" date = "2018-11-13" Bulletin = "url" description = "Rule to detect Malicious RTF based on object dimension "strings:$S1= "objw2180\\objh300" $RTF= "{\\rt"condition:$RTF at 0 and $S1 }3/6rule RTF_Malicous_Object{ version = "1.0" date = "2018-11-13" Bulletin = "url" description = "Rule to detect Malicious RTF based on object dimension "strings:$S1= "objw871\\objh811\\objscalex8\\objscaley8" $RTF= "{\\rt"condition:$RTF at 0 and $S1 }HashActorCVEExploitRTF Object Contentsobjw2180\objh300{\*\objclass Equation.3} {\*\objdata 01050000020000000B0000004571756174objw2180\objh300{\*\objclass Equation.3} {\*\objdata 01050000020000000B0000004571756174objw2180\objh300{\*\objclass Equation.3} {\*\objdata 01050000020000000B0000004571756174objw2180\objh300{\*\objclass Equation.3} {\*\objdata 01050000020000000B0000004571756174objw2180\objh300{\*\objclass Equation.3} {\*\objdata 01050000020000000B0000004571756174objw2180\objh300{\*\objclass Equation.3} {\*\objdata 01050000020000000B0000004571756174objw2180\objh300{\*\objclass Equation.3} {\*\objdata 01050000020000000B0000004571756174objw2180\objh300{\*\objclass Equation.3} {\*\objdata 01050000020000000B0000004571756174objw2180\objh300{\*\objclass Equation.3} {\*\objdata 01050000020000000B0000004571756174objw2180\objh300{\*\objclass Equation.3} Date2007:01:30 09:12:002007:01:30 09:12:002017-11- 18 21:52:00'2017:12:08 00:50:002017:12:08 06:29:002018:01:10 09:47:002018:01:15 14:47:002018:01:16 11:32:002018:01:17 09:09:002018:01:31 11:24:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:02:22 20:08:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:02:22 20:08:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:02:22 V1Temp.Periscope CVE- V1Temp.Periscope CVE- V1Temp.Periscope CVE- V1Temp.Periscope CVE- V1Temp.Periscope CVE- PandaConimes/Goblin QCrat)Conimes/Goblin PandaConimes/Goblin 0802objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:02:22 20:08:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:03:07 11:22:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:03:14 17:34:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:03:27 09:30:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:03:27 09:30:00objw2180\objh300{\objdata 554567{{\*\objdata 1389E614020000000B0000004571756174696F6E22018:04:04 08:54:00'objw2180\objh300{\objdata 554567{{\*\objdata 1389E614020000000B0000004571756174696F6E22018:04:05 10:32:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:04:22 11:39:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:04:22 11:40:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:04:23 01:01:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:08:19 18:12:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:08:23 08:28:00objw2180\objh300{\objdata 554567{\*\objdata 01050000020000000B0000004571756174696F6E2E2018:08:23 08:28:00objw2180\objh300{\objdata 554567{\*\objdata 09:08:00objw2180\objh300{\objdata 554567{\*\objdata 15:42:00objw2180\objh300{\objdata 554567{\*\objdata 09:56:00objw2180\objh300{\objdata 554567{\*\objdata 10:43:00objw2180\objh300{\objdata 554567{\*\objdata 09:22:00objw2180\objh300{\objdata 554567{\*\objdata 04:37:00objw2180\objh300{\objdata 554567{\*\objdata that Runs CalcConimes/Goblin 0802\objdata 554567{{\*\objdata 1389E614020000000B0000004571756174696F6E2N/A\*\objclass Equation.3}{\*\objdata 02:38:36'objw2180\objh300{\objdata 554567{\*\objdata 09:26:00'1 url url url url url execution-side-loading/; url 5bc1a7e7c84c5 url url url - Nomad Panda / Temp.Trident Samples8 url url the AuthorAnomali Labs6/6 