ACTORS’ TOOLSTURN INTO THREATTA505 and other Threat Actors targeting US retailers and financial organizations inEurope, APAC and LATAM1TABLE OF CONTENTSEXECUTIVE SUMMARY‘TA505’ GROUP PROFILERECENT CAMPAIGNSREMOTE MANIPULATOR SYSTEM (RMS)INDICATORS OF COMPROMISE (IOC)APPENDIX A: POTENTIAL C2 DOMAINS3561523312LEGIT REMOTE ADMIN TOOLS TURN INTO THREAT ACTORS’ TOOLSEXECUTIVE SUMMARYExploring the current global trend of increasing threat actors’ sophistication, CyberInt researchers have been tracking various activities following the spear-phishing campaign targeting large US-based retailers detected in December 2018. The research focused on scenarios with the same tactics, techniques and procedures (TTP) along with the repeated nefarious use of a ‘legitimate’ remote administration tool ‘Remote Manipulator System’ (RMS), developed by a Russian- based company ‘TektonIT’.Based on this continued analysis, an additional campaign targeting financial institutions in Chile, India, Italy, Malawi, Pakistan and South Korea was identified as previously conducted during December 2018. Given the use of specific malware, it is with high certainty attributed to the financially-motivated threat actor group ‘TA505’.Whilst TA505 are almost certainly responsible for several of these recent campaigns, broader analysis of the TTP employed indicates that multiple threat actors are conducting similar operations against a variety of victims,This report contains key research findings on the following issues: Recent attacks against global retailers and financial institutions (ongoing since December 2018) attributed to TA505, a suspected Russian speaking threat group:• Group motives – financial benefits overpolitical backing• Group activities since 2014, incl. distribution of high-volume malicious email campaigns, including the distribution of the “Dridex” and “Shifu” banking trojans as well as the Neutrino botnet/exploit kit and Locky ransomware• Attacks against financial institutions in Chile, India, Italy, Malawi, Pakistan and South Korea • Attacks against retailers in the United StatesCampaign Modus Operandi•Leverage of legitimate software – remote administration tool – to gain entry into networks and evade traditional security controls Delivered via phishing emails containing malicious MS office documents and leveraging social engineering3especially with the use of RMS. Whilst sophisticated and organized cybercriminal threat actors, such as TA505, are successfully conducting large scale campaigns against high-value targets using these tried-and-tested TTP, Russian-language forum discussions and tutorials provide detail to unsophisticated and disparate threat actors that could enable them to package and deliver the same threats. As such, numerous recent campaigns observed as deploying the RMS tool cannot all be attributed to the same threat actor and may be serving a variety of objectives.Organized cybercriminal groups, and many less- organized threat actors, utilising these TTPs are likely financially motivated, seeking access to systems from which valuable data can be stolen or on which they can perform fraudulent financial transactions.In order to achieve these goals, threat actors appear to be utilising remote administration tools to directly perform this activity as well as leveraging the tool’s capabilities to conduct reconnaissance and lateral movement within a victim network. Given the capabilities of the remote administration tool and the accessibility of information on how to conduct malicious operations, ‘lone-wolf’ threat actors and groups with differing objectives or motivations may be utilising the same toolsets and TTPs for general malevolence or mischief.Tried and tested attack patterns appear to be consistent across these recently observed campaigns and commence with the delivery of phishing emails that have lure document attachments. Utilising legitimate logos, language and terminology consistent with common business interactions or the target organization, the email encourages the potential victim to open the lureCyberInt researches have been tracking various activities following the spear-phishing campaign targeting large US-based retailers detected in December 2018.document attachment which in turn instructs them to disable security controls within Microsoft Office to allow a nefarious macro to be executed.The macro, if executed, subsequently attempts to download malicious payloads from the threat actor’s C2 infrastructure that in most cases also masquerades as, or mimics, legitimate-looking domains such as using names and misspellings related to ‘Cloud’, ‘Microsoft Office 365’ or ‘Security’.Typically, the initial payload will be a more robust malware downloader that is used to gather further components including a remote access trojan (RAT), in many cases the legitimate remote administration tool ‘RMS’, as well as supporting shell scripts (BAT) and configuration files.Given continued activity sharing the same or similar TTP, this report provides an overview of the recent observations along with detailing the capabilities of the legitimate remote administration tool ‘RMS’ and associated indicators of compromise (IOC).4LEGIT REMOTE ADMIN TOOLS TURN INTO THREAT ACTORS’ TOOLS‘TA505’ Group ProfileThe sophisticated threat actor group dubbed ‘TA505’ are financially- motivated and have been attributed to high-volume malicious email campaigns since 2014 including the distribution of the ‘Dridex’ and ‘Shifu’ banking trojans as well as the Neutrino botnet/exploit kit and Locky ransomware. Following the decline in the popularity of ransomware, likely due to mitigation tactics employed by organizations and victims lacking confidence in data restoration following payment, TA505 were observed as returning to tried and tested payloads such as information stealing backdoors and remote access trojans (RAT) that are delivered using downloaders and weaponised Microsoft Office files. Subsequently TA505 were observed in November 2018 as deploying a threat known as ‘ServHelper’ of which there are reported two variants, one which provides remote desktop capabilities via a reverse-SSH tunnel and anotherwhich primarily acts as a downloader, presumably to allow additional malicious payloads to be installed on the victim system. Notably, recent TA505 attributed campaigns include the use of the ‘Remote Manipulator System’ (RMS), an off-the-shelf commercial remote administration tool, as observed in the December 2018 campaigns against US-based retailers as well as targeting the financial industry between December 2018 and February 2019. Furthermore, indicators of compromise identified in this US retail campaign are consistent with an attack against the Notary Chamber of Ukraine (Нотаріальна палата України), also during December 2018. Whilst the cryptographic hashes and payload filenames deployed in both December 2018 campaigns were identical, the Ukrainian attacks cannot necessarily be attributed to TA505 as other groups may be utilising similar TTP along with the commercial tool.5RECENT CAMPAIGNS US RETAIL ATTACKSIn mid-December 2018 a spear-phishing campaign was detected as targeting large US-based retailers along with organizations in the food and beverage industry. Masquerading as a legitimate communication sent from a Ricoh printer, the initial email lured victims into opening an attached malicious Microsoft Word document. Lure Document/Downloader Once opened, the lure document (Figure 1) encourages the victim to disable Microsoft Office’s security features as well as including the target organization logo to appear authentic.You've got a new messageClick Enable editing button from the yellow bar aboveOnce You have enabled editing, please click Enable Content button from the yellow bar aboveThis document is only avalible for desktop or laptop version of Microsoft Office WordFigure 1 – Lure documentOnce editing has been enabled within the document, a Visual Basic for Applications (VBA) macro is executed that will download an additional payload from the threat actor’s command and control (C2) infrastructure, using the Microsoft Windows Installer (Figure 2).Figure 2 – Payload download using MSIExecThe remote payload to install is specified by passing the URL to the ‘/i’ command line option whilst the quiet ‘/q’ option ensures that the installation is performed in the background without displaying user interface (UI) elements to the victim. Additionally, three variables are provided, ‘step’, ‘done’ and ‘change’ that, along with their corresponding values, would be passed to the installation package to influence or modify the installation. Presumably to thwart detection or casual analysis, the VBA macro code has some code obfuscation with class and module attributes being used to store values (Figure 3) that are later referenced (Figure 4).6Figure 3 – Form ‘Tag’ attribute value holding the MSIExec parameters (download URL)Figure 4 – Referencing the ‘Tag’ attributePotentially remaining from previous versions of this VBA macro, artefacts include code comments that appear to be variable assignments referencing ‘Temp\scype0’, a potential file path and misspelling of ‘Skype’ (Figure 5), as well as a seemingly unreferenced IP logging service ‘hxxps://iplogger.org/6vfgP’ that provides logs detail of any IP address accessing the URL (Figure 6).Figure 5 – Code artefactsThe use of this IP logging service provides a useful insight into those that have executed the weaponised document with details of the visitor’s, or more aptly victim’s, IP address, operating system, browser and geolocation being available to the threat actor through a statistics page accessible via a specific link combined with their ‘IPLogger ID’.Figure 6 – ‘IPLogger.org’ statistics7INSTALLATION Having downloaded the MSI installation package, the MSIExec installation process executes without user interaction (Figure 7) and extracts the payload components.Reboot#1#168winserv.exeChild ProcessSample Start#1msiexec.exeRPC Server#2msiexec.exeChild Process#7msi2adc.tmpChild ProcessChild Process#8exit.exeChild Process#9cmd.exe#10ping.exe#11ping.exe#15reg.exeFigure 7 – Execution flowChild Process#127zinstall.exeChild ProcessChild Process#13exit.exe#14cmd.exeHaving dropped a binary file to disk, ‘%SystemRoot%\installer\msi2adc.tmp’, the RAT executable ‘exit.exe’, self-extracting archive ‘syst.dll’ and shell script ‘i.cmd’ are extracted to the ‘%TEMP%’ directory. Subsequently, ‘exit.exe’ is launched and spawns the command-line interpreter ‘cmd.exe’ which in turn executes the ‘i.cmd’ shell script (Figure 8).#16winserv.exe#24winserv.exeHaving extracted the contents of the self- extracting archive to ‘%PROGRAMDATA%\ Microtik’, a second copy of the ‘exit.exe’ file is present along with a legitimate signed Remote Manipulator System (RMS) executable ‘winserv. exe’, RMS configuration file ‘settings.dat’ and a different ‘i.cmd’ shell script. The final stage of the self-extraction process launches ‘exit.exe’ (Figure 9) which in turn spawns another command-line interpreter ‘cmd.exe’ to execute the new ‘i.cmd’ shell script (Figure 10).Figure 8 – First-stage shell script The use of the ping command (lines 2 and 4) sends three echo requests to the legitimate domain ‘cloudflare.com’, with the timeout value set to 3,000 milliseconds, and potentially acts as both a connectivity test and a pause between steps. Assuming the ping process exits without error, indicated by the ‘%ERRORLEVEL%’ not being equal to one, the dropped self-extracting archive file ‘syst. dll’ is first renamed as ‘7zinstall.exe’ (line 3) and then executed (line 5). The self-extracting archive is extracted, as specified by the ‘x’ option, using the password provided after the ‘-p’ switch whilst the ‘-y’ switch suppresses any potential user interaction by assuming ‘yes’ to any query or prompt.Remote Manipulator System (RMS)Figure 9 – ‘exit.exe’ process execution8Figure 10 – Second-stage shell script For persistence, the second-stage shell script (line 2) adds a ‘Microtik’ string value to the ‘HKEY_ CURRENT_USERS’ hive, ‘Windows\CurrentVersion’Run’ key (Figure 11) to launch the RMS executable whenever the user logs on.Figure 11 – Persistence registry keyAdditionally, the RMS executable is launched (line 3) before the script tries to forcefully kill the ‘rundll32.exe’ process, causing the script to go into a loop. Finally, the RMS executable attempts to ‘call home’ with connection attempts being observed, at Pivoting on the indicators observed in this campaign identify additional malicious samples and associated C2 domains/IP addresses that, in addition to identifying a pattern of activity, link this observed activity to TA505 operations utilising the ‘ServHelper’ backdoor.FINANCIAL INDUSTRY ATTACKS WITH SERVHELPERPivoting on indicators and behaviours observed in the US-based retail attacks and TA505 activity, a campaign targeting financial organizations was identified as active between December 2018 and March 2019. Based on the email and document lures detected thus far, this campaign has targeted financial institutions in Chile, India, Italy, Malawi, Pakistan and South Korea at least,with similar sample submissions originating from China, Great Britain, France and the United States potentially indicating a more widespread campaign. Utilising somewhat minimal email lures (Figure 12/Figure 13/Figure 14), often purporting to relate to payments, victims are enticed into opening the attached weaponised Microsoft Excel spreadsheet.9Figure 12 – Example email lure ‘pending payments’Figure 13 – Example email lure ‘DLR payments’Figure 14 – Example email lure 'detalle de referencia'10Figure 15 – Lure spreadsheet (English)Figure 16 – Lure spreadsheet (Italian)Figure 17 – Lure spreadsheet (Korean)Unlike the US-based retail campaign, the spreadsheet lure does not contain VBA macros and instead spawns a Microsoft Windows Installer process (Figure 18) to download an additional payload from the threat actor’s command and control (C2) infrastructure.Sample Start#1excel.exeChild Process#2msiexec.exeChild Process#3msiexec.exeFigure 18 – Execution flow11This behaviour is consistent with other TA505 campaigns utilising a combination of weaponised Microsoft Office files containing either VBA macros or exploit code to spawn additional processes. Of the spreadsheet lures analysed in this campaign, four different C2 servers and payloads were identified, with each likely being unique to a specific target organization or victim cluster (Figure 19).Figure 19 – Payload download using MSIExecIn addition to specifying the remote package to install, using the ‘/i’ command line option, the quiet ‘/q’ option ensures that the installation is performed in the background without displaying any user interface (UI) elements to the victim. Additionally, variables are passed to the installation package with ‘OnLoad’ being present in all cases along with either ‘serf’ and ‘done’ or ‘val’ and ‘rdp’. Whilst the nature of these variables has not been determined, they may influence or modify the installation of the specified MSI file.C2 Server ThemeServHelperThe C2 domains observed in this campaign share a common ‘Microsoft Office 365’ theme, presumably in an attempt to thwart casual analysis by appearing legitimate to the untrained eye. Given this theme, pivots on DNS Whois data can be used to identify additional potential infrastructure and are provided in Appendix A for reference.Having downloaded and installed the MSI installation package, an executable is dropped that spawns numerous processes and commences the installation of ‘ServHelper’, a threat reportedly developed using ‘Delphi’ and first identified in November 2018. Upon execution, further confirmation that the threat was developed using the Delphi integrated development environment (IDE) is gained through attempts to access the following legitimate registry keys:• HKEY_CURRENT_USER\Software\Embarcadero\Locales • HKEY_LOCAL_MACHINE\Software\Embarcadero\Locales • HKEY_CURRENT_USER\Software\CodeGear\Locales • HKEY_LOCAL_MACHINE\Software\CodeGear\Locales • HKEY_CURRENT_USER\Software\Borland\Locales • HKEY_CURRENT_USER\Software\Borland\Delphi\Locales12Note:Whilst these registry keys are not in themselves an indicator of compromise (IOC), attempts to access them in environments not using Delphi-developed applications may be of interest. Having created the file that resulted in the threat’s name, ‘%SYSTEMROOT%\ ServHelper.dll’, the process checks for the presence of the ‘Terminal Services’ service and changes the configuration, if necessary, to ensure that the service is started automatically during system start-up (‘dwStartType=0x2’) (Figure 20).Figure 20 – ‘Terminal Services’ service check Subsequently, the Terminal Services service is started, presumably to allow remote access via RDP (Figure 21).Figure 21 – 'Terminal Services' service started Additional files are also created by the malicious process including ‘%SYSTEM32%\syssettings.ini’ and ‘%SYSTEM32%\termsrv32.dll’. Communications between ServHelper and the command and control (C2) server include basic information about the compromised host (Figure 22) and are sent using HTTP POST.Figure 22 – ServHelper C2 BeaconRemote Desktop Capabilities Presumably as part of the process to ensure that the Terminal Services service is operational, the registry key ‘HKLM\SYSTEM\CurrentControlSet\Services\TermService\Parameters’ is updated, or created, (Figure 23) and references the dropped ‘termsrv32.dll’ file rather than the default ‘termsrv.dll’ (Figure 24).Figure 23 – Alternate ‘Terminal Services’ ServiceFigure 24 – Updated ‘Terminal Services’ registry value13Having queried the status of multiple services, the ‘CryptSvc’, ‘Dnscache’, ‘LanmanWorkstation’, ‘NlaSvc’ and ‘TermService’ services are started, likely to enable the ServHelper remote capabilities. Subsequently, to facilitate remote access, a new user ‘supportaccount’ is created, with a password of ‘Ghar4f5’, and added to both the ‘Remote Desktop Users’ and ‘Administrators’ groups (or the Russian language equivalents) using the ‘net.exe’ command line utility (Figure 25).Figure 25 – ‘supportaccount’ user creation/‘Remote Desktop Users’ & ‘Administrator’ group membership Additionally, the username of the currently logged-in user is obtained from the environment variabnle and also added to the ‘Remote Desktop Users’ group, again using ‘net.exe’ commands (Figure 26).Figure 26 – Victim added to 'Remote Desktop Users' groupPersistence Utilising Windows Scheduled Task command line utility ‘schtasks.exe’, the ‘ServHelper.dll’ in configured to execute under the ‘SYSTEM’ user context at logon (Figure 27).Figure 27 – Persistence using Scheduled Tasks Subsequently, payloads are dropped and result in same malicious execution flow as observed in the US- based retail incident, including the RMS binary file, configuration shell scripts and victim specific content including the RMS configuration file.NOTARY CHAMBER OF UKRAINEAlso observed in December 2018, the same TTP, including ‘RMS’ being deployed, were used in an attack against the Notary Chamber of Ukraine (Нотаріальна палата України). In this instance, the initial email spear-phishing campaign mimicked the Shevchenkivsky District Court of Kyiv (Шевченківський районний суд міста Києва) regarding a notary issue and encouraged the victim to open the weaponised Microsoft Word document attachment (Figure 28).Figure 28 – Lure email (Notary Chamber of Ukraine)14The document attachment, appearing as badly scanned documentation (Figure 29), reportedly either contained a VBA macro downloader, as observed in the US-based retail incident, or malicious binary payloads used to ultimately install the RMS tool.Figure 29 – Lure DocumentREMOTE MANIPULATOR SYSTEM (RMS)Remote Manipulator System (RMS) is a legitimate remote administration tool developed by a Russian organization ‘TektonIT’ and has been observed in campaigns conducted by TA505 as well as numerous smaller campaigns likely attributable to other, disparate, threat actors. In addition to the availability of commercial licences, the tool is free for non-commercial use and supports the remote administration of both Microsoft Windows and Android devices.Figure 30 – TektonIT RMS (rmansys.ru/remoteutilities.com) As to be expected when dealing with cybercriminals, ‘cracked’ versions of RMS also appear to be distributed on underground forums and likely remove licencing restrictions. Negating the need for a threat actor to develop their own tools, RMS features include remote control with multi-monitor support, task manager, file transfer, command line interface, network mapping capabilities and webcam/microphone access, all of which are common traits of a well-developed remote access trojan (RAT). These features, coupled with the ability to install and operate the tool silently, make RMS an attractive off-the-shelf solution for ‘abuse’ by both sophisticated and unsophisticated threat actors alike.15In addition to RMS implementing its own remote desktop capabilities, which are compressed and encrypted, the Microsoft Remote Desktop Protocol (RDP) is also supported and as such could facilitate the control of ‘ServHelper’ compromised devices. Notably, whilst most malicious RATs would need to call home to the threat actor’s command and control (C2) infrastructure, RMS includes an ‘Internet-ID’ feature which calls home to the developers’ servers and sends a notification via email (Figure 31), further reducing attack complexity for less sophisticated threat actors.Figure 31 – Example ‘Internet-ID’ emailWithin this notification email, the victim’s username and device name is provided along with the internet- ID and password required for remote administration. Alternatively, and seemingly favour by more sophisticated threat actors such as TA505, a self-hosted option is supported by RMS and allows them to configure their own ‘Remote Utilities’ (RU) Server. This RU Server supports three roles that can be deployed individually or together, although only one, the ‘Relay Server’, would likely be utilised in nefarious implementations. This Relay Server acts as an intermediary with ‘compromised’ RMS clients calling-home to it and identifying themselves with their ‘Internet-ID’ facilitating communications that allow firewalls and NAT devices to be bypassed. The additional roles, ‘Authorization Server’, supporting the management of access permissions, and ‘Sync Server’, synchronising address books, are likely only deployed in legitimate environments such as corporate IT support teams.16BROADER USE OF RMSNumerous Russian-language forum and social media posts, along with YouTube video tutorials, detail how to package the legitimate RMS components for use in malicious campaigns and appear to date back to at least 2011.Threat actors such as TA505 have likely evolved their use of RMS over time to the point where they now package and deliver the capable tool with their own malware; a blend of proprietary threats with off-the- shelf components combined with tried and tested TTP.Figure 32 – 2011 Forum thread discussing the hidden installation and use of RMSThat being said, the accessibility and simplicity of using RMS for nefarious purposes likely explains the prevalence of the tool in unrelated malicious campaigns, many of which share similar TTP but differ in their configuration and use of RMS.RMS CONFIGURATIONWhilst the recent TA505 campaigns illustrate how a sophisticated threat actor may deliver the RMS tool, along with other payloads, numerous tutorials, guides and tools are available on underground forums to allow unsophisticated threat actors to conduct similar operations. As if RMS didn’t already provide enough functionality that can be abused by threat actors, the ‘Viewer’ application includes a ‘MSI Configurator’ option that allows an installer package to be created. Having first downloaded the latest RMS Host package from the legitimate website, the configurator wizard allows the creation of three distribution types (Figure 33).Figure 33 – RMS Host distribution types17Once the distribution package type has been selected, the wizard allows the configuration of email notifications (Figure 34) as well as supressing various options, dependant on the package type selected (Figure 35).Figure 34 – Internet-ID ConfigurationFigure 35 – Other advanced optionsOnce the initial wizard has finished, a package is created and an additional ‘Remote Settings’ dialog is displayed (Figure 36) allowing further configuration and customisation.Notably within these settings is the ability to supress notifications and other potentially victim-alerting features as well as configuring the network port and preventing the future modification of settings without a password. Once the package and configuration have been prepared, they can then be delivered via various means to potential victims. In the case of TA505, this involved a lure file acting as a downloader which delivered custom payloads which ultimately silently install RMS. Less-sophisticated threat actors may choose to follow an existing tutorial or obtain one of many builder tools available on underground forums to further prepare their pre-configured RMS host which can then subsequently be delivered to victims via common methods such as phishing emails or by masquerading as legitimate downloads.Figure 36 – ‘ Remote Settings’ dialog18RMS BUILDERSEarly tutorials regarding the silent installation of RMS demonstrate the use of ‘AutoIT’, a legitimate automation tool, that supresses user interactive elements of a preconfigured RMS installer, such as sending a mouse click command to close the installation completion dialog (Figure 37).Figure 37 – AutoIT ScriptIn this instance, the AutoIT script is compiled and compressed, along with a customised RMS installation executable, in a self-extracting archive. To further simplify the packaging process, numerous ‘builder’ tools (Figure 38) are available to generate silent configurations and installers for the RMS host.Whilst the features of these builder tools vary from tool to tool (Figure 39), they typically include persistence capabilities, the ability to mimic legitimate application or be bundled with another file, file encryption and packing to evade antivirus solutions, bypassing User Account Control (UAC) and, further demonstrating that there is no honour among thieves, the removal of any other RMS instance to eliminate potential competition.Figure 38 – Example RMS Host ‘Builder’Figure 39 – Example RMS Host ‘Builder’ features19RMS VIEWERHaving successfully built and deployed the nefariously configured RMS host components to victims, the threat actor can remotely manage victim machines, with a simple right-click, using the RMS Viewer application (Figure 40).Figure 40 – Example Threat Actor use of RMS ViewerWhilst functionality such as ‘Full control’ and ‘Chat’ will likely alert the victim to the activity, functions such as the ‘File transfer’, ‘Terminal’ and ‘Remote install’ could facilitate the theft of data, information gathering and the deployment of additional malicious payloads.RMS CONFIGURATION XMLWhen installed, RMS appears to store its configuration as hexadecimal encoded XML data within the Windows Registry (Figure 41).Figure 41 – Example RMS Registry Configuration20Whilst the registry location may differs between threat variants and versions, common locations include: • HKEY_CURRENT_USER\Software\TektonIT\ • HKEY_LOCAL_MACHINE\SYSTEM\Remote Manipulator System\ The presence of these registry keys, or similarly named values containing hexadecimal encoded RMS configuration XML data, are likely indicators of compromise. When obtained from a compromised machine, analysis of RMS configuration XML data can provide insight into the RMS configuration as well as identifying the C2 server (Figure 42) or threat actor email address (Figure 43).Figure 42 – Example 'RMS Internet ID Settings' XML with C2 domainFigure 43 – Example 'RMS INET ID Notification' XML with notification email addressRMS C2 COMMUNICATIONSC2 communications between the RMS host and server have been observed as using a pre-defined user- agent string ‘Mozilla/4.0 (compatible; RMS)’. In the absence of a configuration option for this string, it is likely hardcoded and therefore communications identifying themselves as this user-agent are likely compromised. C2 communications, via TCP, appear to transmit XML data with a structure similar to the RMS configuration data with base-64 encoded elements (Figure 44).21Figure 44 – Example C2 communications (Red – victim; Blue – C2 server) Decoding the above base-64 encoded value reveals another XML configuration file, providing an overview of the RMS client to the C2 server (Figure 45).Figure 45 - RMS host (victim) data sent to C2 Server In the case of a RMS host configured to call home to the legitimate servers, resulting in a notification email to the threat actor, a HTTP POST is used to send the data comprised of email address, additional text (as specified in the configuration, and potentially providing an indication of a tool being used), victim user name, victim computer name, Internet-ID, victim language and the product name (Figure 46).Figure 46 – Call home to legitimate server with email notification22INDICATORS OF COMPROMISE (IOC) %PROGRAMDATA%\Microtik %PROGRAMDATA%\Microtik\exit.exe %PROGRAMDATA%\Microtik\winserv.exe %PROGRAMDATA%\Microtik\i.cmd %SYSTEMROOT%\installer\msi2adc.tmp %TEMP%\7zinstall.exe %TEMP%\i.cmd %TEMP%\sdw.vbsRegistry [HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run] "Microtik"="c:\ProgramData\Microtik\winserv.exe"[HKEY_CURRENT_USER\Software\tectonite\Remote MANIPULATOR System\]C2 IP Addresses hxxps://iplogger.org/6vfgP hxxp://local365office.com/content hxxp://office365onlinehome.com/host32 hxxps://afgdhjkrm.pw/aggdst/Hasrt.php24INDICATORS OF Lure SpreadsheetLure SpreadsheetInstallation scriptInstallation scriptLure SpreadsheetLure SpreadsheetLure SpreadsheetLure SpreadsheetLure SpreadsheetLure SpreadsheetLure SpreadsheetShortcutDrops ServHelper.dllConfiguration fileTerminal ServicesLure SpreadsheetMSI Installer Package25URLs hxxp://add3565office.com/rstr hxxps://checksolutions.pw/ghuae/huadh.php hxxp://office365advance.com/update hxxp://offficebox.com/host32 hxxp://officemysuppbox.com/staterepository hxxp://update365office.com/agp hxxp://upgradeoffice365.com/pack hxxps://vesecase.com/support/form.php hxxp://www.microsoftoffice365box.com/streampoolWindows User Accounts Username: supportaccount | Password: Ghar4f5File System %SYSTEM32%\syssettings.ini %SYSTEM32%\termsrv32.dll %SYSTEMROOT%\ServHelper.dll %SYSTEMROOT%\installer\msi1.tmp %TEMP%\htpd.dat %TEMP%\rds.vbs %TEMP%\2.lnk %TEMP%\help.bat %TEMP%\nsd1211.tmp\system.dllRegistry [HKEY_LOCAL_MACHINE\CurrentControlSet\ Services\TermService\Parameters] "ServiceDLL"="%SystemRoot%\System32\ termsrv32.dll"C2 IP Addresses vesecase.comScheduled Tasks “ServHelper”=”rundll32.exe C:\Windows\ servhelper.dll, main”26INDICATORS OF %PROGRAMDATA%\Microtik %PROGRAMDATA%\Microtik\exit.exe %PROGRAMDATA%\microtik\settings.dat %PROGRAMDATA%\Microtik\winserv.exe %TEMP%\i.cmd %TEMP%\7zinstall.exeRegistry [HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run] "Microtik"="c:\ProgramData\Microtik\winserv.exe"[HKEY_CURRENT_USER\Software\TektonIT\]C2 IP Addresses gogiloudg2.temp.swtest.ru28INDICATORS OF POTENTIAL C2 DOMAINSBased on DNS Whois pivots of known C2 domains, the following domains are provided as ‘potential C2 domains’ based on suspicious naming conventions that are similar to, or consistent with, observed C2 domain naming themes. Pivots were based on registrant name, registrant address, registrant email address, DNS SOA, name server or hosting IP address where appropriate.accountservice.linkalertsofamericaservice.netalertsofamericaservice.orgalertsonlineb.infoalertsonlineb.siteamazonalertsservice.comamazonalertsservice.netamazonsecuve.comboaservicalonotiservicesa.tkboaserviceraletst.cfboaserviceraletst.tkboaservicertalak.combof-1apiservicesalert.mlbof-1apiservicesalert.tkbof-apiservicesalert.tkserviboaalertsacess.gaservicapplecustomers.gaservicboas.comservicboaservicesupoboa.gaservicboaservicesupoboa.mlservice-alert.linkservice-boaofamerica.cfbofamericaservicealertscusto.tkservice-boaofamerica.mlamazonservericaseracalerts.mlbofasserserivcersa.gaamazonservericaseracalerts.tkchasepnlineba.comamazonservicesaeqwec.comchaseservericaserlaertsse.mlapleid-store.gaapleid.gaapplebankoaofamelc.gaapplebankoaofamelc.mlapplecsertcas.gaappleicloudeservice.comappleicloudeservice.netappleicloudeservice.orgchaseservericaserlaertsse.tkchasservice.comcomcasrerserc.gacomcasrerserc.tkcomcasservicealerts.gacomcastertiser.tkcomcastserivei.comcomcastserviceaatinfo.tkservice-boaserive.cfservice-boaserive.mlservice-pp.xyzservicealerts.clubservicealerts.netservicealerts.onlineservicealerts.siteservicealerts.websiteservicealertsofservi.netservicealertsonline.siteservicealoneapple.com31appleidcustomersaer.com bankofamerica-re.tk bankofamerica-reactivte.ml boaofamerica-serviceas.cf boaofamerica-serviceas.tk boaserivaalertsnitoa.tkcomcstconnect.cf secure-alert.email servericaseralertsforaccou.netservicebankofamericas.com support-your-accounet.tk verifed-account-896628153.com wellsservicessu.com32United Kingdom Tel: +442035141515 25 Old Broad Street | EC2N 1HN | London | United KingdomUSA Tel: +1-646-568-7813 214 W 29th Street | Suite 06A-104 | New York, NY, 10001 | USAIsrael Tel:+972-3-7286777 Fax:+972-3-7286777 17 Ha-Mefalsim St | 4951447 | Kiriat Arie Petah Tikva | IsraelSingapore Tel: +65-3163-5760 10 Anson Road | #33-04A International Plaza 079903 | Singaporesales@cyberint.comwww.cyberint.com33 