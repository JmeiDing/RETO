OPERATION ARID VIPERBypassing the Iron DomeTrend Micro Threat Research TeamCONTENTSIntroduction i Operation Arid Viper 1 Targets 1 Infection Chain 1 C&C Infrastructure 5 Operation Advtravel 9 C&C Infrastructure 9 fpupdate.info Server 16 Victims 16 linksis.info Server 17 Attribution 17 Khalid Samra 17 Ahmed Jmal 19 Mahmoud Hashem 19 Mohammed Khaled 25 Fathy Mostafa 25 Other Individuals 26 Appendix ivINTRODUCTIONTrend Micro researchers discovered an ongoing malware campaign that targets Israeli victims and leverages network infrastructure in Germany. The campaign has strong attribution ties to Arab parties located in the Gaza Strip and elsewhere. Picture the following reconstruction based on one attack—an employee in an Israeli government research facility receives and opens a highly targeted phishing email. A pornographic movie starts to play on his screen, which he hurriedly closes before any of his colleagues notice. He then thinks nothing more of the event. Minutes later, an attacker from somewhere in the Gaza Strip in Palestine gets notified that a new victim’s system has been successfully infected. The attacker then proceeds to exfiltrate a package containing all of the interesting documents from the newly infected system. Israel is one of the most highly defended countries in the world, sheltered behind the legendary “Iron Dome.” [1] But all of that counts for nothing when an attacker— possibly seeking out revenge for Israeli air strikes on Gaza last year—circumvents all of that to strike right at the heart of the Israeli administration. [2] The Internet is quickly becoming a battlefield for new age wars, a chessboard where a new game is played by world powers comprising enemies and allies. This is a new take on an old game, that of deception, duplicity, and espionage in world politics. The ability to attack an enemy without needing to declare war is a very useful thing in such a game, as is being able to spy on enemies cloaked by distance and faint electronic traces. For a security company, the most complicated thing is to determine the motivation behind an electronic attack. In rare cases, we do find state-sponsored espionage. And the most useful clues we count on to discern between threat actors or those behind highly targeted attacks and other cybercriminals include:• Complexity: The level of sophistication employedby some of these highly targeted attacks goes over and beyond normal cybercrime. Government agencies with the manpower to create the kind of malware for highly targeted attacks perfect their2code over the years. They often employ scores of teams working on different sections of their malicious programs. Of course, not all nation states have the same resources at their disposal when it comes to creating sophisticated malware. In fact, for every Stuxnet, there are hundreds of rather straightforward spear-phishing campaigns.• Targets: Over time, state-sponsored malwarehave been targeting victims that can be clustered into specific groups—regions or vertical industries. This could be a telltale sign that whoever is behind a highly targeted attack has loftier interests than merely stealing money.It is also worth noting that not all politically motivated attacks are carried out by the governments that would most likely benefit from them. They can be the work of hacktivists, patriotic hacking groups, or to further complicate things, enemy nations using the name of supposed culprits to carry out attacks. Welcome to the wonderfully complex world of geopolitical malware! This research paper tells the story of a highly targeted attack campaign that raised all kinds of red flags. What we have dubbed “Operation Arid Viper” refers to a campaign that exclusively targets victims in Israel. This particular case showed that not only countries are looking at Israel through the crosshairs; a few organizations who consider themselves the country’s adversaries are, too. As such, we cannot discount that this attack could have been made by a rogue organization that is trying to shake the chessboard of world politics. Operation Arid Viper uses malware delivered via phishing emails to steal documents from target systems. This paper—a collaborative effort of the Trend Micro Forward- Looking Threat Research Team and fellow threat defense experts—reveals the campaign’s technical details and its targets as well as details on a number of individuals who appear to be tied to the campaign. Special thanks also goes out to the United States Air Force (USAF) Office of Special Investigations for their assistance and partnership in this endeavor.© 2015 Trend Micro IncorporatedOPERATION ARID VIPERTargetsThreat intelligence from within Trend Micro was used to determine who the targets of an ongoing campaign dubbed “Operation Arid Viper” have been so far. Based on IP addresses associated with malware infections tied to the campaign’s core infrastructure, we were able to determine its targets—a government office, transport service/infrastructure providers, a military organization, and an academic institution in Israel. It also targeted an academic institution in Kuwait along with several other unidentified Israeli individuals. Research also revealed an interesting Twitter conversation between @Ramzi_MHADHBI, a Tunisian blogger, and @waleedassar, a reverse engineer currently working as a senior security researcher at the Al Jazeera Media Network. Their exchange mentioned two of the domains associated with Operation Arid Viper malware, suggesting that one or both of them may have also been targeted.Infection ChainOperation Arid Viper targeted various Israeli organizations across industries.As will be made clear later, Operation Arid Viper aimed to extract victim information though it also paid much attention to its means of getting into target systems. The campaign used the most popular targeted attack infection vector—a simple phishing email from a nonexistent sender to a specific recipient. It targeted organizations from various industries with a clear focus on Israel. The spear-phishing email came with a compressed file attachment and a more or less credible social engineering ploy to trick victims into opening it and running the embedded .EXE file. The .RAR file attachment contains an .SCR file that when executed drops two more files onto an infected system. One file is a short pornographic video in .FLV or .MPG format, depending on the samples seen. The other file is a Windows® binary file sporting the icon of the well-known Internet communication program, Skype™. Operation Arid Viper was unusual in that it had a pornographic component in hopes of taking user focus away from the infection or the fact that something strange is happening. It targeted professionals who might be receiving very inappropriate content at work and so would hesitate to report the incident. These victims’ failure to act on the threat could have then allowed the main malware to remain undiscovered. The attackers used a distinct and likely successful strategy previously unseen when it came to avoiding incident response team investigations.Twitter conversation between @Ramzi_MHADHBI and @waleedassar1 | Page© 2015 Trend Micro IncorporatedIt is also worth mentioning that variations in the spear-phishing elements were seen across attacks though the idea behind them was the same. They all used a socially engineered email with a malicious file attachment and had a pornographic element as shown in the infection chain. Once executed, the binary accesses a command-and-control (C&C) server to immediately download an updated module and check if the infected system is already known or if it has been newly infected. Each infected system is assigned a unique identifier comprising its hard disk name and a specific set of numbers. Specific URLs are used for command and control. Note how often the unique identifier is used in all kinds of communication with C&C servers. Below are sample commands for a system with the unique ID, VMwareVirtualIDEHardDrive—1268730784.•••/session/aadd_rtemp. php?n=VMwareVirtualIDEHardDrive—1268730784: To add the system’s record or perhaps start a communication session. /session/gget_rtemp. php?n=VMwareVirtualIDEHardDrive—1268730784: To get a record or perhaps continue a communication session. /flupdate/3.html: To download an updated .EXE file.Operation Arid Viper infection chainIncidentally, even though the file that should be downloaded—3.html— was hard-coded into the original malicious binary, the C&C server has sequentially numbered similar though not identical binaries such as 1.html, 2.html, and so on. These varied from sample to sample but were all Base64-encoded strings. The malware also commonly set the User-Agent for communication to “SK,” “Skypee,” or “Skype” as shown in the Wireshark log. The previously mentioned paths— aadd_temp and gget_rtemp—varied a little from sample to sample and C&C server to C&C server but the request formatting was the same. A nonexhaustive list of other paths seen include:User-Agent Wireshark log for “SK,” “Skypee,” or “Skype” communication2 | Page© 2015 Trend Micro Incorporated•••••••• •/new/add_tree.php?name=[SYSTEM- ID]&date=[TODAYS DATE] /new/all_file_info1.php?name=[SYSTEM- ID]&user=[NUM]&file=[DD-MM-YYYY HH-MM. uml]&type=msn /new/all_file_info1.php?name=[SYSTEM- ID]&user=[NUM]&file=[DD-MM-YYYY HH-MM. rml]&type=log /new/all_file_info1.php?name=[SYSTEM- ID]&user=[NUM]&file=[DD-MM-YYYY HH-MM. dll]&type=img /new/all_file_info1.php?name=[SYSTEM- ID]&user=[NUM]&file=[DD-MM-YYYY HH-MM. rml]&type=tree /new/get_flash.php?name=[SYSTEM- ID]&serial=[SERIAL NUM] /new/get_tree.php?name=[SYSTEM- ID]&date=[DD-MM-YYYY] /new/get_statu.php?name=[SYSTEM-ID] /new/view_flash_files.php?name=[SYSTEM- ID]&serial=[SERIAL NUM]•• php?name=[SYSTEM-ID]&serial=[SERIAL NUM] /new/update.php /new/view_file_order.php?name=[SYSTEM-ID] /new/view_file_up.php?name=[SYSTEM-ID] /new/view_random_order. php?name=[SYSTEM-ID] /down/add_temp.php?name= [SYSTEM-ID] /new/add_tuser.php?name=[SYSTEM-ID]&use /new/chang_flag.php /new/chang_rfflag.php /new/chang_rflag.php /new/n_chang_fflag.php /mians/aadd_rtemp.php?n=[SYSTEM-ID] /mians/gget_rtemp.php?n=[SYSTEM-ID] /session/aadd_rtemp.php?n=[SYSTEM-ID] /session/gget_rtemp.php?n=[SYSTEM-ID]When the second-stage malware runs, it sets itself to auto- run with each system reboot in the guise of an Internet communication software. This is accomplished with an old- fashioned auto-start registry key such as HKCU\SOFTWARE\ Microsoft\Windows\CurrentVersion\Run—“Skype = <path\ name.exe”>. This keeps the path and name of the .EXE file dropped into the registry key. It also copies itself into %SystemDrive%\Program Files\Messenger via a hard-coded path. In addition to using “Skype” in the registry, the malware also frequently spoofed the Skype icon. All of the malware samples seen had portable executable (PE) file sections written in Arabic. The malware logs in to the C&C console by calling a very specific PHP script on the C&C server—/products/add_user.ph p?name=VMwareVirtualIDEHardDrive—1268730784&user=38. The number it creates for the user parameter—38 in the example—was chosen from the malware client to identify the session. It then starts searching the whole hard disk for documents—.DOC, .XLS, .PPT, and .TXT files. Each document found is reported to the C&C server using the format, GET / products/file_order3.php?name=VMwareVirtualIDEHardDri ve—1268730784&path=C:/Documents%20and%20Settings/ user/Templates/winword.doc. 3 | PageThe Wireshark log (top) shows the files the malware sends to a C&C server. The assembly code section (bottom) searches for .XLS files to steal.© 2015 Trend Micro IncorporatedThe C&C server immediately responds if each document is interesting or not. This decision probably comes from a hard-coded black list on the server side to likely prevent the client from sending out default templates and generic readme.txt files. The server also tries to avoid requesting for duplicates of files it already has in further stealing sessions. It has two possible responses:• Response for an interesting document:HTTP/1.1 200 OK Date: Thu, 02 Oct 2014 14:49:45 GMT Server: Apache/2.4.10 (Unix) OpenSSL/1.0.1e-fips mod_ bwlimited/1.4 X-Powered-By: PHP/5.5.16 Transfer-Encoding: chunked Content-Type: text/html 0• Response for an uninteresting document:HTTP/1.1 200 OK Date: Thu, 02 Oct 2014 14:49:23 GMT Server: Apache/2.4.10 (Unix) OpenSSL/1.0.1e-fips mod_ bwlimited/1.4 X-Powered-By: PHP/5.5.16 Transfer-Encoding: chunked Content-Type: text/html 2 2The client then proceeds to list down all of the interesting documents to steal. These are compressed in a 0.txt file and uploaded to a C&C server via a POST request such as POST /products/fupdates.php. This request comprises a single POST parameter formatted as a GET parameter such as account=38&name=VMwareVirtualIDEHardD rive—1268730784&folder=tree&fname=02-10-2014 10-50.rml&s=<base64-file>. The server presumably uses the account value, which is the same as the previously mentioned user value, to track sessions where particular files are uploaded. The fname parameter is the .ZIP file’s name and contains a specific date and time. The 0.txt file is deleted after the upload. At the end of the file upload, the client issues the request, /products/all_file_info1.ph p?name=VMwareVirtualIDEHardDrive—1268730784&user=38&file=02-10-2014%20 10-50.rml&type=tree, to make sure everything went smoothly. As shown, a single execution allows the malware client to steal documents from infected systems. After carrying out all of its routines, the malware routinely checks back with the C&C server to see if it should continue running using the path, /products/get_statu.php?name=VMwareVirtualIDEHardDrive—1268730784. A response containing run11 tells it to continue running whereas stop disables it to possibly avoid infecting uninteresting systems.4 | Page© 2015 Trend Micro IncorporatedC&C InfrastructureUsing an initial malware sample and its corresponding C&C server, we looked through internal Trend Micro databases to compile a list of similar malware that contact the same server. All cases revealed that the malware essentially exhibited the same behaviors previously outlined. The first C&C server found was pstcmedia.com. A quick search revealed that another site—mixedwork.com—hosted on the same IP pstcmedia.com site changed IP addresses, mixedwork.com seemed to stay on this IP address. The other IP addresses pstcmedia.com used been sink-holed by other security researchers. To find other domains that may be part of the same campaign or used by the same perpetrators, an investigation of domain registration data was conducted. The C&C server that pstcmedia.com used was registered using the personal email address, khalid.samraa@gmail.com. More details on this can be found in the attribution section. The main page of mixedwork.com also contained a decoy redirection to the legitimate site, url But on its 404 page, it is interesting to note the mention of the email address, ahmed. jmal1989@gmail.com, as site administrator. An in-depth look at Trend Micro™ Smart Protection Network™ feedback for network activity similar to the previously mentioned URL paths allowed us to identify where the following active C&C servers were at various times:• ahmedfaiez.info • mediahitech.comThe first three servers have all been hosted at some point on the same Germany. A more in-depth look at the first IP address revealed that among several other domains, it also hosts two—advtravel.info and fpupdate.info—that have clear ties to cybercriminal activities although not necessarily to the same campaign being investigated. A closer look at the last two C&C servers revealed that they have been misconfigured and allowed directory listing. Inside them were large amounts of victim data analyzed in the Operation Advtravel section.5 | Page© 2015 Trend Micro IncorporatedMaltego® map showing the relationships among the sites, IP addresses, and servers seen in the featured campaignsOperation Arid Viper’s main C&C servers have been configured so their main pages redirected visitors to other web pages as shown in the table below.C&C ServerSite It Redirects Toahmedfaiez.infoflushupate.comflushupdate.comineltdriver.commediahitech.infomixedwork.comSimply shows the word “test”helpx.adobe.com/flash-player.htmlget.adobe.com/flashplayerdownloadcenter.intel.com/default.aspxNot resolving anymorevisitmix.com/work6 | Page© 2015 Trend Micro IncorporatedC&C ServerSite It Redirects Toplmedgroup.compstcmedia.compalmgroupasia.comA parked pageA check of the Domain Name System (DNS) Start of Authority (SOA) and Whois records of each identified C&C server turned up several other interesting email addresses, more details on all of which can be found in the attribution section. The table below shows our findings.C&C ServerEmail Addresses Used in DNS SOAand Whois Recordsadvtravel.info*ahmedfaiez.infoflushupate.comflushupdate.comfpupdate.info*ineltdriver.commediahitech.infomixedwork.complmedgroup.compstcmedia.commoh.s009@gmail.commoh.s009@gmail.commahmoud.hashem12@gmail.commoh.s009@gmail.commoh.s009@gmail.commoh.s009@gmail.commahmoud.hashem12@gmail.commoh.s009@gmail.commahmoud.hashem12@gmail.comahmed.jmal1989@gmail.comahmed.jmal1989@gmail.comkhalid.samraa@gmail.comNote that C&C server names marked with * are part of a separate campaign—Advtravel.7 | Page© 2015 Trend Micro IncorporatedThe malware binary hashes and their respective C&C servers, along with the dates they were first seen, allowed us to create a timeline of attacks that shows how much Operation Arid Viper has evolved over time.8 | Page© 2015 Trend Micro IncorporatedOPERATION ADVTRAVELOngoing Operation Advtravel differed from Operation Arid Viper in terms of the malware used, their chosen victims, and attribution information. But it does bear certain similarities to Operation Arid Viper that we believe merits its addition to this paper. The cybercriminals behind this campaign may have some ties with the threat actors behind Operation Arid Viper, which include:• They shared servers for command and control. • They used the same email addresses to register their domains—advtravel.info, fpupdate.info, and linksis.info.• Their perpetrators had ties to the Gaza Strip.C&C InfrastructureWhile conducting our investigation, we came across an Advtravel C&C server that shared the same infrastructure with Operation Arid Viper. It is particularly interesting to note that the advtravel.info site left its server’s root directory structure completely open to the public. This, combined with some other cybercriminal activities elaborated in the attribution section, led us to believe that the Advtravel attackers were less-skilled than those behind Operation Arid Viper. An analysis of December 2014 data shows that Advtravel’s C&C server directory could be publicly accessed. This allowed us to download copies of its entire content to study as part of our investigation before its owners realized their mistake and locked it down. Earlier versions of data from September 2014 were also downloaded. The advtravel.info directory had several files and folders. Although we were not able to exhaustively analyze every file on it, details on its most interesting components are highlighted below:Publicly accessible Advtravel site root directory•• B1312.zip: This is a 1.4GB compressed backup of all of the other files on the C&C server. Leaving this file on the server allowed us to look inside the code of the .PHP files the attackers used. /apps/: This main directory contains stolen victim data, along with several PHP scripts that uploaded it to the server. It used the format, /apps/A[3 nums]X/[COMPUTERNAME_USERNAME] where A[3 nums]X represents a particular subcampaign while /[COMPUTERNAME_USERNAME] identifies a unique victim. The three digits in the folder format seem to indicate the month of the year, as they ranged from 001 to 012. Further analysis of the dates when the data was stolen, however, disproved that theory. An exhaustive analysis of every file on the server is beyond the scope of this paper but the details of the most interesting components are:9 | Page© 2015 Trend Micro Incorporated/apps/A[3 nums]X/ison.on: This refers to the last time stolen data was uploaded in the format, dd-mm-yyyy-hh-mm-ss. /apps/A[3 nums]X/data/: This contains screenshots taken from infected systems, along with the following files, the presence of which varied from victim to victim:  allips.txt: Contains victims’ local andexternal IP addresses. CurrentProcess.txt: List of runningprocesses on infected systems. cmpinf.txt: Contains the infection date, OS, user domain name, and username. downinf.txt: Contains the infection date,OS, user domain name, username, and status such as “Download Complete :).” DrivesList.txt: List of all of an infectedsystem’s drives. FileList.txt: List of files in a directoryon an infected system, frequently where the malware was executed. pdata.txt: List of stolen website logincredentials. webrowser.txt: List of stolen webbrowser credentials. wifi.txt: List of stolen Wi-Fi connectioncredentials. workdata.txt: Contains the infectiondate, OS, user domain name, username, and a line labeled APP_ PATH=, which indicates which directory the malware was installed on. Winkey.log: Log of victims’ keystrokes.  Other files that the attacker manuallyordered his malware to directly steal from the victim. These include Wi-Fi network passwordsLogs keystrokes/del/: This has been formatted like the /apps/ folder and also contains stolen victim data, particularly pictures, documents, and passwords. /downs/: This contains several tools like those in the /apps/ folder as shown in the following table.An index of over 400 compromised systems from facebook.com/messages/ LODALODALODA, which sends a Facebook message to Mohamed Khaled (https:// www.facebook.com/ LODALODALODA)Copies pat2.exe and patver. tmp from the \appdata\ roaming\explr\ folderBackdoor that accesses the C&C server, devhelx.no-ip.orgBackdoor that accesses the C&C server, devhelx.no-ip.orgHacking tool that comes in the form of a password-protected archive fileDrops WinKey.log where keystrokes are logged.ZIP file that contains pswd2. exe detected as TROJ_ STRPADT.ADropped .TXT file that contains URLs, usernames, and passwordsDropped .TXT file that contains URLs, usernames, STRPADT.A and downloads pat2.exeDetected as TROJ_ STRPADT.A and downloads while the second is detected as TROJ_STRPADT.A/patlogs/: Every action that the C&C server carries out is logged in a series of detailed log files here. Each log file uses the format, Log_A[3 letters]X_[COMPUTERNAME_USERNAME]_m-dd-yyyy-hh-mm-ss.log.Log snippet showing victim data stolen by an attacker logged in as admin@dhs12 | Page© 2015 Trend Micro Incorporated/rpts/: This contained several empty subdirectories and two files as shown these people came from all over the world. The actual last login by the attacker to the server can be geolocated to Gaza in Palestine.The advtravel.info domain was moved to privacy-protected Whois in 2013. From 2007 to 2012 though, it was registered to: Registrant Name:Adv Travels Registrant Organization:Adv Travels Registrant Street1:4401 Bayou Boulevard Registrant City:Pensacola Registrant State/Province:Florida Registrant Postal Code:32503 Registrant Country:US Registrant Phone:+01804777777 Registrant Phone Ext.: Registrant FAX: Registrant FAX Ext.: Registrant Email:renold.dave@advtravel.infoMalwareAn analysis of the stolen files and logs allowed us to come up with a brief description of the initial Advtravel malware. In general, it only serves to respond to a C&C server. The attackers then manually downloaded other tools onto infected systems to extract victim credentials.13 | Page© 2015 Trend Micro IncorporatedAfter the initial dropper or download chain, the malware starts its data-stealing routine. It calls home to a C&C server and report each folder found on the infected system. The server then replies with a confirmation on whether or not the malware should send the folders’ contents. The Advtravel and Operation Arid Viper malware had similar behaviors. This may or may not be a coincidence, as their binaries significantly differed. The Advtravel malware was coded in C# so the dropper needs to go through additional steps to build and update a .NET-running environment where it can be executed. This involves downloads and Microsoft™ software installations, which not only caused significant infection delays but also served as an additional point of failure to execute. The following are some sample HTTP requests seen in Operation Advtravel:• GET/sys/who.php?t=2/8/2015%205:30:59%20AM HTTP/1.1:First-time login.• GET/sys/genid.php?t=2/8/2015%205:31:00%20AM: Asks togenerate a unique ID for a particular first-time client. The ID returned in this example was 2aMUu7TcPbUBsHVLNogB.vic, which will be used by the bot client throughout.Possible Advtravel malware infection chain• POST/sys/upload.php?dirname=//2aMUu7TcPbUBsHVLNogB.vic&x=old:Send directory name information.• GET/sys/data//2aMUu7TcPbUBsHVLNogB.vic/command.cmd?t=2/8/2015%205:31:02%20AM: Get a command from the server.In one particular example, the initial malware was a self-extracting .CAB file that eventually downloaded the main malware and patver.tmp, which contains the value, A012X. This value indicates the server folder where the stolen data should be uploaded to. This is essentially a campaign identifier. The malware then dropped a .JPG file showing the famous Dome of the Rock Church in Jerusalem. It also exhibited the following behaviors:•Installs itself to a default location such as C:\Users\[USER]\AppData\Roaming\ AdobeAPP or C:\Documents and Settings\[USER]\Application Data\explr• Puts logs and support files in C:\Users\[USER]\AppData\Roaming\AdobeAPP\temp (Note that the .EXE file varies and appears to be downloaded on demand.)• Uses many of the support files previously described in another section, whichare found in the \temp folder• Can send commands such as the following to bots: get_scrshot: Get a screenshot.  get_workdata: Returns an infected system’s local time, OS, user domain14 | Page© 2015 Trend Micro Incorporatedname, username, and malware path. explore_dir*[FULL PATH TO DIR]: Gets a directory listing. run_file*[FILE TO RUN]: Executes a file. get_file*[FILE TO GET]: Retrieves avictim’s file. get_procslist: Gets a process or tasklist. kill_prcs*[PID]: Kills a process.  get_driveslist: Lists all of an infectedsystem’s mounted drives. =FILE=: Allows attackers to upload new files to a victim’s system. download*[URL]: Downloads a file from a URL onto an infected system. del_path*[FILE]: Deletes a file orfolder.• Communicates with the advtravel.info/ apps/ directory to listen for commands and uploads stolen data to the / del directory. The log lists down an infected system’s current directory, runs a password stealer, retrieves stolen credentials, and takes screenshots.Based on patlogs, at least four botnet administrators—khloda@dhs, belal@dhs, belal2@dhs, and admin@dhs—log in to the server and control the bots through the administration panel—a tool called DHDSM.VictimsLog of the activities an Advtravel malware variant performs on infected systemsThe Advtravel server has more than 500 infected systems. All of the stolen details found on it have been backed up for evidence. Most of the data have been analyzed to get an idea as to who have been victimized by the campaign. Some observations made include:• The majority of victims appeared to be Arabs from Egypt. • All of the infected systems appeared to be personal laptops, judging by thepresence of a battery indicator in screenshots. This led us to believe that the campaign was not as sophisticated or as targeted as Operation Arid Viper.15 | Page© 2015 Trend Micro Incorporated• The attackers appear to be keenly interested in images stored on victims’systems. This could be a sign that they are looking for incriminating or compromising images for blackmail purposes. As such, the attackers may be less-skilled hackers who are not after financial gain nor hacking for espionage purposes.• A lot of the screenshots unusually showed open Facebook profiles. Thevictims either spent a lot of time on Facebook every day or the malware took screenshots every time a victim accessed the site. This allowed the attackers to identify their victims. More details on this will be revealed after further investigation.fpupdate.info ServerThe fpupdate.info server’s main directory contains a /mobile/ folder. At the time of writing, the site no longer allowed public access to the server’s files although we were able to back them up back in September 2014. At present, all of the related .PHP files cannot access the server’s back-end database, which could mean it is down or unmaintained. An uploads folder had two subfolders that contained personal information stolen from victims’ mobile phones. Each subfolder had another two subfolders—/calllog and /sms. We were, however, unable to obtain a copy of the Android™ malware the attackers may have used to create the logs.VICTIMSfpupdate.info main directoryThe fpupdate.info server contained phone data stolen from two victims, namely:Victim data stored on fpupdate.info• LGE_IMEI: The device’s International Mobile Station Equipment Identity (IMEI) number revealed that it was an LG D821 Nexus 5 phone owned by someone from Israel. Call logs containing several Israel-based phone numbers, some of which had corresponding contact names, were found on the server. One particular contact called My Number belonged to someone from Palestine.• SAMSUNG_IMEI: This device’s IMEI number revealed that it was a SamsungP5100 Galaxy Tab 2 10.1 owned by someone from Israel. Logs indicating calls made to several Israel-based phone numbers were found, along with SMS logs. Most of the text messages were tweets by @shadipal2 and @Alaqsavoice_Brk, users who relayed real-time news about Gaza. The other text messages, meanwhile, revealed meetings in places in Tunisia such as Gafsa and Sakiet Eddaier.16 | Page© 2015 Trend Micro IncorporatedLINKSIS.INFO SERVERIn addition to the two previously mentioned servers, linksis.info has also been found to have a very similar open directory layout to advtravel.info. It also used a lot of the same malware. We have not completely explored this server though a quick look Germany. Its DNS SOA record used the email address, mahmoud.hashem12@gmail. com. It has an url folder, which is owned by one of the users of advtravel.info’s C&C control panels. It contains the same log files—webbrowser.txt and so on—although these were encrypted.ATTRIBUTIONThe individuals identified in this section have some apparent connection with Operation Arid Viper or Advtravel. Trend Micro would, however, like to point out that they may or may not be involved with cybercrime. We simply intend to lay out verified facts that link them to the campaigns’ infrastructure and malware. Several other reasons such as having their email accounts stolen and used to register C&C servers, deliberate impersonation, and the like could also account for their links to the campaigns.Khalid SamraSome of the C&C server domain names were registered by a supposed Khalid Samra from Palestine. His social networking account email addresses were used to register several Operation Arid Viper C&C servers based on Whois registration data. An email address incorporating Samra’s name—khalid.samraa@ gmail.com—was used to register the pstcmedia.com C&C server based on DNS SOA records. Further OSINT investigation revealed ties to other similar email addresses—khalid.Khalid Samra’s profile also mentions that he was based in Palestine.17 | Page© 2015 Trend Micro IncorporatedSamra’s two Facebook accounts with matching profiles and imagesTwo Facebook pages Samra has ties tosamraa@gmail.com, khalid.samraa@hotmail.com, khalid.samraa@wwb.ps, and khalid.samraa@coreions.com. To get a better idea as to what sort of person Samra is and to determine if he may have a motive for taking part in the campaigns, we took a look at his other social networking accounts. He apparently has two Facebook accounts—url facebook.com/khaled.a.samraa and url The email address for the first account was used to register one of Operation Arid Viper’s C&C servers. The publicly visible profile pictures also suggest that he owned all three accounts. The accounts indicate that he lives in Gaza and that he has pro- Palestine and anti-Israeli political beliefs.18 | Page© 2015 Trend Micro IncorporatedWhat appears to be Samra’s second Facebook account also indicates that he is from Gaza. It also mentions where he worked, Coreions, like his LinkedIn profile. Unlike the first account though, this has more ties to several members of his family. Photographs posted on it also clearly show his presence in Gaza in 2012. A further Facebook search for the email address, khalid.samraa@gmail.com, also pointed to a group page called “GazaUnderFire2012” (url GazaUnderFire2014), which Samra apparently set up back in 2012. This page then led to a newer group page called “Gaza Under Attack 2014” (url Both of the pages provide updates on the ongoing Palestine-Israel conflict with a very strong pro-Palestine/-Hamas and anti-Israeli focus, just like the personal Samra Facebook accounts. Apart from the Facebook accounts, Samra had other social networking accounts such as in Twitter (url Google+ (url and url google.com/117379342774799926526/), and MySpace (url com/225923317). On 4 November 2011, Coreions’ Whois record again changed. Although all of the major details remained the same, the email address was changed to khalid.samraa@gmail.com. On 13 January 2012, its entire registration details changed to the following:khalid abu samra () Gaza- Al Rimal- Al Wihda Street, Opposite to Al-Amal institu Al-Nakheel commercial mall, 1st floor Gaza, ISRAEL 00972 ILAhmed JmalThe email address, ahmed.jmal1989@gmail.com, was used to register two of Operation Arid Viper’s C&C servers—mixedwork.com and plmedgroup.com. It also has ties to the Facebook account, url facebook.com/ahmed.jmal.00. The Ahmed Jmal Facebook account indicates that he resides in Marrakesh, Morocco.Mahmoud HashemThe email address, mahmoud.hashem12@gmail.com, was used to register two Operation Arid Viper C&C servers—mediahitech.info and ahmedfaiez.info—and one of the Advtravel C&C domains—fpupdate. info. Ahmedfaiez.com and fpupdate.info also has ties to the email address, moh.s009@gmail.com. This fact shows a relationship between19 | Page© 2015 Trend Micro Incorporatedthe two campaigns even if they used unrelated binaries. They did have some commonalities such as sharing a common network infrastructure. Moh.s009@gmail.com was also used to register six of the C&C servers—ahmedfaiez.info, fpupdate. info, ineltdriver.com, flushupdate. com, flushupate.com, and advtravel. info—related to the two campaigns. It was also found in DNS SOA records for linkedim.in, iwork-sys. com, nauss-lab.com, nice-mobiles. com, and abuhmaid.net. The site, linkedim.in, was particularly registered using the following details:Registrant Name:Mahmoud Hashem Registrant Organization:blogging hoster Registrant Street1:omar mokhtar Registrant City:gaza Registrant State/Province:gaza strip Registrant Postal Code:00972 Registrant Country:IL Registrant Phone:+972546587385 Registrant Email:blogging.host@live.comAhmed Jmal’s email address was used to register two of Operation Arid Viper’s C&C servers.The registration details above ties the two email addresses—mahmoud.hashem12@ gmail.com and moh.s009@gmail.com—together. We believe they belong to the same person though we have yet to find a real person behind the profiles.Dev_himaAs previously mentioned, several advtravel.info infection logs can be clearly linked to Operation Advtravel’s malware developers or bot masters. It is also worth remembering that the malware used in Operations Advtravel and Operation Arid Viper distinctly differed from each other though they shared a common network infrastructure. The logs showed that the infection started from the same folder Visual Studio® drops a compiled file into and that screenshots showed other malware present on advtravel.info. This shows that advtravel.info is a development environment and could very likely be where the malware are programmed. The server’s username is Dev_hima. A close look at other log files allowed us to find at least three other systems with the same user. Some of the samples gathered from the Trend Micro sample database listed down Dev_hima as an internal author as well.20 | Page© 2015 Trend Micro IncorporatedScreenshot of Dev_hima’s system stored on advtravel.infoThe bot logs from Dev_hima look like logs from test environments with different virtual machines that belonged to the original developer who performed some debugging and testing. This mistake went even further, as while testing the malware, it took several screenshots of Dev_hima’s system, which gave us some insight into his operations. The CPanel display in a Windows 8 environment showed how he went through victim logs. Other tabs open in the same browser display his Facebook profile page. The control panel is a Windows tool called “DHSDM.” Its icon can also be seen as the rightmost program on the taskbar. This can be found on several of Dev_hima’s test virtual machines. It also showed that Dev_ hima corresponded to the Admin user of the control panel. Other details recovered from logs revealed an IP address geolocated in Cairo, Egypt. Another clue to Dev_hima’s relation to the Advtravel malware was a working downloader from December 2014 that is related to advtravel. info. It downloaded a malware from a server that is then run on infected systems. The PE header data of this downloader again showed the name, Dev_hima as application publisher. Nveron appears to be Dev_ hima’s filename for the malware. A web search for developers with the nickname, Dev_hima, turned up one profile that fit what we know so far very well. Dev_hima was not exactly hiding online. He actually had various online accounts—url http:// devhima.webs.com/about, youtube.com/user/ibrahhm2121/, facebook.com/devhima, twitter.com/dev_hima, linkedin.com/pub/ebrahim-elsharawy/69/324/7b5, scribd.com/ devhima, soundcloud.com/ebrahim-elsharawy, and devhima.tumblr.com—that tie his real identity to his nickname.Information on a malware variant published by Dev_hima21 | Page© 2015 Trend Micro IncorporatedSome of Dev_hima’s social networking profilesDev_hima can also be tied to the Skype ID, ibrahhm2121, along with the email addresses, dev_ hima@yahoo.com, devhima@ hotmail.com, ibrahhm2121@ gmail.com, ibrahhm212@gmail. com, and ibrahhm2121@yahoo. com. Of course, it is conceivable that a malicious hacker sought to appropriate El Sharawy’s identity or coincidentally chose the same nickname. A look at malicious activities tied to the nickname, Dev_hima, revealed very interesting things. We found that Dev_hima was part of the “Gaza Hacker Team,” a group involved in multiple website hacking and defacement incidents against Israeli targets in the past. A few of the more than 2,000 defacement attacks the team carried out involved sites in Israel. Some of Dev_hima’s hacker group profiles can also be found on gaza- hacker.org/cc/member-u_42271. html and arabteam2000-forum.com/ index.php/user/272853-dev-hima/. His personal project page—http:// devhima.webs.com/—showed several potentially malicious tools that he has coded. DevPcTwitter, for instance, allows attackers to control a target system using a Twitter account. DevSpy, meanwhile, allows parents to monitor their children’s online communication and browsing habits for protection purposes. In reality though, DevSpy is simply a piece of spyware. available for download on Dev_hima’s site. The structure of the last four DevPcTwitter commands—getfile*[file_path]—is interesting. The commands had a similar though not identical syntax to the format Dev_hima’s bot used to communicate with advtravel.info. Dev_hima shared tutorial videos on YouTube on how to configure and use DevPcTwitter. These videos were linked to his personal page. His Twitter bot’s function is simple. It lets a user register a Twitter account and an email address in theDev_hima also has ties to several email addresses and online accounts22 | Page© 2015 Trend Micro IncorporatedList of website attacks that Dev_hima’s hacker group was involved withDevPcTwitter program. The user can then start tweeting commands via the account registered, which the bot reads and executes. Commands such as GetScreenShot tells DevPcTwitter to take screenshots of a victim’s desktop that it then emails to the email address registered. The bot can also download and execute files using the Download$[URL] command. DevPcTwitter is low-risk because it requires a lot of user interaction to set up and operate. Its bot does not have the functionality to stealthily run in the background as well. Dev_hima also developed the spying tool, DevSpy. Its installer (MD5:DevPcTwitter’s UI shows it was designed for Arabic-speaking is also available for public download from http:// devhima.webs.com/. Unlike DevPcTwitter, the DevSpy interface uses English, not Arabic. Its setup is also pretty self-explanatory. It takes desktop screenshots at user-specified intervals that it then stores in a folder. It can stealthily run in the background. In stealth mode though, it can be only be accessed by pressing a hotkey that requires password authentication. In the same mode, DevSpy can remove itself from a victim’s Windows Task Manager process list. DevSpy is medium- to high-risk because it is designed to spy on users in stealth mode. It is possible or even likely that the malware used to communicate with advtravel.info is a privately enhanced version of Dev_hima’s tools.VIRUS_HIMADev_hima used the handles, hima, virusxhima and ViRuS_HiMa, with the email address, virusxhima@gmail.com, though there was not enough evidence to confirm that Dev_hima and ViRuS_HiMa are the same person. ViRuS_HiMa had ties to several high-profile hacking attacks, including:• The theft of 150,000 passwords fromAdobe employees, customers, and partners such as the U.S. Military, USAF, Google, NASA, and DHL [5]DevPcTwitter supports an extensive array of executable commands.24 | Page© 2015 Trend Micro Incorporated• The cross-site scripting (XSS) attack on 2shared. com [6]• More than 1,700 websitedefacement incidents• The Yahoo SQL attackclaimed to have been by perpetrators from Egypt [7]Some emails with ties to ViRuS_ HiMa include virusxhima@gmail. com, egypt_government@hotmail. com, a.e@hotmail.com, and ana. msre@hotmail.com.Mohammed KhaledDevSpy’s UI and setup consoleAs previously mentioned, one advtravel.info file—Mkhaled.txt—had the link, url When clicked, a Facebook message was sent to a Mohamed Khaled profile page (url as notification of new successful system infections. The profile indicates that Khaled lives in Cairo, Egypt. Interestingly, a Mohamed Khaled can be further connected to Dev_ hima. On a page promoting Dev_hima’s DevPcTwitter tool, we saw one comment from a Mohamed Khaled regarding the remote access tool (RAT).Fathy Mostafa.TXT file snippet from http:// www/hackerbox.net/upload. txt showing a relationship between Dev_hima and ViRuS_HiMaFathy Mostafa is another individual with apparent connections to Operation Advtravel. In one of the advtravel.info logs, we saw a screenshot of the main Advtravel malware under development. The code showed testing URLs that used the same paths as the actual malware that accessed the advtravel.info domain. The username, fathy, can clearly be seen. Other logs from the same infection gave us some stolen account details, including:• url was registered usingismaelalaa32@gmail.com and fathymostafa9@gmail.com• url url and url used fathymostafa9@gmail.comMostafa’s’s skills, according to work profile sites, include C# programming, which was coincidentally used to program the Advtravel malware.25 | Page© 2015 Trend Micro IncorporatedMohammed Khaled’s Facebook profile and pictureThe email address, fathymostafa9@ gmail.com, was also associated with the Facebook account, url facebook.com/fathy.mostafa.1690. The profile indicates that Mostafa lives in Egypt, like many others tied to Operation Advtravel. He studied Electronic Engineering and is a member of several Facebook groups, including two that were related to the Muslim Brotherhood. [8]Other IndividualsKhaled commenting on Dev_hima’s RATIn addition to the previously mentioned individuals, other nicknames associated with Operation Advtravel have been found as well. We saw three other account names—khodla, belal, and belal2—on the Advtravel control panel. The systems that belal owned had particular ties to Operation Advtravel due to their use of the word “Roo0T” or “Ro0t” in usernames. His systems all had the main malware control panel, along with games such as “Counter Strike Global Offensive.” He also had folders containing the njrat7 malware—a popular RAT in Arabic countries, as it wasAdvtravel.info log showing the malware code while it was being developed26 | Page© 2015 Trend Micro Incorporatedlocally developed and supported. Belal’s folders also contained a .TXT file named Israil mails.txt, which had 2,572 email addresses, possibly for attack purposes.Mostafa’s Facebook profileBelal logged in to the Advtravel control panel27 | Page© 2015 Trend Micro IncorporatedCONCLUSIONThe malware campaigns—Operation Arid Viper and Advtravel—discussed in detail in this paper are separate but closely linked. Operation Arid Viper targets specific Israeli organizations, including some high-profile victims, using a network infrastructure in Germany with several strong ties to Gaza in Palestine. Advtravel, meanwhile, has more connections— possible culprits and victims alike—to Egypt. However, based on IP address logins, we again saw connections to the Gaza Strip. While the two campaigns shared infrastructure, their tactics could not be further apart. Operation Arid Viper is a sophisticated campaign targeting key individuals in organizations in order to exfiltrate sensitive data. Its C&C servers were, in fact, closely locked down, providing very little hint that could aid our investigation. Advtravel, on the other hand, looks very much like the work of less-skilled cybercriminals who appeared to be motivated neither by financial gain nor conducting espionage. Instead, they look like a classic group of beginner hackers just starting their careers. Yet it remains intriguing to note the close ties between Operations Arid Viper and Advtravel, apart from signs of Arabic heritage. We cannot know for sure if the people behind the campaigns operate as separate groups or as individuals though we suspect they are part of a larger organization. Several organizations with ties to both Gaza and Egypt, for instance, the Muslim Brotherhood—a transnational Islamist organization founded in Egypt in 1928, exist. The brotherhood was legalized in Egypt in 2011 and won the parliamentary elections before the army overthrew it in 2013. In 1987, brotherhood-affiliated charitiesestablished the Islamic Resistance Movement, better known as “Hamas,” an infamous Palestinian organization that has been controlling the Gaza Strip since around 2007. Whoever the real culprits are, it is clear that they are part of the Arab world, evidence of a budding generation of Arab hackers and malware creators intent on taking down their chosen adversaries. Some of the black hats—be they mercenaries or cybersoldiers—are actively targeting countries such as Israel due to political motivations. We have seen all of the ingredients of a cyberskirmish guerrilla war that goes unnoticed by mainstream IT security media. Beyond these specific campaigns, what we found most interesting was that we had disparate groups of Arab aggressors who used the same infrastructure to launch and monitor attacks. This can possibly mean two things—the attacks were somehow linked, something that appears unlikely given their nature and motivation, or a supra-organization that provides means for Arab parties to commit acts of cyberviolence exists, which appears to be the more probable option. If our theory holds, we will see a host of cyber attacks with detrimental results stem from Arab countries in the near future. Internet users will be stuck in the middle of a battlefield they do not care much for. We can only offer well-informed inferences on attribution for now. Nevertheless, one thing is very clear—whether the malware involved was sophisticated and stealthy or basic and created by beginners, they both had devastating effects on their victims. Trend Micro will always continue to uncover such threats in order to make the world safe for the exchange of digital information.ii© 2015 Trend Micro IncorporatedREFERENCES[1] The Week Ltd. (1 August 2014). The Week. “Iron Dome: How Israel’s Missile Defence System Works.” Last accessed on 12 February 2015, url how-israels-missile-defence-system-works.[2] BBC. (20 December 2014). BBC. “Israel Launches Gaza Air Strike on ‘Hamas Target.’” Last accessed on 12 February 2015, url com/news/world-middle-east-30558922.[3] Pierluigi Paganini. (16 December 2012). The Hacker News. “Yahoo Data Leak by ViRuS_HiMa, Why Do We Need Proactive Security?” Last accessed on 12 February 2015, url com/2012/12/yahoo-data-leak-by-virushima-why-do-we.html.[4] Pierluigi Paganini. (15 March 2013). Security Affairs. “XSS Vulnerabilityin 2shared.com reported by ViRuS_HiMa.” Last accessed on 12 February 2015, url vulnerability-in-2shared-com-reported-by-virus_hima.html.[5] Guest. (15 December 2012). Pastebin. “Yahoo Data Leak by ViRuS_HiMa.” Last accessed on 12 February 2015, url Pxnszw7b.[6] Wikimedia Foundation Inc. (8 February 2015). Wikipedia. “MuslimBrotherhood.” Last accessed on 12 February 2015, url org/wiki/Muslim_Brotherhood.iii | Page© 2015 Trend Micro IncorporatedAPPENDIXThis section provides all of the SHA256 hashes found in relation to Operations Arid Viper and Advtravel and world safe for exchanging digital information. Our innovative solutions for consumers, businesses and governments provide layered content security to protect information on mobile devices, endpoints, gateways, servers and the cloud. All of our solutions are powered by cloud-based global threat intelligence, the Trend Micro™ Smart Protection Network™, and are supported by over 1,200 threat experts around the globe. For more information, visit www.trendmicro.com.©2015 by Trend Micro, Incorporated. All rights reserved. Trend Micro and the Trend Micro t-ball logo are trademarks or registered trademarks of Trend Micro, Incorporated. All other product or company names may be trademarks or registered trademarks of their owners. 