SolutionsServicesCapabilitiesInsightsAboutContactResearch  BRONZE BUTLER Targets Japanese Enterprises LoginTHREAT ANALYSISBRONZE BUTLER Targets Japanese Enterprises Secureworks® Counter Threat Unit™ Threat IntelligenceTHURSDAY, OCTOBER 12, 2017 BY: COUNTER THREAT UNIT RESEARCH TEAM   Summary Secureworks® incident responders and Counter Threat Unit™ (CTU) researchers PDF generated automatically by the PDFmyURL HTML to PDF APIRead the CapabilitiesLEARN MOREinvestigated activities associated with the BRONZE BUTLER (also known as threat group, which likely originates in the People's Republic of China (PRC). BRONZE BUTLER's operations suggest a long-standing intent to exﬁltrate intellectual property and other conﬁdential data from Japanese organizations. Intrusions observed by CTU™ researchers indicate a focus on networks involved in critical infrastructure, heavy industry, manufacturing, and international relations.Tick )andtactical. Executives can use the strategic assessmentstrategicthreat intelligenceabout this threat group intoCTU researchers divided the two sections: of the ongoing threat to determine how to reduce risk to their organization's mission and critical assets. Computer network defenders can use the tactical information gathered from incident response investigations and research to reduce the time and effort associated with responding to the threat group's activities.Key pointsAnalysis of BRONZE BUTLER's operations, targeting, and capability led CTU researchers to assess that it is likely that the group is located in the PRC. The group has used spearphishing, strategic web compromises (SWCs), and an exploit of a zero-day vulnerability to compromise targeted systems. After exﬁltrating targeted data from a network, BRONZE BUTLER typically deletes evidence of its activities. However, it maintains access to compromised environments when possible, periodically revisiting compromised sites to identify new opportunities for data exﬁltration.PDF generated automatically by the PDFmyURL HTML to PDF APIThe threat actors seemingly have the capability to develop and deploy their own proprietary malware tools. The group's command and control (C2) protocols are encrypted, presenting challenges for network defenders and incident responders.Strategic threat intelligence Analysis of a threat group's targeting, origin, and competencies can determine which organizations could be at risk. This information can help organizations make strategic defensive decisions regarding this threat.Intent CTU analysis indicates that BRONZE BUTLER primarily targets organizations located in Japan. The threat group has sought unauthorized access to networks of organizations associated with critical infrastructure, heavy industry, manufacturing, and international relations. Secureworks analysts have observed BRONZE BUTLER exﬁltrating the following categories of data:Intellectual property related to technology and development Product speciﬁcation Sensitive business and sales-related information Network and system conﬁguration ﬁles Email messages and meeting minutesThe focus on intellectual property, product details, and corporate information suggests that the group seeks information that they believe might be of value PDF generated automatically by the PDFmyURL HTML to PDF APIto competing organizations. The diverse targeting suggests that BRONZE BUTLER may be tasked by multiple teams or organizations with varying priorities.Attribution The following characteristics led CTU researchers to assess that it is likely that BRONZE BUTLER originates in the PRC:Use of T-SMB Scan tools published on a Chinese developer's website Chinese characters in the installation service name of an early version of the xxmm backdoor NCPH hacking group during PRC national holidayslinks between BRONZE BUTLER's Daserf tool and the PRC- , and a decrease in BRONZE BUTLER activityPRC-based cyberespionage groups have historically sought intellectual property and economic intelligence from competing economies to deliver information which can provide a competitive advantage domestically. The demand for this type of intelligence gathering could be inﬂuenced by China’s ambitious economic growth goals .Capability BRONZE BUTLER has used a broad range of publicly available (Mimikatz and gsecdump) and proprietary (Daserf and Datper) tools. It appears to have beenPDF generated automatically by the PDFmyURL HTML to PDF APIsufﬁciently resourced to continuously develop and replace its proprietary tools over a long period of time. The threat actors developed remote access tools and malware that generate and use encrypted C2 communication, presumably to complicate detection and mitigation. The threat actors are also ﬂuent in Japanese, crafting phishing emails in native Japanese and operating successfully within a Japanese-language environment.CTU analysis indicates that BRONZE BUTLER purchases a subset of its C2 infrastructure. A large percentage of this infrastructure is hosted in Japan, possibly to avoid scrutiny from security agencies that monitor international communications. The group periodically changes the C2 IP addresses and domains for each compromised network, which can limit the effectiveness of blacklisting the group's infrastructure. The group also supplements its operational infrastructure with access to compromised websites. The breadth and complexity of BRONZE BUTLER's operational infrastructure suggests that the group may have access to a dedicated infrastructure acquisition function.The group has demonstrated the ability to identify a signiﬁcant zero-day vulnerability within a popular Japanese corporate tool and then use scan-and- exploit techniques to indiscriminately compromise Japanese Internet-facing enterprise systems. The threat actors appear to use these initial footholds to select organizations of interest for further compromise. The group is attentive to changes in compromised networks and proactively attempts to avoid scrutiny from network defenders by modifying tools and methods. It has remained undetected in several compromised networks for up to ﬁve years.PDF generated automatically by the PDFmyURL HTML to PDF APITactical threat intelligence Incident response engagements have given CTU researchers insight into the tools and tactics that BRONZE BUTLER employs during intrusions.Tools CTU researchers have observed BRONZE BUTLER leveraging the following tools that appear to be exclusive to the group. Figure 1 shows the threat group's use of some proprietary tools between 2012 and 2017.Figure 1. Timeline of malware used by BRONZE BUTLER. (Source: Secureworks)Daserf — This backdoor has the functionality of a remote shell and can be used to execute commands, upload and download data, capture screenshots, and log keystrokes. It uses RC4 encryption and customPDF generated automatically by the PDFmyURL HTML to PDF APIBase64 encoding to obfuscate HTTP trafﬁc. CTU researchers identiﬁed two versions of Daserf written in Visual C and Delphi. Analysis of the compile timestamps suggest that Delphi version is the successor to the Visual C version. CTU analysis suggests that the following registry entry is an indication of a Delphi-based Daserf infection:Key: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer Value: MMID = <random hex string>Datper — BRONZE BUTLER likely created this Delphi-coded RAT to replace Daserf. Datper uses an RC4-encrypted conﬁguration to obfuscate HTTP trafﬁc. xxmm (also known as Minzen) — This RAT and likely successor to Daserf AES-encrypts HTTP communications using a one-time encryption key. As of this publication, BRONZE BUTLER demonstrates a preference for concurrently using Datper and xxmm in its operations. CTU researchers identiﬁed an xxmm builder for xxmm (see Figure 2), which suggests that the threat actors customize the xxmm malware settings based on the target.PDF generated automatically by the PDFmyURL HTML to PDF APIFigure 2. Customizable settings in an xxmm builder. (Source: Secureworks)xxmm downloader (also known as KVNDM) — This simple downloader's code is similar to the main xxmm payload. Gofarer — This downloader uses the “Mozilla/4.0+ (compatible;+MSIE+8.0;+Windows+NT+6.1;+Trident/4.0;” User-Agent in its HTTP communication (see Figure 3).PDF generated automatically by the PDFmyURL HTML to PDF APIFigure 3. Gofarer HTTP GET request. (Source: Secureworks)MSGet — This persistent downloader uses a dead-drop resolver (DDR) to download and execute another malicious payload. MSGet typically downloads encoded binaries from hard-coded URLs. After decoding, MSGet saves the binary as %TEMP%\ms DGet — This simple downloader (see Figure 4) is similar to the server retrieval tool.exe and executes it.<hex string>.wgetwebFigure 4. DGet usage. (Source: Secureworks)Screen Capture Tool— This tool can capture the desktop of a victim's system (see Figure 5).PDF generated automatically by the PDFmyURL HTML to PDF APIFigure 5. Screen Capture Tool usage. (Source: Secureworks)RarStar — This custom tool uploads RAR archives to a speciﬁed URL as POST data (see Figure 6). RarStar encodes the POST data using Base64 and a custom XOR algorithm.Figure 6. RarStar HTTP POST request. (Source: Secureworks)BRONZE BUTLER has also used the following publicly available tools, but CTU researchers determined that the group modiﬁed most of them. Analysis of the ﬁles identiﬁed the use of multiple packers, adjusted functionality in the source code, and recompilation.PDF generated automatically by the PDFmyURL HTML to PDF APIMimikatz — This tool retrieves passwords from memory. Windows Credential Editor (WCE) — This tool obtains passwords from memory. gsecdump — This tool obtains passwords from memory. T-SMB Scan — This SMB scanning tool was originally published on a Chinese program-sharing website (pudn.com). BRONZE BUTLER removed its help message functionality. WinRAR — This tool extracts tools for lateral movement and compresses data for exﬁltration.Tactics, techniques, and procedures Incident response engagements have given CTU researchers insight into the tactics that BRONZE BUTLER employs during intrusions.Delivery BRONZE BUTLER uses spearphishing emails and SWCs to compromise target networks, often leveraging Flash. The group has used phishing emails with Flash animation attachments to download and execute Daserf malware, and has alsoFlash exploits for SWC attacks.leveragedCTU researchers observed BRONZE BUTLER using compromised websites, typically located in Japan and South Korea, as part of its attack infrastructure. The group has demonstrated a capability to compromise and leverage a large number of websites in its campaigns. Based on the large quantity of C2PDF generated automatically by the PDFmyURL HTML to PDF APIservers and varying IP addresses used during the same operation, the group also appears to purchase attack infrastructure. BRONZE BUTLER has leveraged a distinct attack infrastructure for different targets, suggesting that the group proactively segments operational infrastructure to minimize the risk of attribution by security researchers.Exploitation While investigating a 2016 intrusion, Secureworks incident responders identiﬁed BRONZE BUTLER exploiting a then-unpatched remote code execution vulnerability (CVE-2016-7836) in product used to manage an organization's IT assets. SKY Corporation the vulnerability on December 21, 2016, but entries in the victim's announced SKYSEA Client View default log (CtlCli.log) show that the group had exploited the issue since at least June 2016 (see Figure 7)., a popular JapaneseSKYSEA Client ViewFigure 7. SKYSEA Client View log entries resulting from CVE-2016-7836 exploitation. (Source: Secureworks)This vulnerability can be exposed when a portable connection device, such as an LTE USB modem, is connected to corporate devices. It is common for remote Japanese workers to use portable connection devices to connect toPDF generated automatically by the PDFmyURL HTML to PDF APIthe Internet and corporate VPNs. However, some of these devices assign the ISP's global IP address to the connected laptop. Threat actors could exploit the vulnerability to impersonate the management console, and compromise the laptop's SKYSEA agent that is exposed on the Internet.BRONZE BUTLER conducted periodic Internet scans to ﬁnd vulnerable hosts. CTU researchers veriﬁed that some exploited systems were not subject to further compromise or lateral movement. This outcome suggests that the group may deploy malware to all identiﬁed vulnerable systems, but then pursues speciﬁc targets after validating the system's association with organizations of interest.Installation The threat actors use multiple custom downloaders that rely on executable ﬁles (Gofarer, MSGet, and xxmm downloader), PowerShell scripts, or VBS/VBE scripts. These downloaders use HTTP trafﬁc, download an additional payload such as Daserf, Datper, or xxmm in a compressed and encoded format, and typically execute the downloaded malware after decoding the ﬁle.CTU researchers identiﬁed the code in Figure 8 within a downloader program. This code inserts ‘0' characters at the end of the executable ﬁle to inﬂate the ﬁle size to 50-100 MB, likely to evade antivirus software detection. When analyzing BRONZE BUTLER incidents, CTU researchers observed several antivirus tools skip scanning of inﬂated ﬁles.PDF generated automatically by the PDFmyURL HTML to PDF APIFigure 8. Downloader malware code used to inﬂate payload ﬁle size. (Source: Secureworks)CTU researchers also observed BRONZE BUTLER copying downloader source code to a ﬁle (do.cs) on a compromised system and then compiling it into an executable ﬁle (do.exe). The decrypted proxy log shows the threat actors compiling custom code on the compromised system (see Figure 9).Figure 9. Decrypted proxy log showing compilation of custom code onPDF generated automatically by the PDFmyURL HTML to PDF APIcompromised endpoint. (Source: Secureworks)Command and control (C2) communication Daserf, Datper, and xxmm communicate with C2 servers via HTTP, encrypting commands and data using the algorithms in Table 1. The tools use an Internet Explorer component to bypass proxy authentication as long as the compromised system communicates during the authorized times deﬁned by the proxy server.HTTP methodsEncryption algorithm Malware Daserf (Visual C) POST RC4 Daserf (Delphi) GET (POST for large data) RC4 GET (POST for large data) RC4 GET (POST for large data) RC4Table 1. Daserf, Datper, and xxmm encryption algorithms.AES with one-time encryption keyBRONZE BUTLER uses unique C2 servers for each tool and changes C2 servers periodically. A large proportion of the group's C2 servers are hosted in Japan. The presence of certain URL patterns in proxy logs (see Table 2) can reveal BRONZE BUTLER activity.Malware URL patternUser-AgentPDF generated automatically by the PDFmyURL HTML to PDF APIDaserf<domain/path> string> <4 lowercase characters><string similar to Base64-encoded string>.gif .asp .php?id=<8-digit hex=Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; SV1) Internet Explorer version number may varyDatper url hex string><random string> http:// characters><16-digit hex string> <string similar to Base64-encoded string><lowercase.php?21=PDF generated automatically by the PDFmyURL HTML to PDF APIMozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; SV1)<8-digit hex<number> <8-digit hex<number>&idcard6=.php?t0= string> <number> <number> idcard1=<number>&idcard2 string> <number> <8-digit hex string> <number> <number> ﬁlename>.php?item0= <number><8-digit hex <8-digit hex <number><random /<8-digit hex<8-digit hex <number>=<8-digit hex =<8-digit hex <number> <8-digit hex <8-digit hex <number> <8-digit hex<8-digit hex <number> <8-digit hexTable 2. URL patterns related to BRONZE BUTLER activity.PDF generated automatically by the PDFmyURL HTML to PDF APIBRONZE BUTLER leverages the remote access capabilities in these tools, often using existing PC vendors' directories such as C:\DELL and C:\HP as working directories in compromised environments. CTU researchers have also observed threat actors using the following working directories:C:\Intel\ C:\Intel\Logs\ C:\Intel\ExtremeGraphics\CUI\ C:\PerfLogs\Admin\Credential access BRONZE BUTLER uses credential theft tools such as Mimikatz and WCE to steal authentication information from the memory of compromised hosts. Several xxmm samples analyzed by CTU researchers incorporate Mimikatz, allowing the threat actors to issue Mimikatz commands directly from xxmm (see Figure 10). In addition, xxmm incorporates a UAC bypass tool for privilege escalation prior to stealing passwords.Figure 10. Mimikatz command in xxmm. (Source: Secureworks)CTU analysis revealed BRONZE BUTLER creating forged Kerberos Ticket Granting Ticket (TGT) and Ticket Granting Service (TGS) tickets (also calledPDF generated automatically by the PDFmyURL HTML to PDF APIgolden and silver tickets, respectively) to maintain administrative access. Figure 11 shows an example of the threat actors creating a golden ticket.Figure 11. Kerberos golden ticket created by BRONZE BUTLER. (Source: Secureworks)Golden tickets require a username, but the domain controller does not validate that it is legitimate. CTU researchers detected BRONZE BUTLER using the following usernames for golden tickets:bgtras The threat actors typically use built-in Windows ping and net commands for network and host enumeration activity to eventually contact the ﬁle-share server (see Figure 12). BRONZE BUTLER also uses the T-SMB Scan tool to list available SMB hosts, and screen-capture tools to obtain additional information.PDF generated automatically by the PDFmyURL HTML to PDF APIFigure 12. Host enumeration by BRONZE BUTLER. (Source: Secureworks)Lateral movement After compromising a host, the threat actors attempt to compromise other connected systems to move within the network. BRONZE BUTLER typically uses the following procedure for lateral movement:1. Use ‘net use' and ‘copy' commands to transfer a malicious ﬁle (such as malware) from the compromised host to a target system on the same network.2. Use the ‘net time' command to check the local time on the targetsystem.3. Use the ‘at' or ‘schtask' commands to register a scheduled task tobe executed in a few minutes.4. After a few minutes, execute the malicious ﬁle on the system.The malicious ﬁle is typically a batch ﬁle that downloads malware and registers the malware's automatic execution in the registry. Figure 13 shows the PDF generated automatically by the PDFmyURL HTML to PDF APIscheduled task that executes zrun.bat (a batch ﬁle) using the at command.Figure 13. Scheduled task registration. (Source: Secureworks)Figure 14 shows the batch ﬁle (zrun.bat) executing, which adds a registry entry that auto-executes the malware.Figure 14. Registry entry added to auto-execute malware. (Source: Secureworks)CTU researchers have also observed BRONZE BUTLER giving malware the same name as an existing document ﬁle on the ﬁle share server to cause users to unwittingly launch and install the malware on additional systems (see Figure 15).Figure 15. Malware given the same name as an existing document ﬁle. (Source:PDF generated automatically by the PDFmyURL HTML to PDF APISecureworks)Exﬁltration BRONZE BUTLER typically creates a list of ﬁles (i.e., a shopping list) from compromised hosts and ﬁle-share servers. If the list is short, the group exﬁltrates the ﬁles directly. For large lists, the threat actors use the following procedure:1. Use malware to upload the large list of enumerated ﬁles to the C2server.2. Select speciﬁc ﬁles to steal, creating a new list. 3. Use downloaders or other malware to send the new list to acompromised host.4. Use archiving software to collect ﬁles in a password-protectedarchive.5. Use an uploader or other malware to send the archived ﬁles to anattacker-controlled server. The uploader software is proprietary to this group, but Datper and xxmm also contain an uploading feature. When exﬁltration is complete, the uploader (or Datper or xxmm) immediately uses the del command to delete the RAR archives.Figure 16 shows BRONZE BUTLER extracting a new list of ﬁles and archiving a speciﬁc ﬁle into RAR format for exﬁltration.PDF generated automatically by the PDFmyURL HTML to PDF APIFigure 16. Extracting a new ﬁle list and archiving a targeted ﬁle for exﬁltration. (Source: Secureworks)The group uses a password to encrypt ﬁles for RAR archiving. CTU researchers have observed the following passwords used in BRONZE BUTLER network BRONZE BUTLER compromises organizations to conduct cyberespionage,PDF generated automatically by the PDFmyURL HTML to PDF APIprimarily focusing on Japanese enterprises. Initial attack vectors include spearphishing emails, SWCs, and exploiting vulnerability in software commonly used by Japanese businesses. The group can override security controls to exﬁltrate intellectual property, and victims should formulate a solid eviction plan before engaging with the threat actors to prevent them from reentering the network.CTU researchers recommend that organizations, particularly those whose assets and intellectual property could be valuable to BRONZE BUTLER, implement the following security practices:AETD) to log detailed Windows event information to assist with incidentReview proxy log settings to ensure they capture information such as HTTP parameters and User-Agents for future analysis. Search proxy log ﬁles for evidence of web server scanning using the URL patterns associated with BRONZE BUTLER activity. Use an advanced endpoint threat detection ( ) solution to monitor activity on network endpoints. Install a background monitor tool (e.g., Implement timely vulnerability patching and system updates. Update SKYSEA Client View implementations to the latest version as soon as possible. Review network access control. In particular, review network access for use of mobile USB modems on corporate systems. Also implement strict security controls for privileged accounts such as Active Directory administrator to prevent access by an unauthorized user.PDF generated automatically by the PDFmyURL HTML to PDF APIThreat indicators The indicators in Table 3 are associated with BRONZE BUTLER activity. The URLs may contain malicious content, so consider the risks before opening them in a browser.Indicator (Visual C)Daserf host toolsUsed by host toolsurlﬂashinfo/ns12.jpgurlﬂashinfo/pageicons/6.jpgurl generated automatically by the PDFmyURL HTML to PDF APIURLURLURLURLURLUsed by host toolsUsed by pointurl pointTable 3. BRONZE BUTLER indicators.   Enjoyed what you read? Share it!RELATED CONTENTPDF generated automatically by the PDFmyURL HTML to PDF APIBLOGTHREAT ANALYSISBLOGSecureworks at GISEC 2018 – 1st – 3rd May 2018,… Dubai World Trade CenterSecureworksGOLD GALLEON: How a Nigerian Shipping IndustryCounter Threat Unit™ Research 2018SecureworksPDF generated automatically by the PDFmyURL HTML to PDF APICareersRSS FeedManage SubscriptionsSitemapPrivacy Policy USATerms & ConditionsDell Technologies©2018SecureWorks, Inc.PDF generated automatically by the PDFmyURL HTML to PDF API 