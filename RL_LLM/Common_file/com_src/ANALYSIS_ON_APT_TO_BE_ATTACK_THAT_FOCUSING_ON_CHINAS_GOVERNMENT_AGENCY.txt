ANALYSIS ON APT-TO-BE ATTACK THATFOCUSING ON CHINA'S GOVERNMENTAGENCYAntiy CERTFirst release time: 14:32, May 27, 2015Updated time of this version: 14:32, May 27, 2015Analysis on APT-to-be Attack That Focusing on China's Government AgencyContents1 2BACKGROUND 1 ANALYSIS ON INCIDENT SAMPLE 12.1LEADING FILES AND SAMPLE DOWNLOADING 12.2KEY MECHANISM 32.3ANALYSIS ON THE MAJOR SAMPLE (SAMPLE B) OF APT-TOCS 32.4ANALYSIS ON SCRIPT 1 32.5ANALYSIS ON MODULE 1 42.6ANALYSIS ON MODULE 2 52.7ANALYSIS ON MODULE 3 63THE AUTHENTICATION ANALYSIS ON THE TECHNOLOGY SOURCES OF THIS ATTACK 73.1COMPARISON OF MODULE 1 83.2COMPARISON OF DISASSEMBLING COMMANDS OF MODULE 2 93.3COMPARISON ANALYSIS ON MODULE 3 DATA PACKAGE 103.4CHARACTERISTICS OF COBALT STRIKE 11CONCLUSION 11 4 APPENDIX 1 REFERENCES OF COBALT STRIKE AND THE AUTHOR 12 ption at t h e e n t r y a_nai)Sample module 2Relevant Beacon files© Antiy Labs. All rights reserved.Page 9Analysis on APT-to-be Attack That Focusing on China's Government AgencyThe calls3.3 Comparison analysis on module 3 data packageThe following figure is the GET request comparison of the module generated by sample module 3 and Beacon.Here we can see both of them use Cookie to transmit information that has been encrypted, and send requestsactively every 60 seconds. The data package is heartbeat.© Antiy Labs. All rights reserved.Page 10Analysis on APT-to-be Attack That Focusing on China's Government AgencyFigure 16 Comparison of module 3 data package3.4 Characteristics of Cobalt StrikeUsing Cobalt Strike attack can execute various operations in the targeted systems, such as downloading anduploading files, executing designated programs, injecting keyboard recorder, executing commands via PowerShell,importing PowerShell script, executing commands via CMD, accessing system passwords and so on.Cobalt Strike has the following characteristics: Penetrating sandbox Avoiding whitelist mechanism and cloud detectionIntranet penetration Persistent attacks Attacking various platforms4 ConclusionWith an automated test platform Cobalt Strike, the attack penetration can penetrate firewall, the approach theattackers used to control targeted host is covert and undetectable; what’s more, it can attack various platforms, such© Antiy Labs. All rights reserved.Page 11Analysis on APT-to-be Attack That Focusing on China's Government Agencyas Windows, Linux, Mac etc.; it’s formidable adversary to Trusted Computing, Cloud Detection, SandboxDetection and so on. According to the traces in the past, we believe that the threat has been active for 5 years;unfortunately, there isn’t any powerful detection production and methods to defeat the malicious attack till now.The reason why the CERT Analysis Team of ANTIY classified APT-TOCS into APT incidents is that it’s a kind oftargeted attack (one of the features of APT attack), it has anti-detection functions and also it can conceal itself.Compared with APT incidents in the past, the APT attack in this case doesn’t cost too much, and the attackersaren’t responsible for coding. With the application of commercial attack platform, the attackers saved the cost ofan attack, also the vulnerability built joint function provided by relevant attack platform make the attackers easy todo injection. As a result, nations and organizations which without its own elite hacker groups and abundant capitalcan also launch some kind of APT attack via the attack pattern mentioned in this case. Meanwhile, it’s moredifficult for us to tracing when facing such modeled attack.One of the leaders in Information Security area-Bruce Schiner said, “when big events on information securityhappened, people tend to treat it as an example of cyber warfare. It’s ridiculous. From my point of view, what’shappening and going to happen is: more and more tactics in physical warfare are applied to cyber warfare. It’simportant to note that, attack capabilities can be widely distributed if attackers take full advantages of certaintechnology, especially computer technology can make attack more powerful and automated.” Obviously, highlyautomated commercial platform realized a high speed of spread of this attack capability (exceeded ouranticipation).We have to remind all relevant parties that we are confronting with the risk of large scale diffusion of networkarmaments which is led by the low cost of the attack capability. The commercial penetration attack detectingplatform has two sides, on one hand, it can check the network environment of systems effectively, on the other hand,for nations, organizations and industries which has limited budget, it costs too much. Given the situation, all relatedparties should conduct more communication with each other, additionally, there is no doubt that both offensiveparty and defensive party are supported by superpowers, these superpowers should prevent the attack techniquefrom widely distributing.The incident mentioned there has no difference with other cases we detected in the past, it shows that, on the way torealize national informatizaion, we must fight against serious security challenges as we confronting now; it’s also agood opportunity for our Chinese people and enterprises to demonstrate our faith and the efforts we made toconquer the challenge.Appendix 1 References of Cobalt Strike and the authorCobalt Strike is the business version of Armitage which is the penetration testing software of Metasploit figureinterface written by Java. Armitage can carry out automatic attacks by combining with known exploits ofMetasploit. It integrates the free version of Armitage under bt5 and kali linx, and the most powerful functionality isadding the Payload of Beacon.The first release time of Cobalt Strike is June, 2012.VersionDescriptionCobalt Strike1.45 andtheIt can connect the metasploit of Windows. Then it must connect metasploit of Linux.© Antiy Labs. All rights reserved.Page 12Analysis on APT-to-be Attack That Focusing on China's Government Agencyformer versionsCobalt Strike1.46System analyzer used return steps to check on Java report version, and fixed the exploits generatedby private key.Cobalt Strike1.47Relieved multiple Beacon information backlog; had a overall check when dictograph was on.Cobalt Strike1.48Adding timestomp command to Beacon; the waiting time of copying bypassuac privilege filesCobalt Strike1.49Fixed Beacon HTTP Stager payload generator of Windows XP.lasted 10 seconds.Cobalt Strike2.0Cobalt Strike2.1Cobalt Strike2.2C&C of plasticity, adding option “veil” to the payload generator.PowerShell command started major local PowerShell; updated build.sh tool.Reconstructed the VNC server of process injecting and connecting with targeted system. The newprocess is easier to be neglected due to the host firewall. The exploit report showed URL quotesfrom ZDI, MSB, US-CERT-VU and WPVDB.Cobalt Strike2.3Compiled the DNS field of Beacon with customized encoder. Beacon added command runas andpwd.Cobalt Strike2.4Adding time stamp to view - >web log; regenerating new default Beacon HTTPS certification withdifferent parameters; then generating C2 HTTPS certification; updating executable files and defaulttool kit of DLLS.Author of Cobalt Strike: Raphael MudgeRaphael Mudge is the founder of Strategic Cyber LLC, a Washington, DC based company that creates software forred teams. He created Armitage for Metasploit, the Sleep programming language, and the IRC client jIRCii.Previously, Raphael worked as a security researcher for the US Air Force, a penetration tester, and he even inventeda grammar checker that was sold to Automattic. His work has appeared in Hakin9, USENIX ;login:, Dr. Dobb'sJournal, on the cover of the Linux Journal, and the Fox sitcom Breaking In. Raphael regularly speaks on securitytopics and provides red team support to many cyber defense competitions.Education background: Syracuse University, Michigan Technological UniversityCurrent position: Strategic Cyber LLC , Delaware Air National GuardSkills: software development, information security, object-oriented design, distributed system, figure interface,computer network design, blog system, social engineering, security research and so on.© Antiy Labs. All rights reserved.Page 13Analysis on APT-to-be Attack That Focusing on China's Government AgencyCompany/Project/OrganizationPostionTimeStrategic cyber LLCFounder and PrincipalJanuary, 2012-nowDelaware Air National GuardMajor2009-nowCobalt strikeTDIAutomatticPrincipal InvestigatorNovember, 2011- May, 2012Senior Security EngineerAugust, 2010 – June, 2011Code WranglerJuly, 2009 – August, 2010Feedback Army, After the DeadlineFounderJuly, 2008 –November, 2009Air Force Research LaboratorySystems EngineerApril, 2006 – March, 2008US Air ForceCommunications andMarch, 2004 - March, 2008Information OfficerSupported organizations:Collegiate Cyber Defense Competition (CCDC)North East CCDC 2008-2015Mid Atlantic CCDC 2011-2015Pacific Rim CCDC 2012, 2014South East CCDC - 2014Western Regional CCDC - 2013National CCDC 2012-2014Projects: Sleep Scripting LanguageAn extensible general purpose language with Perl inspired syntax for the Java platform. Sleep is open source,licensed under the LGPL.jIRCiiScriptable Internet Relay Chat client for Windows, MacOS X, and Linux. jIRCii is open source, licensedunder the artistic license.Published works:Live-fire Security Testing with Armitage and MetasploitGet in through the backdoor: Post exploitation with ArmitageTutorial: Hacking Linux with Armitage© Antiy Labs. All rights reserved.Page 14Analysis on APT-to-be Attack That Focusing on China's Government AgencyThe Design of a Proofreading Software ServiceAgent-based Traffic GenerationContribution:cortana-scriptsmetasploit-loadermalleable-c2-profileslayer2-privoting-clientarmitageProjects:Enterprise-level business cooperationAfter the DeadlineFeedback ArmyCobalt StrikeOpen source softwareArmitageFar EastjIRCiiMocontiOne Hand Army Man sphPERL Same GameSleepReference linking:url （google+）url (GitHub)url (youtube)url~raffi/index.htmlurl© Antiy Labs. All rights reserved.Page 15Analysis on APT-to-be Attack That Focusing on China's Government Agencyurl 2 About AntiyAntiy Labs is a professional next-generation security-testing engine R&D enterprise. Antiy’s engines provide theability to detect various viruses and malware for network security products and mobile devices, which are used bymore than ten well known security vendors. Antiy’s engines are embedded in tens of thousands of firewalls and tensof millions of mobile phones all over the world. Antiy Labs is awarded the “Best Protection” prize by AV-TEST in2013. Based on engines, sandboxes and background systems, Antiy Labs will continue to provide traffic-basedanti-APT solutions for enterprises.More information about antivirus engine,url (Chinese)More information about anti-APT products ofurl (English)Antiy,© Antiy Labs. All rights reserved.Page 16 