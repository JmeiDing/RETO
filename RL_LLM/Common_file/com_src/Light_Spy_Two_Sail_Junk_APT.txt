3/27/2020iOS exploit chain deploys “LightSpy” feature-rich malware | SecurelistiOS exploit chain deploys LightSpy feature-rich malwaresecurelist.com/ios-exploit-chain-deploys-lightspy-malware/96407Alexey Firsh, Kurt Baumgartner, Brian BartholomewA watering hole was discovered on January 10, 2020 utilizing a full remote iOS exploit chain to deploy a feature-rich implant named LightSpy. The site appears to have been designed to target users in Hong Kong based on the content of the landing page. Since the initial activity, we released two private reports exhaustively detailing spread, exploits, infrastructure and LightSpy implants.Landing page of watering hole siteWe are temporarily calling this APT group “TwoSail Junk”. Currently, we have hints from known backdoor callbacks to infrastructure about clustering this campaign with previous activity. And we are working with colleagues to tie LightSpy with prior activity from a long running Chinese-url exploit chain deploys “LightSpy” feature-rich malware | Securelistspeaking APT group, previously reported on as Spring Dragon/Lotus Blossom/Billbug(Thrip), known for their Lotus Elise and Evora backdoor malware. Considering this LightSpy activity has been disclosed publicly by our colleagues from TrendMicro, we would like to further contribute missing information to the story without duplicating content. And, in our quest to secure technologies for a better future, we reported the malware and activity to Apple and other relevant companies.This supplemental information can be difﬁcult to organize to make for easy reading. In light of this, this document is broken down into several sections.1. Deployment timeline – additional information clarifying LightSpy deployment milestone events, including both exploit releases and individual LightSpy iOS implant component updates.2. Spreading – supplemental technical details on various techniques used to deliver maliciouslinks to targets3. Infrastructure – supplemental description of a TwoSail Junk RDP server, the LightSpyadmin panel, and some related server-side javascript4. Android implant and a pivot into evora – additional information on an Android implant and related infrastructure. After pivoting from the infrastructure in the previous section, we ﬁnd related implants and backdoor malware, helping to connect this activity to previously known SpringDragon APT with low conﬁdence.More information about LightSpy is available to customers of Kaspersky Intelligence Reporting. Contact: intelreports@kaspersky.com Deployment timeline During our investigation, we observed the actor modifying some components involved in the exploit chain on February 7, 2020 with major changes, and on March 5, 2020 with minor ones.Figure 1. Brief LightSpy event timelineurl exploit chain deploys “LightSpy” feature-rich malware | SecurelistThe ﬁrst observed version of the WebKit exploit dated January 10, 2020 closely resembled a proof of concept (PoC), containing elements such as buttons, alert messages, and many log statements throughout. The second version commented out or removed many of the log statements, changed alert() to print() statements, and also introduced some language errors such as “your device is not support…” and “stab not ﬁnd…”.By analyzing the changes in the ﬁrst stage WebKit exploit, we discovered the list of supported devices was also signiﬁcantly extended: Table 1. iOS version exploit support expansioniOS version Supported as of Jan 10 Supported as of Feb 7 iPhone 6S 12.01 iPhone 7+ 12.2 iPhone 8+ 12.2 –As seen above, the actor was actively changing implant components, which is why we are providing a full list of historical hashes in the IoC section at the end of this report. There were many minor changes that did not directly affect the functionality of each component, but there were also some exceptions to this that will be expanded on below. Based on our observations of these changes over a relatively short time frame, we can assess that the actor implemented a fairly agile development process, with time seemingly more important than stealthiness or quality.One interesting observation involved the “EnvironmentalRecording” plugin (MD5: responsible for recording surrounding audio and phone calls. On February 7, 2020, we noticed a to the earlier one. This new ﬁle did not contain any environment paths, version stamps, or any other traces from the parent plugin pattern. Its sole purpose was to clean up the implanturl exploit chain deploys “LightSpy” feature-rich malware | Securelistcomponents by erasing all ﬁles located in “/var/iolight/”, “/bin/light/”, and “/bin/irc_loader/”. We’re currently unsure whether the actor intended to replace the original plugin with an uninstall package or if this was a result of carelessness or confusion from the rapid development process.Another example of a possible mistake involved the “Screenaaa” plugin. The ﬁrst version (MD5: expected: It was a small plugin designed to capture a screenshot, create a directory, and save the with the same name that was packaged on February 7 had a completely different functionality. This binary was actually a LAN scanner based on MMLanScan, an open source project for iOS that helps scan a network to show available devices along with their MAC addresses, hostname, and manufacturer. Most likely, this plugin was mistakenly bundled up in the February 7 payload with the same name as the screenshot plugin.Figure 2. LightSpy iOS implant component layout and communicationsSpreading We cannot say deﬁnitively that we have visibility into all of their spreading mechanisms. We do know that in past campaigns, precise targeting of individuals was performed over various social network platforms with direct messaging. And, both ours and previous reporting from others have documented TwoSail Junk’s less precise and broad use of forum posts and replies. These forum posts direct individuals frequenting these sites to pages hosting iframes served from their exploit servers. We add Telegram channels and instagram posts to the list of communication channels abused by these attackers.These sites and communication medium are known to be frequented by some activist groups.url exploit chain deploys “LightSpy” feature-rich malware | SecurelistFigure 3. LightSpy iPhone infection stepsThe initial watering hole site (hxxps://appledaily.googlephoto[.]vip/news[.]html) on January 10, 2020 was designed to mimic a well known Hong Kong based newspaper “Apple Daily” by copy- pasting HTML content from the original:Figure 4. Source of html page mimicking newspaper “Apple Daily”However, at that time, we had not observed any indications of the site being purposely distributed in the wild. Based on our KSN detection statistics, we began seeing a massive distribution campaign beginning on February 18, 2020.url exploit chain deploys “LightSpy” feature-rich malware | SecurelistTable 2. LightSpy related iframe domains, urls, and ﬁrst seentimestampsStarting on February 18, the actors began utilizing a series of invisible iframes to redirect potential victims to the exploit site as well as the intended legitimate news site from the lure.Figure 5. Source of html page with lure and exploitInfrastructureRDP Cluesurl exploit chain deploys “LightSpy” feature-rich malware | SecurelistThe domain used for the initial watering hole page (googlephoto[.]vip) was registered through GoDaddy on September 24, 2019. No unmasked registration information was able to be obtained for this domain. The subdomain (appledaily.googlephoto[.]vip) began resolving to a non-parked IP address (103.19.9[.]185) on January 10, 2020 and has not moved since. The server is located in Singapore and is hosted by Beyotta Network, LLP.At the time of our initial investigation, the server was listening on ports 80 (HTTP) and 3389 (RDP with SSL/TLS enabled). The certiﬁcate for the server was self-signed and created on December 16, 2019. Based on Shodan data as early as December 21, 2019, there was a currently logged in user detected who’s name was “SeinandColt”.Figure 6. Screenshot of RDP login page for the server 103.19.9[.]185Admin Panel The C2 server for the iOS payload (45.134.1[.]180) also appeared to have an admin panel on TCP port 50001.url exploit chain deploys “LightSpy” feature-rich malware | SecurelistThe admin panel seems to be a Vue.js application bundled with Webpack. It contains two language packs: English and Chinese. A cursory analysis provides us the impression of actual scale of the framework:If we take a closer look at the index.js ﬁle for the panel, some interesting conﬁgurations are visible, to include a user conﬁg, an application list, log list, and other interesting settings.The “userConﬁg” variable indicates other possible platforms that may have been targeted by the same actors, such as linux, windows, and routers.url exploit chain deploys “LightSpy” feature-rich malware | SecurelistAnother interesting setting includes the “app_list” variable which is commented out. This lists two common applications used for streaming and chat mostly in China (QQ and Miapoi). Looking further, we can also see that the default map coordinates in the conﬁg point directly to the Tian’anmen Gate in Beijing, however, most likely this is just a common and symbolic mapping application default for the center of Beijing.Android implants and a pivot into “evora”url exploit chain deploys “LightSpy” feature-rich malware | SecurelistDuring analysis of the infrastructure related to iOS implant distribution we also found a link directing to Android malware – hxxp://app.hkrevolution[.]club/HKcalander[.]apk (MD5: “winuxhk” and “brothersisterfacebookclub”, and Instagram posts in late November 2019 with a message lure in Chinese translated as “The Hong Kong People Calendar APP is online ~~~ Follow the latest Hong Kong Democracy and Freedom Movement. Click to download and support the frontline. Currently only Android version is available.”Further technical analysis of the packed APK reveals the timestamp of its actual build – 2019-11- 04 18:12:33. Also it uses the subdomain, sharing an iOS implant distribution domain, as its c2 server – hxxp://svr.hkrevolution[.]club:8002.Its code contains a link to another related domain:Checking this server we found it hosted another related APK:MD5 hxxp://movie.poorgoddaay[.]com/MovieCal[.]apk hxxp://app.poorgoddaay[.]com:8002The distribution vector remains the same – Telegram channels:The latest observed APK sample is hosted on a server that is unusual for the campaign context – xxinc-media[.]oss-cn-shenzhen.aliyuncs[.]com. We assume that the actors are taking steps to split the iOS and Android activities between different infrastructure pieces.url exploit chain deploys “LightSpy” feature-rich malware | SecurelistMD5 hxxps://xxinc-media.oss-cn-shenzhen.aliyuncs[.]com/calendar-re‐ lease-1.0.1.apk hxxp://45.134.0[.]123:8002 2020-01-14 18:30:30We had not observed any indications of this URL being distributed in the wild yet.If we take a look closer at the domain poorgoddaay[.]com that not only hosted the malicious APK but also was a C2 for them, we can note that there are two subzones of particular interest to us:zg.poorgoddaay[.]com ns1.poorgoddaay[.]comWe were able to work with partners to pivot into a handful of “evora” samples that use the above two subzones as their C2. Taking that a step further, using our Kaspersky Threat Attribution Engine (KTAE), we can see that the partner samples using those subzones are 99% similar to previous backdoors deployed by SpringDragon.We are aware of other related and recent “evora” malware samples calling back to these same subnets while targeting organizations in Hong Kong as well. These additional factors help lend at least low conﬁdence to clustering this activity with SpringDragon/LotusBlossom/Billbug. Conclusion This particular framework and infrastructure is an interesting example of an agile approach to developing and deploying surveillance framework in Southeast Asia. This innovative approach is something we have seen before from SpringDragon, and LightSpy targeting geolocation at least falls within previous regional targeting of SpringDragon/LotusBlossom/Billbug APT, as does infrastructure and “evora” backdoor use.url exploit chain deploys “LightSpy” feature-rich malware | SecurelistSource: wikimedia.orgIndicators of CompromiseFile hashes payload.dylib Domains and IPs Implant c2 45.134.1[.]180 (iOS) 45.134.0[.]123 (Android) app.poorgoddaay[.]com (Android) svr[.]hkrevolution[.]club (Android)WebKit exploit landing 45.83.237[.]13 messager[.]cloudSpreading appledaily.googlephoto[.]vip www[.]googlephoto[.]vip news2.hkrevolution[.]club news.hkrevolution[.]club www[.]facebooktoday[.]cc www[.]hkrevolt[.]com news.hkrevolt[.]com movie.poorgoddaay[.]com xxinc-media[.]oss-cn-shenzhen.aliyuncs[.]comRelated subdomains app.hkrevolution[.]club news.poorgoddaay[.]com zg.poorgoddaay[.]com ns1.poorgoddaay[.]com Full Mobile Device Command List get_wechat_msgurl exploit chain deploys “LightSpy” feature-rich malware | Securelistget_wechat_ﬁle screenshoturl 