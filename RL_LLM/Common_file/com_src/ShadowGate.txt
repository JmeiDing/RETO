2/11/2020ShadowGate Returns to Worldwide Operations With Evolved Greenﬂash Sundown Exploit Kit - TrendLabs Security Intelligence BlogTrend Micro About TrendLabs Security Intelligence BlogSearch:Home CategoriesHome » Exploits » ShadowGate Returns to Worldwide Operations With Evolved Greenﬂash Sundown Exploit KitShadowGate Returns to Worldwide Operations With Evolved Greenﬂash Sundown Exploit KitPosted on:June 27, 2019 at 7:16 am Posted in:Exploits Author: Joseph C Chen (Fraud Researcher)0After almost two years of sporadic restricted activity, the ShadowGate campaign has started delivering cryptocurrency miners with a newly upgraded version of the Greenﬂash Sundown exploit kit. The campaign has been spotted targeting global victims, after operating mainly in Asia. Background of the Greenﬂash Sundown exploit kiturlﬂash-sundown-exploit-kit/1/72/11/2020 ShadowGate Returns to Worldwide Operations With Evolved Greenﬂash Sundown Exploit Kit - TrendLabs Security Intelligence Blog The ShadowGate (also called WordsJS) campaign was identiﬁed in 2015. It delivered malware with exploit kits through the compromised ad servers of Revive/OpenX advertising software. After a takedown operation on September 2016, the campaign tried to hide their activities. However, that same year they also developed their own exploit kit, which we named Greenﬂash Sundown, likely to avoid using exploit kit services from the underground market. At the end of 2016, the campaign stopped their injection attacks on the compromised ad servers and restricted their activity to spreading ransomware via compromised South Korean websites. In April 2018, ShadowGate was spotted spreading cryptocurrency miners with Greenﬂash Sundown. However, the injection was limited to servers in East Asian countries and soon stopped. After a period of relatively restrained activities, we noticed ShadowGate attacking through ad servers again this June. However, these attacks were not just targeting regional victims but global ones. Visitors to websites embedded with malicious advertisements (from the compromised ad servers) were redirected to the Greenﬂash Sundown exploit kit and infected with a Monero cryptocurrency miner. This is the most notable activity we have seen from this group since 2016. Despite their low proﬁle over the past couple of years, it seems that they have been continuously developing and evolving their exploit kit. Below is a report on how the Greenﬂash Sundown exploit kit has changed since we discovered it in 2016, including details of their latest activity. Greenﬂash Sundown reﬁned evasion and targeting techniques ShadowGate is invested in the continuous development of their exploit kit. In 2018, Greenﬂash Sundown was spotted integrating the Flash exploit for CVE-2018-4878 prior to other exploit kits. Greenﬂash Sundown was then identiﬁed using another Flash exploit for CVE-2018-15982 this April. The continuous updates of the kit to include new exploits allows it to maintain its infection rate.Figure 1. Attack ﬂow of ShadowGate and the Greenﬂash Sundown exploit kiturlﬂash-sundown-exploit-kit/2/72/11/2020ShadowGate Returns to Worldwide Operations With Evolved Greenﬂash Sundown Exploit Kit - TrendLabs Security Intelligence BlogFigure 2. Timeline of ShadowGate Activity (data from Trend Micro Smart Protection Network)Figure 3. Country distribution of ShadowGate Activity (data from Trend Micro Smart Protection Networkfrom June 7, 2019 to June 24, 2019)During the latest attack of ShadowGate that started this June, we found that they had another version of the payload. Last November, we saw that this exploit kit used the same encryption technique to protect their malware payload during the last infection stage. However, this time they used the encryption from the ﬁrst few communications to encrypt all of their trafﬁc during infection.urlﬂash-sundown-exploit-kit/3/72/11/2020 ShadowGate Returns to Worldwide Operations With Evolved Greenﬂash Sundown Exploit Kit - TrendLabs Security Intelligence Blog The encryption technique is as follows: ﬁrst, the victim generates a random number called a nonce to produce a unique secret key during each attack. The secret key will be encrypted by a public key and then securely sent to the exploit kit. The exploit kit — using a private key — can recover the secret key and use it to encrypt the malicious payload that will be delivered with the RC4 algorithm (a cipher algorithm requiring a shared key for decryption). The payload will then be sent to the victim, who will decrypt it with the secret keys. This encryption technique is supposed to prevent security solutions from detecting their malicious payload as it is transferred to the victim. In theory, because the secret key only exists in memory and is not supposed to be transferred directly in plaintext, it is difﬁcult for a threat analyst to ﬁnd the secret key and decrypt the malicious payload. The use of public key encryption algorithm was also seen in the exploit kit Underminer, which we discovered last year. However, we found that the hackers behind the Greenﬂash Sundown exploit kit made a mistake with their encryption. They used the generated nonce not only for generating the secret key but also as a key of RC4 to encrypt victim’s WebGL information before sending it to exploit kit server. The generated nonce was actually sent in plaintext during their communication, which makes it accessible and readable. With the nonce, it becomes possible to reproduce the secret key and decrypt the malicious payload ofﬂine.Figure 5. The Greenﬂash Sundown exploit kit encrypts the secret key with JSEncrypt library (deobfuscated) The latest version of the Greenﬂash Sundown exploit kit also features an updated PowerShell loader. Since November 2018, we noticed the exploit kit started to use a PowerShell loader, which makes it capable of ﬁleless malware infection. The upgraded loader in this new version is now capable of collecting a proﬁle of the victim’s environment and sending the information to the exploit kit server. This allows its operators to be more precise in their targeting. If the victim’s proﬁle ﬁts their speciﬁcations, the malware will deliver its payload. Otherwise, the server will return an empty response. The upgrade also helps them avoid sandboxes or honeypots that can capture their malware. The information taken from the victim includes OS details, user name, video card, hard disk information, and antivirus products.Figure 6. The PowerShell loader sends victim’s proﬁle and loads a malware payload with ﬁleless infection Recommendations and Solutionsurlﬂash-sundown-exploit-kit/4/72/11/2020 ShadowGate Returns to Worldwide Operations With Evolved Greenﬂash Sundown Exploit Kit - TrendLabs Security Intelligence Blog Cybercriminals are continuously updating their exploit tools and techniques to evade detection and ﬁnd better targets. These criminals sometimes spend years reﬁning their attacks, as seen with Greenﬂash Sundown. To stay ahead of the curve, users should always keep their systems and applications updated to the latest version. The vulnerabilities targeted by these exploit kits usually have available ﬁxes, so applying a solid patching and update strategy mitigates much of the risk. To further strengthen security, enterprises are also advised to enable a multilayered protection system that can actively block threats and malicious URLs from the gateway to the endpoint. A proactive, multilayered approach to security is key against threats that exploit vulnerabilities. Trend Micro Deep Security and Trend Micro™ Vulnerability Protection also provide virtual patching that protects servers and endpoints from threats that abuse vulnerabilities in critical applications or websites. Trend Micro customers are protected by the following Deep Security rule:1009405-Adobe Flash Player Use After Free Vulnerability (CVE-2018-15982)Trend Micro™ OfﬁceScan™ with XGen™ endpoint security has Vulnerability Protection that shields endpoints from identiﬁed and unknown vulnerability exploits even before patches are even deployed. Trend Micro™ Smart Protection Suites and Worry-Free™ Business Security protect end users and businesses from these threats by detecting and blocking malicious ﬁles and all related malicious URLs. Additional insights from Chaoying Liu and Nakaya Yoshihiro This was also earlier reported by Malwarebytes. Indicators of CompromiseIndicator cdn-cloud[.]club Updated July 1, 4:20PM: Updated to clarify the product of Revive/OpenX that was compromised.Detection GreenFlash Sundown EK domain GreenFlash Sundown EK domain GreenFlash Sundown EK domain Coinminer.Win32.MALXMR.S MBM4 Coinminer.Win64.TOOLXMR. xeLearn how to protect Enterprises, Small Businesses, and Home Users from ransomware:ENTERPRISE»SMALL BUSINESS»HOME»urlﬂash-sundown-exploit-kit/5/7ShadowGate Returns to Worldwide Operations With Evolved Greenﬂash Sundown Exploit Kit - TrendLabs Security Intelligence Blog2/11/2020 Tags: exploit kit Security Predictions for 2020Cybersecurity in 2020 will be viewed through many lenses — from differing attacker motivations and cybercriminal arsenal to technological developments and global threat intelligence — only so defenders can keep up with the broad range of threats. Read our security predictions for 2020.Business Process CompromiseAttackers are starting to invest in long-term operations that target speciﬁc processes enterprises rely on. They scout for vulnerable practices, susceptible systems and operational loopholes that they can leverage or abuse. To learn more, read our Security 101: Business Process Compromise.Recent PostsOutlaw Updates Kit to Kill Older Miner Versions, Targets More Systems Malicious Optimizer and Utility Android Apps on Google Play Communicate with Trojans that Install Malware, Perform Mobile Ad Fraud Security Analysis of Devices That Support SCPI and VISA Protocols January Patch Tuesday: Update List Includes Fixes for Internet Explorer, Remote Desktop, Cryptographic Bugs First Active Attack Exploiting CVE-2019-2215 Found on Google Play, Linked to SideWinder APT GroupPopular PostsSecurity Analysis of Devices That Support SCPI and VISA Protocols January Patch Tuesday: Update List Includes Fixes for Internet Explorer, Remote Desktop, Cryptographic Bugs First Active Attack Exploiting CVE-2019-2215 Found on Google Play, Linked to SideWinder APT Group Why Running a Privileged Container in Docker Is a Bad Idea Looking into Attacks and Techniques Used Against WordPress SitesStay Updated Email Subscriptionurlﬂash-sundown-exploit-kit/6/72/11/2020ShadowGate Returns to Worldwide Operations With Evolved Greenﬂash Sundown Exploit Kit - TrendLabs Security Intelligence BlogHome and Home Ofﬁce About Trend Micro Asia Paciﬁc Region (APAC): Australia / New Zealand, 中国, ⽇本, 대한민국, 台灣 Latin America Region (LAR): Brasil, México North America Region (NABU): United States, Canada Europe, Middle East, & Africa Region (EMEA): France, Deutschland / Österreich / Schweiz, Italia, Россия, España, United Kingdom / Ireland Copyright © 2020 Trend Micro Incorporated. All rights reserved.urlﬂash-sundown-exploit-kit/7/7 