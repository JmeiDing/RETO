Go to…Trend MicroAbout TrendLabs Security Intelligence Blog▼Home » Malware » New Android Spyware ActionSpy Revealed via Phishing Attacks from Earth EmpusaNew Android Spyware ActionSpy Revealed via Phishing Attacks from Earth EmpusaPosted on: June 11, 2020 at 5:25 am Posted in: Malware, Mobile Author: Trend Micro23By Ecular Xu and Joseph C. ChenWhile tracking Earth Empura, also known as POISON CARP/Evil Eye, we identified an undocumented Android spyware we have named ActionSpy (detected by Trend Micro as AndroidOS_ActionSpy.HRX). During the first quarter of 2020, we observed Earth Empusa’s activity targeting users in Tibet and Turkey before they extended their scope to include Taiwan. The campaign is reportedly targeting victims related to Uyghurs by compromising their Android and iOS mobile devices. This group is known to use watering hole attacks, but we recently observed them using phishing attacks to deliver their malware.The malware that infects the mobile devices is found to be associated with a sequence of iOS exploit chain attacks in the wild since 2016. In April 2020, we noticed a phishing page disguised as a download page of an Android video application that is popular in Tibet. The phishing page, which appears to have been copied from a third-party web store, may have been created by Earth Empusa. This is based on the fact that one of the malicious scripts injected on the page was hosted on a domain belonging to the group. Upon checking the Android application downloaded from the page, we found ActionSpy.Go to…▼Figure 1. The Earth Empusa attack chainActionSpy, which may have been around since 2017, is an Android spyware that allows the attacker to collect information from the compromised devices. It also has a module designed for spying on instant messages by abusing Android Accessibility and collecting chat logs from four different instant messaging applications.Phishing attacks delivering ActionSpyEarth Empusa’s use of phishing pages is similar to our recent report on Operation Poisoned News, which also used web news pages as a lure to exploit mobile devices. Earth Empusa also used social engineering lures to trick its targets into visiting the phishing pages. We found some news web pages, which appear to have been copied from Uyghur-related news sites, hosted on their server in March 2020. All pages were injected with a script to load the cross-site scripting framework BeEF. We suspect the attacker used the framework to deliver their malicious script when they found a targeted victim browsing the said sites. However, our investigation did not yield any script when we attempted to access said phishing pages. How these pages were distributed in the wild is also unclear.Go to…▼Figure 2. A news page copied from the World Uyghur Congress website used for loading the BeEF frameworkUpon continued investigation in late April 2020, we found another phishing page that appears to be copied from a third-party web store and injected with two scripts to load ScanBox and BeEF frameworks. This phishing page invites users to download a video app that is known to Tibetan Android users. We believe the page was created by Earth Empusa because the BeEF framework was running on a domain that reportedly belongs to the group. The download link was modified to an archive file that contains an Android application. Analysis then revealed that the application is an undocumented Android spyware we named ActionSpy.Go to…▼Figures 3 and 4. Fake Android application download page (In original language and translated into English)Go to…▼Figure 5. The injection of ScanBox (above) and BeEF (below) on the phishing page shows overlap to Earth Empusa’sdomainBreaking Down ActionSpyThis malware impersonates a legitimate Uyghur video app called Ekran. The malicious app has the same appearance and features as the original app. It is able to achieve this with VirtualApp. In addition, it’s also protected by Bangcle to evade static analysis and detection.Figure 6. ActionSpy’s icon (left) and appearance (right)A legitimate Ekran APK file is embedded in the ActionSpy assets directory, and installed in virtual environment after VirtualApp is ready when ActionSpy is launched the first time.Figure 7. ActionSpy is protected by BangcleGo to…▼Figure 8 and 9. Install real “Ekran” (above) and launch it (below)ActionSpy’s configuration, including its C&C server address, is encrypted by DES. The decryption key is generated in native code. This makes static analysis difficult for ActionSpy.Every 30 seconds, ActionSpy will collect basic device information like IMEI, phone number, manufacturer, battery status, etc., which it sends to the C&C server as a heartbeat request. The server may return some commands that will be performed on the compromised device. All the communication traffic between C&C and ActionSpy is encrypted by RSA and transferred via HTTP.Figure 10. Collected device informationActionSpy supports the following modules: Go to…Module NameDescription▼locationgeocontactscallingsmsnettracesoftwareprocesswifi connectwifi disconnectwifi listdirfilevoicecamerascreenwechatwxfilewxrecordAbuse of AccessibilityGet device location latitude and longitudeGet geographic area like province, city, district, street addressGet contacts infoGet call logsGet SMS messagesGet browser bookmarksGet installed APP infoGet running processes infoMake device connect to a specific Wi-Fi hotspotMake the device disconnect to Wi-FiGet all available Wi-Fi hotspots infoCollect specific types of file list on SDCard, like txt, jpg, mp4, doc, xls…Upload files from device to C&C serverRecord the environmentTake photos with cameraTake screenshotGet the structure of WeChat directoryGet files that received or sent from WeChatGet chat logs of WeChat, QQ, WhatsApp, and ViberNormally, a third-party app can’t access files belonging to others on Android. This makes it difficult for ActionSpy to steal chat log files from messaging apps like WeChat directly without root permission. ActionSpy, in turn, adopts an indirect approach: it prompts users to turn on its Accessibility service and claims that it is a memory garbage cleaning service.Go to…▼Figure 11. Prompt to turn on AccessibilityOnce the user enables the Accessibility service, ActionSpy will monitor Accessibility events on the device. This is occurs when something “notable” happens in the user interface (such as clicked buttons, entered text, or changed views). When an Accessibility Event is received, ActionSpy checks if the event type is VIEW_SCROLLED or WINDOW_CONTENT_CHANGED and then check if the events came from targeted apps like WeChat, QQ, WhatsApp, and Viber. If all the above conditions are met, ActionSpy parses the current activity contents and extracts information like nicknames, chat contents, and chat time. All the chat information is formatted and stored into a local SQLite Database. Once a “wxrecord” command is pushed, ActionSpy will gather chat logs in the database and convert them into JSON format before sending it to its C&C server.Figure 12. Code snippet of parsing chat informationWe believe ActionSpy has existed for at least three years, based on its certificate sign time (2017-07-10). We also sourced some old ActionSpy versions that were created in 2017.Go to…▼Figure 13. Certificate infoMore on Earth Empusa: Watering hole attacks to compromise iOS systemsFigure 14. The earlier version (created in 2017)Earth Empusa also employs watering hole attacks to compromise iOS devices. The group injected their malicious scripts on websites that their targets could potentially visit and load the injected script from it. We found two kinds of attacks they injected into compromised websites:One injection we found is the ScanBox framework. The framework can collect information from a website’s visitors by using JavaScript to record keypresses and harvest the profiles of the OS, browser, and browser plugins from the client environment. The framework is usually used during the reconnaissance stage, allowing them to understand their targets and prepare for the next stage of the attack. Another injection is their exploit chain framework, which exploits the vulnerabilities on the iOS devices. When a victim accesses the framework, it checks the User-Agent header of the HTTP request to determine the iOS version on the victim’s device and reply with a corresponding exploit code. If the User-Agent doesn’t belong to any of the targeted iOS versions, the framework will not deliver any additional payload.Figure 15. An example of iOS exploit chain trafficIn the first quarter of 2020, the exploit chain framework was upgraded to include a newer iOS exploit that can compromise iOS versions 12.3, 12.3.1, and 12.3.2. Other researchers have also published details of this updated exploit.Go to…▼Figure 16. The script for determining the iOS version and launching the exploit codeWe have observed these injections on multiple Uyghur-related sites since the start of 2020. In addition, we have also identified a news website and political party website in Turkey that have been compromised and injected with the same attack. In a more recent development, we found the same injection on a university website as well as a travel agency site based in Taiwan in March 2020. These developments have led as to believe that Earth Empusa is widening the scope of their targets.Best practices and solutionsEarth Empusa is still very active in the wild. We are constantly tracking and monitoring the threat group as it continues to develop new ways to attack its targets.iOS users are advised to keep their devices updated. Android users, on the other hand, are encouraged to install apps only from trusted places such as Google Play to avoid malicious apps.Users can also install security solutions, such as the Trend Micro™ Mobile Security for iOS and Trend Micro™ Mobile Security for Android™ (also available on Google Play) solutions, that can block malicious apps. End users can also benefit from their multilayered security capabilities that secure the device owner’s data and privacy, and features that protect them from ransomware, fraudulent websites, and identity theft.For organizations, the Trend Micro™ Mobile Security for Enterprise suite provides device, compliance and application management, data protection, and configuration provisioning. The suite also protects devices from attacks that exploit vulnerabilities, prevents unauthorized access to apps and detects and blocks malware and fraudulent websites. Trend Micro’s Mobile App Reputation Service (MARS) covers Android and iOS threats using leading sandbox and machine learning technologies to protect users against malware, zero-day and known exploits, privacy leaks, and application Malware, Perform Mobile Ad Fraud Dissecting Geost: Exposing the Anatomy of the Android Trojan Targeting Russian Banks Operation Poisoned News: Hong Kong Users Targeted With Mobile Malware via Local News Links Barcode Reader Apps on Google Play Found Using New Ad Fraud TechniqueLearn how to protect Enterprises, Small Businesses, and Home Users from ransomware:Go to…ENTERPRISE»SMALL BUSINESS»HOME»▼Tags: ActionSpyandroidEarth EmpusaEkranUyghur0 CommentsTrendLabs🔒 Disqus' Privacy PolicyRecommendt Tweet f ShareLogin1Sort by BestStart the discussion…LOG IN WITHOR SIGN UP WITH DISQUS?NameBe the first to comment.✉SubscribedAdd Disqus to your site⚠Do Not Sell My DataSecurity Predictions for 2020Cybersecurity in 2020 will be viewed through many lenses — from differing attacker motivations and cybercriminal arsenal to technological developments and global threat intelligence — only so defenders can keep up with the broad range of threats. Read our security predictions for 2020.Business Process CompromiseGo to…Attackers are starting to invest in long-term operations that target specific processes enterprises rely on. They scout for vulnerable practices, susceptible systems and operational loopholes that they can leverage or abuse. To learn more, read our Security 101: Business Process Compromise.▼Recent PostsNew Android Spyware ActionSpy Revealed via Phishing Attacks from Earth EmpusaPatch Tuesday: Fixes for LNK, SMB, and SharePoint BugsNew Tekya Ad Fraud Found on Google PlayBarcode Reader Apps on Google Play Found Using New Ad Fraud TechniqueBackdoor, Devil Shadow Botnet Hidden in Fake Zoom InstallersPopular PostsBarcode Reader Apps on Google Play Found Using New Ad Fraud TechniqueQAKBOT Resurges: Despite Takedowns, Online Banking Threats PersistExposed Redis Instances Abused for Remote Code Execution, Cryptocurrency MiningThird-Generation QAKBOT: Repackaged with Improved PropagationTA505 At It Again: Variety is the Spice of ServHelper and FlawedAmmyyStay UpdatedEmail Subscription Your email hereSubscribeHOME AND HOME OFFICE |FOR BUSINESS |SECURITY INTELLIGENCE |ABOUT TREND MICROAsia Pacific Region (APAC): Australia / New Zealand, 中国, 日本, 대한민국, 台灣 (NABU): United States, Canada Europe, Middle East, & Africa Region (EMEA): France, Deutschland / Österreich / Schweiz, Italia, Россия, España, United Kingdom / IrelandLatin America Region (LAR): Brasil, MéxicoNorth America RegionPrivacy StatementLegal PoliciesCopyright © 2020 Trend Micro Incorporated. All rights reserved. 