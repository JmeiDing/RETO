Syrian Malware, the ever-evolving threatKaspersky Lab Global Research and Analysis TeamVersion 1.0 August 201421. Executive SummaryThe Global Research and Analysis Team (GReAT) at Kaspersky Lab has discovered new malware attacks in Syria, with malicious entities using a plethora of methods from their toolbox to hide and operate malware. In addition to proficient social engineering tricks, victims are often tempted to open and explore malicious files because of the dire need for privacy and security tools in the region. In the hopes of maintaining anonymity and installing the latest “protection”, victims fall prey to these malicious creations. A vast majority of the samples obtained were found on activist sites and in social networking forums.The victims are distributed across different countries: • Kingdom of Saudi Arabia • United Arab Emirates • United StatesThe group members are operating from different locations around the world: • LebanonThe group’s attacks are evolving and they are making extensive use of social engineering techniques to trick targeted victims into running their malicious files. Among the principal file extensions observed among the malware samples obtained we can list: .scr3The group is relying on RAT (Remote Access Tool) Trojan tools, of which the most common are: • Dark Comet RAT • Blackshades RATThe number of malicious files found is 110, with a big increase seen in recent attacks.The number of domains linked to the attacks is 20.The number of IP addresses linked to the attacks is 47.The samples details and domains lists used by the attackers can be found in the Appendices 1 and 2 in the end of the document.Protection and resilience against these attacks is ensured through the use of a multi-layered security approach, having up to date security products, and mainly by being sceptical about suspicious files.Contents3.1. Infection Vectors 3.1.1. Skype messages 3.1.2. Facebook posts 3.1.3. YouTube Videos 3.2. Samples and types of files 3.2.10. Victims 3.2.11. Activist Behavior 3.3. Attribution1. Executive Summary 4. Kaspersky Lab MENA RAT Statistics Appendix 1: Samples Appendix 2: C&C Domains2 3.2.1. The National Security Program 3.2.2. Files named “Scandals” are quite attractive 14 3.2.3. “Ammazon Internet Security” the “popular Antivirus” 16 3.2.4. You’ve installed the latest antivirus solution, now let’s “protect your network” 19 3.2.5. Whatsapp and Viber for PC: Instant messaging, instant infection 3.2.6. Beware of chemical attacks 23 3.2.7. Commands and functionality 3.2.8. Evolution of malware attack file numbers 3.2.9. Locations, domains and team 47TLP: GreenFor any inquire please contact intelreports@kaspersky.com52. IntroductionThe geopolitical conflicts in the Middle East have deepened in the last few years; Syria is no exception. The crisis is taking many forms, and the cyberspace conflict is intensifying as sides try to tilt the struggle, by exploiting cyber intelligence and exercising distortion.In the last few years cyber-attacks in Syria have moved into the front line; many activities in cyberspace have been linked to Syria, especially those conducted by the Syrian Electronic Army and pro-government groups.The Global Research and Analysis Team (GReAT) at Kaspersky Lab has found new malware attacks in Syria, using new but not advanced techniques to hide and operate malware, in addition to using proficient social engineering tricks to deliver malware by tricking and tempting victims into opening and exploring malicious files. The malware files have been found on hacked activist sites, web pages and in social networking forums.Cyber Arabs, an Arabic-language digital security project of the IWPR (Institute for War and Peace Reporting), reported four of these samples in March 2014. The same samples were also reported on Syrian Facebook pages (ةيرحلا لجلأ نوينقت, Technicians For Freedom): url tech4freedomGiven the complexity of the situation, there are many factors and entities at play in this event, but from the outside these are all largely speculative. Pro-government groups talk about “defense” and opposition activists talk about “offense”. Here, we will only focus on the malware and the facts that have been found during the analysis, presenting only relevant information, in the hope of setting a clear context for this research.63. Analysis3.1. Infection VectorsMalware writers are using multiple techniques to deliver their files and entice the victims to run them, creating an effective infection vector. Mainly depending on social engineering the attackers exploit: • Victims’ trust in social networking forums • Victims’ curiosity in following news related to political conflict in Syria • Victims’ fear of attacks from government • Victims’ lack of technology awarenessOnce they have infected the victim’s computer, attackers have full access and control over victim’s devices. In the following section we show different versions of posts sent via popular file sharing sites or social networking platforms. The sample details and domain lists used by the attackers can be found in the Appendices 1 and 2 in the end of the document.3.1.1. Skype messagesMessages sent via Skype offer links to download: 1. The “SSH VPN” program to encrypt communication 2. The popular and effective antivirus with daily updates from “Ammazon Internet Security” 3. The “SmartFirewall” to block connections made by malware and bad programsThe messages are usually sent from fake or compromised accounts.3.1.2. Facebook postsThe same messages sent via Skype are also shared via the Facebook social platform, asking victims to install these “security programs” to protect themselves from malware infections and cyber-attacks, especially government attacks.783.1.3. YouTube VideosIn the following example, we can see a YouTube video providing links to download fake Whatsapp and Viber applications for PC. By using everyday technologies that are commonly used by a broad audience, attackers increase the effectiveness of their operations and their infection rates.93.2. Samples	and	types	of	filesAnalysis has led us to identify the following RAT variants being used in the wild: • Dark Comet RAT • BlackShades RATThe samples collected during our research can be classified as follows.Old samplesSamples obtained during 2013 are simple RAT executable files, compressed and sent to victims using a wide range of delivery options. Newer samples were typically found to use “.scr” containers in order to hide malicious files and avoid early detection by security solutions.New samplesMore recent samples, starting from the end of 2013, have shown a more organized development effort, creating highly stealth and graphically-enticing applications.In this analysis we have seen how Syrian malware has evolved, showing no signs of stopping any time soon. Even though new malicious Syrian samples are appearing each day, the subset presented here will hopefully give the reader an overall view of the techniques and tools that are currently being used to target Syrian citizens.3.2.1. The National Security ProgramCuriosity killed the cat: browsing a previously leaked spreadsheet of wanted activists leads to infection.We found a set of compressed files on a popular social networking site; when, extracted it showed a database containing a list of activists and wanted individuals in Syria. A video entitled “دسلاا ةباصع يقابو كولمم يلع مرجملاب ةصاخلا رتويبمكلا ةزهجٔا قارتخٕا“ was published on November 9 2013, and the download link for this database application was included in the information section of the video.10The download URL redirected victims to a file-sharing service where the file was being hosted. The compressed RAR file “ينطولا نمٔلاا جمانرب.rar”, with the MD5 signature 0c711bf29815aecc65016712981 59a74 and a file-size of 7,921,063 bytes was protected with the password “111222333”.The video requests the victim to scan the password protected “.rar” file using VirusTotal to verify that it is not infected.After extracting all the files to a temporary folder, we were presented with the application itself and a text file needed to access the “hidden” features of the program.The file “PASSWORD.txt file” contained the following text:syria123!@#ةرصنلا ةهبج ةنصارق ءاعدلاب انيلع اولخبت لا11Upon closer inspection, the first and last buttons of the application were functional, but the others generated error messages (claiming that some files were missing).The first button (لماش ماع شيف, General Global File) uses “data-base.db.exe” (MD5 8f16efb51fe67961e e31c4f36cbe11db), which was placed into “C:\Users\User\AppData\Roaming“and, when executed, • “ينطولا نمٔلاا جمانرب.exe” is not detected as a malicious file. • The file “data-Base.db” is detected as a malicious file.The file “data-base.db” is a compressed archive: • Product name from the file signature: Project1 • Publisher name from the signature: Syrian malware • Compilation Timestamp: 2013-11-09 14:47:2613When system32.exe is run, the process “iexplorer.exe” is spawned and is automatically registered for local\temp\” folder.14The presence of DarkComet’s “DC_MUTEX-*” was a giveaway of the usage of this remote administration tool.During infection, the Excel spreadsheet is displayed, comprising 96763 rows and 13 columns of activist information. The rows correspond to records of individuals wanted by the government and the columns correspond to information about the individuals. While there is no column description, data in each column reflects the type of data.3.2.2. Files named “Scandals” are quite attractiveUsing shockingly disturbing videos to distribute malwareA disturbing video showing injured victims of recent bombings was used to appeal to people’s fear and exert them to download a malicious application available in a public file-sharing website. After our initial analysis, the file named “حئاضف.exe” proved to be heavily obfuscated with the commercial utility “MaxToCode” for .NET as a means of avoiding early detection by antivirus solutions.When executed, the original sample created another executable file in the Windows’ temporary folder (C:\Users\[USERNAME]\AppData\Local\Temp) named “Trojan.exe”, which corresponds to the code of the RAT itself. This is used to save all keystrokes and system activity to another file in the same location, “Trojan.exe.tmp”.15Captured information is sent to a dynamic domain corresponding to the host “hacars11.no-ip.biz”, using local port 1177 with no SSL encryption (but base64 encoded), making the analysis of the network traffic a much easier task. During the initial connection to the remote server (after an initial ping to check for internet connectivity), the Trojan will send the machine’s name, installed Windows version, logged username, webcam availability and the version of the RAT in use.Several embedded command line scripts are in charge of adding the Trojan’s executable file to the Windows Firewall allowed list, while at the same time disabling security zone checking in Internet Explorer. System persistence is obtained via a modification in the “Software\Microsoft\Windows\ CurrentVersion\Run” registry key and by adding a copy of the malware to the Startup folder.16Even though different obfuscation techniques are used in the samples we analysed, all of them have underlying dependencies on the .NET framework namespaces, which eventually allows deep source code inspection of the threat.173.2.3. “Ammazon Internet Security” the “popular Antivirus”If you thought the era of fake antivirus programs was over, here comes a newly developed sample to challenge your beliefs. With the innocent title of “Ammazon Internet Security”, this malicious application tries to mimic a security scanner, even including a quite thorough graphical user interface and some interactive functionality.Again, this shows the simplicity of creating a graphical user interface that will trick most of the non- tech-savvy population. Using nothing more than a couple of buttons and a catchy name, Syrian malware groups were hoping that the intended victims would fall for the trap. Analyzing the code interestingly revealed that it has the look--feel of a security application; but, of course, no real security features. While silently executing a remote administration tool when launching this “security suite”, targeted victims were left without their “Ammazon” protection but witha RAT installed.From the Windows process list shown in Process Explorer, we were able to see “J. L Antivirus 4.0” executing in our system, and through Process Monitor we caught the creation of the “analysis” log file for our fake antivirus. Behind the curtains, a connection is made to a remote host, sending real time information on all our activities — the real cost of this free internet security suite!Among the many programming methods found inside the source code, we were even able to find a “CheckForUpdates” function; and if you look closely enough you can even see “Detection” and “Quarantine” assemblies included in this application. So, not only has a lot of work gone into creating this fake antivirus, the authors also followed good programming practices and implemented modules for each specific (albeit fake) functionality. Maybe at a really quick first sight this could pose as a legitimate tool, but a deeper inspection reveals its true malicious nature.18The real log file was one where all keystrokes were recorded and later sent from the computer via a TCP connection. Even though this type of keylogging functionality is nothing new, when we consider how these malicious applications are being used, and the control they give to the attackers, we can start to measure the importance of reporting these threats and providing protection from them.Evidently, the malware authors didn’t care much to provide an option to close the “antivirus”, and if you were to kill the process you would get a nice ‘blue screen of death’ and an unexpected system reboot. Surely, the fake application will load again once everything is back up, creating an interesting method for guaranteeing persistence.193.2.4. You’ve installed the latest antivirus solution, now let’s “protect yournetwork”Total Network Monitor (which is a legitimate application) was inside another sample we found, used with embedded malware for spying purposes. Offering security applications to protect against surveillance is one of the many techniques used by malware writing groups to get victims who are in desperate need for privacy to execute these dubious programs.An almost fully functional version of the “Total Network Monitor” utility is included. What this modified version does not show is the remote connection made to a host where f system information is dumped. The actual infection is performed when first clicking on the installer, which uses obfuscation to hide all malicious activity until the “legitimate” tool is completely installed.As with other samples reviewed, system persistence is obtained by modifying Windows start-up registry keys. Using names such as “Desktop Manager” increases the likelihood for this threat to go unnoticed. However, the entry name “empty” or “empty.exe” should raise a red flag when auditing these keys.3.2.5. Whatsapp and Viber for PC: Instant messaging, instant infectionAs with other samples, social engineering does all of the heavy work. Instant messaging applications for desktop operating systems have been used in the past to spread malware and it seems that Syrian malware authors have jumped on the bandwagon. In contrast to the “Ammazon Internet Security”, these samples don’t contain any graphical user interface or even an error message that will tell the victim not to worry about their security. Heading straight for system infection has proven successful for them, and using these popular application names gets the interest of a much larger audience.20The following screenshot shows how the application name, intended functionality and even the icon used, all work in conjunction to create a believable story for the victim. And this is not a comprehensive list, by any means. Framing and social engineering techniques are playing an essential role in all Syrian named “Kimawi.exe” and with JPG icon, is a RAT file bound to the picture “Kimawi.jpg”. This picture is a previously leaked paper supposedly by the regime in Syria warning military units to prepare for chemical attacks from friendly units.21Kimawi.jpg3.2.7. Commands and functionalityDifferent remote administration tools have been spotted in the wild; most of them provide an extensive range of functionality to fully control infected systems. These include: Capturing screenshots and webcam control. Recording live sound/video. Installing programs Uploading/downloading files File, process and registry key management Remote shell Executing DDoS attacks22Among the most popular RAT found in the samples subset is Dark Comet, a free remote administration tool that provides a comprehensive command set for the attackers to use in their malicious purposes.DarkComet Control panel & FunctionalityAnother RAT widely used in the Arab world is NjRAT, which includes a list of commands (see below) that can be sent from the controller to the infected system.CommandOptionFunction23“PROC”“RSS”“RS”“RSC”“KL”“INF”“RN”“CAP”“P”“UN”“UP”“RG”~KKDRE~!@~!@#$Retrieve information about current running processKill a processKill list of processes and delete module filesRestart a running processStart a CMD and direct STDIN and STDOUT to be controlled by C&CSend command to CMDTerminate CMD processRetrieves keylogging fileInformation about system Drive, malware statusDownload and run a file from a specified URLScreenshots, desktop monitoringPingCompletely Uninstall TrojanTerminate Trojan ProcessRestart TrojanUpdate TrojanEnumerate Registry KeySet Key ValueDelete Registry KeyCreate SubKeyDelete SubKey243.2.8.	Evolution	of	malware	attack	file	numbersThe attackers are working on full power, and the number of attacks and malicious files being distributed is constantly increasing as they become more organized and proficient. Below is the timeline distribution for malicious files distributed during 2013-2014, based on the first time they were distributed or seen in public (Skype, Facebook, file-sharing, email, etc.).Below is the timeline distribution for the collected samples based on compilation time25The samples details and domains list used by the attackers can be found in the Appendices 1 and 2 in the end of the document.3.2.9. Locations, domains and teamThe group responsible for the attacks is using common techniques shared by many of the hacking groups around the world. They benefit from dynamic domains that can be linked to their modem devices and configured with forward functionality to a public IP address assigned by the ISP. By restarting their modems they obtain a new address, creating a dynamic infrastructure that can be easily managed. Dynamic Update Clients (DUC) on their computer devices (usually the same as the RAT server) are in provided by TARASSUL ISP (Syrian Telecommunications Establishment) for its attacks. We suspect this subnet has been allocated to the group, also an indication that they are now operational from a attacks.Information on domain “All4Syrian.com”This domain is registered for the email aloshalaa@gmail.com. It served as a pro-regime website back in 2012 and is being used for the C&C of some of the RAT files. The domain was registered to okpa1984@gmail.com from 2011 to 2013. Malware has also been seen connecting to xtr.all4syrian.com and vip.all4syrian.com.Attackers’ geographical distributionThe map below shows the attackers’ geograhical distribution based on the geolocation of the IP addresses used by the C&C servers:273.2.10. VictimsThe distribution of victims is confined only to Syria, but also reaches nearby countries. We have observed victims of the Syrian-based malware in: • Kingdom of Saudi Arabia • United Arab Emirates • United States28Victims geographical distribution mapMap showing geographical distribution of victims with zoom on the most affected areasBelow are snapshots taken from videos published by the attackers, showing their RAT control panel and list of victims. This shows some of the victims located in different countries.29The sample details and domain lists used by the attackers can be found in Appendices 1 and 2 in the end of this document.3.2.11. Activist BehaviorIt is worth noting that we have seen evidence of activists trying to carry out Denial of Service attacks on the RAT domains and servers, in an effort to overwhelm their resources and cause their connections to timeout.The post below shows a warning from activists about pro-government hacker attacks on Facebook pages, explaining how pro-government groups post links to Trojanized applications in order to infect users The activists announce in the post that they have spotted a C&C domain used by the Trojans and that they are attacking it to remove all hacked victims.30“للهاشنأ كاهلل نيدوجولا اياحضلا عيمج فذحل تسوهلا برض يراج” translated as “Host Attack in progress to remove all hacked victims with help of god”.3.3. Attribution31Team and positionsFrom many posts, forums and identification videos, it is clear that the group has an organized structure of teams working together, The names and positions outlined below were collected from posts on infiltrated forums or pages. They are all either nicknames or incomplete names that do not enable full identification of the attackers.The Resistant Syrian Electronic Army • Group 1: Team Hacker and Assad Penetrations Unit • Group 2: Anonymous Syria Al Assad Unit • Group 3: Management of Electronic Monitoring and Central Tracking UnitGroup1: Team Hacker and Assad Penetrations UnitNameShadyFadiSarmadMahmoudPositionHead of Assad Hacker teamResponsible for raidsResponsible for operations in raids unitAssistant to the head of management unitGirl nickname Fidaeya (redemptionist)Member of support and publishing teamNajmaMember of media and publishing team32Group2: Anonymous Syria Al Assad UnitNameJabbourHaydaraPositionPublic relations managerElectronic ambushes unitAlaa MorchedElectronic monitoring unit and follow upAhmadNarimanAliZinaResponsible for team unitResponsible for team unitResponsible for team unitResponsible for team unitDerkachli KordahliAhmad and MoradResponsible for destruction of victim accountsEngaged in attacksGroup3: Management of Electronic Monitoring and Central Tracking UnitNameKenanOkbaAhmadPositionHead of teamHead of electronic operationsHead of eectronic raidsRitzel (heart of the lion)Head of electronic penetration operations334. Kaspersky Lab MENA RAT StatisticsRemote Administration Tool (RAT) Trojans are malicious programs that allow a remote “operator” to control a system as if he has physical access to that system. Malicious RATs are widely used by different types of cybercriminals (hacktivists, script-kiddies, and scammers) and even in some state-sponsored attacks.Some of the most popular RATs are detected by Kaspersky products as following: • Trojan.MSIL.Zapchast, also known as Njrat • Backdoor.Win32.Bifrose, also known as Bitfrose • Backdoor.Win32.Fynloski, also known as DarkComet • Backdoor.Win32.Xtreme, also known as XtremratThe statistics below, extracted from the Kaspersky Security Network (KSN), show the number of RAT infection attacks blocked by Kaspersky Lab products in the MENA (Middle East North Africa) • Three countries from MENA are in the DarkComent top 10.365. ConclusionSyrian malware has a strong reliance on social engineering and the active development of technologically complex malicious variants. Nevertheless, most of them quickly reveal their true nature when inspected carefully; and this is one of the main reasons for urging Syrian users to be extra vigilant about what they download and to implement a layered defense approach.Antivirus software uses either signature or heuristic-based detection to identify malware. On the one hand, signature detection searches for a unique sequence of bytes that is specific to a piece of malicious code. On the other hand, heuristic detection identifies malware based on program behaviour. In our research we were able to collect more than 100 malware samples used to attack Syrian citizens. Although most of these samples are known, cybercriminals rely on a plethora of obfuscation tools and techniques in order to change the malware structure so as to bypass signature scanning and avoid antivirus detection. This proves how critical heuristic technologies are when it comes to protecting against these types of attack. By being able to identify variants of known malware types or even new malware families, Kaspersky Lab security products detected all the collected samples.We expect these attacks to continue and evolve both in quality and quantity. We expect the attackers to start using more advanced techniques to distribute their malware, using malicious documents or drive-by download exploits. With enough funding and motivation they might also be able to get access to zero day vulnerabilities, which will make their attacks more effective and allow them to target more sensitive or high profile victims.Even though the attackers depend mainly on using known RATs, their rapid improvement and application of obfuscation techniques, GUI development for fake applications, and code modification via automated builders, increase the probability that it won’t be too long before they start writing their own Trojans to take advantage of customized infection capabilities and implement better security evasion.Finally, having a comprehensive and up-to-date antivirus and firewall should be the first measure taken by any user that does any type of online activity, especially during these uncertain times when new cyber threats appear almost daily.37Appendix 1: SamplesAll samples tableThe list of sample files has been collected through the infection vectors detailed above (Skype, Facebook, file-sharing, email, etc.). The samples have been either generated using automated tools (RAT server, obfuscation tools) or developed and bound to RAT files, especially the new samples with graphical content.File information• Ammazon Internet Security.rar• Smart Firewall.rar• SSH VPN.rarurl on facebook and url Viber fooorpc%E2%80%AEexe%E2%80%AEexe.rarurl exe, shitanoxxx.exe, shitano.exe(shitano= the devil)Source from friends at www.cyber-arabs.comينطولا نملأا جمانرب.rar (=national security program)-rar pass: 111222333-Internal exe pass: syria123!@#url حئاضف.exe (=scandals) url بياكس سورياف داضم.zip (anti skype April2014 ملاسلإا شيج-ماه.rar (imp the islamic army) ةيركسعلا نكامٔلاا.exe (military locations) .دوربي نم امود لوخد ةطخ.exe Russian Federation VimpelCom PPPOE(Wireless broadband) Syrian TelecommunicationsEstablishment 