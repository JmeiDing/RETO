Tardigrade: APT Attack on the Bioeconomy (Bulz.253748 Variant Overview: intserrs644.dll)Callie Churchwell – Senior Digital Biosecurity Analyst Charles Fracchia – VP of Data at Dotmatics & CEO/Founder BioBright Ed Chung, MD – Digital Biosecurity Lead & CMO BioBrightWebsite: url Contact: tips@isac.bio PGP: EB2A A1AA 4AD9 4A0B BE07 E8A9 625B BFEE 2E95 C7FCEmbargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyBottom Line Up Front – Impact• Extremely sophisticated malware actively spreading in the bioeconomy • Metamorphic version of the SmokeLoader family • Potentially the first identified malware with this level of sophistication targeting biomanufacturing facilities • This is ongoing and this disclosure was accelerated in the public interest given the observed spreadEmbargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyBottom Line Up Front – Motivations and TargetsTargets:• Bioeconomy companies • Biomanufacturing sector • Possibly targeted based on public / news activityMotivations (based on activity):• Intellectual property theft • Persistence • Ransomware preparationEmbargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyTardigrade APT attack on Bioeconomy infrastructure Timeline of DiscoveryRansomware discovered Ransomware locks computers across biomanufacturing facilityMalware Reverse In the public interest and to help the industry protect itself and Advanced actor, later discovered to have been patiently lurkingIncident & Disaster Response The team tackled issues at the intersection of biological quality (eg: GxP) and infosecFurther samples obtainedFurther spread discovered, disclosure is set in motionEmbargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyWhere are we today? - AttacksIndianBiomanufacturingTissue RegenixWHODüsseldorf BiotecHealth ServiceIrelandOxfordUniversityPfizer/BioNTech US: January 20th 2020 UK: 29th January 2020Pfizer/BioNTech HoldingVaccineManufacturingAmericoldEuropeanMedicines AgencyLife SciencesInstituteEmbargoed until Nov 22nd 12 (Noon) US ET6.87 Billion Doses AdministeredSmokeLoader / Bulz / Dofoil background• SmokeLoader - Smokey Bear family, Loader/Trojan • Purpose: To inject a more effective and destructivemalware into the machine• Smokey Bear Family is constantly automizing techniques/tactics • Smokey Bear Focus: multi-purpose tools thatinclude keylogging, information theft, botnet support, and backdoor access• Attack Delivery: Infected email software, plug-ins, adverts,infected networks, physical infections (USB).Embargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyBackground Information – TardigradeTagged Bulz.Method:253748 Ransomware Trojans• First Variant: SmokeLoader • Suspected Second Variant: DofoilAttack delivery:• USB, Files, Network autonomously • Primary: PhishingGoal:• The main role of this malware is still to download, manipulate files, send main.dll library if possible, deploy othermodules and remain hidden.• Espionage, tunnel creation, carry a bigger payload. • Compatible with other APT made payloads so far: Conti, Ryuk, Cobalt StrikeEmbargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyMalware Architecture and CapabilitiesMetamorphic• While many malware systems are polymorphic, this system seems to be able to recompile the loader frommemory without leaving a consistent signature.• Recompiling occurs after a network connection in the wild that could be a call to a command and control (CnC)server to download and execute the complier• Allows the system to change portions/all the functions based on CnC like a normal loader system but with a levelof autonomy that is unexpectedMinimum Supported System for Functions PerformedMinimum supported clientWindows 2000 Professional [desktop apps only]Minimum supported serverWindows 2000 Server [desktop apps only]Target PlatformWindowsHeaderLibraryDLLwinbase.h (include Windows.h)Advapi32.libAdvapi32.dllEmbargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyMalware Dynamics – MITRE ATT&CK Resource Development Stage CapabilitiesInitial Access External Remote Services Phishing Replication Through Removable Media Supply Chain Compromise Valid AccountsExecution Command and Scripting Interpreter Inter-Process Communication Scheduled Task/Job User ExecutionPersistence Boot or Logon Autostart Execution Boot or Logon Initialization Scripts Browser Extensions Create or Modify System Process Event Triggered Execution External Remote Services Scheduled Task/Job Abuse Elevation Control Mechanism Boot or Logon Autostart Execution Boot or Logon Initialization Scripts Create or Modify System Process Event Triggered Execution Exploitation for Privilege Escalation Process Injection Scheduled Task/Job Valid AccountsDefense Evasion Abuse Elevation Control Mechanism Deobfuscate/Decode Files or Information File and Directory Permissions Modification Indicator Removal on Host Modify Registry Obfuscated Files or Information Process Injection Signed Binary Proxy Execution Valid Accounts Virtualization/Sandbox Evasion Credential Access Credentials from Password Stores Unsecured CredentialsEmbargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyMalware Dynamics – MITRE ATT&CKDiscovery File and Directory Discovery Virtualization/Sandbox EvasionLateral Movement Exploitation of Remote Services Remote Service Session Hijacking Remote Services Replication Through Removable Data from Local System Data from Network Shared Drive Exfiltration Over C2 ChannelCommand and Control Application Layer Protocol Ingress Tool Transfer Web ServiceImpact Account Access RemovalData ManipulationWeb ProtocolsOne-Way CommunicationRuntime Data Manipulation Stored Data Manipulation Transmitted Data ManipulationEmbargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyMalware Dynamics – High LevelAutonomy • Previous SmokeLoader versions were externally directed, dependent on CnC infrastructure • This “Tardigrade” version is far more autonomous, able to decide on lateral movement based on internal logic • Significant level of autonomous decision-making ability, possibly on random wait times. • The ability to selectively identify files for modification.Privilege Escalation • Uses impersonate client technique to gain Admin controlConnectivity • Replaces Main.dll and attempts to export original to varying IPs that do not correlate with a specific CnC • Traffic is encrypted and uses a diversity of methods (no more to share at this time) • One method of lateral spread uses network shares and creates folders in CnC connected servers with random names(eg: ProfMargaretPredovic)Embargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyIndicators of Compromise (IoCs)Websites Reached• Random Batch of Amazon Web Services (AWS): • HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Ext\Stats\{DBC80044-A445-435B-BC74-9C25C1C588A9}\iexplore • HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings • HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings • HKEY_CURRENT_USER\Software • HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Download • HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main • HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main\FeatureControl • HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ALLOW_REVERSE_SOLIDUS_IN_USERINFO_KB932562 • HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ALWAYS_USE_DNS_FOR_SPN_KB3022771Registry Keys Deleted• HKLM\SYSTEM\ControlSet001\Services\WmiApRpl\Performance\First Counter • HKLM\SYSTEM\ControlSet001\Services\WmiApRpl\Performance\Last Counter • HKLM\SYSTEM\ControlSet001\Services\WmiApRpl\Performance\First Help • HKLM\SYSTEM\ControlSet001\Services\WmiApRpl\Performance\Last Help • HKLM\SYSTEM\ControlSet001\Services\WmiApRpl\Performance\Object ListEmbargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyProcess Termination Trees2368 - %windir%\System32\svchost.exe -k WerSvcGroup2912 - %windir%\system32\WerFault.exe -u -p 2728 -s 6601028 - wmiadap.exe /F /T /R2860 - %windir%\system32\DllHost.exe /Processid:{3EB3C877-1F16-487C-9050-104DBCD66683}872 - %windir%\system32\wbem\wmiprvse.exe2728 - %SANDBOX_DLL_LOADER_AMD64% %SAMPLEPATH% %WORKDIR% 4832800 - cmd.exe /c echo kOJAdtQoDcMuogIZIl>"%TEMP%\DEM3504.tmp"&exit2808 - %CONHOST% "110683108618492252-5067897321351265997-609353785-17193410651810180281534763768Embargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyInitial ActionsImpersonateNamedPipeClient • This function allows the server end of a named pipe to impersonatethe client end.• When this function is called, the named-pipe file system changesthe thread of the calling process to start impersonating the security context of the last message read from the pipe.• Only the server end of the pipe can call this function. The servercan call the RevertToSelf function when the impersonation is completeEmbargoed until Nov 22nd 12 (Noon) US ETBehavior in timingWaitNamedPipeA• Waits until either a time-out interval elapses or an instance of the specified named pipe is available for connection (that is, the pipe's server process has a pending ConnectNamedPipe operation on the pipe)• Rax identifies that the malware is writing to a specific registerEmbargoed until Nov 22nd 12 (Noon) US ETRemote Server Behavior• Retrieves a registered handle to the specified event log. TheUniversal Naming Convention (UNC) name of the remote server on which this operation is to be performed.• The name of the event source whose handle is to be retrieved. The source name must be a subkey of a log under the Eventlog registry key.• Note that the Security log is for system use only.Embargoed until Nov 22nd 12 (Noon) US ETFlush File FunctionFlushFileBuffers• This function clears the buffers for the specified file and causes allbuffered data to be written to the fileEmbargoed until Nov 22nd 12 (Noon) US ETObfuscation and File Attribute SpoofingReplaceFile • Replaces one file with another file, with the option of creating a backup copyof the original file. The replacement file assumes the name of the replaced file and its identity.• This function combines several steps within a single function. An application can call ReplaceFile instead of calling separate functions to save the data to a new file, rename the original file using a temporary name, rename the new file to have the same name as the original file, and delete the original file.• Another advantage is that ReplaceFile not only copies the new file data, butalso preserves the following attributes of the original file:• Short file name • Named streams not already in the replacement fileSecurity resource attributes Encryption Compression• For example, if the replacement file is encrypted, but the replaced file is notencrypted, the resulting file is not encrypted.Embargoed until Nov 22nd 12 (Noon) US ETCommitting changes to the RegistryRegFlushKey • Calling RegFlushKey is an expensive operation that significantly affects system-wide performance as it consumes disk bandwidth and blocks modifications to all keys by all processes in the registry hive that is being flushed until the flush operation completes.• RegFlushKey should only be called explicitly when an applicationmust guarantee that registry changes are persisted to disk immediately after modification.• All modifications made to keys are visible to other processeswithout the need to flush them to diskEmbargoed until Nov 22nd 12 (Noon) US ETRecommendationsEmbargoed until Nov 22nd 12 (Noon) US ETRecommendations – DO THIS TODAY1. Review your biomanufacturing network segmentation• Run tests to verify proper segmentation between corporate, guest andoperational networks• Most facilities use remote logins with shared passwords to operate keyinstrumentation. Enforcing segmentation is essential.2. Work with biologists and automation specialists to create a “crownjewels” analysis for your company • Ask: “if this machine was inoperable overnight, what would be the impact?” • Ask: “how long would it take to re-certify (GxP) this instrument?”3. Test and perform offline backups of key biological infrastructureLadder logic for biomanufacturing instrumentation SCADA and Historian configurations• • • Batch record system Inquire about lead times for key bio-infrastructure components • Chromatography systems • Endotoxin and microbial contamination systems4.Embargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyRecommendations - continuedPrevention is Key • Use antivirus with behavioral analysis capabilities • Phishing is a vector of attack• Train biomanufacturing facility staff to look out for targeted attacks • Review LinkedIn and other social media posts of employees for vaccinemanufacturing posts to determine likely targetsAwareness • The Bioeconomy and Biomanufacturing sectors are underconcerted, sophisticated attack. You are a target.• This malware is extremely difficult to detect due to metamorphicbehavior. Vigilance on key personnel corporate computers is important.Embargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyRecommendations – continued (2)Accelerate upgrade paths for key instruments • Many machines in the sector use outdated operating systems.Segment them off aggressively and accelerate upgrade timelinesEmbargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyAcknowledgementsWe would like to thank Alexander Petrovitch for his contributions to this report and help in analysisEmbargoed until Nov 22nd 12 (Noon) US ETcontributed by:a companyEmbargoed until Nov 22nd 12 (Noon) US ET 