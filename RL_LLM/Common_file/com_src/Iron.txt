HomeProducts & ServicesTechnologyCompanyBlogResourcesTry it nowBlog Cybersecurity DNAIron Cybercrime Group Under The ScopePDFmyURL converts any url to pdf!Omri Ben Bassat 29.05.18 | 11:53 amShare:In April 2018, while monitoring public data feeds, we noticed an interesting and previously unknown backdoor using HackingTeam’s leaked RCS source code. We discovered that this backdoor was developed by the Iron cybercrime group, the same group behind the Iron ransomware (rip-off Maktub ransomware recently discovered by Bart Parys), which we believe has been active for the past 18 months.During the past year and a half, the Iron group has developed multiple types of malware (backdoors, crypto-miners, and ransomware) for Windows, Linux and Android platforms. They have used their malware to successfully infect, at least, a few thousand victims.In this technical blog post we are going to take a look at the malware samples found during the research.Technical Analysis: Installer:** This installer sample (and in general most of the samples found) is protected with VMProtect then compressed using UPX.Installation process: 1. Check if the binary is executed on a VM, if so – ExitProcess2. Drop & Install malicious chrome extension %localappdata%\Temp\chrome.crx 3. Extract malicious chrome extension to %localappdata%\Temp\chrome & create a scheduled task to execute %localappdata%\Temp\chrome\sec.vbs. 4. Create mutex using the CPU’s version to make sure there’s no existing running instance of itself. 5. Drop backdoor dll to %localappdata%\Temp\\<random>.dat. 6. Check OS version:PDFmyURL converts any url to pdf!.If Version == Windows XP then just invoke ‘Launch’ export of Iron Backdoor for a one-time non persistent execution. .If Version > Windows XP -Invoke ‘Launch’ export -Check if Qhioo360 – only if not proceed, Install malicious certificate used to sign Iron Backdoor binary as root CA.Then create a service called ‘helpsvc’ pointing back to Iron Backdoor dll.PDFmyURL converts any url to pdf!Using the leaked HackingTeam source code: Once we Analyzed the backdoor sample, we immediately noticed it’s partially based on HackingTeam’s source code for their Remote Control System hacking tool, which leaked about 3 years ago. Further analysis showed that the Iron cybercrime group used two main functions from HackingTeam’s source in both IronStealer and IronPDFmyURL converts any url to pdf!ransomware.1.Anti-VM: Iron Backdoor uses a virtual machine detection code taken directly from HackingTeam’s “Soldier” implant leaked source code. This piece of code supports detecting Cuckoo Sandbox, VMWare product & Oracle’s VirtualBox. Screenshot:2. Dynamic Function Calls: Iron Backdoor is also using the DynamicCall module from HackingTeam’s “core” library. This module is used to dynamically call external library function by obfuscated the function name, which makes static analysis of this malware more complex. In the following screenshot you can see obfuscated “LFSOFM43/EMM” and “DsfbufGjmfNbqqjohB”, which represents “kernel32.dll” and “CreateFileMappingA” API.PDFmyURL converts any url to pdf!For a full list of obfuscated APIs you can visit obfuscated_calls.h.Malicious Chrome extension: A patched version of the popular Adblock Plus chrome extension is used to inject both the in-browser crypto-mining module (based on CryptoNoter) and the in-browser payment hijacking module.**patched include.preload.js injects two malicious scripts from the attacker’s Pastebin account.The malicious extension is not only loaded once the user opens the browser, but also constantly runs in the background, acting as a stealth host based crypto-miner. The malware sets up a scheduled task that checks if chrome is already running, every minute, if it isn’t, it will “silent-launch” it as you can see in the following screenshot:PDFmyURL converts any url to pdf!Internet Explorer(deprecated):Iron Backdoor itself embeds adblockplusie – Adblock Plus for IE, which is modified in a similar way to the malicious chrome extension, injecting remote javascript. It seems that this functionality is no longer automatically used for some unknown reason.Persistence: Before installing itself as a Windows service, the malware checks for the presence of either 360 Safe Guard or 360 Internet Security by reading following registry keys:.SYSTEM\CurrentControlSet\Services\zhudongfangyu. .SYSTEM\CurrentControlSet\Services\360rpIf one of these products is installed, the malware will only run once without persistence. Otherwise, the malware will proceed to installing rouge, hardcoded root CA certificate on the victim’s workstation. This fake root CA supposedly signed the malware’s binaries, which will make them look legitimate.Comic break: The certificate is protected by the password ‘caonima123’, which means “f*ck your mom” in Mandarin.IronStealer (<RANDOM>.dat): Persistent backdoor, dropper and cryptocurrency theft module.1. Load Cobalt Strike beacon: The malware automatically decrypts hard coded shellcode stage-1, which in turn loads Cobalt Strike beacon in-memory, using a reflective loader:PDFmyURL converts any url to pdf!Beacon: hxxp://dazqc4f140wtl.cloudfront[.]net/ZZYO2. Drop & Execute payload: The payload URL is fetched from a hardcoded Pastebin paste address:We observed two different payloads dropped by the malware:1. Xagent – A variant of “JbossMiner Mining Worm” – a worm written in Python and compiled using PyInstaller for both Windows and Linux platforms. JbossMiner is using known database vulnerabilities to spread. “Xagent” is the original filename Xagent<VER>.exe whereas <VER> seems to be the version of the worm. The last version observed was version 6 (Xagent6.exe).PDFmyURL converts any url to pdf!**Xagent versions 4-6 as seen by VT2. Iron ransomware – We recently saw a shift from dropping Xagent to dropping Iron ransomware. It seems that the wallet & payment portal addresses are identical to the ones that Bart observed. Requested ransom decreased from 0.2 BTC to 0.05 BTC, most likely due to the lack of payment they received.PDFmyURL converts any url to pdf!**Nobody paid so they decreased ransom to 0.05 BTC3. Stealing cryptocurrency from the victim’s workstation: Iron backdoor would drop the latest voidtool Everything search utility and actually silent install it on the victim’s workstation using msiexec. After installation was completed, Iron Backdoor uses Everything in order to find files that are likely to contain cryptocurrency wallets, by filename patterns in both English and Chinese.Full list of patterns extracted from sample: – Etherenum keystore filename – *litecoin*.txtPDFmyURL converts any url to pdf!– *莱特币*.txt – *coinbase*4. Hijack on-going payments in cryptocurrency: IronStealer constantly monitors the user’s clipboard for Bitcoin, Monero & Ethereum wallet address regex patterns. Once matched, it will automatically replace it with the attacker’s wallet address so the victim would unknowingly transfer money to the attacker’s account:Pastebin Account: As part of the investigation, we also tried to figure out what additional information we may learn from the attacker’s Pastebin account:PDFmyURL converts any url to pdf!The account was probably created using the mail fineisgood123@gmail[.]com – the same email address used to register blockbitcoin[.]com (the attacker’s crypto-mining pool & malware host) and swb[.]one (Old server used to host malware & leaked files. replaced by u.cacheoffer[.]tk):1. Index.html: HTML page referring to a fake Firefox download page. 2. crystal_ext-min + angular: JS inject using malicious Chrome extension. 3. android: This paste holds a command line for an unknown backdoored application to execute on infected Android devices. This command line invokes remote Metasploit stager (android.apk) and drops cpuminer 2.3.2 (minerd.txt) built for ARM processor. Considering the last update date (18/11/17) and the low number of views, we believe this paste is obsolete.4. androidminer: Holds the cpuminer command line to execute for unknown malicious android applications, at the time of writing this post, this paste received nearly 2000 hits.PDFmyURL converts any url to pdf!Aikapool[.]com is a public mining pool and port 7915 is used for DogeCoin:The username (myapp2150) was used to register accounts in several forums and on Reddit. These accounts were used to advertise fake “blockchain exploit tool”, which infects the victim’s machine with Cobalt Strike, using a similar VBScript to the one found by Malwrologist (ps5.sct).XAttacker: Copy of XAttacker PHP remote file upload script. miner: Holds payload URL, as mentioned above (IronStealer).FAQ:How many victims are there? It is hard to define for sure, , but to our knowledge, the total of the attacker’s pastes received around 14K views, ~11K for dropped payload URL and ~2k for the android miner paste. Based on that, we estimate that the group has successfully infected, a few thousandsPDFmyURL converts any url to pdf!victims.Who is Iron group? We suspect that the person or persons behind the group are Chinese, due in part to the following findings: . There were several leftover comments in the plugin in Chinese. . Root CA Certificate password (‘f*ck your mom123’ was in Mandarin) We also suspect most of the victims are located in China, because of the following findings: . Searches for wallet file names in Chinese on victims’ workstations. . Won’t install persistence if Qhioo360(popular Chinese AV) is foundIOCS:blockbitcoin[.]com pool.blockbitcoin[.]com ssl2.blockbitcoin[.]com xmr.enjoytopic[.]tk down.cacheoffer[.]tk dzebppteh32lz.cloudfront[.]net dazqc4f140wtl.cloudfront[.]net androidapt.s3-accelerate.amazonaws[.]com androidapt.s3-accelerate.amazonaws[.]com winapt.s3-accelerate.amazonaws[.]com Ex-officer in the IDF-CERT. Malware analyst and Reverse Engineer with vast experience in dealing with Nation-sponsored cyber attacks. | omri@intezer.comTags:backdoorbitcoincryptominercybercrimemalwareransomwarechinaironShare:Register to our free communityTry it nowPDFmyURL converts any url to pdf!Executable And Linkable Format 101 Pa…Digital Certificates- When The Chain Of T…Home ProductsIntezer Analyze™Compromise AssessmentTechnology CompanyAboutNews and EventsIntezer Blog Contact© Intezer.com 2017 All rights reservedTerms ofUsePrivacyPolicyPDFmyURL converts any url to pdf! 