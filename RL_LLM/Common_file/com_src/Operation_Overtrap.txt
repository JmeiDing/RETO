3/12/2020Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security Inâ€¦Trend Micro About TrendLabs Security Intelligence BlogSearch:Home CategoriesHome Â» Malware Â» Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking TrojanOperation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking TrojanPosted on:March 11, 2020 at 6:00 am Posted in:Malware Author: Trend Micro0By Jaromir Horejsi and Joseph C. Chen (Threat Researchers) We recently discovered a new campaign that we dubbed â€œOperation Overtrapâ€ for the numerous ways it can infect or trap victims with its payload. The campaign mainly targets online users of various Japanese banks by stealing their banking credentials using a three-pronged attack. Based on our telemetry, Operation Overtrap has been active since April 2019 and has been solely targeting online banking users located in Japan. Our analysis found that this campaign uses three different attack vectors to steal its victimsâ€™ banking credentials:By sending spam emails with a phishing link to a page disguised as a banking website By sending spam emails asking victims to run a disguised malwareâ€™s executable downloaded from a linked phishing page. By using a custom exploit kit to deliver malware via malvertisingurlâ€¦ 1/83/12/2020Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security Inâ€¦Figure 1. Operation Overtrap three-pronged attack ï¬‚owThis blog will discuss how we discovered the campaign and introduce the brand-new banking trojan Cinobi. Meanwhile, a detailed look at the different attack vectors associated with this campaign, and a more in-depth analysis of dropped conï¬guration ï¬les as well as Cinobiâ€™s features, are discussed in our technical brief.Technical Analysis Discovering Operation Overtrap We ï¬rst discovered the campaign in September 2019 using a then-unidentiï¬ed exploit kit. Based on our data, Operation Overtrap has been using spam emails to deliver its payload to victims as early as April 2019. In mid-September, we observed a signiï¬cant number of victims being redirected to the exploit kit, which targeted Internet Explorer, after they have clicked on links from social media platforms. It should be noted, however, that the way the victims received the links has not been identiï¬ed. It is also worth mentioning that Operation Overtrap only seems to target Japanese online banking users; it redirects victims with other geolocations to a fake online shop. Upon analysis, we saw that the exploit kit only dropped a clean binary that does not perform malicious activities on a victimâ€™s device. It also immediately closes after infection. It is still unclear why the threat actors behind Operation Overtrap initially delivered a clean binary ï¬le; itâ€™s possible that they were testing their custom exploit kit during this stage of the campaignâ€™s development.Figure 2. A screengrab that shows exploit kit network trafï¬c in September 2019urlâ€¦ 2/83/12/2020Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security Inâ€¦Figure 3. A screengrab that shows a clean ï¬le dropped by Operation Overtrapâ€™s exploit kitOperation Overtrapâ€™s Custom Exploit Kit: Bottle Exploit Kit On September 29, 2019, we observed that the exploit kit ceased to drop a clean ï¬le, and instead, delivered a brand-new banking trojan that we dubbed â€œCinobi.â€ We also noted that the threat actors behind Operation Overtrap have stopped redirecting victims from social media and began to use a Japan-targeted malvertising campaign to push their custom exploit kit. Another researcher later discovered the custom exploit kit, which was named the Bottle Exploit Kit (BottleEK). It exploits CVE-2018-15982, a Flash Player use after free vulnerability, as well as CVE-2018-8174, a VBScript remote code execution vulnerability. Victims will be infected with BottleEKâ€™s payload if they access this particular exploit kitâ€™s landing page with unpatched or outdated browsers. Our telemetry shows that BottleEK was the most active exploit kit detected in Japan in February 2020.Figure 4. Exploit kit activity observed in Japan on February 2020 (Data obtained from Trend Micro Smart ProtectionNetworkâ„¢)Brand-new banking malware: Cinobi Operation Overtrap used a new banking malware weâ€™ve decided to call Cinobi. Based on our analysis, Cinobi has two versions â€” the ï¬rst one has a DLL library injection payload that compromises victimsâ€™ web browsers to perform form-grabbing. This Cinobi version can also modify web trafï¬c sent to and received from targeted websites. Our investigation found that all the websites that this campaign targeted were those of Japan-based banks. Aside from form-grabbing, it also has a webinject function that allows cybercriminals to modify accessed webpages. The second version has all the capabilities of the ï¬rst one plus the ability to communicate with a command-and-control (C&C) server over the Tor proxy.urlâ€¦ 3/8Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security Inâ€¦3/12/2020 Cinobiâ€™s four stages of infection Each of Cinobiâ€™s four stages contains an encrypted position-independent shellcode that makes analysis slightly more complicated. Each stage is downloaded from a C&C server after certain conditions have been met. First stage The ï¬rst stage of Cinobiâ€™s infection chain, which has also been analyzed by another cybersecurity researcher, starts by calling the â€œGetUserDefaultUILanguagesâ€ function to check if the infected deviceâ€™s local settings are set to Japanese.Figure 5. Screengrab of Cinobiâ€™s check to determine the deviceâ€™s language settings using â€œGetUserDefaultUILanguagesâ€Cinobi will then download legitimate unzip.exe and Tor applications from the following locations:ftp://ftp[.]cadwork.ch/DVD_V20/cadwork.dir/COM/unzip[.]exe execute it. It will also run tor.exe with custom torrc ï¬le settings.â€œC:\Users\<username>\AppData\LocalLow\<random_name>\Tor\taskhost.exeâ€ â€“f â€œC:\Users\<username>\AppData\LocalLow\<random_name>\torrcâ€It will download the second stage of the malware payload from a .onion C&C address and save it in a randomly named .DLL ï¬le within the â€œ\AppData\LocalLow\â€ folder. The ï¬lename of the ï¬rst stage downloader is saved into a .JPG ï¬le with a random name.Figure 6. Screengrab of the .JPG ï¬le that contains the ï¬lename of the ï¬rst stage downloaderAfter this, Cinobi will run the second stage of its downloader on the victimâ€™s machine.Figure 7. Screengrab of code showing Cinobi running the second stage of its downloader on the victimâ€™s machineSecond stage Cinobi will connect to its C&C server to download and decrypt the ï¬le for the third stage of its infection chain. We observed that the ï¬lename of the third stage starts with the letter C, followed by random characters. Afterward, it will download and decrypt the ï¬le for the fourth stage, which has a ï¬lename that starts with the letter A, followed by random characters. After these, Cinobi will download and decrypt a conï¬g ï¬le (<random_name>.txt) that contains a new C&C address. Cinobi uses RC4 encryption with a hardcoded key.urlâ€¦ 4/83/12/2020Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security Inâ€¦Figure 8. Screengrab of code showing Cinobiâ€™s decoded conï¬g ï¬leNext, Cinobi will run the downloaded third stage infection ï¬le using the UAC bypass method via the CMSTPLUA COM During the third infection stage, Cinobi will copy malware ï¬les from â€œ\AppData\LocalLow\â€ to the â€œ%PUBLIC%â€ folder. It will then install the fourth stage of the downloader (which was downloaded during the second stage) as Winsock Layered Service Provider (WSCInstallProviderAndChains).Figure 9. Screengrab of code showing the installation of the infectionâ€™s fourth stage on the victim machine asâ€œWSCInstallProviderAndChainsâ€Cinobi will then perform the following actions:Change spooler service conï¬g to â€œSERVICE_AUTO_STARTâ€ Disable the following services:UsoSvc DisableAntiSpywareCopy and extract Tor ï¬les to â€œ%PUBLIC%â€ folder Rename tor.exe to taskhost.exe Create torrc in â€œ%PUBLIC%â€ with the content â€œDataDirectory C:\Users\Public\<random_nam>\data\torâ€ Create .JPG ï¬le with the original dropper name Remove ï¬les from â€œ\AppData\LocalLow\,â€ remove original dropper ï¬leFourth stage Cinobi will call the WSCEnumProtocols function to retrieve information about available transport protocols. It will also call the WSCGetProviderPath function to retrieve the DLL path of the original transport provider. This function is called twice. The ï¬rst call will return the malicious provider (as the fourth stage of the malware has already been installed during the third stage of infection). The second call will return the original transport provider (â€œ%SystemRoot%\system32\mswsock.dllâ€) and resolve and call its WSPStartup function. Cinobi will then check the name of the process in which the malicious DLL provider gets injected. In practice, Cinobi should be injected into all processes that make network connections using Windows sockets.Figure 10. Screengrab of processes where the malicious DLL provider has been injectedBest practices against spam and vulnerabilitiesOperation Overtrap uses a variety of attack vectors to steal banking credentials. Users and organizations need to adopt best practices to protect their systems against messaging-related threats and avoid malicious advertisements. An example of a best practice is to have a central point for reporting suspicious emails. Organizations, through their IT teams, need to have a urlâ€¦ 5/8Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security Inâ€¦3/12/2020 centralized information gathering system, and all employees must be aware of the reporting procedure for suspicious emails. Meanwhile, users can avoid malicious advertisements by avoiding clicking on suspicious links or pop-ups and updating software via ofï¬cial channels. Organizations will beneï¬t from regularly updating systems (or useÂ virtual patchingÂ for legacy systems) to prevent attackers from taking advantage of security gaps. Additional security mechanisms like ï¬rewallsÂ andÂ intrusion detection and prevention systemsÂ will help thwart suspicious network activities such as data exï¬ltration or C&C communication. Trend Micro Solutions Organizations can consider Trend Microâ„¢ endpoint solutions such asÂ Trend Micro Smart Protection SuitesÂ andÂ Worry-Freeâ„¢ Business Security. Both solutions can protect users and businesses from threats by detecting malicious ï¬les and spammed messages as well as blocking all related malicious URLs.Â Trend Micro Deep Discoveryâ„¢Â has an email inspection layer that can protect enterprises by detecting malicious attachments and URLs. Trend Microâ„¢ Hosted Email SecurityÂ is a no-maintenance cloud solution that delivers continuously updated protection that stops spam, malware, spear phishing, ransomware, and advanced targeted attacks before they reach the network. It protects Microsoft Exchange,Â Microsoft Ofï¬ce 365, Google Apps, and other hosted and on-premises email solutions. For defending against malvertising campaigns in general, users can employ Trend Microâ„¢ Maximum Security, which protects consumers via a multi-layered defense that delivers highly effective and efï¬cient protection against ever-evolving threats.Â Trend Microâ„¢ Smart Protection SuitesÂ also protect businesses against these types of threats by providing threat protection techniques designed to eliminate security gaps across multiple users and endpoints. You may read our in-depth analysis of Operation Overtrap in thisÂ technical brief, which also contains details about possible links to other phishing campaigns and the indicators of compromise. Related Posts:Latest Trickbot Campaign Delivered via Highly Obfuscated JS File New Exploit Kit Capesand Reuses Old and New Public Exploits and Tools, Blockchain RuseLearn how to protect Enterprises, Small Businesses, and Home Users from ransomware:ENTERPRISEÂ»SMALL BUSINESSÂ»HOMEÂ»Tags: banking malwarebanking TrojanBottle exploit kitBottleEKCinobiexploit kitOperation Overtrapurlâ€¦ 6/8Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security Inâ€¦3/12/2020 0 CommentsTrendLabsğŸ”’Â Privacy PolicyLoginî˜ƒ1 Sort by BestRecommendï„ˆt Tweet f ShareStart the discussionâ€¦LOG IN WITHOR SIGN UP WITH DISQUS?Be the ï¬rst to comment.SubscribeAdd Disqus to your siteAdd DisqusAdddâœ‰ Security Predictions for 2020D N t S ll M D tâš Cybersecurity in 2020 will be viewed through many lenses â€” from differing attacker motivations and cybercriminal arsenal to technological developments and global threat intelligence â€” only so defenders can keep up with the broad range of threats. Read our security predictions for 2020.Business Process CompromiseAttackers are starting to invest in long-term operations that target speciï¬c processes enterprises rely on. They scout for vulnerable practices, susceptible systems and operational loopholes that they can leverage or abuse. To learn more, read our Security 101: Business Process Compromise.Recent PostsOperation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan March Patch Tuesday: LNK, Microsoft Word Vulnerabilities Get Fixes Busting Ghostcat: An Analysis of the Apache Tomcat Vulnerability (CVE-2020-1938 and CNVD-2020-10487) Dissecting Geost: Exposing the Anatomy of the Android Trojan Targeting Russian Banks Security Risks in Online Coding PlatformsPopular PostsLokiBot Impersonates Popular Game Launcher and Drops Compiled C# Code File Misconï¬gured Container Abused to Deliver Cryptocurrency-mining Malware Dissecting Geost: Exposing the Anatomy of the Android Trojan Targeting Russian Banksurlâ€¦ 7/83/12/2020Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security Inâ€¦February Patch Tuesday: Fixes for Critical LNK, RDP, Trident Vulnerabilities Angler and Nuclear Exploit Kits Integrate Pawn Storm Flash ExploitStay Updated Email SubscriptionHome and Home Ofï¬ce About Trend Micro Asia Paciï¬c Region (APAC): Australia / New Zealand, ä¸­å›½, â½‡æœ¬, ëŒ€í•œë¯¼êµ­, å°ç£ Latin America Region (LAR): Brasil, MÃ©xico North America Region (NABU): United States, Canada Europe, Middle East, & Africa Region (EMEA): France, Deutschland / Ã–sterreich / Schweiz, Italia, Ğ Ğ¾ÑÑĞ¸Ñ, EspaÃ±a, United Kingdom / Ireland Copyright Â© 2020 Trend Micro Incorporated. All rights reserved.urlâ€¦ 8/8 