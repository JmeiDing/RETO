team-cymru.com /blog/2022/07/12/an-analysis-of-infrastructure-linked-to-the-hagga-threat-actor/ An Analysis of Infrastructure linked to the Hagga Threat Actor Kyle Krejci View all posts by Kyle Krejci ⋮ ⋮ 7/12/2022SummaryAs this research reveals, mapping out adversary infrastructure has distinct advantages that enable a proactive response to future threats. A well resourced team with access to the right tools can monitor changes to adversary infrastructure in real time, discoveries can become strategic advantages when fully exploited. This blog is geared towards the practitioner threat hunters and threat researchers, anyone reading this with the bottomline in mind should take a look at our economic study here first.IntroductionWe began tracking the threat actor Hagga in late 2021 following the release of an analysis by Z-Lab (Yoroi Security’s malware research team). Z-Lab were tracking a worldwide campaign to distribute the1/11Agent Tesla information stealer through an elusive multi-stage infection process. In their analysis, they common URL directory pattern for the identified C2 panels.This blog will describe how we were able to pivot in threat telemetry, using these IOCs as seeds, to identify several other C2s used by this threat actor, ultimately leading us to a backend MySQL server.Figure 1: C2 Panel IOCsKey ObservationsHagga infrastructure is hosted on dedicated leased infrastructure, largely on QuadraNet and Vietnam Posts and Telecommunications (VNPT). 01 November 2021 onwards. During the period 17 September – 17 December 2021, no further domains were hosted on this IP, indicating it was likely dedicated infrastructure (and not a compromised / shared host).Reviewing certificate data for this IP address identified an expired self-signed SSL certificate with a CN to communications with a single Hostinger IP address on TCP/3306 (the default port for MySQL servers). This activity occurred between 14 October – 17 December; occurring during the same time window as the Agent Tesla campaign identified by Z-Lab.Hostinger IP AddressNote: The Hostinger IP address is redacted throughout this report. As backend infrastructure, its identification would not provide any value to network defenders, and as explained below is likely also utilized for unconnected shared hosting purposes.Passive DNS data identified this IP as a web hosting control panel server. This is supported by open ports data identifying 16 TCP ports that are associated with Hostinger cPanel services. Namely, ports 21, 25, 80, 110, 143, 443, 465, 587, 993, 995, 2080, 2083, 2086, 2087, and 3306.Threat telemetry data for the Hostinger IP address identified inbound connections to TCP/3306 from numerous other IP addresses dating back to at least 17 September 2021. It was assessed that the IP was shared amongst other Hostinger clients, who were likely unconnected to malicious activities.3/11Figure 2: Hostinger MySQL ClientsHostinger MySQL ClientsConsidering the likelihood that the Hostinger IP was used in shared hosting, we needed to include additional constraints to limit our scope to data of relevance to the initial (and potentially other) C2s.We identified several HTTP requests to the original C2 IP address, with several ‘webpanel’ paths using a page.First reported in 2019 by Yoroi researchers, Mana Tools is a malware distribution and C2 panel that was created by the threat actor Hagga. It has been associated with several well-known malware variants, data) are hosted on QuadraNet infrastructure.5/11Figure 4: Hostinger MySQL Client RelationExamining open ports data for each of the above IPs, it appears that they are run on MS-Windows based operating systems. In addition to having standard Windows ports open, TCP/445, TCP/3389, and hosting IP for domain update.newbotv2[.]monster.Based on threat telemetry for communications with the Hostinger IP and timestamps for the Passive DNS resolutions, it appears that the threat actor “rebranded” the C2 domain from bot.statusupdate[.]one to newbotv4[.]monster around 13 October 2021.The X.509 CertificateIt was identified that the certificate (Figure 3) with the serial B5C752C98781B503 was a default certificate included with OpenSSL as part of an XAMPP installation. XAMPP is a free, open-source distribution that packages OpenSSL, MariaDB, PHP, and Perl with an Apache web server. Its primary use is for developers, allowing them to deploy a web server on a local server to test web applications without the need for an internet connection.Given that this certificate was installed on several systems hosting Mana Tools, it appeared that this threat actor was using XAMPP as the web server to host the Mana Tools C2 panel on Windows virtual6/11servers.Back to the Hostinger IPHaving identified the Hostinger IP as a common destination for MySQL traffic from several Hagga C2s, we needed to find more evidence to connect Hagga to the cPanel server. As stated earlier, given the possibility that the cPanel IP is shared amongst multiple Hostinger customers, this was difficult to achieve based on threat telemetry alone. To aid this process, we used insight derived from MalBeacon, in addition to further Passive DNS data.Note: MalBeacon is a revolutionary system that can attribute malware campaigns to the threat actor themselves through proprietary pixel tracking technology. If you haven’t heard of it before, I urge you to check it out.MalBeacon data identified several actor IPs in the vicinity of Lahore, Pakistan, associated with the C2s December 2021 and 03 December 2021. This activity aligned with the dates the IPs were associated with the Hagga C2s.We also identified resolutions in passive DNS data that connect the newbotv4.monster and statusupdate.one domains to Hostinger.7/11Table 4: Hostinger PDNS ResultsWhilst the response IP differed from the Hostinger IP address seen in the outbound TCP/3306 connections, it aligned with the processes of leasing a cPanel VPS with Hostinger.When a user purchases their cPanel account through Hostinger, they are asked to add the domain that they are seeking to host on the account to start the service. Once that domain is added, Hostinger assigns several default hostnames to the domain that resolve to a second IP address, which differs from the cPanel management IP first provided. These default hostnames are what are detailed in Table 4.The cPanel management IP can continue to be used for access to the web server control panel, or as an endpoint for a MySQL database.Continued Observation of Hostinger IPBy continuously monitoring threat telemetry for the Hostinger IP and examining X.509 certificates and URL requests for new MySQL clients, we were able to identify additional related C2 infrastructure within to enumerate associated activity. We subsequently identified several ‘new’ adversary IPs in the vicinity of Lahore, Pakistan. These IPs were observed in communications with the Hostinger IP during the same control server, it was possible to pivot and identify a backend server hosting a MySQL database operated by the threat actor Hagga. From this point a further pivot led us to the identification of additional C2s hosting the Mana Tools C2 panel along with a common certificate that can be used to increase mobibanewdan.duckdns.org mohbeebnew.duckdns.org mubbibun.duckdns.org cdec22.duckdns.org vncgoga.duckdns.org bakuzamokala.duckdns.org warnonmobina.duckdns.org abotherrdpajq.duckdns.org mobinomomuam.duckdns.org workflowstatus.live heavy-dutyindustry.shop microsoftiswear.duckdns.org update.newbotv4.monster newbotv4.monster bot.statusupdate.one11/11 