R E P O R T B Y – R O B E R T FA LC O N E , J O S H G R U N Z W E I G , J E N M I L L E R - O S B O R N , R YA N O L S O NPALO ALTO NETWORKS | 4401 Great America Parkway | Santa Clara, CA 95054 www.paloaltonetworks.comIntroduction 3 Operation Details 3Vietnam 4 Philippines 10 Taiwan and Hong Kong 11 Indonesia 12Elise Backdoor Analysis 12Variant A 13 Variant B 17 Variant C 20Previous Research 23 Conclusion 24 Appendix 25Elise Sample Details 25Elise Executable SHA256 values 33 Elise Delivery Document SHA256 values 34Elise Command and Control Servers 35IntroductionOperation Lotus Blossom describes a persistent cyber espionage campaign against government and military organizations in Southeast Asia, stretching back over three years. Nations we have identified as targeted in this campaign include Hong Kong, Taiwan, Vietnam, the Philippines and Indonesia. The Lotus Blossom group deploys a backdoor Trojan, named Elise, after the sports car made by Group Lotus PLC of the United Kingdom.The group relies on spear phishing attacks to infect its users, often using a malicious office document and decoy file containing content relevant to the target’s occupation or interests. The spear phishing attachment typically includes exploit code for a well-known Microsoft® Office® vulnerability, CVE-2012-0158, which is used to install the Trojan on the system and then display the decoy file, tricking the user into thinking the file opened correctly. Example decoy files include:• A spreadsheet listing high-level officers in the Philippine Navy, along with theirdates of birth and mobile phone numbers.• The operational humanitarian and disaster response (HADR) plan for theArmed Forces of the Philippines, stamped “Secret.”• An invitation to the screening of a film at the Norwegian embassy.While we have not identified specific individuals responsible for these attacks, the evidence suggests a nation state with a strong interest in Southeast Asia. Elise is a custom backdoor Trojan, not readily available online. The tool appears to be used exclusively by Lotus Blossom and was likely developed specifically for their operations. The targets attacked by this group are almost exclusively military and government organizations, whose data is most valuable to other nation states, rather than criminal actors. The fact that this campaign has been ongoing for over three years indicates the individuals behind the attack are well-resourced.Using the Palo Alto Networks® AutoFocus™ platform, which enables analysts to correlate the results of the hundreds of millions of reports generated by the WildFire™ service, Unit 42 has linked over 50 individual attacks to this campaign.The Operational Details section of this report provides details on specific attacks against the targeted governments. The Elise Backdoor Analysis section contains descriptions of how the three different variants of Elise operate and how they changed over time. Domain names and IP addresses used for command and control, as well as hashes of the files used in the attacks are included in the appendix.Operation DetailsOperation Lotus Blossom repeatedly targeted several Southeast Asian countries’ militaries and government agencies, beginning in 2012 and continuing through 2015. The bulk of the activity discussed in this paper involves heavy targeting against both Vietnam and the Philippines during 2013 and 2014.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 3All of the attacks use the custom backdoor Trojan named Elise, which gives the Lotus Blossom group their initial foothold in a network. From there, they can install additional tools, move laterally, and exfiltrate data from the network. Elise is described in more detail later in this report.The operation relies heavily on spear phishing as the initial attack vector, with enticing subject lines and legitimate-looking decoy documents meant to trick users into believing they are opening a legitimate file, as opposed to malware. A popular theme for the decoy documents was personnel rosters, largely claiming to be for specific military or government offices. Another theme was the use of attractive pictures of Asian women that were sourced from the Internet. Some of the information contained in the decoys could be found on the Internet; however, it is worth noting none of the military or government themed decoys could be found.VietnamHong Kong & TaiwanIndonesiaPhilippinesIn particular, the decoys used against the Philippines were exclusively military and government themed, with the bulk purporting to be related to the Navy. As we were unable to find any of the decoys online, and they purport to contain sensitive information, we have not included images of them, in case the information is legitimate. One document is even stamped “Secret.”FIGURE 1 + Elise backdoor samples and C2 infrastructure in distinct but overlapping groups.While all of the Lotus Blossom attacks appear to be the work of a single group, the infrastructure used to target each nation is largely separate (Figure 1). Each Trojan binary in this diagram is connected to command and control (C2) IP addresses and domains that are defined in the Trojan’s configuration file. Additionally, the domains are connected to email addresses used to register them, as well as IP addresses they resolve to at the time of the attack. These links create a visual map of the attacks, which shows that, while the infrastructure is not identical in each attack, they are all connected. In the following sections, we will take a closer look at the attacks on each nation.Vietnam The Lotus Blossom campaign against the Vietnamese government was the most persistent and consisted of 11 waves of spear phishing, primarily during November 2014. There were a total of eight droppers — one Microsoft Excel® document and five Microsoft Word® documents. All included a decoy document intended to trick users into believing they had opened a legitimate file rather than malware, and the content of each was different.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 4The attacks on Vietnam break into two distinct groups. All but three samples used overlapping C2 infrastructure (Figure 2), including two domains registered by “2759931587@qq.com,” which was also used registered C2 domains used in attacks against other Southeast Asian countries. This group of attacks used the following campaign codes to identify their infections, many of which include the string “Alice,” which may have a significance we have not yet identified.• Alice_erpas• Alice_rosey• Alice_15A• Alice_Spider• Alice_vishipel• jessica-cpt-app• oyf• oooFIGURE 2 + Elise samples and infrastructure used to target the Vietnamese government.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 5The second group of attacks (Figure 3) used a different registrant not seen elsewhere in this activity, but overlap with targeting, campaign code structure, and one C2 IP address. While the other domains maintained the information they were originally registered with, one domain used here was registered by ‘paulzz@yeah.net’ and then updated to ‘studywindows123@outlook.com’. The initial registrant also registered other domains detailed in this paper, targeting other Southeast Asian countries prior to their updating, indicating this may be a reseller favored by particular APT group(s). It could also be a simple matter of actor preference, but we cannot say for sure one way or the other. The other domain used a registrar that does not show any registration information. The three campaign codes used with these samples are below.• QY030610• KITY01232• KITY090901FIGURE 3 + Diagram of second group of Vietnam attacks.Most of the attachments used in this campaign had a technical theme, shown in figures two through four. Additionally, all were written in Vietnamese. We are not including an image of one sample, as it claims to be a certification test for a particular type of VSAT terminals. It is unknown how the actors obtained a test for this course, assuming the questions are legitimate.FIGURE 4 + Instructions on how to install and use LogFusion, a legitimate tool used to parse log files.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 6FIGURE 5 + The agenda for Vietnam’s Ministry of Information and Communication workshop with Vibrand, which was held on 4 December 2014. The purpose of the workshop was promoting the development of products and IT services in Vietnam.FIGURE 6 + Excel spreadsheet titled “VPTW Transfer Network Phase 2” and lists a number of provinces in Vietnam as well as Taiyuan in China.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 7The final four sample decoy documents had very different themes. One was an invitation to an event at the Norwegian Embassy in Vietnam commemorating the anniversary of the Kon-Tiki voyage (Figure 7). Of note, the date of the invitation is incorrect — the actual event took place 11 and 12 December 2014. The requested email address accepting RSVPs also seems just slightly suspicious, and they helpfully instructed the recipients to forward the invitation, if they were unable to attend. Two of the decoys contained one or more images of attractive Asian women taken from the Internet, one of which (shown in Figure 8) was used multiple times. The final decoy contained a Merry Christmas image with broken English text.FIGURE 7 + Fake invitation to an event commemorating the Kon-Tiki voyage.FIGURE 8 + Photo of Hoàng Thùy Linh, a Vietnamese actress and singer.FIGURE 9 + A Merry Christmas image with broken English text.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 8The second group of attacks also used decoy documents written in Vietnamese. One document purported to be a contact roster and contains the names and Vietnamese webmail email addresses for multiple high-level Vietnamese officials. The first page of the second decoy is shown below (Figure 10) and claims to be an IT upgrade plan for 2015 for the Vietnamese government. The final sample also appears to be related to an IT upgrade plan, with implementation dates and responsible individuals (Figure 11.)FIGURE 10 + Claims to be an IT upgrade plan for 2015 for the Vietnamese government.FIGURE 11 + Also appears to be related to an IT upgrade plan, with implementation dates and responsible individuals.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 9Philippines The Lotus Blossom operation has targeted the Philippine government, with a particular focus on the military, since at least 2013. We identified six unique Elise droppers, each with its own decoy document and content. These samples all had overlapping command and control infrastructure (Figure 12). All six decoy documents were related to the Philippine military or government, primarily claiming to contain contact information for high-level officers and officials. We are not including images, as it is possible the information is legitimate, but the subject lines with brief descriptions are included in Table 1 below.FIGURE 12 + Connections between Elise samples and C2 servers used in attacks on the Philippines.Decoy Name DFA GAD DirectoryHADR PLAN 29 May 14Decoy Description Claims to be a directory of personnel in the Philippine Department of Foreign Affairs Gender and Development, including private emails and cellphones. Claims to be the operational humanitarian and disaster response (HADR) plan for the Armed Forces of the Philippines and is stamped “Secret.”C,1AD NR 03-0226-313-14 Claims to document a problem logging into an account for a specific real-timeRQST MOUTPIECE LOUD HAILER PN KEYPOSITION with CELL NrsCellphone Numberaircraft tracking system and appears to be a Philippine Air Force document. Claims to be a requisition form for a mouthpiece for a specific hailer for a specific unit. Claims to be a roster of high-level officers at the Philippine Naval Headquarters and is dated 23 June 2014. It has birth dates and cellphone number as well as current job roles. Claims to be a roster of high-level officers at the Philippine Naval Headquarters and is dated February 2015. It contains job roles as well as cellphone numbers.Table 1 + Names and descriptions of decoy documents included in attacks on the Philippine government and military.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 1 0In contrast to the Vietnamese targeting, this activity involves a mix of actor-registered and dynamic DNS (DDNS) domains use for C2. However, the actor-registered domain also used the same initial registrant, ‘paulzz@yeah.net,’ as the final two Vietnamese samples discussed above, and most campaign codes also appear to end with a date. Also of note, all but two of these samples used campaign codes that started with ‘340‘. The text within three of the campaign codes refers to the decoy contents. The campaign codes we saw with the Philippines’ activity are below.• 340_typhoon• 340-0226• 340-dfa-520• 340-0528• phone• key0730Taiwan and Hong Kong We uncovered three droppers that targeted Taiwan and one that targeted Hong Kong. One of these claimed to be a current staff contact list, but when opened, did not contain any information. As this is the only roster-themed decoy that did not contain any information, it may indicate this was a mistake on the threat actor’s part. We were unable to recover decoy documents for the other two.The sample targeting Hong Kong contains earthquake safety information in long form Chinese, copied from the Internet and widely circulated in multiple languages, since at least 2009. It has its own entry on Snopes.com evaluating the accuracy of the information i. This sample is also an outlier, in that it targeted a science and technology university, in contrast to most of the other targeting that had a government or military focus.This activity shows the clearest striation (Figure 13), with the cluster on the left using the first two campaign codes below.• 310-pyq• mm-0807• cyd-zcFIGURE 13 + Connections between Elise samples and C2 servers used in attacks on Taiwan and Hong Kong.It is possible this represents two sub-groups targeting Taiwan and Hong Kong with the same malware over the same period of time. Interestingly, the cluster in the upper left uses some infrastructure used in the Vietnamese activity, as well as a registrant seen in the Philippines’ activity.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 1 1Indonesia We identified one Elise dropper carrying a decoy document written in Indonesian that contains information about health foods to avoid the flu, including a picture of a sweet potato. It appears to have been copied directly from the Internet. The campaign code used in this attack was “36-SC-0115,” as well as the the C2 matches up with one of the Philippine-targeted samples in the previously discussed activity. In addition, the campaign code format and numbers at the end of the campaign code appear to be a date, which is also similar to the Philippines’ activity.FIGURE 14 + Decoy document written in Indonesian, which describes foods that help fend off the flu.Elise Backdoor AnalysisOver the course of our research, Unit 42 has identified over 50 samples belonging to the Elise malware family. Through analysis of these files, we have grouped them into three distinct variants. Compile timestamps for these samples ranged from June 2012 to March 2015. The naming of the three Elise malware variants coincides with their original compile timestamps, starting with the oldest. Please note that these variant labels may not coincide with naming conventions created by the antivirus industry.While each variant uses distinct mechanisms for infecting the system and remaining persistent between reboots, all three variants share the following common attributes:• An encrypted binary configuration data structure containing a list of C2servers to contact.• A campaign identifier, such as ‘jessica-cpt-app’ or ‘370my0216’, whichidentifies the specific malware reporting to the C2 server.• C2 communications using a custom format delivered over HTTP or HTTPS.• Performs basic network reconnaissance upon installation and reports findingsto C2 server.Each variant of Elise contains the functionality to perform the following tasks:• Execute commands, DLLs, or executables• Write Files• Read Files• Update Configuration• Upload Configuration DataP A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 1 2Variant A The first variant of Elise identified by Unit 42 has a compile date set in mid-2012. This particular variant has a configuration size of 1480 and the ability to install itself as either a service or executable. Variant ‘A’ is delivered via a dropper executable file, which differs from later variants that are typically deployed with a malicious Microsoft Office document.When executed, the malware will configure itself for deletion upon reboot, using the MoveFileExA function, as seen below.MoveFileExA(self, 0, MOVEFILE_DELAY_UNTIL_REBOOT);Readers may recall seeing this technique used by the Microsoft Excel shellcode identified in the Vietnam campaign. The malware proceeds to extract and decrypt an embedded DLL to the following location.• %APPDATA%\Microsoft\Network\mssrt32.dllThe following algorithm is used to encrypt/decrypt the embedded DLL:void decrypt_string(char *encrypted, int size) for ( i = size - 1; i > 0; --i ) encrypted[i] ^= encrypted[i - 1]; }Prior to writing this DLL to disk, the malware will write the encrypted configuration to this DLL. The following Python code may be used to decrypt this configuration:from ctypes import * from struct import * import sysfh = open(sys.argv[1], ‘rb’) fd = fh.read() fh.close()cdll.msvcrt.srand(2014) out = “” for x in fd: out += chr(ord(x) ^ (cdll.msvcrt.rand() % 128))print repr(out)P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 1 3The malware proceeds to configure the mssrt32.dll DLL as a service. This service is configured with properties specified in the malware’s configuration. The following example was identified in one of the samples analyzed.Service Name Microsoft Security Compliance Manager The service provides centralized security baseline management features, a baseline portfolio, customization capabilities, and security baseline export flexibility to accelerate your organization¡¯s ability to efficiently manage the security and compliance process for the most widely used Microsoft technologies. %SystemRoot%\System32\svchost.exe -k MSCM %APPDATA%\Microsoft\Network\mssrt32.dll ESEntryThis service is then manually started using a call to the StartServiceA function. Should the installation of this newly created service fail, the malware will instead write an executable to the following location:• %APPDATA%\Microsoft\Network\svchost.exeThe name of this executable is specified within the malware’s configuration data. This file is embedded and dropped in the same manner the mssrt32.dll file was previously. Persistence for this executable is set via the following registry key:• HKCU\Software\Microsoft\Windows\CurrentVersion\Run\svchost :%APPDATA%\Microsoft\Network\svchost.exeFinally, this executable is run via a call to the ShellExecuteW function.This dropped DLL or executable contains the actual Elise malware. When run, it will begin by deleting the following file should it exist:• %TEMP%\000ELISEA350.TMPThis file will be used going forward to store any log data generated by Elise. The malware writes its encrypted configuration to one of the following locations:• %APPDATA%\Microsoft\Network\6B5A4606.CAB • %APPDATA%\Microsoft\Network\6B5A4607.CABP A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 1 4The following script can decrypt and parse the CAB file:import sys from struct import * from ctypes import *cdll.msvcrt.srand(2014) out = “” for x in data: out += chr(ord(x) ^ (cdll.msvcrt.rand() % 128)) return outdef decrypt(data): def parse_config(out): out[0:1154]) fh = open(sys.argv[1], ‘rb’) data = fh.read() fh.close() parse_config(decrypt(data))identifier, \ c1, c2, c3, c4, c5, \ service_description = unpack(“40siiib20s50s50s50s50s50sb40s20s20s50print “Config Identifier : %s” % identifier print “Compile Time : %s” % compile_time print “Unknown DWORD : %s” % unknown1 print “Sleep Timer : %s” % sleep_timer print “Unknown Bool Value : %s” % unknown_bool print “Campaign : %s” % campaign print “Command and Control : %s” % c1 print “Command and Control : %s” % c2 print “Command and Control : %s” % c3 print “Command and Control : %s” % c4 print “Command and Control : %s” % c5 print “Unknown Bool Value 2 : %s” % unknown_bool2 print “Service Executable : %s” % unicode_exe_name.replace(“\x00”,’’) print “Service Name : %s” % service_name print “Registry Service Name : %s” % registry_service_name print “Service Display Name : %s” % display_name print “Service Description : %s” % service_descriptionP A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 1 5The malware proceeds to enter in a loop, where it will attempt to communicate with the specified URLs via HTTP or HTTPS. It initially sends the following GET request to the C2 servers specified in its configuration:GET /<param1>/page_<param2>.html HTTP/1.1 Accept: */* User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Win32) Host: <C2 Server> Connection: Keep-Alive Cache-Control: no-cache Pragma: no-cacheIn the request above, the <param1> parameter is determined using the last four octets of the victim’s MAC address. For example, if the victim’s MAC address was 00-11-22-33-44-55-66, this parameter would become ‘2233445566’. The <param2> parameter is randomly generated using the current time as a seed. This results in a unique request being made every time.When an initial communication is made to the remote server, the malware will execute the following commands to conduct basic network reconnaissance:ipconfig	/all• net user • systeminfoElise uses a series of cookie values in order to exfiltrate data, as seen below.FIGURE 15 + Elise Variant A POST Request.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 1 6Data contained within these cookies is Base64-encoded. Once decoded and joined, the data has the following structure.FIGURE 16 + Elise Variant A Data Encoding.Variant B The second variant (B) of Elise has compile timestamps dating back to July 2012. Variant B has a configuration data structure size of 324 bytes. It is often delivered via a file exploiting a client-side vulnerability, such as CVE-2012-0158.When originally installed on a victim machine, the client-side exploit shellcode will drop two files — an executable file and a DLL. The executable is then run in a newly spawned process. This executable file loads the second exported function of the DLL via the function’s ordinal value. This exported function is commonly called either ‘CsOptionsHandle’ or ‘ESHandle’.When this function is called, this Elise variant will begin by decrypting its 324-byte configuration structure. The following Python code may be used to decrypt and parse this configuration:import sys from struct import * from ctypes import *def decrypt(data):cdll.msvcrt.srand(2014) out = “” for x in data: out += chr(ord(x) ^ (cdll.msvcrt.rand() % 128)) return outdef parse_config(out): c1, c2, c3, c4, c5, \ unknown_string = unpack(“iiib20s50s50s50s50s50sb40s”, out) print “Compile Time : %s” % compile_time print “Unknown DWORD : %s” % unknown1 print “Sleep Timer : %s” % sleep_timer print “Unknown Bool Value : %s” % unknown_bool print “Campaign : %s” % campaignP A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 1 7print “Command and Control : %s” % c1 print “Command and Control : %s” % c2 print “Command and Control : %s” % c3 print “Command and Control : %s” % c4 print “Command and Control : %s” % c5 print “Unknown Bool Value 2 : %s” % unknown_bool2 print “Unknown Unidoce String : %s” % unknown _string.replace(“\x00”,’’)fh = open(sys.argv[1], ‘rb’) data = fh.read() fh.close()parse_config(decrypt(data))As we can see, this variant of Elise uses the same encryption/decryption routine for its configuration data as variant A. The malware proceeds to create one of the following files that will be used to store this configuration data:• %APPDATA%\Microsoft\IMJP8_1\8S3N0PW7.dat • %APPDATA%\\Microsoft\IMJP8_1\26TXNK4F.datOne of the more interesting features of this variant is its ability to detect either a VMware® or VirtualPC virtual environment, as we see below.FIGURE 17 + Elise Variant B virtual environment check.Should the malware detect it is running within either of these environments, it will not perform any malicious activity going forward. Otherwise, it proceeds to configure persistence across reboots by setting the following registry key:• HKCU\Software\Microsoft\Windows\CurrentVersion\Run\imejp : [self]P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 1 8When initially run, Elise variant B will also execute the following commands on the victim machine:ipconfig	/all• • net start • dir	C:\progra~1 • systeminfoThese command strings are obfuscated within the malware, using the following algorithm:char* decrypt_string(char *encrypted, int size) char *result;for ( i = 0; i < size; ++i ) { result = &encrypted[i]; }Exfiltration for variant B uses the same technique used in variant ‘A’. Base64-encoded cookie values are used to exfiltrate data, as seen below.The structure of this base64-decoded data remains the same as well. The following structure is used in variant ‘B’.FIGURE 18 + Elise Variant B POST RequestP A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 1 9FIGURE 19 + Elise Variant B Data EncodingVariant C The third variant of Elise has its earliest compile timestamp in mid-2013 and has been used in attacks periodically since that time. This variant has been the most prevalent overall, accounting for roughly 75 percent of all samples identified by Unit 42. The most recent sample of variant C was compiled in late March of 2015. Additionally, variant C uses a 336-byte configuration structure.Similar to variant B, variant C is often delivered via a file exploiting a client-side vulnerability, such as CVE-2012-0158. This particular variant is delivered as a single DLL with two exported functions — ‘Setting’ and ‘Update’When the ‘Setting’ export is called, the malware will copy itself to the following location:• %APPDATA%\Microsoft\Network\rasphone.dllThis new file is then called via the following command:• Rundll32.exe %APPDATA%\Microsoft\Network\rasphone.dll,UpdateWhen the ‘Update’ export is called on rasphone.dll, the malware will begin by checking if a debugger is attached via a call to IsDebuggerPresent(). In the event it is not detected, the malware will then check to ensure the DLL has been loaded by Rundll32. exe by comparing the current filename against ‘dll32’. rasphone.dll uses a simple string encryption routing. The following code can decrypt encountered strings:void decrypt_string(char *encrypted, int size) for ( i = size - 1; i > 0; --i ) encrypted[i] ^= encrypted[i - 1]; }P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 2 0The malware continues to identify the location of iexplore.exe (%PROGRAM FILES%\ Internet Explorer\iexplore.exe) and spawn a new instance of this process. The malware will proceed to inject itself into iexplore.exe. Finally, the malware will decrypt an embedded DLL located in its resource section (‘XDATA’) and write this DLL to a new section of memory in iexplore.exe. A configuration blob of 336 bytes is subsequently written to this DLL, and the DLL is loaded into iexplore.exe via a call to LoadLibraryA.The injected DLL (hereafter referred to as xdata) begins by spawning a new thread where all further actions will be taken. The malware writes its encrypted configuration to the following location:• %APPDATA%\Microsoft\Network\6B5A4606.CABThe following script can be used to decrypt this CAB file.import sys from struct import *def decrypt(data):str_len = len(data) - 1 out = “” while(str_len > 0): out = chr(ord(data[0]) ^ 0xA0) + out return outstr_len -= 1 if str_len == 0: out = chr(ord(data[str_len]) ^ ord(data[str_len-1])) + outdef parse_config(out): c1, c2, c3, c4, c5, c6 = unpack(“iiib20s50s50s50s50s50s50s”, out[0:333]) print “Compile Time : %s” % compile_time print “Unknown DWORD : %s” % unknown1 print “Sleep Timer : %s” % sleep_timer print “Unknown Bool Value : %s” % unknown_bool print “Campaign : %s” % campaign print “Command and Control : %s” % c1 print “Command and Control : %s” % c2 print “Command and Control : %s” % c3 print “Command and Control : %s” % c4 print “Command and Control : %s” % c5 print “Command and Control : %s” % c6fh = open(sys.argv[1], ‘rb’) data = fh.read() fh.close()parse_config(decrypt(data))P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 2 1Additionally, this CAB file is “time stomped” to a Create/Modify time of Sunday, November 21, 2010, 10:29:33 UTC. This malware also writes to a log file located at the following path.• %TEMP%\00EL225AF.TMPData in this file is not obfuscated or encrypted in any way. The malware proceeds to enter in a loop, where it will attempt to communicate with the specified URLs via either HTTP or HTTPS. The following has been identified about the structure of the binary data submitted via POST requests. This structure is consistent with all previous Elise variants discussed.FIGURE 20 + Elise Variant C Data Encoding.When an initial communication is made to the remote server, the malware will execute the following commands to conduct basic network reconnaissance:ipconfig	/all• net user • systeminfoThis data is exfiltrated using a POST request, as seen below.FIGURE 21 + Elise Variant C POST Request.In the above example, the ‘2320’ value in the URI is generated using the victim’s MAC address. The ‘00320511’ value in the URI is generated using the current time. This allows each request to be unique and also identify the victim machine.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 2 2Previous ResearchMultiple research groups have mentioned the Elise backdoor in publicly available reports. This section highlights some of those to help readers connect this campaign to previously known attacks.In 2013, Xecure Labs and Academia Sinica published a joint paper, and they delivered a presentation at BlackHat in which they identified Elise as part of a larger group of tools they referred to as the “LStudio,” “ST Group” and “APT0LSTU.” The research team noted that Elise and other related tools had been used primarily in attacks on Taiwan (Figure 22), but also against the United States, Canada and other nations.FIGURE 22 + Slide 30 from BlackHat presentation showing Elise target.Trend Micro refers to Elise as BKDR_ESILE, making a slight modification to the author’s chosen name. Trend Micro first reported on Elise in their 2013 2H targeted Attack Trends report ii. Since then, they have referenced that paper in multiple blogs and reports iii iv v. This research indicates that the majority of attacks using Elise also targeted government organizations in the Asia Pacific region.FireEye refers to Elise as the “Page” malware, because early versions of the Trojan use the word “page” in their Command and Control URLs. FireEye first noted an Elise attack in September 2012, which involved a targeted spear phishing attack against the aviation defense industry vi. FireEye later noted Elise was delivered in an attack using a lure related to the crash of Malaysian Airlines flight 370 vii.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 2 3ConclusionOperation Lotus Blossom represents a long-term campaign targeting government and military organizations in several nations of Southeast Asia conducted by a persistent attack group. We traced the earliest of these attacks to 2012, and the most recent occurred during the course of writing this paper. In one case, the targeted organization received 20 separate email attacks carrying Elise exploit files over the course of eight weeks.While we cannot attribute these attacks to those of a specific nation state, the pattern indicates a highly persistent adversary with the ability to develop custom tools, and maintain command and control infrastructure, over a long period of time. This evidence is consistent with a nation state adversary with a strong interest in the militaries of Southeast Asian nations.Lotus Blossom may deploy additional tools beyond the Elise backdoor detailed in this report, after the group has achieved a foothold in the network. Related tools used by the group include those known as “LStudio,” and Evora.Unit 42 initially identified the attacks described in this report using Palo Alto Networks AutoFocus platform, which quickly enables analysts to find connections between malware samples analyzed by our WildFire system. We combined this data with open source intelligence to gather additional samples, which broadened the scope of our analysis. We have tagged all of these samples, and the infrastructure used in this campaign, within AutoFocus, using the tags Elise and LotusBlossom respectively.WildFire correctly identifies Elise executables, as well as the exploit files used in Lotus Blossom attacks, as malicious. We have released IPS signature 14358 in response, which detects command and control traffic generated by Elise.P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 2 4AppendixElise Sample DetailsSHA256 Campaign Code PYQ 59.6.2[.]16 cpcl2006.dyndns-free[.]com shotacon.dyndns[.]info petto.mooo[.]com kid.dyndns[.]orgSHA256 Campaign Code PYQ 59.6.2[.]16 cpcl2006.dyndns-free[.]com shotacon.dyndns[.]info petto.mooo[.]com kid.dyndns[.]orgSHA256 Campaign Code MYGHOST 50.7.11[.]10 www3.bkav2010[.]netSHA256 Campaign Code yxz-tw 184.22.44[.]209 kjd.dyndns[.]org 202.82.202[.]228 wsi.dyndns[.]org cpcl2006.dyndns-free[.]comSHA256 Campaign Code 340_typhoon beckhammer.xicp[.]net 122.10.89[.]84SHA256 Campaign Code llmacau 202.82.91[.]139 218.103.16[.]153 203.218.138[.]30 103.246.245[.]146P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 2 5SHA256 Campaign Code yxz-kjhkjsxy 184.22.44[.]209 kjd.dyndns[.]org 202.82.202[.]228 wsi.dyndns[.]org cpcl2006.dyndns-free[.]comSHA256 Campaign Code 340_typhoon beckhammer.xicp[.]net 122.10.89[.]84SHA256 Campaign Code demo 122.10.89[.]84 beckhammer.xicp[.]net 122.10.89[.]85SHA256 Campaign Code 340-0226 harryleed.dyndns[.]org verolalia.dyndns[.]org jackyson.dyndns[.]info scristioned.dyndns-web[.]com 173.231.49[.]98SHA256 Campaign Code yxz-tw cpcl2006.dyndns-free[.]com wsi.dyndns[.]org 202.82.202[.]228 kjd.dyndns[.]org 184.22.44[.]209SHA256 Campaign Code Alice_vishipel www.serchers[.]net 142.91.252[.]130 www.aliancesky[.]com 58.64.183[.]92SHA256 Campaign Code G140509ZA01 46.251.237[.]59 www.tintuchoahau[.]comP A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 2 6SHA256 Campaign Code 310-pyq cybertunnel.dyndns[.]info newshappys.dyndns-blog[.]com www.imonju[.]com www.serchers[.]net 202.82.202[.]228SHA256 Campaign Code 370mymm 122.10.89[.]84 122.10.89[.]85SHA256 Campaign Code Command and ControlSHA256 Campaign Code Command and ControlSHA256 Campaign Code Command and ControlSHA256 Campaign Code 340-dfa-520 phil-gov.gotdns[.]org scristioned.dyndns-web[.]com asean-star[.]com aseansec.dynalias[.]org 340-0528 phil-army.gotdns[.]org scristioned.dyndns-web[.]com asean-star[.]com aseansec.dynalias[.]org 310-pyq cybertunnel.dyndns[.]info newshappys.dyndns-blog[.]com www.imonju[.]com www.serchers[.]net 340-0528 phil-army.gotdns[.]org scristioned.dyndns-web[.]com asean-star[.]com aseansec.dynalias[.]org 113.10.136[.]18SHA256 Campaign Code 731 usa-moon[.]net 23.234.63[.]197P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 2 7SHA256 Campaign Code key0730 usa-moon[.]net 23.234.63[.]197SHA256 Campaign Code bio usa-moon[.]net 23.234.63[.]197SHA256 Campaign Code Alice_Spider www.aliancesky[.]com 58.64.183[.]92 www.serchers[.]net 162.211.181[.]107SHA256 Campaign Code HKDLS 101.55.121[.]47 27.255.64[.]231 www.iascas[.]net 59.188.247[.]32SHA256 Campaign Code FUCKU 101.55.121[.]47 118.193.212[.]61 www.seachers[.]netSHA256 Campaign Code FUCKU 101.55.121[.]47 118.193.212[.]61 www.seachers[.]netSHA256 Campaign Code FUCKU 101.55.121[.]47 118.193.212[.]61 www.seachers[.]netSHA256 Campaign Code FUCKU 101.55.121[.]47 118.193.212[.]61 www.seachers[.]netP A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 2 8SHA256 Campaign Code HKDLS 101.55.121[.]47 27.255.64[.]231 www.iascas[.]net 59.188.247[.]32SHA256 Campaign Code FUCKU 101.55.121[.]47 118.193.212[.]61 www.seachers[.]netSHA256 Campaign Code mm-0807 www.imonju[.]net 61.58.31[.]102 202.77.181[.]179SHA256 Campaign Code jessica-cpt-app www.serchers[.]net www.aliancesky[.]com 162.211.181[.]107 58.64.183[.]92SHA256 Campaign Code jessica-cpt-app www.serchers[.]net www.aliancesky[.]com 162.211.181[.]107 58.64.183[.]92SHA256 Campaign Code Alice_erpas www.boshman09[.]com www.chris201[.]net 58.64.183[.]92SHA256 Campaign Code jessica-cpt-app www.serchers[.]net www.aliancesky[.]com 162.211.181[.]107 58.64.183[.]92P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 2 9SHA256 Campaign Code KITY090901 46.251.237[.]59 www.tintuchoahau[.]comSHA256 Campaign Code KITY090901 46.251.237[.]59 www.tintuchoahau[.]comSHA256 Campaign Code QY030610 95.154.195[.]152 www.vienclp[.]comSHA256 Campaign Code KITY01232 95.154.195[.]152 www.vienclp[.]comSHA256 Campaign Code KITY01232 95.154.195[.]152 www.vienclp[.]comSHA256 Campaign Code QY030610 95.154.195[.]152 www.vienclp[.]comSHA256 Campaign Code QY030610 95.154.195[.]152 www.vienclp[.]comSHA256 Campaign Code 58.64.183[.]92P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 3 0SHA256 Campaign Code oyf www.boshman09[.]com www.chris201[.]net 210.209.79[.]29SHA256 Campaign Code 36-SC-0114 103.244.91[.]16 162.211.181[.]26 101.55.120[.]165 beckhammer.xicp[.]net newinfo32.eicp[.]netSHA256 Campaign Code 36-SC-0127 www.interhero[.]net 101.55.120[.]165 101.55.120[.]153 www.babysoal[.]com beckhammer.xicp[.]netSHA256 Campaign Code Alice_rosey 210.209.127[.]8 www.boshman09[.]com www.chris201[.]net 45.64.113[.]130SHA256 Campaign Code 340-dfa-1007 usa-moon[.]net aseaneco[.]org 103.28.46[.]96SHA256 Campaign Code 370my0216 113.10.222[.]157 www.tgecc[.]orgSHA256 Campaign Code ooo www.boshman09[.]com www.chris201[.]net 210.209.79[.]29P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 3 1SHA256 Campaign Code ooo www.boshman09[.]com www.chris201[.]net 210.209.79[.]29SHA256 Campaign Code Alice_15A 210.209.127[.]8 www.boshman09[.]com www.chris201[.]netSHA256 Campaign Code Alice_rosey 210.209.127[.]8 www.boshman09[.]com www.chris201[.]net 45.64.113[.]130SHA256 Campaign Code ooo www.boshman09[.]com www.chris201[.]net 210.209.79[.]29SHA256 Campaign Code phone usa-moon[.]net aseaneco[.]org 103.252.19[.]13SHA256 Campaign Code phone usa-moon[.]net aseaneco[.]org 103.252.19[.]13SHA256 Campaign Code cyd-zc 101.55.121[.]47 118.193.212[.]61SHA256 Campaign Code cyd-zc 101.55.121[.]47 118.193.212[.]61P A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 3 2Elise Executable SHA256 values asean-star.com aseaneco.org aseansec.dynalias.org beckhammer.xicp.net cpcl2006.dyndns-free.com cybertunnel.dyndns.info harryleed.dyndns.org jackyson.dyndns.infoP A L O A LT O N E T W O R K S + O p e r a t i o n L o t u s B l o s s o m 3 5kid.dyndns.org kjd.dyndns.org newinfo32.eicp.net newshappys.dyndns-blog.com petto.mooo.com phil-army.gotdns.org phil-gov.gotdns.org scristioned.dyndns-web.com shotacon.dyndns.info usa-moon.net verolalia.dyndns.org wsi.dyndns.org www.aliancesky.com www.babysoal.com www.boshman09.com www.chris201.net www.iascas.net www.imonju.com www.imonju.net www.interhero.net www.seachers.net www.serchers.net www.tgecc.org www.tintuchoahau.com www.vienclp.com www3.bkav2010.neti Triangle of Life. Snopes. December, 2009. url ii Targeted Attack Trends 2013 2H. Trend Micro Inc. May 19, 2014.url Targeted Attack Trends in Asia-Pacific. Trend Micro Inc. Nov. 20, 2014. url BKDR_ESILE.SMEX. Trend Micro Inc. May 28, 2013.url ESILE Targeted Attack Campaign Hits APAC Governments. Trend Micro Inc. July 28, 2014.url esile-targeted-attack-campaign-hits-apac-governmentsvi Analysis of Malware Page. Singh, Abhishek. Sept. 12, 2012.url Spear Phishing the News Cycle: APT Actors Leverage Interest in the Disappearance of Malaysian FlightMH 370. Moran, Ned & Lanstein, Alex url spear-phishing-the-news-cycle-apt-actors-leverage-interest-in-the-disappearance-of-malaysian-flight-mh-370.html4401 Great America Parkway Santa Clara, CA 95054 www.paloaltonetworks.comCopyright ©2015, Palo Alto Networks, Inc. All rights reserved. Palo Alto Networks, the Palo Alto Networks Logo, PAN-OS, App-ID and Panorama are trademarks of Palo Alto Networks, Inc. All specifications are subject to change without notice. Palo Alto Networks assumes no responsibility for any inaccuracies in this document or for any obligation to update information in this document. Palo Alto Networks reserves the right to change, modify, transfer, or otherwise revise this publication without notice. PAN_WP_U42_OLB_061515 