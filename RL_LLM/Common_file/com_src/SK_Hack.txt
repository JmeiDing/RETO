SKHackbyanAdvancedPersistentThreatCommandFivePtyLtd September2011ABSTRACTthe July 2011This document summarises intrusion into SK Communications which	culminated	in the theft	of	the personal informationof	up	to	35millionpeople.Itdescribestheuseofatrojaned softwareupdateto	gainaccessto	thetarget	network,	ineffect	turninga security	practiceinto	avulnerability.	Italso	describestheuseof	a legitimatecompanytohosttoolsusedintheintrusion.Linksbetween thisintrusionandothermaliciousactivity	areidentified	and	valuable insights are provided for network defenders. Technical details of malicioussoftwareand	infrastructurearealso	provided.SK HACKWARNINGThis paper discusses malicious activity and identifiesInternetProtocol(IP)addresses,domain names, and websites that may	contain malicious content.	Forsafety	reasonstheselocationsshould not	be accessed,	scanned, probed,	or otherwise interacted	with	unlesstheirtrustworthinesscanbe verified. On28	July	2011	SKCommunicationsannounced	it had	beenthesubject	ofahackwhich	resulted	inthe theft	of	thepersonaldetailsof	up	to	35	millionof	its users.	The compromised	details were those of stored CyWorld and Nate users, as in SK Communications’userdatabases.	CyWorld1is	South Korea’slargest	socialnetworking	siteand	Nateis	a popularSouth	Koreanwebportal.	Both	servicesare ownedby	SKCommunications.	(Sung­jin,2011) 1CyWorldhas	alsoexpanded	toChina,Japan,theUnited	States, Taiwan,Vietnamand	Europe.(SK	Communications)Thesophisticationof	theattackalong	with	the period of time over which	it	was planned,	and conducted,	indicatethat	thisattackwaslikely	to havebeenundertakenby	anAdvanced	Persistent Threat2.	Between18and25July2011	theattackers3 infectedover60SK	Communicationscomputersand usedthem	to	gainaccesstotheuserdatabases.	The compromising	aserver,belonging	toaSouthKorean softwarecompany,used	todeliversoftwareupdates to	customers(includingSKCommunications).	The attackers modified the server so that trojaned4update file when they	conducted	their routinechecksforsoftwareupdates.	(Moon­young, 2011)(ESTsoft,	2011) 2Foradefinitionoftheterm‘Advanced	PersistentThreat’	referto theCommandFivepaper‘Advanced	PersistentThreats:ADecade inReview’	(Command	FivePtyLtd,2011). 3Theterm‘attackers’isusedinthis	papertodescribeboththe hackers	and	anyonetowhomtheywerereporting. 4Atrojanisadocumentorprogramwhich	appearsharmless	but performs	maliciousactivitywhenopened	orrun.COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE1OF	24detailsof upSuch	routine updates (commonly	known as ‘patches’)areagoodsecurity	practiceastheyoften includefixesforsecurityweaknessesidentifiedin the software.	Without	software updates the SK Communications computers would have been vulnerable to several other attacks including	a significant one which	was made public in June 20115.	Thesecurityofsoftwareupdatesisusually trusted	implicitly	and	theexploitationof	thistrust relationshipcould	go	undetectedbymany	targets,	as it	didforsometimeby	SK	Communications. Between18	and25	July	theattackersconducted commandandcontrolandmonitoringactivitieson theinfectedcomputers.	Thisinvolvedtheupload	of tools,	conveniently stored on the website of a Taiwanesepublishingcompany	theattackershad earlierhacked.	Thenon26July	2011,	theattackers, having	donethenecessary	groundwork,	proceeded to	hack the Nate and CyWorld user databases6. (Birdman,2011)(Moon­young,	2011) Using	‘waypoints’7to	obfuscate the source of theiractivities,	theattackerssuccessfully	stolethe to 35 million Communicationscustomersfromtheuserdatabases. These personal details included names, phone numbers,	homeandemailaddresses,birthdates, genderdetails,	useridentifiers,	passwords	and,	due to	SouthKorea’sRealNameSystem8which	wasin placeat	thetime,	also	resident	registrationnumbers. Thepasswords	andresident	registrationnumbers were reportedly encrypted but the other details werenot.	(Birdman,	2011)(Hauri­ResponseTeam, 2011)(Moon­young,2011)(Jin­woo	Seo,	2011) The update server used	by	the attackers as a ESTsoftis	alargeSouth	Koreansoftwarecompany 5Avulnerabilityexists	incertainversions	ofasoftwareprogram used	bySK	Communications	(amongstothercompanies)which could allow	an attacker to gain control	of computers	if the programis	used	onthemtoopenamaliciouslycrafted	file. (JapaneseITPromotionAgency2011) 6According	totheKoreanNational	PoliceAgencythehacker collected	informationfromtheinfected	computers	foruptoa weekbeforehacking	thedatabases.(Moon­young,2011) 7A‘waypoint’	is	acomputerused	byattackers	as	anintermediary pointtoobfuscatethesourceoftheirhacking	activities. 8UnderSouth	Korea’s	Real	NameSystem,Koreans	wererequired tosubmittheirreal	names	and	residentregistrationnumbers whencreating	accounts	onanywebsiteattracting	morethan 100,000visitors	perday.(TMCnews	2011)THE UPDATE SERVERsoftware, ALYac. Theand	ALZip	isafilecompressionand	archivetool developed	by	thecompany.	ALZip	is	part	of	atrusted softwareis	independent	oftherest	of	thesuiteof tools.	It	usesadifferentupdateprogram	and	server to	theothertools.	Thesecurity	of	ALYacwasnot compromised	intheattack.	(ESTsoft,2011)(ESTsoft, 2011)The attackers,	purportedly using	Chinese IP addresses9,	gained	accesstotheALZipupdateserver viaunknownmeansand	uploaded	instructionsto	it. the attacker’s instructions on the update server directed the computers to download a trojaned attacker’s Content Delivery Network10(CDN)instead	of	thelegitimateupdate fromESTsoft’sCDN.(ESTsoft,	2011) vulnerability11in the ALTools Common Module program	used to	conduct	theroutinechecksfor ALTools software updates. This vulnerability allowed	amaliciousDynamicLinkLibrary	(DLL)12 filetobeloaded	insteadof	thelegitimateDLLupdate file(ALAd.dll),	therebyenabling	maliciouscodetobe software (malware) run and malicious to be installed	oncomputerswhich	requested	theupdate. Over 60 SK Communications computers were compromised	via the trojaned	update. (ESTsoft, 2011)(EDaily,	2011)(ESTsoft,	2011) Theattackersarebelievedto	havedesignated targetsforinfection,so	that	thetrojaned	updatewas only	delivered	to	SK Communications computers and	not	to	othercomputersrequesting	thesame 9According	toSouth	Koreannews	outlets	theattackers	used ChineseIP	addresses.(Goodin,2011) 10ACDNis	comprised	ofmultipleservers	which	areused	to distributesoftwaredownloads,therebybalancing	theload	and preventing outages due to individual servers becoming several	tools	intheALToolssuite.Thevulnerabilityallowed arbitrarycodetobeexecuted	butcouldonly	beexploited	fromthe actual	updateserveror,ifacomputercouldbedirectedtoit(eg. bymodifying	thehostfile	onthecomputerorviaDNShijacking), afake	updateserver.Apatch	forthevulnerabilitywas	released	on 4	August2011.(ESTsoft2011)(ESTsoft,2011) 12According	toMicrosoft,aDLLisalibrarythatcontains	codeand datathatcanbeused	bymorethanoneprogramatthesametime. (Microsoft2007)fortheirCOPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE2OF	24software update from	the server13.	The way	the updateserverwasused	intheattackis	depictedin Figure1.AttackerALZip Update ServerTargeted ComputersNon­targeted 2.3.THE INFECTED COMPUTERSattack.	This	knowledgewaslikely	gainedduringthe reconnaissance14stageof	theattack. AftertheALZip	updateprogram	(ALCMUpdate.exe) downloadedthetrojaned	updateonto	the60+	SK as‘Backdoor.Agent.Hza’. Thetrojaned	updatefile ‘dropped’ the malware ‘Backdoor.Agent.Hza’ onto thecomputersand,	inso	doing,	gavetheattackera ‘backdoor’ into them. The trojaned update is ‘Trojan.Dropper.Agent.Hza Backdoor.Agent.Hza’ ‘V.DRP.Agent.Hza and V.BKD.Agent.Hza’by	different	versionsofESTsoft’s ALYacantivirussoftware.	(ESTsoft,	2011)(ESTsoft, 2011)Once infected,	the computers communicated with	thecommand	and	controlserverlocatedat TransmissionControlProtocol(TCP)port808015.	It is	possible the infected SK	computers used	the associated	withthehack16)to	locatethecommand and	control server.	It	is, however,	unconfirmed whetherthedomain‘update.alyac.org’resolved	to the South	Korean IP	addressat	thetimeof the Between18	July	2011	and25	July	2011,	the attackers used	the infected	computers to	collect additionalinternalaccessinformationand	database credentials.	They	presumably	used	a file named ‘x.exe’17to	acquiresomeofthisinformation,	after downloading it onto infected computers from a toolbox they	had	earlier set	up. Based	on the behaviourof	thisfile,theattackerslikely	usedit	to conduct network enumeration and to obtain refertotheCommand	FivePaper‘AdvancedPersistentThreats:A DecadeinReview’(Command	FivePtyLtd,2011). 15AccordingtoSamsung	IDC,theALToolsrelatedcommandand 16According	toETnews	thedomain‘update.alyac.org’	was	used	in thehack.ETnews	does	notstatehowthedomainwas	involved but,giventheinfectedcomputers	had	ALTools	installed	onthem, useof‘ALYac.org’	inthecallbackdomainmayhavehelpedto disguisethemalicious	communications.(ETnews2011) 17Thefilenamed‘x.exe’	is	51712bytes	andhas	aSHA1	hashof 5A1B	E6ADCB2CC40B2E9D6B6C569F	D4DAB273E7AD. (JSUNPACK,	2011)‘update.alyac.org’ (SamsungAttacker modifies the ALZip update server. Computers check for ALZip software updates and are redirected to a Content Delivery Network (CDN). Non­targeted computers download a legitimate update from the ESTsoft CDN. Targeted computers download a trojaned update from the attacker’s malicious CDN.FIGURE1­DEPICTIONOFHOWTHEALZIPUPDATE SERVERWASUSEDINTHEATTACK This	specifictargeting	of	SKCommunications indicatesthetargetingwasn’tpurelyopportunistic. Totarget	thecompanyinthemannerthey	did,	the attackers would	have needed	knowledge of	SK Communicationsand	its	useof	ALZip,	ahead	of	the 13The Korean National	Police Agency presumes	the hacker, instead	oftargeting	allALZipusers,singledouttheintranet computers	atSK	Communications.(Moon­young,	2011)COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE3OF	24THE TOOLBOXcredentials such	as usernames and	passwords18. (Birdman,2011)(Moon­young,	2011) Theattackeralso	installed	themalwareused	to accesstheuserdatabasesonatleastoneofthe infected computers. The malware was named ‘nateon.exe’19and	was also	hosted	on the same toolbox,	along	withanotherfilenamed‘rar.exe’20. (Birdman,2011)(Hauri	­ResponseTeam,	2011) Staticanalysis21of	thefile‘rar.exe’indicatesit	is amodifiedversionof	theWinRar22commandline program	­also	named‘rar.exe’.Thefilemay	have beenusedintheattacktocreateoropenarchive files. The modifications made to the program remove the program properties This	issomewhatredundant	inthisinstancethough, given the file name indicates the nature of	the files downloaded onto the at	‘www.cph.com.tw/act’23–awebsitebelongingto the company’s It webserverwascompromised	unbeknownst	to	its ownerandused	by	theattackerasatoolboxfrom which	to	download	maliciousfilesand	hackertools ontotargeted	computers. Thewebsite‘cph.com.tw’isassumed	to	have beenrunning	onanInternet	InformationServices (IIS)webserverat	thetimetheserverwashacked25. IIS runs on the Microsoft Windows operating system,	indicating	the compromised	server was ‘Heuristic.BehavesLike.Win32.PasswordStealer.H’ ‘HKTL_NETVIEW’.(HispasecSistemas,2011) 19Thefilenamed‘nateon.exe’is	166912bytesand	hasaSHA1 hashofF84CD73DABF1	8660	7F98	6DF9	8C5402A5	7BB5 8AD1.	Itis	detected	as‘Backdoor.Sogu’bySymantecantivirus software.(JSUNPACK	2011).(HispasecSistemas,2011) 20Thefile	named	‘rar.exe’is	337920	bytes	and	has	aSHA1	hashof E87C3ACB	A599	5E017AD3	1B29	A5E2	FE363ED4D9EB. (JSUNPACK	2011) 21Static analysis	refers to analysis	of a program’s code to determineitsfunctionality,as	opposed	todynamicanalysis	in which	aprogramis	executedtodetermineits	behaviour. 22WinRARis	apopulararchiving	andcompressiontool. 23The files	‘nateon.exe’, ‘rar.exe’ and	‘x.exe’ were hosted	at ‘www.cph.com.tw/act’.(Birdman,2011) 24CiteMediaHolding	Grouppublishes	over20millionmagazine issueseachyearinTaiwan.(Novell2011) 25Anarchivederrorpageshows	the‘cph.com.tw’websitewas running	onanIISserverinlate2010.(TheInternetArchive2010)softwareisTHE DATABASE ACCESSlikely	running	Microsoft Windows. There are a numberof	knownvulnerabilitiesforboth	IIS	and Microsoft	Windows	which	potentially	could	have After the week collecting information from the infected computers the attackers were ready to accessthedatabases.On26July	2011,	theyusedthe information they had gathered, along with a maliciousprogram	named	‘nateon.exe’,	to	accessthe theft of and CyWorld databases. The Nate informationcontinued	intothefollowingday	­27 July	2011. (Birdman,	2011) (Moon­young,	2011) (Hauri­ResponseTeam,	2011) The personal information extracted from the databaseswaspurportedly	sent	viaawaypoint	to	a ChineseIPaddresswherethehackerreceivedthe information. The waypoint used purportedly belonged	toacompany	based	inSeoul’sNonhyeon neighbourhood.	(Moon­young,	2011) The South Korean waypoint	may	have been located	by	themalwareusing	thecallbackdomain ‘ro.diggfunny.com’which	wasreportedly	associated with	theleakof	informationfrom	thedatabases27.	It hasnot,	however,	beenconfirmed	whether,	at	the timeof	theattack,	thiscallbackdomainpointed	to	an IP	addressbelonging	toaNonhyeon­based	company.26Both	theMicrosoftSecurityTechCenterand	theUSNational VulnerabilityDatabasemakeavailableacomprehensivelistof Microsoft Windows and	IIS vulnerabilities. (Microsoft n.d.) (NationalInstituteofStandardsandTechnologyn.d.) associatedwiththeleakofdatabasefiles	fromNate.(Samsung IDC2011)COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE4OF	2410026210/10070910: 31 9C 6C 4C B9 3A 10 00 E8 03 00 00 01 00 50 00 1.lL.: è P. 10026220/10070920: 6E 61 74 65 6F 6E 2E 64 75 61 6D 6C 69 76 65 2E nateon.duamlive. 10026230/10070930: 63 6F 6D 00 00 00 00 00 00 00 00 00 00 00 00 00 com 10026240/10070940: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 … 100268A0/10070FA0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 100268B0/10070FB0: 00 00 00 00 00 00 00 00 00 00 00 00 77 69 6E 73 wins 100268C0/10070FC0: 76 63 66 73 00 00 00 00 00 00 00 00 00 00 00 00 vcfs 100268D0/10070FD0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 … 10026930/10071030: 00 00 00 00 00 00 00 00 00 00 00 00 FIGURE2­EXCERPTSFROMTHE‘NATEON.EXE’CONFIGURATIONBLOCKTHE DESTORY RATStructure	and Behaviourusedinthe malwareThemaliciousprogramnamed‘nateon.exe’installsa ‘winsvcfs.dll’.	Itmodifiesthesystemregistry	insuch away	that	theRAT	getsexecuted	asaserviceby	the ‘svchost.exe’ 28 each computeris	started.	Once‘winsvcfs.dll’is	installed, ‘nateon.exe’29and is deleted. Both ‘nateon.exe’ ‘winsvcfs.dll’30arenow	detected	by	someantivirus software. the malware reveals a Static analysis of configuration block. This configuration block containsthenameof	theDLLfilewhich	‘nateon.exe’ is	tocreate.Inthisinstance,	theconfigurednamed was‘winsvcfs.dll’,	asshowninFigure2.	Dueto	the namebeing	configurable,	theRAT	willnot	alwaysbe called	‘winsvcfs.dll’.	The configuration block also contains a callback domain and port for the malware’scommand	and	controlcommunications. ‘nateon.duamlive.com’and	theportis	configuredto be80	(50inhexadecimal),	also	showninFigure2. If	no	configuration is specified, the malware uses default	values instead.	The default	callback locationhardcodedinto	themalwareis	theprivate 28Theprocess‘svchost.exe’	is	agenerichostprocessforservices which	runfromDLLs.(Microsoft,AdescriptionofSvchost.exein WindowsXP	ProfessionalEdition2007) 29On29July	2011,23of43antivirusproducts	testeddetected ‘nateon.exe’	as	malware,as	of19August2011this	numberhad increasedto36ofthe43.(HispasecSistemas2011)(Hispasec Sistemas	2011) 30As	of6September2011,34of44	antivirusproductstested detected	‘winsvcfs.dll’	asmalware.(HispasecSistemas	2011)routableontheInternetand	suggeststheattackers According to information contained within Communicationshackwascompiled	from	source codeon27	September2010	at	01:17.04­over6 monthsbeforetheattack.	Theconfigurationblock waslikely	inserted	into	thebinary	afterthisdateas thecallbackdomainwasnot	registered	untilMay 2011.	This	mayindicatethat	theRAThasbeenused inotherattacksbut	withdifferent	configurations.	If identified ‘Backdoor.Sogu’31is a the previously version of the malware, other callback domains previously	configured	may	includethoseknownto beused	by‘Backdoor.Sogu’.Thesedomainsinclude ‘newhose.ntimobile.com', ‘bbs.afbjz.com', and ‘www.adv138mail.com'32. TheRAT	hasmany	different	capabilitiesand runs	onmultipleversionsoftheMicrosoft	Windows operating system.	The RAT's behaviour changes slightly	depending	onwhichversionof	theWindows operating system it is installed	on and which modulesareinstalled.	Modulesused	by	theRAT deployed to the SK Communications network ‘nateon.exe’ as 'Backdoor.Sogu'.Themalwaredescribed	bySymantecexhibits similarbehaviourto'nateon.exe'	butis	asmallersize.(Mullaney, 2011) 32In addition to being	used	by ‘Backdoor.Sogu’, the callback domain'www.adv138mail.com'was	used	byaPoisonIvyRATina July	2011	sociallyengineeredemail	campaignwhich	targeted experts	ontherelationshipoftheUnited	States	with	Japan,China and	Taiwan.(Parkour,2011) COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.domainisantivirusPAGE5OF	24� Ofnote,	themodule‘odbc32.dll’is	used	inthe accessof	databases.	The RAT	uses a numberof StandardQueryLanguage(SQL)33functionswhich are accessed (or more technically,	dynamically imported)	asthesoftwareruns.	Theseinclude: Thesefunctionswould	havebeenutilisedby	the details.The RAT can not only access and query databasesbut	canalso	enumeratethenetworksto which	theinfected	computeris	connected,	set	up networkconnections,modify	theregistry,lockthe workstation'sscreen,controlprocessesandservices 33SQLinstructions	areused	toquerycertaintypesofdatabases and	obtaininformationfromthem.running on the computer, download files, create files,	takescreenshotsandshutdown,	rebootorlog out	ofthecomputer.TheRAT	hasfourdifferent operating modes; SMI (Install),	SMU (Uninstall), SMRAC (Run as Console) and SMRACU (Run	as ConsoleUser).	(Hauri­ResponseTeam,	2011) Acompletelistofstringsobtainedthroughstatic analysis	of	themalwareisprovidedinAnnex	A. Thesestringsgiveadditionalinsight	into	theRAT and	itsbehaviour.	Ofnote,auniquestringispresent which	may	beused	to	associate‘nateon.exe’with othermalware.	This	stringis	‘CONFIGDESTORY!’ and is contained within the malware in an obfuscatedform.	Thestring	is	displayed	inapop­up The RAT employs some basic obfuscation techniques.	Allstringsareobfuscatedinmemory and	only	decoded	when they	need	to	be used, thereby	making	static analysis	more difficult.	In addition,	unnecessary	operations are inserted	at frequent	intervalsthroughout	thecode.	Theprolific use of	unnecessary	operations is	likely	to	make reverseengineeringmoredifficult	and	potentially indicatesthat	themalwareis	polymorphic34.	The RAT,	whileinsomewayssophisticated,	stillhidesin plainsight	–limiting	itsscopeforobfuscation. TheRATattemptscommunicationsto	acommand and	controlserverlocatedusing	acallbackdomain. It	also	createsarawsocket	and	binds	it	to	the infectedcomputer’slocalIPaddress(asassignedto thecomputer’snetworkinterfacecard).	This	is	not, however,	fortheRAT	to	acceptinbound	connection requests.Thesocketis	configuredbytheRAT	in such	away	that	it	actsasapacket	sniffer,	whereby, theRATreceivesacopy	ofallinboundand	outbound networktrafficonthebound	interface.Aswellas enabling	deepinspectionof	thisnetworktraffic,	the capability	could	allowtheRAT	to	passively	receive commands	onany	portusing	any	protocol. Before attempting communications command	and	controlserver,themalwarechecks fornetworkconnectivity.	Itdoesthisbyusing	the 34Polymorphicprograms	canbemodified	(ormodifythemselves) tohaveadifferentfilehash	and/orsizewhileretainingthesame COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE6OF	24Communicationslegitimate ‘download.windowsupdate.com’. domainis	hardcoded	intothemalwarebut	may	be ‘nateon.duamlive.com'35onTCP	port	80	(configured asnoted	previously).	Communicationsoccur	over theHyperText	TransferProtocol(HTTP)	protocol– a protocol commonly	used	on TCP port	80	for website browsing.	The malware appears to	be proxy­awareandcapableof	communicatingviaa webproxy. Thefollowing	malformed	user­agent36is	present intheHTTPrequests(spacesshownhereas‘·’): ‘Mozilla/4.0·(compatible;·MSIE·6.0;·Windows·NT·5. 1;SV1;’.This	user­agent	is	consistent	with	that	which may	beexpectedfromauserrunningversion6.0of theMicrosoft	Internet	Explorerwebbrowseronthe MicrosoftWindowsXP	operating	system,exceptthat it is missing a closing bracket after the last semicolon and	a space after the second	to	last semicolon.This	malformed	user­agent	is	hardcoded and	can beused	asasignatureto detect	HTTP communicationsproduced	by	themalware. Fourcustom	headersarealso	presentinthe HTTPrequests:	‘X­Session’, ‘X­Status’,	‘X­Size’,	and ‘/update?product=windows’.	Thesecustomheaders and	the file path	may	also	be used	to	develop Once the malware successfully	contacted	the command	and	controlserver,theattackerwould thembackto	alocationtheattackercould	access. Thenameof	themalwareand	thenameof	the selected	callbackdomainwerepresumably	chosen 35Multiplesources	confirmthemalwareused	inthehack	called back	to'nateon.duamlive.com'.(Samsung	IDC2011)(Birdman, 2011) 36User­agents are used in HTTP communications to tell webservers	which operating	system and	web browser their clients	areusing,sotheycanservecompatiblewebpages.by	theattackersto	disguisethem	asbeingassociated with	NateOn­anInstant	Messaging	Serviceowned by	SKCommunications.Legitimatefilesdeveloped by	SK	Communicationsarealso	knownby	thename ‘nateon.exe'37. Callback domains are translated	to IP addresses using	theDomainNameSystem	(DNS)38protocol. This	translatesthedomaininto	auniqueaddresson theInternetwhich	infected	computerscanuseto locate and communicate with	a command	and controlserver.Commandand	controlserversare typically	more resource intensive to	set	up	and maintainthancallbackdomainswhich	may	beused to direct communications is not to them. It uncommon for multiple domains to	identify	the samecommand	and	controlinfrastructure. In	lateJuly	2011,at	thetimeoftheattack,	the callbackdomain‘nateon.duamlive.com’pointedto the time of	writing points to	local loopback IP acallbackdomaintoalocalloopbackIP	address whenthey	do	not	haveany	instructionsforthe infected	computersusing	that	domain.	This	prevents thecomputers from	unnecessarily	contacting	the attacker’s command and control infrastructure. Attackers also	quite commonly	point a callback domainto	alocalloopbackIP	addresswhenthey command and control At	thetimeof	theattack,	thecallbackdomain ‘ro.diggfunny.com’pointedto	theSouth	KoreanIP addressused	by	theALToolsrelated	command	and 37Differentversions	ofalegitimatefile	named	'nateon.exe'	exist. Thesefiles	areassociated	with	theNATEONUpgraderdeveloped bySKCommunications.(MisterGroupn.d.) 38DNSis	fundamental	ontheInternet.Itisaformofdirectory assistancetohelpcomputers	communicatewith	othercomputers. Itsuseis	analogous	toapersoncalling	directoryassistancetofind outwhatphonenumbertodial	tospeak	toacertainperson. 39AlocalloopbackIP	addressisanaddress	whichisnotInternet orIntranetroutable,ie.itcannotbeusedbyacomputerto communicatewith	anothercomputer.Whenacomputerattempts to communicate with a communicates	with	itself. COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.THE MALICIOUS INFRASTRUCTUREPAGE7OF	24addressrangeis	allocatedto	theSouth	KoreanISP Hanaro	Telecom. Aportionof	theIP	addressrangeappearsto havebeenassignedby	Hanaro	Telecom	toaSouth Korean web hosting	company.	It	is	not	known whetherthetwo	IP	addressesused	bytheattackers fall within the range used by the webhosting company.	It	is	also	unconfirmed	whether that companyisbased	inNonhyeong	­thegeographic regionofthecompanythat	hosted	thewaypoint used	intheattack. If	theIP	addressesused	by	theattackersinthe hosting company, is possible the attackers company	tohost	theircommand	andcontrolservers insteadofcompromising	legitimateservers.OtherIP addresses in the range are also	associated	with malware41but	that	malwaremay	notberelated	in any	way	to	theSKCommunicationshackorthe attackersinvolved	inthehack. In	lateJuly	2011,	at	around	thetimeof	the callback domain ‘update.alyac.org’ the domain now	points to	the legitimate Google IP GoogleIPaddressiscompromised,andtheGoogleIP addressisunlikely	to	becompromised. TheGoogleIP	addressis	likely	only	usedto indicatethat	theattackerhasno	instructionsforthe malwareorto	instructthemalwareto	continuewith pre­programmedbehaviour.Themalwarelikely	has logic	built	inwhich	preventsit	from	communicating with	theGoogleIPaddress.	Useof	theGoogleIP addresswould	likely	achievetheattacker’sdesired outcomeinasimilarway	touseof	alocalloopback IP	address.	It	would,	however,belesslikely	to	flag theactivityto	networkdefenders42. It	is	also	possibletheGoogleIPaddressisused 41The command	and	control	servers	of dozens	of pieces	of malwarehaveusedIPaddresseswithintheIPaddress	range 42 Use of in combination with IP addresses preprogramed	logictopreventacommunicationwith	command and	control	infrastructureis	amuch	lesscommonindicatorof malicious	activitythanuseofalocal	loopback	IP	addressforthe samepurpose.legitimateCOPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE8OF	24Registration Information2010.and	controlserverovertheDNS	protocol43,	ineffect, using	Google as a voluntary	waypoint	without actually	compromisingGoogle’sinfrastructure. Each	of	thethreecallbackdomainshasaTime­ To­Live (TTL)44of 30 minutes, allowing the attackers to rapidly	change the command and controlserverpointed	to	by	thecallbackdomain. Thedomain‘duamlive.com’wasregisteredon21 May	2011.Itwasregisteredby	a‘Guangming	Wang’. Thereis	alargenumberof	domainregistrations (approximately	400) associated	with ‘Guangming Wang’,	possiblyindicatingthat	thedomainswere registeredbyanintermediary. The domain‘alyac.org’wasregistered	on24 information is	almost	identical to	that	of	the legitimateESTsoft	domain‘alyac.com’.	Thedomainis not,	however,	associated	with	theALYacantivirus softwareanddoesnotappeartobeassociatedwith ESTsoftat	all.	Thetitleofthewebsitepreviously hostedat	‘alyac.org’wasassociated	withfinance, insurance and cell phones and not antivirus software45. At	thetimeofwriting,themaliciousdomain previously	pointed	to	South Korean IP	address following	asimilarpatternto	‘alyac.org’(whereby they	disguisethemselvesasbeing	associated	with legitimatesoftwarecompanies)havealso	pointed	to thesameSouth	KoreanIPaddress.	Theseincludethe Thedomain‘trendmicros.net’waspurportedly registered by Trend	Micro	Inc.	The registration detailsarealmostidenticalto	thatofthelegitimate domain ‘trendmicro.com’.	The domain,	however, appearsto	havenothing	to	do	with	thesecurity company.	Themaliciousdomain‘nprotects.org’is similarto	that	of	thelegitimatesecurity	company iodine.(Kryo,2010) 44TheTTL	ofadomaininaDNSrecord	referstothedurationfor which	theDNSresult	canbecached. 45Awebpagepreviouslyhosted	at'alyac.org'	hadatitleof'Cash Advance|	DebtConsolidation|	Insurance|	FreeCreditReport| CellPhones	atalyac.org’.(DomainTools,LLC,2011)‘trendmicros.net’,Thedomain‘diggfunny.com’wasregistered	on 14	April2011bya‘LeeCooper’.	Thesameregistrant detailswereused	to	registerseveralotherdomains. Thesedomainsinclude‘edsplan.com’,‘ezxsoft.com‘, ‘finalcover.com’,	‘mindplat.com’,	‘projectxz.com’,	and ‘soucesp.com’­allofwhichwereregisteredon14 April 2011. The domains ‘daumfan.com’ and ‘natefan.com’werealso	registeredby‘LeeCooper’, but	on25	July	2011,theday	beforethehacking operation against the Nate and CyWorld user registrant details were purportedly	usedto registeranadditionalseven domains.	Each	of	thesedomainshasaTTLof	30 minutes.	(DomainTools,	LLC,	2011) At	the time of writing none of	the above domains registered	by ‘Lee Cooper’ point to	a malicious IP address.	The domain ‘natefan.com’ points ‘daumfan.com’pointsto	theEnom	Inc47IP	address ‘finalcover.com’ points	to the privateIP ‘projectxz.com’ or currently	point	to	anIP	address.	This	suggeststhe domainsarenot	currently	inuse,	however,	at	least one subdomainappears to	be in current	useas showninTable2.nProtect(‘nprotect.com’)but	again,doesnotappear to	beassociated	with	thecompany.	Thedomainhas previously	beenassociated	withmalwareknownas ‘Trojan.Win32.Generic’46. Similarly is not dissimilar to that of at	‘bomul.com’.(ETnews,	2011) NATEON. FR. UPDATE. ­ ­ ­ DOWNLOAD. FORUM. *Indicates	IP	addressassignedattimeofwriting. TABLE1­SUMMARYOFREFERENCEDDOMAINSNPROTECTS.ORG TRENDMICROS.NET BOMULS.COM46Malwaredetected	as	‘Trojan.Win32.Generic’	inMay2011used thecallback	domain‘pc.nprotects.org’.(GFISandBox,2011)47EnomIncis	alegitimatedomainnameregistrarused	bythe attackers	toregisterdomainnames	and	alsotohostwebpages.COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE9OF	24IPADDRESS(ES) WWW. RO. WWW. I. T. CACHE. ITT. *Indicates	IP	addressassignedattimeofwriting. the domains registered by ‘Lee Cooper’ previously pointed to webpages. The domain ‘mindplat.com’ previously	pointed	to	an EnomInc.serverwhich	hosted	its	webpage.Thetitle and	metadescriptionof	the‘mindplat.com’website is	almost	identicaltothat	of	the‘alyac.org’website. Both	websitesfollowthetemplateshowninFigure 3.	Thesametemplatehasalso	beenused	forseveral other webpages and may merely	be a template provided by a service provider used by the registrants. Thedomains‘natefan.com’and‘projectxz.com’ also	previously	pointedtowebpages.	Thewebpages weresimilarto	the‘mindplat.com’and	‘alyac.org’ webpages but with different	text.	Again,	these webpagesusethesametemplateasotherwebpages and	may	merely	beprovided	by	aserviceprovider. Thepresenceof	thesewebpagesmay	indicatean attempt	by	the attackers to	make the malicious domainsappearmorelegitimate.SIMILARITIES TO OTHER MALWAREFIGURE3­EXAMPLEOFWEBPAGETEMPLATEUSED is associated with malicious ‘ro.diggfunny.com’ activity. The domains ‘cache.mindplat.com’ and ‘bbs.ezxsoft.com’arealso	knownto	beassociated with	malware.	The first	is listed	as a malicious domain48and	thesecond	wasused	asacallback ‘Trojan.Win32.AgentBypass’ ‘bbs.ezxsoft.com’ also	previously	pointed to the 49 sameSouth	KoreanIP	addressas‘update.alyac.org’ the hack into Evenif	ignoring	theconnectiontheyboth	have to	thedomain‘alyac.org’,	thetwo	piecesof	malware ‘Trojan.Win32.Generic’ ‘Trojan.Win32.AgentBypass’ referenced)arestilllinked.	Both	piecesofmalware createauniquely	nameddirectory50,	asdo	at	least three other pieces of	malware (summarised	in Annex B). This ‘nprotects.org’and	‘ezxsoft.com’,	and	suggeststhis malware,along	withthecallbackdomains,	maybe part	of	a broader,	concerted	effort	by	the same 'cache.mindplat.com' 'ro.diggfunny.com' in a list of malicious web addresses. (CEOinIRVINE2011). 49Malwaredetected	as	'Trojan.Win32.AgentBypass'	inmid	July 2011used	thecallback	domain'bbs.ezxsoft.com'.(GFISandBox 2011) 50Malware analysis reports indicate both	pieces	of malware createadirectorynamed	‘03a075fb70d5d675f9dc26fc’	insidethe system directory and	a subdirectory named SandBox2011)(GFISandBox,2011) PAGE10OF	24isTitleCash Advance | Debt Consolidation | Insurance | Free CreditReport | Cell Phones @ domainMeta DescriptionFind Cash Advance, Debt Consolidation and more at domain. Get the best of Insurance or Free Credit Report, browse our section on Cell Phones or learn about Life Insurance. Domain is the sitefor Cash Advance.COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.TIMELINE24 September 2010The domain 'alyac.org' is registered.27 September 2010The Destory RAT is compiled.14 April 2011The domain 'diggfunny.com' is registeredalong with other domains.21 May 2011The domain 'duamlive.com' is registered.18 July 2011On or prior to this date attackerscompromise the ESTSoft ALZip updateserver.18­25 July 2011Numerous SK Communications computersbecome infected during routine ALZipsoftware updates. Attackers use their new access to download tools and prepare fortargeting of the user database.25 July 2011The domains ‘daumfan.com’, and'natefan.com' are registered.26 ­ 28 July 2011The attackers use ‘nateon.exe’ malware and the callback domains ‘nateon.duamlive.com’and ‘ro.diggfunny.com’ to access SKCommunications’ Nate and CyWorld user databases, stealing the personal details ofup to 35 million users.COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE11OF	24INSIGHTSAttackerswillconduct	reconnaissanceon theirtargetsand	considerallsortsof targetingoptions(bothdirect	and	indirect). Attackersmay	target	acompany	inorderto useitasa‘launchpad’to	gainaccessto othertargets,asdemonstrated	by	the targetingof	ESTsoft'sALZip	updateserver. Attackerscanconduct	selectivetargeting­ choosing	which	computersdownload maliciouscontentand	whichdo	not,asthey appearto	havedonewith	theALZip	update server. Eventhoughtwocomputersmay	submit	an identicalrequest	forafile(orwebpage), they	may	not	get	thesamefile(orwebpage) backinresponse.	This	behaviourreduces thelikelihood	of	malwareunintentionally goingviral.	Unfortunately	it	also	hampers investigationsbynetworkdefenderswho may	assessafile(orwebpage)tobesafe, whenitis	not	safeto	allusers. Attackersmay	hackacomputerforthesole purposeof	using	itasa‘waypoint’orasan intermediary	locationfrom	wheretheycan storeandaccesstheirtoolswithout suspicionfromtheirtargets.	This	appearsto Nonhyeong	basedwaypoint,althoughit	is possibletheywereinitially	hacked	for names.	Such	appearsto	havebeenthecase with	thedomainsregisteredby	‘Lee wordsthat	areexpected	to	makethem appearlesssuspiciousto	targets.	Such	as with	theuseof	‘nateon'and‘alyac’inthe callbackdomainsused	by	infectedSK Communicationscomputers. Attackersmay	useseemingly	legitimate registrationinformationto	registerdomain names.	Such	appearsto	havebeenthecase with	theregistrationof	‘alyac.org’and ‘trendmicros.net’. Usersshould	bewary	ofdomainswhich appearto	belegitimatebut	arenot.	Such	as ‘alyac.org’insteadof	‘alyac.com’,������������‘trendmicros.net’instead	of ‘trendmicro.com’,‘nprotects.org’instead	of ‘nprotect.com’and‘bomuls.com’instead	of ‘bomul.com’. Eventhoughit	is	relatively	easy	to	create new	infrastructure,	attackerssometimes reuseinfrastructure.	Forexample,	the domains‘bbs.ezxsoft.com’and ‘update.alyac.org’bothpreviously	pointed ‘alyac.org’,	‘trendmicros.net’,‘nprotect.org’ and	‘bomuls.com’allpointedto	IPaddress TheTTLof	domains(inDNSrecords) controlled	byattackersareoftenset	tolow values(such	as30	minutes)allowing	the attackersto	rapidly	changethecommand and	controlserverpointed	to	byacallback domain.This	facilitatesrelatively uninterruptedaccessto	atarget	when command	and	controlinfrastructure purposes,	familiarwords	indomainnames and	ofnon­maliciousIP	addressesinDNS records	formaliciousdomains,	canmake detectionofmaliciousactivity	moredifficult and	causenetworkdefendersto	dismiss maliciousactivity	(innetwork/system	logs orIntrusionDetectionSystem	alerts,in particular)aslegitimate.�AddingmaliciousIP	addressesanddomains to	blacklistscanhelp	prevent	malicious activity,	however,attackerscanrespond	by merely	using	alternateinfrastructure and/orcallbackdomains. Domainsand	IPaddressesmay	have legitimatepurposestoo	and	blacklisting themmay	also	blocklegitimatebusiness. Blacklistsshould	bereviewed	periodically to	ensurethey	arenot	blocking	legitimate businessunnecessarily. � Whitelistsaregenerally	much	more effectivethanblacklists,	however,even whitelistscanallowmaliciousactivity	to occur	to	legitimatesitesthathavebeen compromised.	Forexample,asagood security	practice,	mostsystem administratorswould	haveallowed	access to	theALZip	updateserveriftheyhad	ALZip softwareinstalled	ontheirnetwork. Similarly,	ifawhitelistwereemployed	on thetargetednetworkbutusershada legitimateneedto	accessthewebsiteof	the Taiwanesepublishing	company,	the attackerwould	likely	stillhavebeenableto continually	reassesswhoand	what	they trust	ontheInternet	giventhat	trust relationshipscanbe,	andincreasingly	are, exploitedformaliciouspurposes.��DISCLAIMERMachinetranslationsoftwarehasbeenheavily	relied	onthroughout	the development of this paper.	While data has been verified	against multiplesources,	wherepossible,	CommandFivePty	Ltd	doesnot guaranteetheveracity	of	sourcesortheaccuracy	of	translationand interpretation.	Command	FivePty	Ltd	remindsreadersto	exercise cautionwhenvisiting	untrusted	websitesand/oropeninguntrusted digitaldocuments.	Command	FivePty	Ltd	doesnot	warrant	that	the websitesreferenced	inthispaperaretrustworthy.COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE12OF	24REFERENCESBirdman.(2011,July	31). Xecure Lab	Blog.	RetrievedAugust	12,	2011,	fromurl­ lab.com/2011/07/2500.html CEOinIRVINE.	(2011,	August17).	Information Security & US	&	Life	& Love	& Fashion & Hacking & Passion.	Retrieved September13,	2011,	from	url CommandFivePty	Ltd.	(2011,	June). Advanced Persistent Threats: A	Decade	in Review.Retrieved	September24, 2011,	fromCommand	FivePty	Ltd: url DomainTools,	LLC.	(2011). AlYAc.org ­ Al	Y Ac ­ Screenshot History.	Retrieved	September08,2011,	from DomainTools:	url­history/alyac.org DomainTools,	LLC.	(2011). Reverse	Whois Lookup | Domain Ownership Search	| Domain Tools.	Retrieved September22,	2011,	from	DomainTools:	url­ whois/?all[]=leecooper%40korea.com&none[]= EDaily.	(2011,	August	11).	Nate	hack	related.RetrievedSeptember14,	2011,	fromEDaily	KoreanNews: url 5&OutLnkChk=Y ESTsoft.(2011,	August	04). ESTsoft apology for	ALTools	security vulnerability.Retrieved	September14,2011,from ESTsoftBlog:	url ESTsoft.(2011,	August	05). ESTsoft news release	with	respect to	ALTools	security	vulnerability.Retrieved September19,	2011,	from	ESTsoftBlog:	url ESTsoft.(2011,	August	11). Police release	interim results on Nate	hack.RetrievedSeptember14,2011,from ESTsoftBlog:	url ESTsoft.(2011,	August	04). Urgent security patches for public	ALTools products.Retrieved	September20,	2011, fromALToolsAnnouncements:	url ETnews.	(2011,	August05).	ETnews ­ Nate	hack, planned since last year?Retrieved	August	12,	2011,	from url GFI	SandBox.(2011,May	30).	GFI SandBox Malware Analysis Report: Backdoor.Win32.Generic.Retrieved September22,	2011,	from	GFI	SandBox: GFI	SandBox.(2011,July	15).	GFI SandBox Malware Analysis Report: Trojan.Win32.AgentBypass.	Retrieved	August GFI	SandBox.(2011,May	29).	GFI SandBox Malware Analysis Report: Trojan.Win32.Generic!SB Trojan.Trojan.Win32.Generic.	RetrievedSeptember2011,2011,	from GFI	Software.(2011,February	08).	CWSandbox Report By	MD5	at Sunbelt Security.	RetrievedSeptember22,	2011, fromurl 48d8de2dda9 Goodin,D.	(2011,	August12).	Software maker fingered in Korean hackocalypse.Retrieved	September06,2011, fromTheRegister:	url©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE13OF	24Hauri­ResponseTeam.(2011,	August	04).	SK Communications detailed analysis report of nateon.exe malware. Retrieved	August12,	2011,	from	url HispasecSistemas.	(2011,	September06).	VirusTotal.	RetrievedSeptember22,	2011,	from url­ d67­1315308204 HispasecSistemas.	(2011,	August	03).	VirusTotal	­ Free online	Virus, Malware and URL Scanner.RetrievedAugust 12,	2011,from	url­ 1313643321 HispasecSistemas.	(2011,	August	19).	VirusTotal	­ Free Online	Virus, Malware and URL Scanner.Retrieved September22,	2011,	from	url­ 1313760695 HispasecSistemas.	(2011,	July	29).	VirusTotal	­ Free	Online	Virus, Malware and URL Scanner.RetrievedSeptember 22,	2011,from	url­ 1311902003 HispasecSistemas.	(2011,	August	07).	VirusTotal	­ Free Online	Virus, Malware and URL Scanner.Retrieved	August 18,	2011,from	url­ 1311920836 JapaneseIT	PromotionAgency.	(2011,	June29). IPA/ISEC: Vulnerabilities: Security	Alert for	Vulnerability	in ALZip. Retrieved	September18,	2011,	from	JapaneseIT	PromotionAgency: url Jin­woo	Seo,	J.­h.	H.	(2011,	July	28).	35mn User Info Leaked in Cyber Attack	against S. Korean Portals.Retrieved September19,	2011,	from	MK	BusinessNews: url lag=sc&relatedcode=&wonNo=&sID=308 JSUNPACK.(2011,July	27). jsunpack ­ a generic	JavaScript unpacker.	Retrieved	August	14,	2011,	from JSUNPACK.(2011,July	27). jsunpack ­ a generic	JavaScript unpacker.	Retrieved	August	08,	2011,	from JSUNPACK.(2011,July	27). jsunpack ­ a generic	JavaScript unpacker.	Retrieved	August	04,	2011,	from Kryo.(2010,	February	6).	kryo.se: iodine	(IP­over­DNS, IPv4	over DNS	tunnel).	Retrieved	September18,2011,from kryo.se:	url Malc0de.com.	(n.d.).	116.127.121	|	Malc0de	Database.RetrievedAugust	22,2011,from	Malc0deDatabase: url Microsoft.	(2007,	December10).	A	description of Svchost.exe	in Windows XP Professional	Edition.Retrieved September07,	2011,	from	Microsoft	Support:url©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE14OF	24Microsoft.	(2007,	December04).	What is a DLL?Retrieved	September18,	2011,	fromMicrosoft	Support: url Microsoft.	(n.d.).	Security	Center ­ Bulletins Advisories Tools	Guidance	Resources.Retrieved	September09,	2011, fromMicrosoft	Security	TechCenter:url­us/security/default MisterGroup.	(n.d.).	nateon.exe	­ What is the	nateon.exe?Retrieved	September06,	2011,	from url Moon­young,	L.	(2011,	August	12).	Personal	information hack	traced to	Chinese IP	address.RetrievedSeptember 09,	2011,from	TheHankyoreh	MediaCompany: url Mullaney,	C.	(2011,July	30).	Backdoor.Sogu Technical	Details	| Symantec.	Retrieved	August	18,	2011,	from url­073003­5345­99 NationalInstituteof	Standards	and	Technology.	(n.d.).	National	Vulnerability	Database.	Retrieved	September20, 2011,	fromurl Novell.	(2011).	Novell Customer: Cite	Media Holding Group.	Retrieved	July	29,	2011,	from url Parkour,	M.(2011,July	14). contagio: Jul	13 CVE­2010­2883 PDF Meeting Agenda with more Poison Ivy url­13­cve­2010­2883­pdf­meeting­agenda.html Samsung	IDC.(2011,August	05).	Samsung IDC	Helpdesk Notice.	Retrieved	August12,2011,	from url SKCommunications.(n.d.).	SK	Communications ­ About Us.	Retrieved	September06,2011,	from url Sung­jin,	Y.	(2011,July	28).	35m	Cyworld, Nate	users' information hacked.Retrieved	September06,	2011,	from KoreaHerald:	url TheInternet	Archive.	(2010,August	14).	Error	page.Retrieved	September18,	2011,	from	TheInternet	Archive WaybackMachine: url ThreatExpert.(2011,July	13).	ThreatExpert Report: Trojan.Win32.Scar.dysk, Bat/sdel.	Retrieved	September22, ThreatExpert.(2011,August03).	ThreatExpert Report: Trojan.Win32.Scar.dzoc.Retrieved	September22,2011, ThreatExpert.(2011,July	29).	ThreatExpert Report: Virus.Win32.Virut.	RetrievedSeptember22,2011,from TMCnews.	(2011,	August11).	S. Korea plans to	scrap online	real­name	system.Retrieved	September19,2011,from TMCnews:	url©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE15OF	24ANNEX ALIST	OF	DEOBFUSCATED STRINGS FOUND WITHIN ‘NATEON.EXE’Stringsinside‘nateon.exe’arestoredinanobfuscated	formandonlydeobfuscatedas,	and	while,they	areneeded. This	tablecontainsacompletelistofdeobfuscatedstringsextractedduring	staticbinary	analysis	ofthemalicious file.	Foreach	string,	twoaddressesareprovided	–the‘CodeAddress’and	the‘Obfuscated	Address’.The‘Code Address’is	theaddress,	incode,	from	which	thestring	deobfuscationis	requested.	This	addresscanbeused	to efficiently	identifywrapperfunctionsthatdynamicallyimportsystemAPIs(suchasthoseusedfornetwork communications),	aswellasto	locateinteresting	partsofthemalware.	The‘Obfuscated	Address’is	theaddress,	in data,	wheretheobfuscated	string	is	stored. Forreadability,	thestringspresented	inthe‘Deobfuscated	String’columnhavebeenconvertedfromtheir originalformats.	Someof	thestringsarestored	inside‘nateon.exe’as8­bitcharacterstringsand	someas16­bit widecharacterstrings.	Non­printablecharactershavebeenescaped	ashexadecimalvaluesintheform	‘<\xHH>’ or‘<\uHHHH>’.	Trailing	null(‘<\x00>’)charactersarenot	shown.	Standard	escapesequencessuch	as‘\n’ (newline)and	‘\r’(carriagereturn)arealso	used	to	improvereadability. "SetServiceStatus""user32.dll" "iphlpapi.dll"OBFUSCATED 10022230"SMI"51 COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED."RegisterServiceCtrlHandlerExW" 51SMI, SMU, SMRAC, SMRACU are the operating	modes	of ‘nateon.exe’.(Hauri­ResponseTeam,2011) 52The strings with suffix ‘.dll’ 100054DE"ntdll.dll52" "kernel32.dll"10003CCD "\Device\Floppy<\x00><\uA4BC "\Device\Floppy<\x00><\uA4BC COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.CODE "\??\<\x00><\uFC04><\uF06C>" "\SystemRoot\<\x00><\u7C84>< "SYSTEM\CurrentControlSet\Serv ices\<\x00><\u90A0>ÜÐ" "\Parameters<\x00><\u3858>" COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.1000FC7B "\\.\pipe\a%d<\x00><\u3CC4>< \u3C18><\u9C08><\u3C8A>" "\\.\pipe\b%d<\x00><\u7080>< \u0C17><\u4C49><\uEC10>" "CMD.EXE""SQLAllocHandle"53 "SQLGetData"100231AC"NULL" 53Theimportedfunctionswithan‘SQL’prefixwerepresumably used	toaccess	theSKCommunications	databases."SQLGetDiagRecW"100106271002314CCODE unusual"SOFTWARE\CLASSES\SAFEGUI <\x00><\u40F0><\u380B>"54"SOFTWARE\CLASSES\SAFEGUI <\x00><\u40F0><\u380B>"DEOBFUSCATEDSTRING COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.DEOBFUSCATEDSTRING "%2.2X%2.2X%2.2X%2.2X%2.2X 100136DC %2.2X%2.2X%2.2X" "\Documents	and	Settings\All 100137C6 Users<\x00><\uC030><\u0848> " "\Documents	and	Settings\All 10013807 Users<\x00><\u78D8><\u6090> " "\Documents	and	Settings\All 1001384C Users<\x00><\u3818><\u20D0> " "\ProgramData<\x00><\uE8A8>" 1001389A "\ProgramData<\x00><\uFFFD>" "\??\<\x00><\u742C><\uCC38>" 1001404B "\SystemRoot\<\x00><\u0808>< "\VarFileInfo\Translation<\x00> "\StringFileInfo\%4.4X%4.4X\%s 10014605 <\x00><\uF8D8><\uE090><\u2 ‘SOFTWARE\CLASSES\SAFEGUI’	canbeusedtolink	‘nateon.exe’ 54 withthemalwarethathas	theMD5	hash6C6ADBD087276AE8 9F82 6258 2798 B708 and calls back to the domain ‘expre.dyndns.tv’onTCPport443.	Itmayalsobeused	as	a signaturetoidentifyothersimilarmalware.(GFISandBox,2011)10013465100134EAPAGE19OF	24100153FC10023B0C"UserEnv.dll"OBFUSCATED "SYSTEM\CurrentControlSet\Serv 10016108 ices<\x00><\u54AC><\u8C34>" "\Parameters<\x00><\uA8A8>" 55The‘nateon.exe’dropperconfigures	‘winsvcfs.dll’toruninside thetrusted	operating	systemprocess‘svchost.exe’."%SystemRoot%\system32\sv chost.exe ­k LocalService<\x00><\uBC64>< "SOFTWARE\Microsoft\Windows NT\CurrentVersion\SvcHost<\x0 0><\uA8E8><\uC40C><\uFFFD> "SOFTWARE\Microsoft\Windows NT\CurrentVersion\SvcHost<\x0 0><\uA8E8><\uC40C><\uFFFD> <\u9050>" "SOFTWARE\Microsoft\Windows NT\CurrentVersion\SvcHost<\x0 0><\uA8E8><\uC40C><\uFFFD> "SOFTWARE\Microsoft\Windows NT\CurrentVersion\SvcHost<\x0 0><\uA8E8><\uC40C><\uFFFD> "SMI""\SYSPREP<\x00><\uF8D8>" "\SYSPREP.EXE<\x00><\u18B8 >"COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE20OF	2410018836"CRYPTBASE.DLL"10018C881002409C1001903E1002412C1001889010024068"kernel32.dll""CRYPTBASE.DLL"10024068"kernel32.dll"10018DBB100240E0"CRYPTBASE.DLL"OBFUSCATED R(%d)<\x00><\u0CB4><\u40E5 "\\.\PIPE\RUN_AS_CONSOLE(%d )<\x00><\u7000><\u78D8><\u6 "HARDWARE\DESCRIPTION\SYS TEM\CENTRALPROCESSOR\0<\x 56Thehardcoded	domainname‘download.windowsupdate.com’ is	used	todetectinternetconnectivity.Thisdomainnamecanbe overriddeninthemalware’s	configuration."download.windowsupdate.co 00><\u70C0><\u28FB><\u38E4 "\\.\PIPE\RUN_AS_CONSOLE(%d )<\x00><\u7000><\u78D8><\u6 "EAddr=0x%p," "ECode=0x%x," 10024534"XXXXXXXX"57 themalware’s	configuration. COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE21OF	241001D67C "Software\SafeSvc<\x00><\u40F """Proxy­Authorization: Basic " "Proxy­Authorization: Basic "10024694 58Thestring	‘CONFIG­DESTORY!’	is	displayed	inamessagebox when‘nateon.exe’	detects	corruptioninits	configuration.Itcanbe used	as	asignaturetoidentifysimilarmalware. 59Theunusual	hardcodedregistrykey‘Software\SafeSvc’	canbe used	as	asignaturetoidentifysimilarmalware. 60This	is	theuser­agentincluded	inHTTP	requests	madebythe malwaretoits	configured	command	and	controlinfrastructure. This	malformed	user­agentstring	canbeused	as	asignatureto detectmaliciousnetwork	traffic. 61ThisisthepathincludedinHTTP	requestsmadeby‘nateon.exe’ toits	configured	command	and	control	infrastructure.This	string canbeusedas	asignaturetodetectmalicious	network	activity."Mozilla/4.0 (compatible; MSIE 6.0; Windows NT	5.1;SV1;"60 "/update?product=windows"61 1001EFB6100247741001EE91COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE22OF	241001F308CODE 100248C4100248D010020A46100248EC10020A7A10024904"Proxy­Authorization: Basic %s<\r><\n><\x00>öL" "X­Session"62DEOBFUSCATEDSTRING "Software\SafeSvc<\x00><\uB4E """X­Status""X­Size""X­Sn""X­Session" "X­Sn""%s" "WSACleanup""CONNECT %s:%d HTTP/1.1<\r><\n><\x00>d$" "Content­length: 0<\r><\n><\x00>tl" "Content­Type: text/html<\r><\n><\x00>|d" "Proxy­Connection: Keep­ Alive<\r><\n><\x00><\u2584 10024978"Proxy­Authorization: Basic %s<\r><\n><\x00><\u255D>" "HTTP/1.0 200 " "HTTP/1.1 200 "10024940 62TheHTTPheaders‘X­Session’,‘X­Status’,‘X­Size’,and	‘X­Sn’	can beused	todevelopstrongersignaturesfordetectionofnetwork activitygenerated	bythemalware.ANNEX BSUMMARY OF	MALWARE KNOWN TO CREATE THE	UNIQUELY NAMED DIRECTORY: ‘03A075FB70D5D675F9DC26FC’MD5HASH E8EE	9373EE6C	8360 7FD335092DF2D3BCFILE	SIZE	(BYTES) unknownDATE(S)ANALYSED (GFISandBox,2011)FILESCREATED uxtheme.dllNETWORK	CONNECTIVITY TCP	port1058opened	forinbound connections TCP	ports1052and	1053	opened	for inbound	connections pc.nprotects.orgonTCPport80 pc.nprotects.orgonTCPport80 bbs.ezxsoft.comonTCP	port80COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED.PAGE23OF	24COPYRIGHT	NOTICECopyright©CommandFivePty	Ltd.	Allrightsreserved.This	document	is	providedby	thecopyrightholdersunderthelicence that	follows.	Byobtaining,using,	and/ordistributingthisdocumentyou agreethat	youhaveread,understood,	and	agreetothetermsand used	inadvertisingorpublicity	relatingtothisdocumentorits	contents withoutspecific,	prior,	writtenpermission. No	permissionisgivenforthisdocumenttobeused	forcommercial purposes or as part	of	any	commercial activity	or undertaking, including,	but	not	limited to,	use in or relating	to advertising	or publicity,	and/oruseinsupportof,oraspartof,any	pre­salesorsales activities. No	permissionisgiventocreatemodifiedorderivativeworks.	You may	distributethis	document	initsoriginalformfornon­commercial purposesinaccordancewith	theothertermsand	conditionsstated herein.	Copyrighttitle willatalltimesremain withthecopyright holders.Allreferencedtrademarksremaintheproperty	of	theirrespective owners.THIS DOCUMENT	IS PROVIDED	‘AS	IS’ FOR INFORMATIONAL INCLUDING BUT	NOT	LIMITED TO	ANY WARRANTY, EXPRESSORIMPLIED,OFMERCHANTABILITYORFITNESSFORA PARTICULAR PURPOSE; WARRANTY OF	NON­INFRINGEMENT,	OR TITLE;	NORANYWARRANTIES	PERTAININGTO	THEACCURACYOR COMPLETENESSOF	CONTENT. ANYOPINIONS	EXPRESSED	INTHISDOCUMENTMAYCHANGE WITHOUTNOTICEAND	ARENOTNECESSARILYTHECONSIDERED OPINIONS	OF	COMMAND	FIVE	PTYLTD,ITSPARTNERS,	EMPLOYEES, OR AFFILIATE	ORGANISATIONS.	ANY ADVICE OFFERED	IN THIS DOCUMENT	ISOFFERED	WITHOUTWARRANTYOFANYKIND.CommandFivePty	Ltd ABN:	49	149	576	670 url info@commandfive.com PAGE24OF	24COPYRIGHT©	COMMANDFIVEPTY	LTD.ALLRIGHTSRESERVED. 