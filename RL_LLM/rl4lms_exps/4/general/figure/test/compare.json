[
    {
        "article": "5/15/2020APT Group Planted Backdoors Targeting High Pro\ufb01le Networks in Central Asia - Avast Threat LabsAPT Group Planted Backdoors Targeting High Pro\ufb01le Networks in Central Asiadecoded.avast.io/luigicamastra/apt-group-planted-backdoors-targeting-high-pro\ufb01le-networks-in-central-asiaMay 14, 2020Last fall, APT malware intrusions targeting high-pro\ufb01le companies in Central Asia caught our attention. A few months later, we began working together with fellow malware analysts from ESET to analyze samples used by the group to spy on a telecommunications company, a gas company, and a governmental institution in Central Asia. An APT group, which we believe could possibly be from China, planted backdoors to gain long-term access to corporate networks. Based on our analysis, we suspect the group was also behind attacks active in Mongolia, Russia, and Belarus.The group behind the attack frequently recompiled their custom tools to avoid AV detection, which, in addition to the backdoors, included Mimikatz and Gh0st RAT. This has led to a large number of samples, with binaries often protected by VMProtect, making analysis more dif\ufb01cult.The backdoors gave the actors the ability to manipulate and delete \ufb01les, take screenshots, manipulate processes, and services, as well as execute console commands, remove itself, and more. Further, some commands may have instructed the backdoors to ex\ufb01ltrate data to a C&C server. Infected devices could also be commanded by a C&C server to act as a proxy or listen on a speci\ufb01c port on every network interface. The group also used tools such as Gh0st RAT and Management Instrumentation to move laterally within in\ufb01ltrated networks.url\ufb01le-networks-in-central-asia/1/95/15/2020APT Group Planted Backdoors Targeting High Pro\ufb01le Networks in Central Asia - Avast Threat LabsTimelineFigure 1: Timeline of events related to the tracking of Microcin, and Avast notifying the targeted companyAvast\u2019s and Eset\u2019s antivirus engines blocked the samples used by the APT group prior to it attracting our attention, as our antivirus engines\u2019 detections are automated. Attribution & Clusterization The samples we analyzed contain links to malware samples and campaigns, such as Microcin, BYEBY, and Vicious Panda, previously described by Kaspersky, Palo Alto Networks, and Check Point, respectively. The backdoors we found are custom tools that have not previously been analyzed, as far as we know. The majority of the C&C servers are registered to Choopa, LLC, a hosting platform that has been used by cybercriminals in the past. A GoDaddy registrar was also seen early in the campaign, these servers were removed early on.We suspect the APT group behind these attacks is from China. Gh0st RAT, one of the tools used, has been known to be used by Chinese APT groups in the past. Similarities in the code used in the Vicious Panda campaign, (TTPS, especially the use of the RTF Weaponizer in the infection vector), which is also thought to have come from China, and the code we analyzed, also lead us to believe the group might be from China. The targeted companies and institutions, as well as the professional coding point to an APT group. ToolsetBackdoorsurl\ufb01le-networks-in-central-asia/2/95/15/2020APT Group Planted Backdoors Targeting High Pro\ufb01le Networks in Central Asia - Avast Threat LabsThroughout our analysis, we stumbled upon the following backdoors. Details on these backdoors C&C server 104.194.215[.]194pcaudit.bat1395B863AE5697EA5096F4E2EBEF54FC20D5380B6921F8835D1F030F2BA16A40Technical details (pcaudit.bat) pcaudit.bat is a batch \ufb01le that is used to invoke the svchost.exe in order to load the DLL \ufb01le for a given service speci\ufb01ed in the registry. This batch \ufb01le is responsible for the backdoor\u2019s persistence. The contents of the pcaudit.bat script can be found below:Figure 2: The batch \ufb01le that is responsible for the backdoor\u2019s persistenceTechnical details (sqllauncher.dll, logon.dll) Both DLLs, sqllauncher.dll and logon.dll, are primarily used as backdoors. These are installed as services by the aforementioned batch \ufb01le. They both create a log \ufb01le under the path: %COMMON_DOCUMENT%\\WZ9JuN00.tmp aggregating errors during the backdoor\u2019s runtime. Each entry contains an error code, an error message, and a timestamp formatted as \u201c[yyyy-mm- dd hh-mm-ss] %error code% %message%\u201d.If the infected device can\u2019t connect to the C&C server, the malware attempts to determine whether the traf\ufb01c is routed through a proxy. This information may be retrieved either from %WINDOWS%\\debug\\netlogon.cfg or from the TCP table. After successfully connecting to theurl\ufb01le-networks-in-central-asia/3/95/15/2020APT Group Planted Backdoors Targeting High Pro\ufb01le Networks in Central Asia - Avast Threat LabsC&C server, a secure communication channel (Schannel) is established and telemetry (OS version, username) is sent to the C&C server. The following commands are issued by the C&C WELCOMLIST DSTARTCUPLOADDOWNLOEXECUTSend malware version to the C&C Send all used drive let\u2010 ters to the C&C Start remote shell Execute \u201ccmd %com\u2010 mand%\u201d via CreatePro\u2010 cess API Read from %path% and send data to C&C Write %data% into via CreateProcess APICom\u2010 %command%J8AoctiB QHb\u2010 %command%Technical details (logsupport.dll) Similarly to the previous DLLs, the logsupport.dll is primarily used as a backdoor, but uses a different C&C server than the other backdoors. Its corresponding log \ufb01le is located at %TEMP%\\rar%[A-Z0-9]{4}%.tmp. The structure of the log \ufb01le is also the same. The main difference is that the log \ufb01le is encrypted by a XOR cipher with a hardcoded key.url\ufb01le-networks-in-central-asia/4/95/15/2020APT Group Planted Backdoors Targeting High Pro\ufb01le Networks in Central Asia - Avast Threat LabsFigure 3: Log \ufb01le is decrypted by a XOR cipher with a hardcoded keyThis backdoor checks whether the malware is running in a virtualized environment. Additionally, the DLL \ufb01ngerprints the infected device (NETBIOS name, IP address, username, OS version, MAC address and RAM usage, OEM code page, token information, number of CPU cores, is64bit), and sends this information to the C&C server.The communication with the C&C server is encrypted by a simple stream cipher. If the malware fails to establish an encrypted channel, it checks whether a proxy is being used, using different methods than the previous two DLLs. It tries to connect to url and retrieve information about a possible proxy from the connection, and it also checks the value of ProxyServer in the Windows registry key:HKLM\\Software\\Microsft\\Windows\\CurrentVersion\\Internet Settings.Based on what we saw in the code, the backdoor is also capable of accepting various commands from the C&C server. These commands allow the backdoor to manipulate \ufb01les (move, read, delete, check existence), manipulate processes (create, terminate, retrieve parent, and process ID) and Windows services (start, stop, check), execute console commands, remove itself, and more. Some of these commands (read/check \ufb01le, check services, check processes) also send data back to C&C. The infected device can also be commanded by C&C to act as a proxy or listen on a speci\ufb01c port on every network interface.Interestingly, the backdoor has a set of commands speci\ufb01cally targeting \ufb01les with .tu and .tut \ufb01le extension. These commands may similarly check for their existence, send their content back to the C&C, and modify their content (append or rewrite by data given by the C&C server). started in 2007. It is a robust tool that exploits various Windows authentication schemes and dumps credential-related data from a Windows Local Security Account database. For these reasons it is often misused by a wide spectrum of APT actors such as the Lazarus Group or Telebots.The Mimikatz version used in this campaign has a two-stage installation mechanism (installer.exe installing Yokel64.exe and mktz64.dll), and contains a PDB string \u201cE:\\2018_\\MimHash\\mimikatz\\Bin\\mktzx64.pdb\u201d. Calling a mktz64.dll exported function MktzDumpbyInjection inside our testing virtual machine yields the following output:#1 domain = MSEDGEWIN10, user = Administrator ,nthash=FC525C9683E8FE067095BA2DDC971889 #2 domain = MSEDGEWIN10, user = IEUser , uses the following format: \u201c@@<ComputerName>,<UserName>,<Password>,.exe\u201d. Afterwards, the data described in the \ufb01lename is extracted and used to establish a remote console to a computer identi\ufb01ed by the retrieved name. Afterwards, Windows Management Instrumentation (WMI) is leveraged to set a strict proxy security, leading to the encryption of arguments of each remote procedure call, and allowing the server to access local resources. Then WMI is used again to retrieve the Win32_Process class which in turn is used to create a process with given parameters. At the end, it terminates itself. Gh0st RAT is commonly assumed that its source code is widely available. Its presence is often indicated by a \ufb01le named rastls.dll, using an export DLL name svchost.dll and containing a string Gh0st. A string uwqixgze} is used as a placeholder for the C&C domain.The version we\u2019ve seen in this campaign tries to connect to url\ufb01le-networks-in-central-asia/6/95/15/2020APT Group Planted Backdoors Targeting High Pro\ufb01le Networks in Central Asia - Avast Threat LabsFigure 4: Gh0st RAT malwareCode Similarities While analyzing one of the \ufb01les, we noticed that it has several correlations to the Microcin sample from 2017, the BYEBY sample from 2017, and Vicious Panda: The COVID campaign from 2020. Figure 5 below provides a comparison of the decryption loop used to decrypt the main con\ufb01guration data of the \ufb01rst backdoor.Figure 5: Part of code used to decipher the main con\ufb01guration dataurl\ufb01le-networks-in-central-asia/7/95/15/2020APT Group Planted Backdoors Targeting High Pro\ufb01le Networks in Central Asia - Avast Threat LabsSHA256Name of \ufb01le irmon.dll 170008187EBCEF183E792513608B82572FAF0AAEB33212BFA44736439453218F Avast reported its \ufb01ndings to the local CERT team and reached out to the telecommunications company. We have not heard back from either organization.Avast has recently protected users in Central Asia from further attacks using the samples we analyzed. This, along with tying elements of the samples we discovered back to attacks carried out on other countries, makes me assume the group is still active.I would like to thank Peter Kalnai from ESET for working with me on the analysis, Luk\u00e1\u0161 Obrdl\u00edk, and Adolf St\u0159eda from Avast for helping me with this research, as well as Alexey Shulmin from Kaspersky for his support. Indicators of Compromise (IoC)Repository: url List of SHA-256: url Vasily Berdnikov, Dmitry Karasovsky, Alexey Shulmin: \u201cMicrocin malware\u201d, Kaspersky Labs 2017- 9-25 url content/uploads/sites/43/2018/03/07170759/Microcin_Technical_4PDF_eng_\ufb01nal_s.pdfJosh Grunzweig, Robert Falcone: \u201cThreat Actors Target Government of Belarus Using CMSTAR Trojan\u201d, Palo Alto Networks, September 2017, url actors-target-government-belarus-using-cmstar-trojan/Checkpoint Research: \u201cVicious Panda: The COVID Campaign\u201d, 2020-03-12 url Threat Intelligence url\ufb01le-networks-in-central-asia/8/95/15/2020APT Group Planted Backdoors Targeting High Pro\ufb01le Networks in Central Asia - Avast Threat LabsESET Threat Intelligence url Mahjoub, Jeremiah O\u2019Connor, Thibault Reuille, Thomas Mathew: \u201cPhishing, Spiking, and Bad Hosting\u201d, Cisco Umbrella Blog, 2015-09-14url\ufb01le-networks-in-central-asia/9/9 ",
        "summary": "The document describes an advanced persistent threat (APT) campaign targeting high-profile companies in Central Asia that was analyzed by Avast and ESET. The attackers planted backdoors to gain long-term access to corporate networks. The threat actors frequently recompiled their custom malware tools to avoid detection. The tools included backdoors, Mimikatz, and Gh0st RAT. Many samples were protected by VMProtect obfuscation. The backdoors gave the attackers capabilities to manipulate files, take screenshots, manipulate processes and services, execute commands, proxy network traffic, exfiltrate data, and more. Lateral movement within compromised networks was achieved using Mimikatz credential theft and Windows Management Instrumentation (WMI). Attribution points to an APT group possibly from China, based on code similarities with past campaigns like Vicious Panda, the use of Gh0st RAT, and the professional coding techniques. Most command and control servers were registered with Choopa LLC hosting. Avast and ESET detected and blocked the malware before this campaign was fully analyzed. The threat actors are suspected to still be active, as similar attacks were seen targeting Central Asia recently. ",
        "gpt3_gen_texts": [
            "A Chinese APT group is suspected of planting backdoors in the networks of high-profile companies and institutions in Central Asia, according to Avast Threat Labs. The group's custom tools, which included Mimikatz and Gh0st RAT, were frequently recompiled to avoid detection, leading to a large number of samples and making analysis more difficult. The backdoors allowed the attackers to manipulate and delete files, take screenshots, execute console commands and exfiltrate data to a command and control server. The majority of the servers were registered with Choopa, LLC, which has previously been used by cybercriminals."
        ],
        "metrics":R1:48.15, R2:19.40, RL:29.63, BERT scores:89.52
    }
]






